<!doctype html>
<html class="">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<meta name="description" content="We’re on a journey to advance and democratize artificial intelligence through open source and open science." />
		<meta property="fb:app_id" content="1321688464574422" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@huggingface" />
		<meta name="twitter:image" content="https://cdn-thumbnails.huggingface.co/social-thumbnails/datasets/waybarrios/github-code-dataset.png" />
		<meta property="og:title" content="waybarrios/github-code-dataset · Datasets at Hugging Face" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://huggingface.co/datasets/waybarrios/github-code-dataset" />
		<meta property="og:image" content="https://cdn-thumbnails.huggingface.co/social-thumbnails/datasets/waybarrios/github-code-dataset.png" />

		<link rel="stylesheet" href="/front/build/kube-68d7aa0/style.css" />

		<link rel="preconnect" href="https://fonts.gstatic.com" />
		<link
			href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&display=swap"
			rel="stylesheet"
		/>

		<link
			rel="preload"
			href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css"
			as="style"
			onload="this.onload=null;this.rel='stylesheet'"
		/>
		<noscript>
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" />
		</noscript>

		<script>const guestTheme = document.cookie.match(/theme=(\w+)/)?.[1]; document.documentElement.classList.toggle('dark', guestTheme === 'dark' || ( (!guestTheme || guestTheme === 'system') && window.matchMedia('(prefers-color-scheme: dark)').matches));</script>
<link rel="canonical" href="https://huggingface.co/datasets/waybarrios/github-code-dataset"> <script type="application/ld+json">{
  "@context": {
    "@language": "en",
    "@vocab": "https:\/\/schema.org\/",
    "citeAs": "cr:citeAs",
    "column": "cr:column",
    "conformsTo": "dct:conformsTo",
    "cr": "http:\/\/mlcommons.org\/croissant\/",
    "data": {
      "@id": "cr:data",
      "@type": "@json"
    },
    "dataBiases": "cr:dataBiases",
    "dataCollection": "cr:dataCollection",
    "dataType": {
      "@id": "cr:dataType",
      "@type": "@vocab"
    },
    "dct": "http:\/\/purl.org\/dc\/terms\/",
    "extract": "cr:extract",
    "field": "cr:field",
    "fileProperty": "cr:fileProperty",
    "fileObject": "cr:fileObject",
    "fileSet": "cr:fileSet",
    "format": "cr:format",
    "includes": "cr:includes",
    "isLiveDataset": "cr:isLiveDataset",
    "jsonPath": "cr:jsonPath",
    "key": "cr:key",
    "md5": "cr:md5",
    "parentField": "cr:parentField",
    "path": "cr:path",
    "personalSensitiveInformation": "cr:personalSensitiveInformation",
    "recordSet": "cr:recordSet",
    "references": "cr:references",
    "regex": "cr:regex",
    "repeated": "cr:repeated",
    "replace": "cr:replace",
    "sc": "https:\/\/schema.org\/",
    "separator": "cr:separator",
    "source": "cr:source",
    "subField": "cr:subField",
    "transform": "cr:transform"
  },
  "@type": "sc:Dataset",
  "distribution": [
    {
      "@type": "cr:FileObject",
      "@id": "repo",
      "name": "repo",
      "description": "The Hugging Face git repository.",
      "contentUrl": "https:\/\/huggingface.co\/datasets\/waybarrios\/github-code-dataset\/tree\/refs%2Fconvert%2Fparquet",
      "encodingFormat": "git+https",
      "sha256": "https:\/\/github.com\/mlcommons\/croissant\/issues\/80"
    },
    {
      "@type": "cr:FileSet",
      "@id": "parquet-files-for-config-default",
      "name": "parquet-files-for-config-default",
      "description": "The underlying Parquet files as converted by Hugging Face (see: https:\/\/huggingface.co\/docs\/dataset-viewer\/parquet).",
      "containedIn": {
        "@id": "repo"
      },
      "encodingFormat": "application\/x-parquet",
      "includes": "default\/*\/*.parquet"
    }
  ],
  "recordSet": [
    {
      "@type": "cr:RecordSet",
      "dataType": "cr:Split",
      "key": {
        "@id": "default_splits\/split_name"
      },
      "@id": "default_splits",
      "name": "default_splits",
      "description": "Splits for the default config.",
      "field": [
        {
          "@type": "cr:Field",
          "@id": "default_splits\/split_name",
          "name": "split_name",
          "description": "The name of the split.",
          "dataType": "sc:Text"
        }
      ],
      "data": [
        {
          "default_splits\/split_name": "train"
        }
      ]
    },
    {
      "@type": "cr:RecordSet",
      "@id": "default",
      "name": "default",
      "description": "waybarrios\/github-code-dataset - 'default' subset",
      "field": [
        {
          "@type": "cr:Field",
          "@id": "default\/split",
          "name": "default\/split",
          "description": "Split to which the example belongs to.",
          "dataType": "sc:Text",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "fileProperty": "fullpath"
            },
            "transform": {
              "regex": "default\/(?:partial-)?(train)\/.+parquet$"
            }
          },
          "references": {
            "field": {
              "@id": "default_splits\/split_name"
            }
          }
        },
        {
          "@type": "cr:Field",
          "@id": "default\/path",
          "name": "default\/path",
          "description": "Column 'path' from the Hugging Face parquet file.",
          "dataType": "sc:Text",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "column": "path"
            }
          }
        },
        {
          "@type": "cr:Field",
          "@id": "default\/content",
          "name": "default\/content",
          "description": "Column 'content' from the Hugging Face parquet file.",
          "dataType": "sc:Text",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "column": "content"
            }
          }
        },
        {
          "@type": "cr:Field",
          "@id": "default\/size",
          "name": "default\/size",
          "description": "Column 'size' from the Hugging Face parquet file.",
          "dataType": "sc:Integer",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "column": "size"
            }
          }
        },
        {
          "@type": "cr:Field",
          "@id": "default\/max_lines",
          "name": "default\/max_lines",
          "description": "Column 'max_lines' from the Hugging Face parquet file.",
          "dataType": "sc:Integer",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "column": "max_lines"
            }
          }
        },
        {
          "@type": "cr:Field",
          "@id": "default\/repo_name",
          "name": "default\/repo_name",
          "description": "Column 'repo_name' from the Hugging Face parquet file.",
          "dataType": "sc:Text",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "column": "repo_name"
            }
          }
        },
        {
          "@type": "cr:Field",
          "@id": "default\/autogenerated",
          "name": "default\/autogenerated",
          "description": "Column 'autogenerated' from the Hugging Face parquet file.",
          "dataType": "sc:Boolean",
          "source": {
            "fileSet": {
              "@id": "parquet-files-for-config-default"
            },
            "extract": {
              "column": "autogenerated"
            }
          }
        }
      ]
    }
  ],
  "conformsTo": "http:\/\/mlcommons.org\/croissant\/1.0",
  "name": "github-code-dataset",
  "description": "\n\t\n\t\t\n\t\n\t\n\t\tDataset Card for \"github-code-dataset\"\n\t\n\nMore Information needed\n",
  "alternateName": [
    "waybarrios\/github-code-dataset"
  ],
  "creator": {
    "@type": "Person",
    "name": "Wayner Barrios",
    "url": "https:\/\/huggingface.co\/waybarrios"
  },
  "keywords": [
    "10K - 100K",
    "parquet",
    "Tabular",
    "Text",
    "Datasets",
    "pandas",
    "Croissant",
    "Polars",
    "🇺🇸 Region: US"
  ],
  "url": "https:\/\/huggingface.co\/datasets\/waybarrios\/github-code-dataset"
}</script> 

		<title>waybarrios/github-code-dataset · Datasets at Hugging Face</title>

		<script
			defer
			data-domain="huggingface.co"
			event-loggedIn="false"
			src="/js/script.pageview-props.js"
		></script>
		<script>
			window.plausible =
				window.plausible ||
				function () {
					(window.plausible.q = window.plausible.q || []).push(arguments);
				};
		</script>
		<script>
			window.hubConfig = {"features":{"signupDisabled":false},"sshGitUrl":"git@hf.co","moonHttpUrl":"https:\/\/huggingface.co","captchaApiKey":"bd5f2066-93dc-4bdd-a64b-a24646ca3859","captchaDisabledOnSignup":true,"datasetViewerPublicUrl":"https:\/\/datasets-server.huggingface.co","stripePublicKey":"pk_live_x2tdjFXBCvXo2FFmMybezpeM00J6gPCAAc","environment":"production","userAgent":"HuggingFace (production)","spacesIframeDomain":"hf.space","spacesApiUrl":"https:\/\/api.hf.space","docSearchKey":"ece5e02e57300e17d152c08056145326e90c4bff3dd07d7d1ae40cf1c8d39cb6","logoDev":{"apiUrl":"https:\/\/img.logo.dev\/","apiKey":"pk_UHS2HZOeRnaSOdDp7jbd5w"}};
		</script>
		<script type="text/javascript" src="https://de5282c3ca0c.edge.sdk.awswaf.com/de5282c3ca0c/526cf06acb0d/challenge.js" defer></script>
	</head>
	<body class="flex flex-col min-h-dvh bg-white dark:bg-gray-950 text-black DatasetPage">
		<div class="flex min-h-dvh flex-col"><div class="SVELTE_HYDRATER contents" data-target="SystemThemeMonitor" data-props="{&quot;isLoggedIn&quot;:false}"></div>

	<div class="SVELTE_HYDRATER contents" data-target="MainHeader" data-props="{&quot;classNames&quot;:&quot;&quot;,&quot;isWide&quot;:false,&quot;isZh&quot;:false,&quot;isPro&quot;:false}"><header class="border-b border-gray-100 "><div class="w-full px-4 container flex h-16 items-center"><div class="flex flex-1 items-center"><a class="mr-5 flex flex-none items-center lg:mr-6" href="/"><img alt="Hugging Face's logo" class="w-7 md:mr-2" src="/front/assets/huggingface_logo-noborder.svg">
				<span class="hidden whitespace-nowrap text-lg font-bold md:block">Hugging Face</span></a>
			<div class="relative flex-1 lg:max-w-sm mr-2 sm:mr-4 md:mr-3 xl:mr-6"><input autocomplete="off" class="w-full dark:bg-gray-950 pl-8 form-input-alt h-9 pr-3 focus:shadow-xl " name="" placeholder="Search models, datasets, users..."   spellcheck="false" type="text" value="">
	<svg class="absolute left-2.5 text-gray-400 top-1/2 transform -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M30 28.59L22.45 21A11 11 0 1 0 21 22.45L28.59 30zM5 14a9 9 0 1 1 9 9a9 9 0 0 1-9-9z" fill="currentColor"></path></svg>
	</div>
			<div class="flex flex-none items-center justify-center p-0.5 place-self-stretch lg:hidden"><button class="relative z-40 flex h-6 w-8 items-center justify-center" type="button"><svg width="1em" height="1em" viewBox="0 0 10 10" class="text-xl" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" preserveAspectRatio="xMidYMid meet" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.65039 2.9999C1.65039 2.8066 1.80709 2.6499 2.00039 2.6499H8.00039C8.19369 2.6499 8.35039 2.8066 8.35039 2.9999C8.35039 3.1932 8.19369 3.3499 8.00039 3.3499H2.00039C1.80709 3.3499 1.65039 3.1932 1.65039 2.9999ZM1.65039 4.9999C1.65039 4.8066 1.80709 4.6499 2.00039 4.6499H8.00039C8.19369 4.6499 8.35039 4.8066 8.35039 4.9999C8.35039 5.1932 8.19369 5.3499 8.00039 5.3499H2.00039C1.80709 5.3499 1.65039 5.1932 1.65039 4.9999ZM2.00039 6.6499C1.80709 6.6499 1.65039 6.8066 1.65039 6.9999C1.65039 7.1932 1.80709 7.3499 2.00039 7.3499H8.00039C8.19369 7.3499 8.35039 7.1932 8.35039 6.9999C8.35039 6.8066 8.19369 6.6499 8.00039 6.6499H2.00039Z"></path></svg>
		</button>

	</div></div>
		<nav aria-label="Main" class="ml-auto hidden lg:block"><ul class="flex items-center space-x-1.5 2xl:space-x-2"><li class="hover:text-indigo-700"><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/models"><svg class="mr-1.5 text-gray-400 group-hover:text-indigo-500" style="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path class="uim-quaternary" d="M20.23 7.24L12 12L3.77 7.24a1.98 1.98 0 0 1 .7-.71L11 2.76c.62-.35 1.38-.35 2 0l6.53 3.77c.29.173.531.418.7.71z" opacity=".25" fill="currentColor"></path><path class="uim-tertiary" d="M12 12v9.5a2.09 2.09 0 0 1-.91-.21L4.5 17.48a2.003 2.003 0 0 1-1-1.73v-7.5a2.06 2.06 0 0 1 .27-1.01L12 12z" opacity=".5" fill="currentColor"></path><path class="uim-primary" d="M20.5 8.25v7.5a2.003 2.003 0 0 1-1 1.73l-6.62 3.82c-.275.13-.576.198-.88.2V12l8.23-4.76c.175.308.268.656.27 1.01z" fill="currentColor"></path></svg>
					Models</a>
			</li><li class="hover:text-red-700"><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/datasets"><svg class="mr-1.5 text-gray-400 group-hover:text-red-500" style="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 25 25"><ellipse cx="12.5" cy="5" fill="currentColor" fill-opacity="0.25" rx="7.5" ry="2"></ellipse><path d="M12.5 15C16.6421 15 20 14.1046 20 13V20C20 21.1046 16.6421 22 12.5 22C8.35786 22 5 21.1046 5 20V13C5 14.1046 8.35786 15 12.5 15Z" fill="currentColor" opacity="0.5"></path><path d="M12.5 7C16.6421 7 20 6.10457 20 5V11.5C20 12.6046 16.6421 13.5 12.5 13.5C8.35786 13.5 5 12.6046 5 11.5V5C5 6.10457 8.35786 7 12.5 7Z" fill="currentColor" opacity="0.5"></path><path d="M5.23628 12C5.08204 12.1598 5 12.8273 5 13C5 14.1046 8.35786 15 12.5 15C16.6421 15 20 14.1046 20 13C20 12.8273 19.918 12.1598 19.7637 12C18.9311 12.8626 15.9947 13.5 12.5 13.5C9.0053 13.5 6.06886 12.8626 5.23628 12Z" fill="currentColor"></path></svg>
					Datasets</a>
			</li><li class="hover:text-blue-700"><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/spaces"><svg class="mr-1.5 text-gray-400 group-hover:text-blue-500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" viewBox="0 0 25 25"><path opacity=".5" d="M6.016 14.674v4.31h4.31v-4.31h-4.31ZM14.674 14.674v4.31h4.31v-4.31h-4.31ZM6.016 6.016v4.31h4.31v-4.31h-4.31Z" fill="currentColor"></path><path opacity=".75" fill-rule="evenodd" clip-rule="evenodd" d="M3 4.914C3 3.857 3.857 3 4.914 3h6.514c.884 0 1.628.6 1.848 1.414a5.171 5.171 0 0 1 7.31 7.31c.815.22 1.414.964 1.414 1.848v6.514A1.914 1.914 0 0 1 20.086 22H4.914A1.914 1.914 0 0 1 3 20.086V4.914Zm3.016 1.102v4.31h4.31v-4.31h-4.31Zm0 12.968v-4.31h4.31v4.31h-4.31Zm8.658 0v-4.31h4.31v4.31h-4.31Zm0-10.813a2.155 2.155 0 1 1 4.31 0 2.155 2.155 0 0 1-4.31 0Z" fill="currentColor"></path><path opacity=".25" d="M16.829 6.016a2.155 2.155 0 1 0 0 4.31 2.155 2.155 0 0 0 0-4.31Z" fill="currentColor"></path></svg>
					Spaces</a>
			</li><li class="hover:text-yellow-700 max-xl:hidden"><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/posts"><svg class="mr-1.5 text-gray-400 group-hover:text-yellow-500 text-yellow-500!" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" viewBox="0 0 12 12" preserveAspectRatio="xMidYMid meet"><path fill="currentColor" fill-rule="evenodd" d="M3.73 2.4A4.25 4.25 0 1 1 6 10.26H2.17l-.13-.02a.43.43 0 0 1-.3-.43l.01-.06a.43.43 0 0 1 .12-.22l.84-.84A4.26 4.26 0 0 1 3.73 2.4Z" clip-rule="evenodd"></path></svg>
					Posts</a>
			</li><li class="hover:text-yellow-700"><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/docs"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="mr-1.5 text-gray-400 group-hover:text-yellow-500" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><path d="m2.28 3.7-.3.16a.67.67 0 0 0-.34.58v8.73l.01.04.02.07.01.04.03.06.02.04.02.03.04.06.05.05.04.04.06.04.06.04.08.04.08.02h.05l.07.02h.11l.04-.01.07-.02.03-.01.07-.03.22-.12a5.33 5.33 0 0 1 5.15.1.67.67 0 0 0 .66 0 5.33 5.33 0 0 1 5.33 0 .67.67 0 0 0 1-.58V4.36a.67.67 0 0 0-.34-.5l-.3-.17v7.78a.63.63 0 0 1-.87.59 4.9 4.9 0 0 0-4.35.35l-.65.39a.29.29 0 0 1-.15.04.29.29 0 0 1-.16-.04l-.65-.4a4.9 4.9 0 0 0-4.34-.34.63.63 0 0 1-.87-.59V3.7Z" fill="currentColor" class="dark:opacity-40"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 3.1a5.99 5.99 0 0 0-5.3-.43.66.66 0 0 0-.42.62v8.18c0 .45.46.76.87.59a4.9 4.9 0 0 1 4.34.35l.65.39c.05.03.1.04.16.04.05 0 .1-.01.15-.04l.65-.4a4.9 4.9 0 0 1 4.35-.34.63.63 0 0 0 .86-.59V3.3a.67.67 0 0 0-.41-.62 5.99 5.99 0 0 0-5.3.43l-.3.17L8 3.1Zm.73 1.87a.43.43 0 1 0-.86 0v5.48a.43.43 0 0 0 .86 0V4.97Z" fill="currentColor" class="opacity-40 dark:opacity-100"></path><path d="M8.73 4.97a.43.43 0 1 0-.86 0v5.48a.43.43 0 1 0 .86 0V4.96Z" fill="currentColor" class="dark:opacity-40"></path></svg>
					Docs</a>
			</li><li class="hover:text-black dark:hover:text-white"><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/enterprise"><svg class="mr-1.5 text-gray-400 group-hover:text-black dark:group-hover:text-white" xmlns="http://www.w3.org/2000/svg" fill="none" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 33 27"><path fill="currentColor" fill-rule="evenodd" d="M13.5.7a8.7 8.7 0 0 0-7.7 5.7L1 20.6c-1 3.1.9 5.7 4.1 5.7h15c3.3 0 6.8-2.6 7.8-5.7l4.6-14.2c1-3.1-.8-5.7-4-5.7h-15Zm1.1 5.7L9.8 20.3h9.8l1-3.1h-5.8l.8-2.5h4.8l1.1-3h-4.8l.8-2.3H23l1-3h-9.5Z" clip-rule="evenodd"></path></svg>
					Enterprise</a>
			</li>

		<li><a class="group flex items-center px-2 py-0.5 dark:text-gray-300 dark:hover:text-gray-100" href="/pricing">Pricing
			</a></li>

		<li><div class="relative group">
	<button class="px-2 py-0.5 hover:text-gray-500 dark:hover:text-gray-600 flex items-center " type="button">
		<svg class=" text-gray-500 w-5 group-hover:text-gray-400 dark:text-gray-300 dark:group-hover:text-gray-100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" viewBox="0 0 32 18" preserveAspectRatio="xMidYMid meet"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.4504 3.30221C14.4504 2.836 14.8284 2.45807 15.2946 2.45807H28.4933C28.9595 2.45807 29.3374 2.836 29.3374 3.30221C29.3374 3.76842 28.9595 4.14635 28.4933 4.14635H15.2946C14.8284 4.14635 14.4504 3.76842 14.4504 3.30221Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M14.4504 9.00002C14.4504 8.53382 14.8284 8.15588 15.2946 8.15588H28.4933C28.9595 8.15588 29.3374 8.53382 29.3374 9.00002C29.3374 9.46623 28.9595 9.84417 28.4933 9.84417H15.2946C14.8284 9.84417 14.4504 9.46623 14.4504 9.00002Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M14.4504 14.6978C14.4504 14.2316 14.8284 13.8537 15.2946 13.8537H28.4933C28.9595 13.8537 29.3374 14.2316 29.3374 14.6978C29.3374 15.164 28.9595 15.542 28.4933 15.542H15.2946C14.8284 15.542 14.4504 15.164 14.4504 14.6978Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1.94549 6.87377C2.27514 6.54411 2.80962 6.54411 3.13928 6.87377L6.23458 9.96907L9.32988 6.87377C9.65954 6.54411 10.194 6.54411 10.5237 6.87377C10.8533 7.20343 10.8533 7.73791 10.5237 8.06756L6.23458 12.3567L1.94549 8.06756C1.61583 7.73791 1.61583 7.20343 1.94549 6.87377Z" fill="currentColor"></path></svg>
			
		</button>
	
	
	</div></li>
		<li><hr class="h-5 w-0.5 border-none bg-gray-100 dark:bg-gray-800"></li>
		<li><a class="block cursor-pointer whitespace-nowrap px-2 py-0.5 hover:text-gray-500 dark:text-gray-300 dark:hover:text-gray-100" href="/login">Log In
				</a></li>
			<li><a class="whitespace-nowrap rounded-full border border-transparent bg-gray-900 px-3 py-1 leading-none text-white hover:border-black hover:bg-white hover:text-black" href="/join">Sign Up
					</a></li></ul></nav></div></header></div>
	
	
	
	<div class="SVELTE_HYDRATER contents" data-target="SSOBanner" data-props="{}"></div>
	
	

	<main class="flex flex-1 flex-col">
	<div class="SVELTE_HYDRATER contents" data-target="DatasetHeader" data-props="{&quot;activeTab&quot;:&quot;datasetCard&quot;,&quot;author&quot;:{&quot;_id&quot;:&quot;6428793f53b748123d4d793b&quot;,&quot;avatarUrl&quot;:&quot;/avatars/5bf9d1ade981ab50dd488cc01a44b6e6.svg&quot;,&quot;fullname&quot;:&quot;Wayner Barrios&quot;,&quot;name&quot;:&quot;waybarrios&quot;,&quot;type&quot;:&quot;user&quot;,&quot;isPro&quot;:false,&quot;isHf&quot;:false,&quot;isHfAdmin&quot;:false,&quot;isMod&quot;:false},&quot;canReadRepoSettings&quot;:false,&quot;dataset&quot;:{&quot;author&quot;:&quot;waybarrios&quot;,&quot;cardData&quot;:{&quot;dataset_info&quot;:{&quot;features&quot;:[{&quot;name&quot;:&quot;path&quot;,&quot;dtype&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;content&quot;,&quot;dtype&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;size&quot;,&quot;dtype&quot;:&quot;int64&quot;},{&quot;name&quot;:&quot;max_lines&quot;,&quot;dtype&quot;:&quot;int64&quot;},{&quot;name&quot;:&quot;repo_name&quot;,&quot;dtype&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;autogenerated&quot;,&quot;dtype&quot;:&quot;bool&quot;}],&quot;splits&quot;:[{&quot;name&quot;:&quot;train&quot;,&quot;num_bytes&quot;:152825770,&quot;num_examples&quot;:18912}],&quot;download_size&quot;:57591057,&quot;dataset_size&quot;:152825770}},&quot;cardExists&quot;:true,&quot;createdAt&quot;:&quot;2023-06-05T02:08:12.000Z&quot;,&quot;description&quot;:&quot;\n\t\n\t\t\n\t\n\t\n\t\tDataset Card for \&quot;github-code-dataset\&quot;\n\t\n\nMore Information needed\n&quot;,&quot;downloads&quot;:61,&quot;downloadsAllTime&quot;:321,&quot;id&quot;:&quot;waybarrios/github-code-dataset&quot;,&quot;isLikedByUser&quot;:false,&quot;lastModified&quot;:&quot;2023-06-05T02:56:30.000Z&quot;,&quot;likes&quot;:1,&quot;datasetsServerInfo&quot;:{&quot;viewer&quot;:&quot;viewer&quot;,&quot;numRows&quot;:18912,&quot;libraries&quot;:[&quot;datasets&quot;,&quot;pandas&quot;,&quot;mlcroissant&quot;,&quot;polars&quot;],&quot;formats&quot;:[&quot;parquet&quot;],&quot;modalities&quot;:[&quot;tabular&quot;,&quot;text&quot;]},&quot;discussionsDisabled&quot;:false,&quot;repoType&quot;:&quot;dataset&quot;,&quot;private&quot;:false,&quot;gated&quot;:false,&quot;tags&quot;:[&quot;size_categories:10K<n<100K&quot;,&quot;format:parquet&quot;,&quot;modality:tabular&quot;,&quot;modality:text&quot;,&quot;library:datasets&quot;,&quot;library:pandas&quot;,&quot;library:mlcroissant&quot;,&quot;library:polars&quot;,&quot;region:us&quot;],&quot;tag_objs&quot;:[{&quot;id&quot;:&quot;size_categories:10K<n<100K&quot;,&quot;label&quot;:&quot;10K - 100K&quot;,&quot;type&quot;:&quot;size_categories&quot;},{&quot;id&quot;:&quot;format:parquet&quot;,&quot;label&quot;:&quot;parquet&quot;,&quot;type&quot;:&quot;format&quot;},{&quot;id&quot;:&quot;modality:tabular&quot;,&quot;label&quot;:&quot;Tabular&quot;,&quot;type&quot;:&quot;modality&quot;},{&quot;id&quot;:&quot;modality:text&quot;,&quot;label&quot;:&quot;Text&quot;,&quot;type&quot;:&quot;modality&quot;},{&quot;id&quot;:&quot;library:datasets&quot;,&quot;label&quot;:&quot;Datasets&quot;,&quot;type&quot;:&quot;library&quot;},{&quot;id&quot;:&quot;library:pandas&quot;,&quot;label&quot;:&quot;pandas&quot;,&quot;type&quot;:&quot;library&quot;},{&quot;id&quot;:&quot;library:mlcroissant&quot;,&quot;label&quot;:&quot;Croissant&quot;,&quot;type&quot;:&quot;library&quot;},{&quot;id&quot;:&quot;library:polars&quot;,&quot;label&quot;:&quot;Polars&quot;,&quot;type&quot;:&quot;library&quot;},{&quot;type&quot;:&quot;region&quot;,&quot;label&quot;:&quot;🇺🇸 Region: US&quot;,&quot;id&quot;:&quot;region:us&quot;}],&quot;hasBlockedOids&quot;:false,&quot;region&quot;:&quot;us&quot;,&quot;xetEnabled&quot;:false},&quot;discussionsStats&quot;:{&quot;closed&quot;:0,&quot;open&quot;:0,&quot;total&quot;:0}}"><header class="bg-linear-to-t border-b border-gray-100 pt-6 sm:pt-9 from-gray-50-to-white via-white dark:via-gray-950"><div class="container relative "><h1 class="flex flex-wrap items-center max-md:leading-tight mb-3 text-lg max-sm:gap-y-1.5 md:text-xl"><a href="/datasets" class="group flex items-center"><svg class="sm:mr-1.5 -mr-1 text-gray-400" style="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 25 25"><ellipse cx="12.5" cy="5" fill="currentColor" fill-opacity="0.25" rx="7.5" ry="2"></ellipse><path d="M12.5 15C16.6421 15 20 14.1046 20 13V20C20 21.1046 16.6421 22 12.5 22C8.35786 22 5 21.1046 5 20V13C5 14.1046 8.35786 15 12.5 15Z" fill="currentColor" opacity="0.5"></path><path d="M12.5 7C16.6421 7 20 6.10457 20 5V11.5C20 12.6046 16.6421 13.5 12.5 13.5C8.35786 13.5 5 12.6046 5 11.5V5C5 6.10457 8.35786 7 12.5 7Z" fill="currentColor" opacity="0.5"></path><path d="M5.23628 12C5.08204 12.1598 5 12.8273 5 13C5 14.1046 8.35786 15 12.5 15C16.6421 15 20 14.1046 20 13C20 12.8273 19.918 12.1598 19.7637 12C18.9311 12.8626 15.9947 13.5 12.5 13.5C9.0053 13.5 6.06886 12.8626 5.23628 12Z" fill="currentColor"></path></svg>
					<span class="mr-2.5 font-semibold text-gray-400 group-hover:text-gray-500 max-sm:hidden">Datasets:</span></a>
				<hr class="mx-1.5 h-2 translate-y-px rounded-sm border-r dark:border-gray-600 sm:hidden">
			<div class="group flex flex-none items-center"><div class="relative mr-1 flex items-center">

			

<span class="inline-block "><span class="contents"><a href="/waybarrios" class="text-gray-400 hover:text-blue-600"><img alt="" class="w-3.5 h-3.5 rounded-full  flex-none" src="/avatars/5bf9d1ade981ab50dd488cc01a44b6e6.svg" crossorigin="anonymous"></a></span>
	</span></div>
		

<span class="inline-block "><span class="contents"><a href="/waybarrios" class="text-gray-400 hover:text-blue-600">waybarrios</a></span>
	</span>
		<div class="mx-0.5 text-gray-300">/</div></div>

<div class="max-w-full "><a class="break-words font-mono font-semibold hover:text-blue-600 " href="/datasets/waybarrios/github-code-dataset">github-code-dataset</a>
	<button class="relative text-sm mr-4 focus:outline-hidden inline-flex cursor-pointer items-center text-sm  mx-0.5   text-gray-600 " title="Copy dataset name to clipboard" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	
	</button></div>
			<div class="inline-flex items-center overflow-hidden whitespace-nowrap rounded-md border bg-white text-sm leading-none text-gray-500  mr-2"><button class="relative flex items-center overflow-hidden from-red-50 to-transparent dark:from-red-900 px-1.5 py-1 hover:bg-linear-to-t focus:outline-hidden"  title="Like"><svg class="left-1.5 absolute" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" fill="currentColor"><path d="M22.45,6a5.47,5.47,0,0,1,3.91,1.64,5.7,5.7,0,0,1,0,8L16,26.13,5.64,15.64a5.7,5.7,0,0,1,0-8,5.48,5.48,0,0,1,7.82,0L16,10.24l2.53-2.58A5.44,5.44,0,0,1,22.45,6m0-2a7.47,7.47,0,0,0-5.34,2.24L16,7.36,14.89,6.24a7.49,7.49,0,0,0-10.68,0,7.72,7.72,0,0,0,0,10.82L16,29,27.79,17.06a7.72,7.72,0,0,0,0-10.82A7.49,7.49,0,0,0,22.45,4Z"></path></svg>

		
		<span class="ml-4 pl-0.5 ">like</span></button>
	<button class="focus:outline-hidden flex items-center border-l px-1.5 py-1 text-gray-400 hover:bg-gray-50 focus:bg-gray-100 dark:hover:bg-gray-900 dark:focus:bg-gray-800" title="See users who liked this repository">1</button></div>




			
			
	</h1>
		<div class="mb-3 flex flex-wrap md:mb-4"><div class="mr-1 flex flex-wrap items-center"><span class="mb-1 mr-1 p-1 text-sm leading-tight text-gray-400 md:mb-1.5">Modalities:
	</span>
	<a class="mb-1 mr-1 md:mb-1.5 md:mr-1.5 rounded-lg" href="/datasets?modality=modality%3Atabular"><div class="tag tag-white   ">
		<svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.619 4.619C2.667 6.572 2.667 9.715 2.667 16s0 9.43 1.952 11.38C6.572 29.333 9.715 29.333 16 29.333s9.43 0 11.38-1.953c1.953-1.952 1.953-5.095 1.953-11.38 0-6.285 0-9.427-1.953-11.381C25.428 2.667 22.285 2.667 16 2.667c-6.285 0-9.427 0-11.381 1.952ZM16.615 10a1 1 0 1 1 0 2h-1.23a1 1 0 1 1 0-2h1.23Zm0 5a1 1 0 1 1 0 2h-1.23a1 1 0 1 1 0-2h1.23Zm3.154 1a1 1 0 0 0 1 1H22a1 1 0 1 0 0-2h-1.23a1 1 0 0 0-1 1Zm-3.154 4a1 1 0 1 1 0 2h-1.23a1 1 0 1 1 0-2h1.23Zm3.154 1a1 1 0 0 0 1 1H22a1 1 0 1 0 0-2h-1.23a1 1 0 0 0-1 1Zm0-10a1 1 0 0 0 1 1H22a1 1 0 1 0 0-2h-1.23a1 1 0 0 0-1 1Zm-8.538-1H10a1 1 0 1 0 0 2h1.23a1 1 0 1 0 0-2Zm0 5H10a1 1 0 1 0 0 2h1.23a1 1 0 1 0 0-2Zm0 5H10a1 1 0 1 0 0 2h1.23a1 1 0 1 0 0-2Z" fill="currentColor"></path></svg>

	

	<span>Tabular</span>
	

	</div></a><a class="mb-1 mr-1 md:mb-1.5 md:mr-1.5 rounded-lg" href="/datasets?modality=modality%3Atext"><div class="tag tag-white   ">
		<svg class="text-red-700 dark:text-red-600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.619 4.619C2.667 6.573 2.667 9.715 2.667 16s0 9.428 1.952 11.38C6.573 29.333 9.715 29.333 16 29.333s9.428 0 11.38-1.953c1.953-1.95 1.953-5.095 1.953-11.38s0-9.428-1.953-11.381C25.43 2.667 22.285 2.667 16 2.667s-9.428 0-11.381 1.952m8.65 3.714c-.573 0-1.109 0-1.546.066-.495.073-1.003.248-1.41.7-.392.436-.53.956-.59 1.452-.056.464-.056 1.04-.056 1.689V13a1 1 0 1 0 2 0v-.704c0-.724.001-1.176.041-1.505q.015-.15.061-.294a.2.2 0 0 1 .031-.061q0-.003.016-.01a.8.8 0 0 1 .203-.05c.272-.04.654-.043 1.314-.043H15v11.334h-2.333a1 1 0 1 0 0 2H20a1 1 0 0 0 0-2h-3V10.333h1.667c.66 0 1.042.003 1.314.043.123.019.18.04.203.05l.015.009a.2.2 0 0 1 .032.061c.018.05.042.14.061.295.04.329.041.781.041 1.506V13a1 1 0 1 0 2 0v-.76c0-.65 0-1.225-.056-1.69-.06-.495-.198-1.015-.59-1.453-.407-.45-.915-.625-1.41-.698-.437-.067-.973-.067-1.546-.066z" fill="currentColor"></path></svg>

	

	<span>Text</span>
	

	</div></a>

	</div><div class="mr-1 flex flex-wrap items-center"><span class="mb-1 mr-1 p-1 text-sm leading-tight text-gray-400 md:mb-1.5">Formats:
	</span>
	<a class="mb-1 mr-1 md:mb-1.5 md:mr-1.5 rounded-lg" href="/datasets?format=format%3Aparquet"><div class="tag tag-white   ">
		<svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 34 34"><path fill-rule="evenodd" clip-rule="evenodd" d="m17.97 18.44-3.98-2.3-7.1 3.78 3.98 2.3 7.1-3.78Zm15.1-1.4-3.99-2.3-16.22 8.63 3.98 2.3 16.22-8.63Zm-5.98-3.45-3.97-2.3-7.1 3.78 3.98 2.3 7.1-3.78Zm-9.94-5.74 3.98 2.3-11.16 5.93L6 13.78l11.16-5.93Zm-13.19 7 3.98 2.3-3.04 1.62-3.98-2.3 3.04-1.61Z" fill="currentColor"></path></svg>

	

	<span>parquet</span>
	

	</div></a>

	</div><div class="mr-1 flex flex-wrap items-center"><span class="mb-1 mr-1 p-1 text-sm leading-tight text-gray-400 md:mb-1.5">Size:
	</span>
	<a class="mb-1 mr-1 md:mb-1.5 md:mr-1.5 rounded-lg" href="/datasets?size_categories=size_categories%3A10K%3Cn%3C100K"><div class="tag tag-white   ">

	

	<span>10K - 100K</span>
	

	</div></a>

	</div><div class="mr-1 flex flex-wrap items-center"><span class="mb-1 mr-1 p-1 text-sm leading-tight text-gray-400 md:mb-1.5">Libraries:
	</span>
	<a class="mb-1 mr-1 md:mb-1.5 md:mr-1.5 rounded-lg" href="/datasets?library=library%3Adatasets"><div class="tag tag-white   "><svg class="text-black inline-block text-sm" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" preserveAspectRatio="xMidYMid meet" width="1em" height="1em" viewBox="0 0 95 88"><path fill="#fff" d="M94.25 70.08a8.28 8.28 0 0 1-.43 6.46 10.57 10.57 0 0 1-3 3.6 25.18 25.18 0 0 1-5.7 3.2 65.74 65.74 0 0 1-7.56 2.65 46.67 46.67 0 0 1-11.42 1.68c-5.42.05-10.09-1.23-13.4-4.5a40.4 40.4 0 0 1-10.14.03c-3.34 3.25-7.99 4.52-13.39 4.47a46.82 46.82 0 0 1-11.43-1.68 66.37 66.37 0 0 1-7.55-2.65c-2.28-.98-4.17-2-5.68-3.2a10.5 10.5 0 0 1-3.02-3.6c-.99-2-1.18-4.3-.42-6.46a8.54 8.54 0 0 1-.33-5.63c.25-.95.66-1.83 1.18-2.61a8.67 8.67 0 0 1 2.1-8.47 8.23 8.23 0 0 1 2.82-2.07 41.75 41.75 0 1 1 81.3-.12 8.27 8.27 0 0 1 3.11 2.19 8.7 8.7 0 0 1 2.1 8.47c.52.78.93 1.66 1.18 2.61a8.61 8.61 0 0 1-.32 5.63Z"></path><path fill="#FFD21E" d="M47.21 76.5a34.75 34.75 0 1 0 0-69.5 34.75 34.75 0 0 0 0 69.5Z"></path><path fill="#FF9D0B" d="M81.96 41.75a34.75 34.75 0 1 0-69.5 0 34.75 34.75 0 0 0 69.5 0Zm-73.5 0a38.75 38.75 0 1 1 77.5 0 38.75 38.75 0 0 1-77.5 0Z"></path><path fill="#3A3B45" d="M58.5 32.3c1.28.44 1.78 3.06 3.07 2.38a5 5 0 1 0-6.76-2.07c.61 1.15 2.55-.72 3.7-.32ZM34.95 32.3c-1.28.44-1.79 3.06-3.07 2.38a5 5 0 1 1 6.76-2.07c-.61 1.15-2.56-.72-3.7-.32Z"></path><path fill="#FF323D" d="M46.96 56.29c9.83 0 13-8.76 13-13.26 0-2.34-1.57-1.6-4.09-.36-2.33 1.15-5.46 2.74-8.9 2.74-7.19 0-13-6.88-13-2.38s3.16 13.26 13 13.26Z"></path><path fill="#3A3B45" fill-rule="evenodd" d="M39.43 54a8.7 8.7 0 0 1 5.3-4.49c.4-.12.81.57 1.24 1.28.4.68.82 1.37 1.24 1.37.45 0 .9-.68 1.33-1.35.45-.7.89-1.38 1.32-1.25a8.61 8.61 0 0 1 5 4.17c3.73-2.94 5.1-7.74 5.1-10.7 0-2.34-1.57-1.6-4.09-.36l-.14.07c-2.31 1.15-5.39 2.67-8.77 2.67s-6.45-1.52-8.77-2.67c-2.6-1.29-4.23-2.1-4.23.29 0 3.05 1.46 8.06 5.47 10.97Z" clip-rule="evenodd"></path><path fill="#FF9D0B" d="M70.71 37a3.25 3.25 0 1 0 0-6.5 3.25 3.25 0 0 0 0 6.5ZM24.21 37a3.25 3.25 0 1 0 0-6.5 3.25 3.25 0 0 0 0 6.5ZM17.52 48c-1.62 0-3.06.66-4.07 1.87a5.97 5.97 0 0 0-1.33 3.76 7.1 7.1 0 0 0-1.94-.3c-1.55 0-2.95.59-3.94 1.66a5.8 5.8 0 0 0-.8 7 5.3 5.3 0 0 0-1.79 2.82c-.24.9-.48 2.8.8 4.74a5.22 5.22 0 0 0-.37 5.02c1.02 2.32 3.57 4.14 8.52 6.1 3.07 1.22 5.89 2 5.91 2.01a44.33 44.33 0 0 0 10.93 1.6c5.86 0 10.05-1.8 12.46-5.34 3.88-5.69 3.33-10.9-1.7-15.92-2.77-2.78-4.62-6.87-5-7.77-.78-2.66-2.84-5.62-6.25-5.62a5.7 5.7 0 0 0-4.6 2.46c-1-1.26-1.98-2.25-2.86-2.82A7.4 7.4 0 0 0 17.52 48Zm0 4c.51 0 1.14.22 1.82.65 2.14 1.36 6.25 8.43 7.76 11.18.5.92 1.37 1.31 2.14 1.31 1.55 0 2.75-1.53.15-3.48-3.92-2.93-2.55-7.72-.68-8.01.08-.02.17-.02.24-.02 1.7 0 2.45 2.93 2.45 2.93s2.2 5.52 5.98 9.3c3.77 3.77 3.97 6.8 1.22 10.83-1.88 2.75-5.47 3.58-9.16 3.58-3.81 0-7.73-.9-9.92-1.46-.11-.03-13.45-3.8-11.76-7 .28-.54.75-.76 1.34-.76 2.38 0 6.7 3.54 8.57 3.54.41 0 .7-.17.83-.6.79-2.85-12.06-4.05-10.98-8.17.2-.73.71-1.02 1.44-1.02 3.14 0 10.2 5.53 11.68 5.53.11 0 .2-.03.24-.1.74-1.2.33-2.04-4.9-5.2-5.21-3.16-8.88-5.06-6.8-7.33.24-.26.58-.38 1-.38 3.17 0 10.66 6.82 10.66 6.82s2.02 2.1 3.25 2.1c.28 0 .52-.1.68-.38.86-1.46-8.06-8.22-8.56-11.01-.34-1.9.24-2.85 1.31-2.85Z"></path><path fill="#FFD21E" d="M38.6 76.69c2.75-4.04 2.55-7.07-1.22-10.84-3.78-3.77-5.98-9.3-5.98-9.3s-.82-3.2-2.69-2.9c-1.87.3-3.24 5.08.68 8.01 3.91 2.93-.78 4.92-2.29 2.17-1.5-2.75-5.62-9.82-7.76-11.18-2.13-1.35-3.63-.6-3.13 2.2.5 2.79 9.43 9.55 8.56 11-.87 1.47-3.93-1.71-3.93-1.71s-9.57-8.71-11.66-6.44c-2.08 2.27 1.59 4.17 6.8 7.33 5.23 3.16 5.64 4 4.9 5.2-.75 1.2-12.28-8.53-13.36-4.4-1.08 4.11 11.77 5.3 10.98 8.15-.8 2.85-9.06-5.38-10.74-2.18-1.7 3.21 11.65 6.98 11.76 7.01 4.3 1.12 15.25 3.49 19.08-2.12Z"></path><path fill="#FF9D0B" d="M77.4 48c1.62 0 3.07.66 4.07 1.87a5.97 5.97 0 0 1 1.33 3.76 7.1 7.1 0 0 1 1.95-.3c1.55 0 2.95.59 3.94 1.66a5.8 5.8 0 0 1 .8 7 5.3 5.3 0 0 1 1.78 2.82c.24.9.48 2.8-.8 4.74a5.22 5.22 0 0 1 .37 5.02c-1.02 2.32-3.57 4.14-8.51 6.1-3.08 1.22-5.9 2-5.92 2.01a44.33 44.33 0 0 1-10.93 1.6c-5.86 0-10.05-1.8-12.46-5.34-3.88-5.69-3.33-10.9 1.7-15.92 2.78-2.78 4.63-6.87 5.01-7.77.78-2.66 2.83-5.62 6.24-5.62a5.7 5.7 0 0 1 4.6 2.46c1-1.26 1.98-2.25 2.87-2.82A7.4 7.4 0 0 1 77.4 48Zm0 4c-.51 0-1.13.22-1.82.65-2.13 1.36-6.25 8.43-7.76 11.18a2.43 2.43 0 0 1-2.14 1.31c-1.54 0-2.75-1.53-.14-3.48 3.91-2.93 2.54-7.72.67-8.01a1.54 1.54 0 0 0-.24-.02c-1.7 0-2.45 2.93-2.45 2.93s-2.2 5.52-5.97 9.3c-3.78 3.77-3.98 6.8-1.22 10.83 1.87 2.75 5.47 3.58 9.15 3.58 3.82 0 7.73-.9 9.93-1.46.1-.03 13.45-3.8 11.76-7-.29-.54-.75-.76-1.34-.76-2.38 0-6.71 3.54-8.57 3.54-.42 0-.71-.17-.83-.6-.8-2.85 12.05-4.05 10.97-8.17-.19-.73-.7-1.02-1.44-1.02-3.14 0-10.2 5.53-11.68 5.53-.1 0-.19-.03-.23-.1-.74-1.2-.34-2.04 4.88-5.2 5.23-3.16 8.9-5.06 6.8-7.33-.23-.26-.57-.38-.98-.38-3.18 0-10.67 6.82-10.67 6.82s-2.02 2.1-3.24 2.1a.74.74 0 0 1-.68-.38c-.87-1.46 8.05-8.22 8.55-11.01.34-1.9-.24-2.85-1.31-2.85Z"></path><path fill="#FFD21E" d="M56.33 76.69c-2.75-4.04-2.56-7.07 1.22-10.84 3.77-3.77 5.97-9.3 5.97-9.3s.82-3.2 2.7-2.9c1.86.3 3.23 5.08-.68 8.01-3.92 2.93.78 4.92 2.28 2.17 1.51-2.75 5.63-9.82 7.76-11.18 2.13-1.35 3.64-.6 3.13 2.2-.5 2.79-9.42 9.55-8.55 11 .86 1.47 3.92-1.71 3.92-1.71s9.58-8.71 11.66-6.44c2.08 2.27-1.58 4.17-6.8 7.33-5.23 3.16-5.63 4-4.9 5.2.75 1.2 12.28-8.53 13.36-4.4 1.08 4.11-11.76 5.3-10.97 8.15.8 2.85 9.05-5.38 10.74-2.18 1.69 3.21-11.65 6.98-11.76 7.01-4.31 1.12-15.26 3.49-19.08-2.12Z"></path></svg>

	

	<span>Datasets</span>
	

	</div></a><a class="mb-1 mr-1 md:mb-1.5 md:mr-1.5 rounded-lg" href="/datasets?library=library%3Apandas"><div class="tag tag-white   "><svg class="text-black inline-block text-sm text-[#130754] dark:text-gray-200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid slice" viewBox="0 0 210.21 280.43"><rect fill="currentColor" x="74.51" y="43.03" width="24.09" height="50.02"></rect><rect fill="currentColor" x="74.51" y="145.78" width="24.09" height="50.02"></rect><rect fill="#ffca00" x="74.51" y="107.65" width="24.09" height="23.6"></rect><rect fill="currentColor" x="35.81" y="84.15" width="24.09" height="166.27"></rect><rect fill="currentColor" x="112.41" y="187.05" width="24.09" height="50.02"></rect><rect fill="currentColor" x="112.41" y="84.21" width="24.09" height="50.02"></rect><rect fill="#e70488" x="112.41" y="148.84" width="24.09" height="23.6"></rect><rect fill="currentColor" x="150.3" y="30" width="24.09" height="166.27"></rect></svg>

	

	<span>pandas</span>
	

	</div></a><div class="relative inline-block ">
	<button class="group mr-1 mb-1 md:mr-1.5 md:mb-1.5  rounded-lg rounded-br-none " type="button">
		<div class="tag tag-white   relative rounded-br-none pr-2.5"><svg class="text-black inline-block text-sm" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="none" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M22.2812 12.2656L25.9532 15.7187C26.8932 16.6587 28.0913 17.3931 29.0313 16.4531C29.8594 15.7812 29.9332 14.1 29.9532 13.5C29.9532 11.5625 28.9219 8.375 27.25 6.71875C25.5604 5.04493 23.3782 3.91692 22.7032 3.78125L22.2812 12.2656Z" fill="#F5AB6A"></path><path d="M22.2812 12.2656L25.9532 15.7187C26.8932 16.6587 28.0913 17.3931 29.0313 16.4531C29.8594 15.7812 29.9332 14.1 29.9532 13.5C29.9532 11.5625 28.9219 8.375 27.25 6.71875C25.5604 5.04493 23.3782 3.91692 22.7032 3.78125L22.2812 12.2656Z" fill="url(#paint0_radial_18_31665)"></path><g filter="url(#filter0_f_18_31665)"><path d="M22.2849 12.1817L23.4375 13.2656L24.4375 4.70312C23.5121 4.1242 23.0198 3.96369 22.6563 3.89062L22.2849 12.1817Z" fill="url(#paint1_linear_18_31665)"></path></g><path d="M22.7969 3.05741L21.8437 2.65269C19.6421 1.96765 17.2344 1.81208 14.6719 2.23236C12.1094 2.65264 11.5156 3.2442 11.5156 3.2442C10.896 3.3674 10.8671 3.88898 11.1718 4.45363C13.0797 6.72576 15.176 13.4043 18.0469 14.2506C18.89 14.4662 21.3791 14.4776 22.2019 14.1593L22.3238 14.108C22.6692 13.9745 23.1672 13.2814 23.1875 12.9118L23.4219 4.03043C23.4523 3.59924 23.1484 3.25204 22.7969 3.05741Z" fill="url(#paint2_radial_18_31665)"></path><path d="M22.7969 3.05741L21.8437 2.65269C19.6421 1.96765 17.2344 1.81208 14.6719 2.23236C12.1094 2.65264 11.5156 3.2442 11.5156 3.2442C10.896 3.3674 10.8671 3.88898 11.1718 4.45363C13.0797 6.72576 15.176 13.4043 18.0469 14.2506C18.89 14.4662 21.3791 14.4776 22.2019 14.1593L22.3238 14.108C22.6692 13.9745 23.1672 13.2814 23.1875 12.9118L23.4219 4.03043C23.4523 3.59924 23.1484 3.25204 22.7969 3.05741Z" fill="url(#paint3_radial_18_31665)"></path><path d="M22.7969 3.05741L21.8437 2.65269C19.6421 1.96765 17.2344 1.81208 14.6719 2.23236C12.1094 2.65264 11.5156 3.2442 11.5156 3.2442C10.896 3.3674 10.8671 3.88898 11.1718 4.45363C13.0797 6.72576 15.176 13.4043 18.0469 14.2506C18.89 14.4662 21.3791 14.4776 22.2019 14.1593L22.3238 14.108C22.6692 13.9745 23.1672 13.2814 23.1875 12.9118L23.4219 4.03043C23.4523 3.59924 23.1484 3.25204 22.7969 3.05741Z" fill="url(#paint4_radial_18_31665)"></path><path d="M22.7969 3.05741L21.8437 2.65269C19.6421 1.96765 17.2344 1.81208 14.6719 2.23236C12.1094 2.65264 11.5156 3.2442 11.5156 3.2442C10.896 3.3674 10.8671 3.88898 11.1718 4.45363C13.0797 6.72576 15.176 13.4043 18.0469 14.2506C18.89 14.4662 21.3791 14.4776 22.2019 14.1593L22.3238 14.108C22.6692 13.9745 23.1672 13.2814 23.1875 12.9118L23.4219 4.03043C23.4523 3.59924 23.1484 3.25204 22.7969 3.05741Z" fill="url(#paint5_radial_18_31665)"></path><path d="M22.7969 3.05741L21.8437 2.65269C19.6421 1.96765 17.2344 1.81208 14.6719 2.23236C12.1094 2.65264 11.5156 3.2442 11.5156 3.2442C10.896 3.3674 10.8671 3.88898 11.1718 4.45363C13.0797 6.72576 15.176 13.4043 18.0469 14.2506C18.89 14.4662 21.3791 14.4776 22.2019 14.1593L22.3238 14.108C22.6692 13.9745 23.1672 13.2814 23.1875 12.9118L23.4219 4.03043C23.4523 3.59924 23.1484 3.25204 22.7969 3.05741Z" fill="url(#paint6_linear_18_31665)"></path><g filter="url(#filter1_f_18_31665)"><path d="M13.1016 2.72656C11.862 3.06924 11.5298 3.40016 11.5298 3.40016C10.9102 3.52335 10.936 4.11525 11.2408 4.6799C13.1487 6.95202 15.1361 13.2496 18.007 14.0958C18.2707 14.1633 18.6953 14.2107 19.1797 14.2344L13.1016 2.72656Z" fill="url(#paint7_linear_18_31665)"></path></g><path d="M12.2187 22.7187L15.7656 26.2031C16.7332 27.1171 17.3334 28.2487 16.4219 29.2188C15.7749 30.0687 14.2241 29.9933 13.625 30.0313C11.6883 30.0891 9.09014 29.5622 6.84373 27.5313C5.07737 25.9343 4.09321 23.688 3.93751 23.0156L12.2187 22.7187Z" fill="url(#paint8_radial_18_31665)"></path><path d="M12.2187 22.7187L15.7656 26.2031C16.7332 27.1171 17.3334 28.2487 16.4219 29.2188C15.7749 30.0687 14.2241 29.9933 13.625 30.0313C11.6883 30.0891 9.09014 29.5622 6.84373 27.5313C5.07737 25.9343 4.09321 23.688 3.93751 23.0156L12.2187 22.7187Z" fill="url(#paint9_radial_18_31665)"></path><g filter="url(#filter2_f_18_31665)"><path d="M12.0523 22.7916L13.2187 23.9375L4.81018 24.5721C4.4328 23.8671 4.20835 23.2768 4.14062 22.9844L12.0523 22.7916Z" fill="url(#paint10_linear_18_31665)"></path><path d="M12.0523 22.7916L13.2187 23.9375L4.81018 24.5721C4.4328 23.8671 4.20835 23.2768 4.14062 22.9844L12.0523 22.7916Z" fill="url(#paint11_radial_18_31665)"></path></g><path d="M2.99219 22.6484C2.07068 20.538 1.78913 17.4452 2.21096 15.0703C2.63279 12.6953 3.20759 11.951 3.20759 11.951C3.31231 11.3264 3.83281 11.2818 4.40626 11.5703C6.73409 13.4144 13.3119 15.2264 14.2432 18.0781C14.5947 19.3034 14.6279 21.3125 14.1641 22.5156C14.0409 22.8657 13.5 23.3516 13.0625 23.4141C12.625 23.4765 9.47656 23.3516 8.61719 23.3516C7.75781 23.3516 4.64844 23.6719 4.14062 23.6172C3.63281 23.5625 3.23437 23.2031 2.99219 22.6484Z" fill="#EC9F6A"></path><path d="M2.99219 22.6484C2.07068 20.538 1.78913 17.4452 2.21096 15.0703C2.63279 12.6953 3.20759 11.951 3.20759 11.951C3.31231 11.3264 3.83281 11.2818 4.40626 11.5703C6.73409 13.4144 13.3119 15.2264 14.2432 18.0781C14.5947 19.3034 14.6279 21.3125 14.1641 22.5156C14.0409 22.8657 13.5 23.3516 13.0625 23.4141C12.625 23.4765 9.47656 23.3516 8.61719 23.3516C7.75781 23.3516 4.64844 23.6719 4.14062 23.6172C3.63281 23.5625 3.23437 23.2031 2.99219 22.6484Z" fill="url(#paint12_radial_18_31665)"></path><path d="M2.99219 22.6484C2.07068 20.538 1.78913 17.4452 2.21096 15.0703C2.63279 12.6953 3.20759 11.951 3.20759 11.951C3.31231 11.3264 3.83281 11.2818 4.40626 11.5703C6.73409 13.4144 13.3119 15.2264 14.2432 18.0781C14.5947 19.3034 14.6279 21.3125 14.1641 22.5156C14.0409 22.8657 13.5 23.3516 13.0625 23.4141C12.625 23.4765 9.47656 23.3516 8.61719 23.3516C7.75781 23.3516 4.64844 23.6719 4.14062 23.6172C3.63281 23.5625 3.23437 23.2031 2.99219 22.6484Z" fill="url(#paint13_linear_18_31665)"></path><path d="M2.99219 22.6484C2.07068 20.538 1.78913 17.4452 2.21096 15.0703C2.63279 12.6953 3.20759 11.951 3.20759 11.951C3.31231 11.3264 3.83281 11.2818 4.40626 11.5703C6.73409 13.4144 13.3119 15.2264 14.2432 18.0781C14.5947 19.3034 14.6279 21.3125 14.1641 22.5156C14.0409 22.8657 13.5 23.3516 13.0625 23.4141C12.625 23.4765 9.47656 23.3516 8.61719 23.3516C7.75781 23.3516 4.64844 23.6719 4.14062 23.6172C3.63281 23.5625 3.23437 23.2031 2.99219 22.6484Z" fill="url(#paint14_radial_18_31665)"></path><path d="M2.99219 22.6484C2.07068 20.538 1.78913 17.4452 2.21096 15.0703C2.63279 12.6953 3.20759 11.951 3.20759 11.951C3.31231 11.3264 3.83281 11.2818 4.40626 11.5703C6.73409 13.4144 13.3119 15.2264 14.2432 18.0781C14.5947 19.3034 14.6279 21.3125 14.1641 22.5156C14.0409 22.8657 13.5 23.3516 13.0625 23.4141C12.625 23.4765 9.47656 23.3516 8.61719 23.3516C7.75781 23.3516 4.64844 23.6719 4.14062 23.6172C3.63281 23.5625 3.23437 23.2031 2.99219 22.6484Z" fill="url(#paint15_radial_18_31665)"></path><path d="M2.99219 22.6484C2.07068 20.538 1.78913 17.4452 2.21096 15.0703C2.63279 12.6953 3.20759 11.951 3.20759 11.951C3.31231 11.3264 3.83281 11.2818 4.40626 11.5703C6.73409 13.4144 13.3119 15.2264 14.2432 18.0781C14.5947 19.3034 14.6279 21.3125 14.1641 22.5156C14.0409 22.8657 13.5 23.3516 13.0625 23.4141C12.625 23.4765 9.47656 23.3516 8.61719 23.3516C7.75781 23.3516 4.64844 23.6719 4.14062 23.6172C3.63281 23.5625 3.23437 23.2031 2.99219 22.6484Z" fill="url(#paint16_radial_18_31665)"></path><g filter="url(#filter3_f_18_31665)"><path d="M2.70313 13.6719C3.04135 12.4711 3.36224 12.0555 3.36224 12.0555C3.46697 11.4309 3.98746 11.3864 4.56092 11.6749C6.88874 13.5189 13.0809 15.1104 14.0121 17.9622C14.1731 18.5231 14.2766 19.0394 14.3287 19.5128L2.70313 13.6719Z" fill="url(#paint17_linear_18_31665)"></path><path d="M2.70313 13.6719C3.04135 12.4711 3.36224 12.0555 3.36224 12.0555C3.46697 11.4309 3.98746 11.3864 4.56092 11.6749C6.88874 13.5189 13.0809 15.1104 14.0121 17.9622C14.1731 18.5231 14.2766 19.0394 14.3287 19.5128L2.70313 13.6719Z" fill="url(#paint18_linear_18_31665)"></path></g><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="#D79453"></path><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="url(#paint19_radial_18_31665)"></path><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="url(#paint20_radial_18_31665)"></path><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="url(#paint21_radial_18_31665)"></path><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="url(#paint22_linear_18_31665)"></path><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="url(#paint23_radial_18_31665)"></path><path d="M9.83184 2.82184C6.62184 4.07184 4.07184 6.62184 2.82184 9.83184C2.48184 10.7118 2.82184 11.7018 3.62184 12.1918L14.0418 18.5418C14.6618 18.9218 15.4418 18.9218 16.0618 18.5418C17.0718 17.9218 17.9318 17.0718 18.5418 16.0618C18.9218 15.4418 18.9218 14.6618 18.5418 14.0418L12.1918 3.62184C11.7018 2.82184 10.7118 2.48184 9.83184 2.82184Z" fill="url(#paint24_radial_18_31665)"></path><defs><filter id="filter0_f_18_31665" x="22.0349" y="3.64062" width="2.65265" height="9.875" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur stdDeviation="0.125" result="effect1_foregroundBlur_18_31665"></feGaussianBlur></filter><filter id="filter1_f_18_31665" x="10.7815" y="2.47656" width="8.64819" height="12.0078" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur stdDeviation="0.125" result="effect1_foregroundBlur_18_31665"></feGaussianBlur></filter><filter id="filter2_f_18_31665" x="3.89062" y="22.5416" width="9.57812" height="2.2804" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur stdDeviation="0.125" result="effect1_foregroundBlur_18_31665"></feGaussianBlur></filter><filter id="filter3_f_18_31665" x="2.45312" y="11.2538" width="12.1255" height="8.50903" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur stdDeviation="0.125" result="effect1_foregroundBlur_18_31665"></feGaussianBlur></filter><radialGradient id="paint0_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(22.8125 12.9375) rotate(42.7741) scale(12.5164 7.08839)"><stop offset="0.0937591" stop-color="#C05159"></stop><stop offset="0.553697" stop-color="#F6AC6A"></stop><stop offset="0.832916" stop-color="#FFD186"></stop><stop offset="0.916927" stop-color="#FFDC87"></stop></radialGradient><linearGradient id="paint1_linear_18_31665" x1="24.7344" y1="4.67187" x2="20.8594" y2="12.8906" gradientUnits="userSpaceOnUse"><stop stop-color="#EBD67C"></stop><stop offset="0.0655686" stop-color="#FFFFA6"></stop><stop offset="0.530552" stop-color="#F8C281"></stop><stop offset="0.937338" stop-color="#E99E6B"></stop></linearGradient><radialGradient id="paint2_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(22.9009 13.1847) rotate(-127.648) scale(14.3438 11.7966)"><stop stop-color="#FFBE66"></stop><stop offset="1" stop-color="#E2AE5B"></stop></radialGradient><radialGradient id="paint3_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(18 11.4375) rotate(53.9726) scale(11.9013 4.84018)"><stop stop-color="#D67C63"></stop><stop offset="1" stop-color="#D97D67" stop-opacity="0"></stop></radialGradient><radialGradient id="paint4_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(23 4.1875) rotate(45.7639) scale(3.31486 5.75622)"><stop stop-color="#FFE4A6"></stop><stop offset="0.711285" stop-color="#F8B76F"></stop><stop offset="1" stop-color="#F9B870" stop-opacity="0"></stop></radialGradient><radialGradient id="paint5_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(22.875 12.4375) rotate(88.9391) scale(3.37558 1.29066)"><stop stop-color="#FFBC67"></stop><stop offset="1" stop-color="#FFBC67" stop-opacity="0"></stop></radialGradient><linearGradient id="paint6_linear_18_31665" x1="20.375" y1="15.6875" x2="20.125" y2="12.7813" gradientUnits="userSpaceOnUse"><stop offset="0.461609" stop-color="#B45077"></stop><stop offset="0.855389" stop-color="#B75077" stop-opacity="0"></stop></linearGradient><linearGradient id="paint7_linear_18_31665" x1="12.9375" y1="2.57056" x2="18.5625" y2="14.3891" gradientUnits="userSpaceOnUse"><stop stop-color="#DDC173"></stop><stop offset="0.485173" stop-color="#D59F65"></stop><stop offset="1" stop-color="#E49966"></stop></linearGradient><radialGradient id="paint8_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(13.5625 23.5) rotate(109.113) scale(6.68078 10.2578)"><stop offset="0.165756" stop-color="#FFBF7E"></stop><stop offset="0.827674" stop-color="#DF8C6D"></stop><stop offset="1" stop-color="#B05A66"></stop></radialGradient><radialGradient id="paint9_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.1875 26) rotate(41.0652) scale(8.37243 2.03649)"><stop stop-color="#FFD483"></stop><stop offset="1" stop-color="#FFD688" stop-opacity="0"></stop></radialGradient><linearGradient id="paint10_linear_18_31665" x1="3.96063" y1="23.794" x2="13.3748" y2="23.5143" gradientUnits="userSpaceOnUse"><stop stop-color="#A8716F"></stop><stop offset="0.103615" stop-color="#B37173"></stop><stop offset="0.225484" stop-color="#DB9F84"></stop><stop offset="0.799889" stop-color="#F1BB8A"></stop><stop offset="1" stop-color="#FFD780"></stop></linearGradient><radialGradient id="paint11_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(11.4219 23.1719) rotate(-178.616) scale(3.23532 0.569081)"><stop offset="0.621498" stop-color="#AF5A3E"></stop><stop offset="1" stop-color="#B35445" stop-opacity="0"></stop></radialGradient><radialGradient id="paint12_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(13.625 19.125) rotate(-171.737) scale(15.2205 15.0767)"><stop offset="0.138435" stop-color="#FFB974"></stop><stop offset="0.403618" stop-color="#F2A56D"></stop><stop offset="0.925938" stop-color="#A16948"></stop></radialGradient><linearGradient id="paint13_linear_18_31665" x1="8.22184" y1="13.125" x2="6.81191" y2="15.4996" gradientUnits="userSpaceOnUse"><stop offset="0.610751" stop-color="#984847"></stop><stop offset="0.850075" stop-color="#9A4947" stop-opacity="0"></stop></linearGradient><radialGradient id="paint14_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(7.25 23.7461) scale(11.25 5.68361)"><stop stop-color="#C66364"></stop><stop offset="1" stop-color="#D4766B" stop-opacity="0"></stop></radialGradient><radialGradient id="paint15_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(7.875 23.5313) scale(10.0937 1.29657)"><stop stop-color="#B64B4B"></stop><stop offset="1" stop-color="#C56158" stop-opacity="0"></stop></radialGradient><radialGradient id="paint16_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(11.4375 19.875) rotate(-46.8882) scale(4.02385 7.51767)"><stop stop-color="#FFC083"></stop><stop offset="0.620218" stop-color="#FFBD7D" stop-opacity="0"></stop></radialGradient><linearGradient id="paint17_linear_18_31665" x1="2.8125" y1="13.0312" x2="14.5582" y2="18.9404" gradientUnits="userSpaceOnUse"><stop stop-color="#B89367"></stop><stop offset="1" stop-color="#C5835E"></stop></linearGradient><linearGradient id="paint18_linear_18_31665" x1="8.21875" y1="14.6406" x2="7.59349" y2="15.6717" gradientUnits="userSpaceOnUse"><stop offset="0.351552" stop-color="#A74746"></stop><stop offset="0.845198" stop-color="#A04346" stop-opacity="0"></stop></linearGradient><radialGradient id="paint19_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.5625 14.5625) rotate(140.244) scale(18.3733 13.7403)"><stop stop-color="#FDAE69"></stop><stop offset="0.729021" stop-color="#CE8C4F"></stop><stop offset="0.921546" stop-color="#AD7B45"></stop><stop offset="1" stop-color="#8B6B4A"></stop></radialGradient><radialGradient id="paint20_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.0625 7) rotate(65.3152) scale(11.0745 3.16547)"><stop offset="0.233237" stop-color="#FFD47C"></stop><stop offset="0.853648" stop-color="#FFD98B" stop-opacity="0"></stop></radialGradient><radialGradient id="paint21_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.3125 8.875) rotate(100.886) scale(6.6191 5.57808)"><stop offset="0.128419" stop-color="#FFD88C"></stop><stop offset="0.924134" stop-color="#FFBE7B" stop-opacity="0"></stop></radialGradient><linearGradient id="paint22_linear_18_31665" x1="7.25" y1="15.1875" x2="10.7588" y2="10.3142" gradientUnits="userSpaceOnUse"><stop offset="0.142353" stop-color="#C15F4D"></stop><stop offset="1" stop-color="#D58366" stop-opacity="0"></stop></linearGradient><radialGradient id="paint23_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(8.15625 15.7813) rotate(28.5422) scale(12.5574 1.96589)"><stop offset="0.149989" stop-color="#E4745D"></stop><stop offset="0.453292" stop-color="#C8604C"></stop><stop offset="0.632597" stop-color="#C0605F"></stop><stop offset="1" stop-color="#C0605F" stop-opacity="0"></stop></radialGradient><radialGradient id="paint24_radial_18_31665" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(1.40625 2.69067) rotate(46.0943) scale(22.3963)"><stop offset="0.935802" stop-color="#C17C61" stop-opacity="0"></stop><stop offset="0.982109" stop-color="#C17C61"></stop></radialGradient></defs></svg>

	

	<span>Croissant</span>
	

	<div class="border-br-gray-200 absolute bottom-0.5 right-0.5 h-1 w-1 border-[3px] border-l-transparent border-t-transparent border-b-gray-200 border-r-gray-200 dark:border-b-gray-700 dark:border-r-gray-700"></div></div>
		
		</button>
	
	
	</div>

	<button class="tag tag-ghost px-1! -ml-0.5 mb-1 md:mb-1.5" type="button">+ 1</button></div></div>

		<div class="flex flex-col-reverse lg:flex-row lg:items-center lg:justify-between"><div class="-mb-px flex h-12 items-center overflow-x-auto overflow-y-hidden ">
	<a class="tab-alternate active" href="/datasets/waybarrios/github-code-dataset"><svg class="mr-1.5 text-gray-400 flex-none" style="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path class="uim-quaternary" d="M20.23 7.24L12 12L3.77 7.24a1.98 1.98 0 0 1 .7-.71L11 2.76c.62-.35 1.38-.35 2 0l6.53 3.77c.29.173.531.418.7.71z" opacity=".25" fill="currentColor"></path><path class="uim-tertiary" d="M12 12v9.5a2.09 2.09 0 0 1-.91-.21L4.5 17.48a2.003 2.003 0 0 1-1-1.73v-7.5a2.06 2.06 0 0 1 .27-1.01L12 12z" opacity=".5" fill="currentColor"></path><path class="uim-primary" d="M20.5 8.25v7.5a2.003 2.003 0 0 1-1 1.73l-6.62 3.82c-.275.13-.576.198-.88.2V12l8.23-4.76c.175.308.268.656.27 1.01z" fill="currentColor"></path></svg>
	Dataset card
	

	
		</a><a class="tab-alternate" href="/datasets/waybarrios/github-code-dataset/viewer/"><svg class="mr-1.5 text-gray-400 flex-none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 12 12"><path fill="currentColor" d="M2.5 2h7a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1Zm0 2v2h3V4h-3Zm4 0v2h3V4h-3Zm-4 3v2h3V7h-3Zm4 0v2h3V7h-3Z"></path></svg>
	Data Studio
	

	
		</a><a class="tab-alternate" href="/datasets/waybarrios/github-code-dataset/tree/main"><svg class="mr-1.5 text-gray-400 flex-none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path class="uim-tertiary" d="M21 19h-8a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2zm0-4h-8a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2zm0-8h-8a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2zm0 4h-8a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2z" opacity=".5" fill="currentColor"></path><path class="uim-primary" d="M9 19a1 1 0 0 1-1-1V6a1 1 0 0 1 2 0v12a1 1 0 0 1-1 1zm-6-4.333a1 1 0 0 1-.64-1.769L3.438 12l-1.078-.898a1 1 0 0 1 1.28-1.538l2 1.667a1 1 0 0 1 0 1.538l-2 1.667a.999.999 0 0 1-.64.231z" fill="currentColor"></path></svg>
	<span class="xl:hidden">Files</span>
		<span class="hidden xl:inline">Files and versions</span>
	

	
		</a><a class="tab-alternate" href="/datasets/waybarrios/github-code-dataset/discussions"><svg class="mr-1.5 text-gray-400 flex-none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M20.6081 3C21.7684 3 22.8053 3.49196 23.5284 4.38415C23.9756 4.93678 24.4428 5.82749 24.4808 7.16133C24.9674 7.01707 25.4353 6.93643 25.8725 6.93643C26.9833 6.93643 27.9865 7.37587 28.696 8.17411C29.6075 9.19872 30.0124 10.4579 29.8361 11.7177C29.7523 12.3177 29.5581 12.8555 29.2678 13.3534C29.8798 13.8646 30.3306 14.5763 30.5485 15.4322C30.719 16.1032 30.8939 17.5006 29.9808 18.9403C30.0389 19.0342 30.0934 19.1319 30.1442 19.2318C30.6932 20.3074 30.7283 21.5229 30.2439 22.6548C29.5093 24.3704 27.6841 25.7219 24.1397 27.1727C21.9347 28.0753 19.9174 28.6523 19.8994 28.6575C16.9842 29.4379 14.3477 29.8345 12.0653 29.8345C7.87017 29.8345 4.8668 28.508 3.13831 25.8921C0.356375 21.6797 0.754104 17.8269 4.35369 14.1131C6.34591 12.058 7.67023 9.02782 7.94613 8.36275C8.50224 6.39343 9.97271 4.20438 12.4172 4.20438H12.4179C12.6236 4.20438 12.8314 4.2214 13.0364 4.25468C14.107 4.42854 15.0428 5.06476 15.7115 6.02205C16.4331 5.09583 17.134 4.359 17.7682 3.94323C18.7242 3.31737 19.6794 3 20.6081 3ZM20.6081 5.95917C20.2427 5.95917 19.7963 6.1197 19.3039 6.44225C17.7754 7.44319 14.8258 12.6772 13.7458 14.7131C13.3839 15.3952 12.7655 15.6837 12.2086 15.6837C11.1036 15.6837 10.2408 14.5497 12.1076 13.1085C14.9146 10.9402 13.9299 7.39584 12.5898 7.1776C12.5311 7.16799 12.4731 7.16355 12.4172 7.16355C11.1989 7.16355 10.6615 9.33114 10.6615 9.33114C10.6615 9.33114 9.0863 13.4148 6.38031 16.206C3.67434 18.998 3.5346 21.2388 5.50675 24.2246C6.85185 26.2606 9.42666 26.8753 12.0653 26.8753C14.8021 26.8753 17.6077 26.2139 19.1799 25.793C19.2574 25.7723 28.8193 22.984 27.6081 20.6107C27.4046 20.212 27.0693 20.0522 26.6471 20.0522C24.9416 20.0522 21.8393 22.6726 20.5057 22.6726C20.2076 22.6726 19.9976 22.5416 19.9116 22.222C19.3433 20.1173 28.552 19.2325 27.7758 16.1839C27.639 15.6445 27.2677 15.4256 26.746 15.4263C24.4923 15.4263 19.4358 19.5181 18.3759 19.5181C18.2949 19.5181 18.2368 19.4937 18.2053 19.4419C17.6743 18.557 17.9653 17.9394 21.7082 15.6009C25.4511 13.2617 28.0783 11.8545 26.5841 10.1752C26.4121 9.98141 26.1684 9.8956 25.8725 9.8956C23.6001 9.89634 18.2311 14.9403 18.2311 14.9403C18.2311 14.9403 16.7821 16.496 15.9057 16.496C15.7043 16.496 15.533 16.4139 15.4169 16.2112C14.7956 15.1296 21.1879 10.1286 21.5484 8.06535C21.7928 6.66715 21.3771 5.95917 20.6081 5.95917Z" fill="#FF9D00"></path><path d="M5.50686 24.2246C3.53472 21.2387 3.67446 18.9979 6.38043 16.206C9.08641 13.4147 10.6615 9.33111 10.6615 9.33111C10.6615 9.33111 11.2499 6.95933 12.59 7.17757C13.93 7.39581 14.9139 10.9401 12.1069 13.1084C9.29997 15.276 12.6659 16.7489 13.7459 14.713C14.8258 12.6772 17.7747 7.44316 19.304 6.44221C20.8326 5.44128 21.9089 6.00204 21.5484 8.06532C21.188 10.1286 14.795 15.1295 15.4171 16.2118C16.0391 17.2934 18.2312 14.9402 18.2312 14.9402C18.2312 14.9402 25.0907 8.49588 26.5842 10.1752C28.0776 11.8545 25.4512 13.2616 21.7082 15.6008C17.9646 17.9393 17.6744 18.557 18.2054 19.4418C18.7372 20.3266 26.9998 13.1351 27.7759 16.1838C28.5513 19.2324 19.3434 20.1173 19.9117 22.2219C20.48 24.3274 26.3979 18.2382 27.6082 20.6107C28.8193 22.9839 19.2574 25.7722 19.18 25.7929C16.0914 26.62 8.24723 28.3726 5.50686 24.2246Z" fill="#FFD21E"></path></svg>
	Community
	

	
		</a></div>
	
			</div></div></header>
</div>
	
<div class="container relative flex flex-col md:grid md:space-y-0 w-full md:grid-cols-12 md:flex-1 md:grid-rows-full space-y-4 md:gap-6 ">
		<section class="pt-6 border-gray-100 md:col-span-8 pb-24 relative break-words copiable-code-container">
				<div class="SVELTE_HYDRATER contents" data-target="UnsafeBanner" data-props="{&quot;classNames&quot;:&quot;mb-4&quot;,&quot;repoId&quot;:&quot;waybarrios/github-code-dataset&quot;,&quot;repoType&quot;:&quot;dataset&quot;,&quot;minLevel&quot;:&quot;unsafe&quot;}"></div>
					<div class="SVELTE_HYDRATER contents" data-target="DatasetViewer" data-props="{&quot;data&quot;:{&quot;kind&quot;:&quot;DatasetAndSampleData&quot;,&quot;datasetInfo&quot;:[{&quot;isValid&quot;:true,&quot;href&quot;:&quot;&quot;,&quot;label&quot;:&quot;Size of downloaded dataset files:&quot;,&quot;value&quot;:&quot;57.6 MB&quot;},{&quot;isValid&quot;:true,&quot;href&quot;:&quot;/datasets/waybarrios/github-code-dataset/tree/refs%2Fconvert%2Fparquet/&quot;,&quot;label&quot;:&quot;Size of the auto-converted Parquet files:&quot;,&quot;value&quot;:&quot;57.6 MB&quot;},{&quot;isValid&quot;:true,&quot;href&quot;:&quot;&quot;,&quot;label&quot;:&quot;Number of rows:&quot;,&quot;value&quot;:&quot;18,912&quot;}],&quot;partial&quot;:false,&quot;configsData&quot;:{&quot;configInfos&quot;:[{&quot;name&quot;:&quot;default&quot;,&quot;status&quot;:&quot;ok&quot;,&quot;numRows&quot;:18912}],&quot;selectedConfig&quot;:&quot;default&quot;,&quot;hasSelectedConfigParquet&quot;:true},&quot;splitsData&quot;:{&quot;splitInfos&quot;:[{&quot;name&quot;:&quot;train&quot;,&quot;numRows&quot;:18912}],&quot;selectedSplit&quot;:&quot;train&quot;},&quot;sampleData&quot;:{&quot;dataset&quot;:&quot;waybarrios/github-code-dataset&quot;,&quot;config&quot;:&quot;default&quot;,&quot;split&quot;:&quot;train&quot;,&quot;capabilities&quot;:{&quot;rows&quot;:true,&quot;search&quot;:true,&quot;filter&quot;:true,&quot;statistics&quot;:true},&quot;navigation&quot;:{&quot;p&quot;:0},&quot;jwt&quot;:&quot;eyJhbGciOiJFZERTQSJ9.eyJyZWFkIjp0cnVlLCJwZXJtaXNzaW9ucyI6eyJyZXBvLmNvbnRlbnQucmVhZCI6dHJ1ZX0sImlhdCI6MTc0MjkyMzExMSwic3ViIjoiL2RhdGFzZXRzL3dheWJhcnJpb3MvZ2l0aHViLWNvZGUtZGF0YXNldCIsImV4cCI6MTc0MjkyNjcxMSwiaXNzIjoiaHR0cHM6Ly9odWdnaW5nZmFjZS5jbyJ9.Gufrd95DOLdanXEdfwvBPP-6FbkMqcE6vbDuYi2RGjlCPOxoVqYen9XQre5ok07ALxiaatxbxQilO05Sb6WQBA&quot;,&quot;sampleData&quot;:{&quot;columns&quot;:[{&quot;name&quot;:&quot;path&quot;,&quot;align&quot;:&quot;depends on text direction&quot;,&quot;type&quot;:&quot;string&quot;,&quot;statistics&quot;:{&quot;column_name&quot;:&quot;path&quot;,&quot;column_type&quot;:&quot;string_text&quot;,&quot;column_statistics&quot;:{&quot;nan_count&quot;:0,&quot;nan_proportion&quot;:0,&quot;min&quot;:14,&quot;max&quot;:112,&quot;mean&quot;:46.81271,&quot;median&quot;:45,&quot;std&quot;:10.7247,&quot;histogram&quot;:{&quot;hist&quot;:[32,1666,6372,6073,3408,1052,226,69,11,3],&quot;bin_edges&quot;:[14,24,34,44,54,64,74,84,94,104,112]}}}},{&quot;name&quot;:&quot;content&quot;,&quot;align&quot;:&quot;depends on text direction&quot;,&quot;type&quot;:&quot;string&quot;,&quot;statistics&quot;:{&quot;column_name&quot;:&quot;content&quot;,&quot;column_type&quot;:&quot;string_text&quot;,&quot;column_statistics&quot;:{&quot;nan_count&quot;:0,&quot;nan_proportion&quot;:0,&quot;min&quot;:0,&quot;max&quot;:6323090,&quot;mean&quot;:7813.75365,&quot;median&quot;:439,&quot;std&quot;:83807.27579,&quot;histogram&quot;:{&quot;hist&quot;:[18900,8,0,1,0,0,0,0,0,3],&quot;bin_edges&quot;:[0,632310,1264620,1896930,2529240,3161550,3793860,4426170,5058480,5690790,6323090]}}}},{&quot;name&quot;:&quot;size&quot;,&quot;align&quot;:&quot;right&quot;,&quot;type&quot;:&quot;int64&quot;,&quot;statistics&quot;:{&quot;column_name&quot;:&quot;size&quot;,&quot;column_type&quot;:&quot;int&quot;,&quot;column_statistics&quot;:{&quot;nan_count&quot;:0,&quot;nan_proportion&quot;:0,&quot;min&quot;:0,&quot;max&quot;:6323090,&quot;mean&quot;:7813.75365,&quot;median&quot;:439,&quot;std&quot;:83807.27579,&quot;histogram&quot;:{&quot;hist&quot;:[18900,8,0,1,0,0,0,0,0,3],&quot;bin_edges&quot;:[0,632310,1264620,1896930,2529240,3161550,3793860,4426170,5058480,5690790,6323090]}}}},{&quot;name&quot;:&quot;max_lines&quot;,&quot;align&quot;:&quot;right&quot;,&quot;type&quot;:&quot;int64&quot;,&quot;statistics&quot;:{&quot;column_name&quot;:&quot;max_lines&quot;,&quot;column_type&quot;:&quot;int&quot;,&quot;column_statistics&quot;:{&quot;nan_count&quot;:0,&quot;nan_proportion&quot;:0,&quot;min&quot;:1,&quot;max&quot;:100051,&quot;mean&quot;:202.63684,&quot;median&quot;:18,&quot;std&quot;:1555.64522,&quot;histogram&quot;:{&quot;hist&quot;:[18878,22,7,2,0,0,0,0,0,3],&quot;bin_edges&quot;:[1,10007,20013,30019,40025,50031,60037,70043,80049,90055,100051]}}}},{&quot;name&quot;:&quot;repo_name&quot;,&quot;align&quot;:&quot;depends on text direction&quot;,&quot;type&quot;:&quot;string&quot;,&quot;statistics&quot;:{&quot;column_name&quot;:&quot;repo_name&quot;,&quot;column_type&quot;:&quot;string_label&quot;,&quot;column_statistics&quot;:{&quot;nan_count&quot;:0,&quot;nan_proportion&quot;:0,&quot;no_label_count&quot;:0,&quot;no_label_proportion&quot;:0,&quot;n_unique&quot;:2,&quot;frequencies&quot;:{&quot;jart/plegde&quot;:56,&quot;jart/cosmopolitan&quot;:18856}}}},{&quot;name&quot;:&quot;autogenerated&quot;,&quot;align&quot;:&quot;right&quot;,&quot;type&quot;:&quot;bool&quot;,&quot;statistics&quot;:{&quot;column_name&quot;:&quot;autogenerated&quot;,&quot;column_type&quot;:&quot;bool&quot;,&quot;column_statistics&quot;:{&quot;nan_count&quot;:0,&quot;nan_proportion&quot;:0,&quot;frequencies&quot;:{&quot;False&quot;:18912}}}}],&quot;rows&quot;:[{&quot;rowIdx&quot;:0,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/LICENSE&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;ISC License\n\nCopyright 2020 Justine Alexandra Roberts Tunney\n\nPermission to use, copy, modify, and/or distribute this software for\nany purpose with or without fee is hereby granted, provided that the\nabove copyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL\nWARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\nAUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL\nDAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR\nPROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\nTORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:759,&quot;string&quot;:&quot;759&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:17,&quot;string&quot;:&quot;17&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:1,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/.gitignore&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;# -*- conf -*-\n\n/o\n\n# TODO: Find some way to have Python write to o/\n__pycache__\n\n*.tmp\n/.bochs.log\n/HTAGS\n/TAGS\n/bx_enh_dbg.ini\n/tool/emacs/*.elc\n/perf.data\n/perf.data.old\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:173,&quot;string&quot;:&quot;173&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:16,&quot;string&quot;:&quot;16&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:2,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/Makefile&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;# Makefiles are prettier like this\nifeq ($(origin .RECIPEPREFIX), undefined)\n  $(error This Make does not support .RECIPEPREFIX. \\\n        Please use GNU Make 3.82 or later)\nendif\n.RECIPEPREFIX = >\n\n# Use bash as the shell\nSHELL := bash\n\n# ...And use strict flags with it to make sure things fail if a step in there\n# fails\n.SHELLFLAGS := -eu -o pipefail -c\n\n# Delete the target file of a Make rule if it fails - this guards against\n# broken files\n.DELETE_ON_ERROR:\n\n# --no-builtin-rules: I'd rather make my own rules myself, make, thanks :)\nMAKEFLAGS += --no-builtin-rules\n\n# We use `override` to enable setting part of CFLAGS on the command line\n\n# This makes the compiler generate dependency files, which will solve any\n# header-related dependency problems we could have had\noverride CFLAGS += -MMD -MP -MF $@.d\n\n# Make it simpler to include library include files\noverride CFLAGS += -I.\n\n# We need functions provided by defining _GNU_SOURCE\noverride CFLAGS += -D_GNU_SOURCE\n\n# We need to compile as PIC code since we're making shared libraries here\noverride CFLAGS += -fPIC\n\n# LDFLAGS should contain CFLAGS (seperate so command-line can add to it, and\n# to correspond to usual practice)\noverride LDFLAGS += $(CFLAGS)\n\nOUTPUT_FOLDER = o/$(MODE)\n\n.PHONY: all clean\n\nall: $(OUTPUT_FOLDER)/pledge $(OUTPUT_FOLDER)/sandbox.so\n\n# Note: we cannot merge the source file list for pledge and the sandbox as this may otherwise result in constructors calling forbidden syscalls in the sandbox\nPLEDGE_SOURCE_FILES := cmd/pledge\nPLEDGE_SOURCE_FILES += libc/calls/commandv libc/calls/getcpucount libc/calls/islinux\nPLEDGE_SOURCE_FILES += libc/calls/landlock_add_rule libc/calls/landlock_create_ruleset\nPLEDGE_SOURCE_FILES += libc/calls/landlock_restrict_self libc/calls/parsepromises\nPLEDGE_SOURCE_FILES += libc/calls/pledge libc/calls/pledge-linux libc/calls/unveil\n\nPLEDGE_SOURCE_FILES += libc/x/xdie libc/x/xjoinpaths libc/x/xmalloc libc/x/xrealloc\nPLEDGE_SOURCE_FILES += libc/x/xstrcat libc/x/xstrdup\n\nPLEDGE_SOURCE_FILES += libc/elf/checkelfaddress libc/elf/getelfsegmentheaderaddress\n\nPLEDGE_SOURCE_FILES += libc/str/classifypath libc/str/endswith libc/str/isabspath\n\nPLEDGE_SOURCE_FILES += libc/intrin/promises libc/intrin/pthread_setcancelstate\n\nPLEDGE_SOURCE_FILES += libc/fmt/joinpaths libc/fmt/sizetol\n\nPLEDGE_SOURCE_FILES += libc/runtime/isdynamicexecutable\n\nPLEDGE_SOURCE_FILES += libc/sysv/calls/ioprio_set\n\nSANDBOX_SOURCE_FILES := cmd/sandbox\nSANDBOX_SOURCE_FILES += libc/calls/pledge-linux\n\n\nSANDBOX_OBJECT_FILES := $(addprefix $(OUTPUT_FOLDER)/, $(addsuffix .o, $(SANDBOX_SOURCE_FILES)))\nPLEDGE_OBJECT_FILES := $(addprefix $(OUTPUT_FOLDER)/, $(addsuffix .o, $(PLEDGE_SOURCE_FILES)))\n\n# First we need to have a shared object for the sandbox\n$(OUTPUT_FOLDER)/sandbox.so: $(SANDBOX_OBJECT_FILES)\n> $(CC) $(LDFLAGS) -shared -o $@ $^\n\n# Next we need to make an object file out of that shared object containing the shared object as a symbol\n$(OUTPUT_FOLDER)/embedded-sandbox.o: $(OUTPUT_FOLDER)/sandbox.so\n> ld -r -b binary -o $@ $^\n\n# Finally we need to embed the sandbox into our executable so it can copy it out when needed\n$(OUTPUT_FOLDER)/pledge: $(PLEDGE_OBJECT_FILES) $(OUTPUT_FOLDER)/embedded-sandbox.o\n> $(CC) $(LDFLAGS) -o $@ $^\n\n$(OUTPUT_FOLDER)/%.o: %.c\n> @mkdir --parents $(OUTPUT_FOLDER)/cmd\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/calls\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/sysv/calls\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/str\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/mem\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/fmt\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/intrin\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/x\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/runtime\n> @mkdir --parents $(OUTPUT_FOLDER)/libc/elf\n> $(CC) -c $< -o $@ $(CFLAGS)\n\n# Include dependencies for the object files\ninclude $(shell [ -d $(OUTPUT_FOLDER)/obj ] &amp;&amp; find $(OUTPUT_FOLDER)/ -type f -name '*.d')\n\n# Remove all object, binary and other produced files\nclean:\n> rm -rf ./o/\n\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:3966,&quot;string&quot;:&quot;3,966&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:108,&quot;string&quot;:&quot;108&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:3,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/.clang-format&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;---\nBasedOnStyle: Google\nStatementMacros:\n  - INITIALIZER\nAlignConsecutiveMacros: true\nAlignConsecutiveDeclarations: false\nAlwaysBreakBeforeMultilineStrings: false\nAllowShortFunctionsOnASingleLine: false\nKeepEmptyLinesAtTheStartOfBlocks: true\nConstructorInitializerAllOnOneLineOrOnePerLine: true\nIncludeBlocks: Merge\n---\nLanguage: Cpp\nAllowShortFunctionsOnASingleLine: false\n---\nLanguage: Proto\n...\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:399,&quot;string&quot;:&quot;399&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:18,&quot;string&quot;:&quot;18&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:4,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/README.md&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;# pledge for linux\n\nOpenBSD is an operating system that's famous for its focus on security.\nUnfortunately, OpenBSD leader Theo states that there are only 7000 users\nof OpenBSD. So it's a very small but elite group, that wields a\ndisproportionate influence; since we hear all the time about the awesome\nsecurity features these guys get to use, even though we usually can't\nuse them ourselves, *until now*.\n\nPledge was like the forbidden fruit we'd all covet when the boss says we\nmust use things like Linux. Why does it matter? It's because pledge()\nactually makes security comprehensible. Linux has never really had a\nsecurity layer that mere mortals can understand. For example, let's say\nyou want to do something on Linux like control whether or not some\nprogram you downloaded from the web is allowed to have telemetry. You'd\nneed to write stuff like this:\n\n```c\nstatic const struct sock_filter kFilter[] = {\n    /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, syscall, 0, 14 - 1),\n    /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n    /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 2, 4 - 3, 0),\n    /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 10, 0, 13 - 4),\n    /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n    /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~0x80800),\n    /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 1, 8 - 7, 0),\n    /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 2, 0, 13 - 8),\n    /* L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n    /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 12 - 10, 0),\n    /*L10*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 6, 12 - 11, 0),\n    /*L11*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 17, 0, 13 - 11),\n    /*L12*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n    /*L13*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n    /*L14*/ /* next filter */\n};\n```\n\nOh my gosh. It's like we traded one form of security privilege for\nanother. OpenBSD limits security to a small pond, but makes it easy.\nLinux is a big tent, but makes it impossibly hard. SECCOMP BPF might as\nwell be the Traditional Chinese of programming languages, since only a\nsmall number of people who've devoted the oodles of time it takes to\nunderstand code like what you see above have actually been able to\nbenefit from it. But if you've got OpenBSD privilege, then doing the\nsame thing becomes easy:\n\n```c\npledge(\&quot;stdio rpath\&quot;, 0);\n```\n\nThat's really all OpenBSD users have to do to prevent things like leaks\nof confidential information. So how do we get it that simple on Linux?\nThe answer is to find someone with enough free time to figure out how to\nuse SECCOMP BPF to implement pledge. The latest volunteers are us, so\nlook upon our code ye mighty and despair.\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2697,&quot;string&quot;:&quot;2,697&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:56,&quot;string&quot;:&quot;56&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:5,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/macros.internal.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_MACROS_INTERNAL_H_\n#define PLEDGE_LIBC_MACROS_INTERNAL_H_\n\n#define ROUNDUP(X, K) (((X) + (K)-1) &amp; -(K))\n#define ARRAYLEN(A) \\\n  ((sizeof(A) / sizeof(*(A))) / ((unsigned)!(sizeof(A) % sizeof(*(A)))))\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:227,&quot;string&quot;:&quot;227&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:9,&quot;string&quot;:&quot;9&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:6,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/dce.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_DCE_H_\n#define PLEDGE_LIBC_DCE_H_\n\n#ifndef __linux__\n#error \&quot;This program is extremely likely to only work properly on Linux !\&quot;\n#endif\n\n#define IsLinux() 1\n#define IsWindows() 0\n#define IsOpenbsd() 0\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:228,&quot;string&quot;:&quot;228&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:13,&quot;string&quot;:&quot;13&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:7,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/xdie.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include <stdlib.h>\n#include \&quot;libc/x/x.h\&quot;\n\nvoid xdie(void) {\n  abort();\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:1910,&quot;string&quot;:&quot;1,910&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:25,&quot;string&quot;:&quot;25&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:8,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/xstrcat.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/str/str.h\&quot;\n#include \&quot;libc/x/x.h\&quot;\n\n/**\n * Concatenates strings / chars to newly allocated memory, e.g.\n *\n *     xstrcat(\&quot;hi\&quot;, ' ', \&quot;there\&quot;)\n *\n * Or without the C99 helper macro:\n *\n *     (xstrcat)(\&quot;hi\&quot;, ' ', \&quot;there\&quot;, NULL)\n *\n * This goes twice as fast as the more powerful xasprintf(). It's not\n * quadratic like strcat(). It's much slower than high-effort stpcpy(),\n * particularly with string literals.\n *\n * @see gc()\n */\nchar *(xstrcat)(const char *s, ...) {\n  va_list va;\n  intptr_t q;\n  char *p, b[2];\n  size_t n, m, c;\n  n = 0;\n  c = 32;\n  p = xmalloc(c);\n  va_start(va, s);\n  do {\n    q = (intptr_t)s;\n    if (q > 0 &amp;&amp; q <= 255) {\n      b[0] = q;\n      b[1] = '\\0';\n      s = b;\n      m = 1;\n    } else {\n      m = strlen(s);\n    }\n    if (n + m + 1 > c) {\n      do {\n        c += c >> 1;\n      } while (n + m + 1 > c);\n      p = xrealloc(p, c);\n    }\n    memcpy(p + n, s, m + 1);\n    n += m;\n  } while ((s = va_arg(va, const char *)));\n  va_end(va);\n  return p;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2827,&quot;string&quot;:&quot;2,827&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:68,&quot;string&quot;:&quot;68&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:9,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/xmalloc.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/x/x.h\&quot;\n\n/**\n * Allocates uninitialized memory, or dies.\n */\nvoid *xmalloc(size_t bytes) {\n  void *res = malloc(bytes);\n  if (!res) xdie();\n  return res;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2006,&quot;string&quot;:&quot;2,006&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:29,&quot;string&quot;:&quot;29&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:10,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/xstrdup.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/intrin/likely.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n#include \&quot;libc/x/x.h\&quot;\n\n/**\n * Allocates new copy of string, or dies.\n */\nchar *xstrdup(const char *s) {\n  size_t len = strlen(s);\n  char *s2 = malloc(len + 1);\n  if (UNLIKELY(!s2)) xdie();\n  return memcpy(s2, s, len + 1);\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2118,&quot;string&quot;:&quot;2,118&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:32,&quot;string&quot;:&quot;32&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:11,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/xjoinpaths.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/intrin/safemacros.internal.h\&quot;\n#include \&quot;libc/str/path.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n#include \&quot;libc/x/x.h\&quot;\n\n/**\n * Joins paths, e.g.\n *\n *     \&quot;a\&quot;  + \&quot;b\&quot;  â \&quot;a/b\&quot;\n *     \&quot;a/\&quot; + \&quot;b\&quot;  â \&quot;a/b\&quot;\n *     \&quot;a\&quot;  + \&quot;b/\&quot; â \&quot;a/b/\&quot;\n *     \&quot;a\&quot;  + \&quot;/b\&quot; â \&quot;/b\&quot;\n *     \&quot;.\&quot;  + \&quot;b\&quot;  â \&quot;b\&quot;\n *     \&quot;\&quot;   + \&quot;b\&quot;  â \&quot;b\&quot;\n *\n * @return newly allocated string of resulting path\n */\nchar *xjoinpaths(const char *path, const char *other) {\n  if (!*other) {\n    return xstrdup(path);\n  } else if (!*path) {\n    return xstrdup(other);\n  } else if (isabspath(other) || !strcmp(path, \&quot;.\&quot;)) {\n    return xstrdup(other);\n  } else if (endswith(path, \&quot;/\&quot;)) {\n    return xstrcat(path, other);\n  } else {\n    return xstrcat(path, (uintptr_t)'/', other);\n  }\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2580,&quot;string&quot;:&quot;2,580&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:49,&quot;string&quot;:&quot;49&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:12,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/xrealloc.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/x/x.h\&quot;\n\n/**\n * Allocates/expands/shrinks/frees memory, or die.\n *\n * This API enables you to do the following:\n *\n *     p = xrealloc(p, n)\n *\n * The standard behaviors for realloc() still apply:\n *\n * - `!p` means xmalloc (returns non-NULL)\n * - `p &amp;&amp; n` means resize (returns non-NULL)\n * - `p &amp;&amp; !n` means free (returns NULL)\n *\n * The complexity of resizing is guaranteed to be amortized.\n */\nvoid *xrealloc(void *p, size_t n) {\n  void *q;\n  q = realloc(p, n);\n  if (!q &amp;&amp; !(p &amp;&amp; !n)) xdie();\n  return q;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2362,&quot;string&quot;:&quot;2,362&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:42,&quot;string&quot;:&quot;42&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:13,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/x/x.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_X_X_H_\n#define PLEDGE_LIBC_X_X_H_\n\n#include \&quot;libc/integral/c.h\&quot;\n\n_Noreturn void xdie(void);\nvoid *xmalloc(size_t);\nvoid *xrealloc(void *, size_t);\nchar *xstrdup(const char *);\nchar *xstrcat(const char *, ...);\n#define xstrcat(...) (xstrcat)(__VA_ARGS__, NULL)\nchar *xjoinpaths(const char *, const char *);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:334,&quot;string&quot;:&quot;334&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:15,&quot;string&quot;:&quot;15&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:14,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/fmt/conv.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_SIZETOL_H_\n#define PLEDGE_LIBC_SIZETOL_H_\n\n#include \&quot;libc/integral/c.h\&quot;\n\nlong sizetol(const char *, long) paramsnonnull() libcesque;\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:161,&quot;string&quot;:&quot;161&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:9,&quot;string&quot;:&quot;9&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:15,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/fmt/sizetol.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2021 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/fmt/conv.h\&quot;\n// #include \&quot;libc/fmt/fmt.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n// #include \&quot;libc/sysv/errfuns.h\&quot;\n\n#include <errno.h>\n\nstatic int GetExponent(int c) {\n  switch (c) {\n    case '\\0':\n    case ' ':\n    case '\\t':\n      return 0;\n    case 'k':\n    case 'K':\n      return 1;\n    case 'm':\n    case 'M':\n      return 2;\n    case 'g':\n    case 'G':\n      return 3;\n    case 't':\n    case 'T':\n      return 4;\n    case 'p':\n    case 'P':\n      return 5;\n    case 'e':\n    case 'E':\n      return 6;\n    default:\n      return -1;\n  }\n}\n\n/**\n * Converts size string to long.\n *\n * The following unit suffixes may be used\n *\n * - `k` or `K` for kilo (multiply by ðÂ¹)\n * - `m` or `M` for mega (multiply by ðÂ²)\n * - `g` or `G` for giga (multiply by ðÂ³)\n * - `t` or `T` for tera (multiply by ðâ´)\n * - `p` or `P` for peta (multiply by ðâµ)\n * - `e` or `E` for exa  (multiply by ðâ¶)\n *\n * If a permitted alpha character is supplied, then any additional\n * characters after it (e.g. kbit, Mibit, TiB) are ignored. Spaces\n * before the integer are ignored, and overflows will be detected.\n *\n * Negative numbers are permissible, as well as a leading `+` sign. To\n * tell the difference between an error return and `-1` you must clear\n * `errno` before calling and test whether it changed.\n *\n * @param s is non-null nul-terminated input string\n * @param b is multiplier which should be 1000 or 1024\n * @return size greater than or equal 0 or -1 on error\n * @error EINVAL if error is due to bad syntax\n * @error EOVERFLOW if error is due to overflow\n */\nlong sizetol(const char *s, long b) {\n  long x;\n  int c, e, d;\n  do {\n    c = *s++;\n  } while (c == ' ' || c == '\\t');\n  d = c == '-' ? -1 : 1;\n  if (c == '-' || c == '+') c = *s++;\n  if (!isdigit(c)) {\n    errno = EINVAL;\n    return -1;\n  }\n  x = 0;\n  do {\n    if (__builtin_mul_overflow(x, 10, &amp;x) ||\n        __builtin_add_overflow(x, (c - '0') * d, &amp;x)) {\n      errno = EOVERFLOW;\n      return -1;\n    }\n  } while (isdigit((c = *s++)));\n  if ((e = GetExponent(c)) == -1) {\n    errno = EINVAL;\n    return -1;\n  }\n  while (e--) {\n    if (__builtin_mul_overflow(x, b, &amp;x)) {\n      errno = EOVERFLOW;\n      return -1;\n    }\n  }\n  return x;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:4055,&quot;string&quot;:&quot;4,055&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:113,&quot;string&quot;:&quot;113&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:16,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/fmt/joinpaths.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/intrin/bits.h\&quot;\n#include \&quot;libc/str/path.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n// #include \&quot;libc/sysv/errfuns.h\&quot;\n\n/**\n * Joins paths, e.g.\n *\n *     0    + 0    â 0\n *     \&quot;\&quot;   + \&quot;\&quot;   â \&quot;\&quot;\n *     \&quot;a\&quot;  + 0    â \&quot;a\&quot;\n *     \&quot;a\&quot;  + \&quot;\&quot;   â \&quot;a/\&quot;\n *     0    + \&quot;b\&quot;  â \&quot;b\&quot;\n *     \&quot;\&quot;   + \&quot;b\&quot;  â \&quot;b\&quot;\n *     \&quot;.\&quot;  + \&quot;b\&quot;  â \&quot;./b\&quot;\n *     \&quot;b\&quot;  + \&quot;.\&quot;  â \&quot;b/.\&quot;\n *     \&quot;a\&quot;  + \&quot;b\&quot;  â \&quot;a/b\&quot;\n *     \&quot;a/\&quot; + \&quot;b\&quot;  â \&quot;a/b\&quot;\n *     \&quot;a\&quot;  + \&quot;b/\&quot; â \&quot;a/b/\&quot;\n *     \&quot;a\&quot;  + \&quot;/b\&quot; â \&quot;/b\&quot;\n *\n * @return joined path, which may be `buf`, `path`, or `other`, or null\n *     if (1) `buf` didn't have enough space, or (2) both `path` and\n *     `other` were null\n */\nchar *joinpaths(char *buf, size_t size, const char *path, const char *other) {\n  size_t pathlen, otherlen;\n  if (!other) return (char *)path;\n  if (!path) return (char *)other;\n  pathlen = strlen(path);\n  if (!pathlen || *other == '/') {\n    return (/*unconst*/ char *)other;\n  }\n  otherlen = strlen(other);\n  if (path[pathlen - 1] == '/') {\n    if (pathlen + otherlen + 1 <= size) {\n      memmove(buf, path, pathlen);\n      memmove(buf + pathlen, other, otherlen + 1);\n      return buf;\n    } else {\n      return 0;\n    }\n  } else {\n    if (pathlen + 1 + otherlen + 1 <= size) {\n      memmove(buf, path, pathlen);\n      buf[pathlen] = '/';\n      memmove(buf + pathlen + 1, other, otherlen + 1);\n      return buf;\n    } else {\n      return 0;\n    }\n  }\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:3244,&quot;string&quot;:&quot;3,244&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:72,&quot;string&quot;:&quot;72&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:17,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/elf/getelfsegmentheaderaddress.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/elf/elf.h\&quot;\n\nElf64_Phdr *GetElfSegmentHeaderAddress(const Elf64_Ehdr *elf, size_t mapsize,\n                                       unsigned i) {\n  intptr_t addr =\n      ((intptr_t)elf + (intptr_t)elf->e_phoff + (intptr_t)elf->e_phentsize * i);\n  CheckElfAddress(elf, mapsize, addr, elf->e_phentsize);\n  return (Elf64_Phdr *)addr;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2181,&quot;string&quot;:&quot;2,181&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:28,&quot;string&quot;:&quot;28&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:18,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/elf/checkelfaddress.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/elf/elf.h\&quot;\n#include \&quot;libc/runtime/runtime.h\&quot;\n\nvoid CheckElfAddress(const Elf64_Ehdr *elf, size_t mapsize, intptr_t addr,\n                     size_t addrsize) {\n#if 1//!(TRUSTWORTHY + ELF_TRUSTWORTHY + 0) || ELF_UNTRUSTWORTHY + 0\n  if (addr < (intptr_t)elf || addr + addrsize > (intptr_t)elf + mapsize) {\n    /* kprintf(\&quot;%p-%p falls outside interval %p-%p\&quot;,  // */\n    /*         addr, addr + addrsize,                 // */\n    /*         elf, (char *)elf + mapsize);           // */\n    abort();\n  }\n#endif\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2362,&quot;string&quot;:&quot;2,362&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:33,&quot;string&quot;:&quot;33&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:19,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/elf/elf.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_ELF_ELF_H_\n#define PLEDGE_LIBC_ELF_ELF_H_\n\n#include <elf.h>\n#include <stddef.h>\n\nvoid CheckElfAddress(const Elf64_Ehdr *, size_t, intptr_t, size_t);\nElf64_Phdr *GetElfSegmentHeaderAddress(const Elf64_Ehdr *, size_t, unsigned);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:255,&quot;string&quot;:&quot;255&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:11,&quot;string&quot;:&quot;11&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:20,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/blockcancel.internal.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_CALLS_BLOCKCANCEL_INTERNAL_H_\n#define PLEDGE_LIBC_CALLS_BLOCKCANCEL_INTERNAL_H_\n\n#define ALLOW_CANCELLATIONS                   \\\n  pthread_allow_cancellations(_cancelState);  \\\n  }                                           \\\n  while (0)\n\nvoid pthread_allow_cancellations(int);\n\n#define BLOCK_CANCELLATIONS \\\n  do {                      \\\n    int _cancelState;       \\\n  _cancelState = pthread_block_cancellations()\n\nint pthread_block_cancellations(void);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:483,&quot;string&quot;:&quot;483&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:19,&quot;string&quot;:&quot;19&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:21,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/getcpucount.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2021 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include <sched.h>\n#include \&quot;libc/calls/calls.h\&quot;\n#include \&quot;libc/runtime/runtime.h\&quot;\n\nstatic unsigned _getcpucount_linux(void) {\n  cpu_set_t s = {0};\n  if (sched_getaffinity(0, sizeof(s), &amp;s) != -1) {\n    return CPU_COUNT(&amp;s);\n  } else {\n    return 0;\n  }\n}\n\nstatic unsigned _getcpucount_impl(void) {\n  return _getcpucount_linux();\n}\n\nstatic int g_cpucount;\n\n// precompute because process affinity on linux may change later\n__attribute__((__constructor__)) static void _getcpucount_init(void) {\n  g_cpucount = _getcpucount_impl();\n}\n\n/**\n * Returns number of CPUs in system.\n *\n * This is the same as the standard interface:\n *\n *     sysconf(_SC_NPROCESSORS_ONLN);\n *\n * Except this function isn't a bloated diamond dependency.\n *\n * On Intel systems with HyperThreading this will return the number of\n * cores multiplied by two.\n *\n * @return cpu count or 0 if it couldn't be determined\n */\nunsigned getcpucount(void) {\n  return g_cpucount;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2779,&quot;string&quot;:&quot;2,779&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:60,&quot;string&quot;:&quot;60&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:22,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/islinux.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include <errno.h>\n#include <stdbool.h>\n#include <sys/prctl.h>\n#include \&quot;libc/dce.h\&quot;\n#include \&quot;libc/runtime/runtime.h\&quot;\n\nprivileged bool is_linux_2_6_23(void) {\n  return prctl(PR_GET_SECCOMP) >= 0 || errno != EINVAL;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2054,&quot;string&quot;:&quot;2,054&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:28,&quot;string&quot;:&quot;28&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:23,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/parsepromises.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/pledge.internal.h\&quot;\n#include \&quot;libc/macros.internal.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n\nstatic int FindPromise(const char *name) {\n  int i;\n  for (i = 0; i < ARRAYLEN(kPledge); ++i) {\n    if (!strcasecmp(name, kPledge[i].name)) {\n      return i;\n    }\n  }\n  return -1;\n}\n\n/**\n * Parses the arguments to pledge() into a bitmask.\n *\n * @return 0 on success, or -1 if invalid\n */\nint ParsePromises(const char *promises, unsigned long *out) {\n  int rc = 0;\n  int promise;\n  unsigned long ipromises;\n  char *tok, *state, *start, buf[256];\n  if (promises) {\n    ipromises = -1;\n    if (memccpy(buf, promises, 0, sizeof(buf))) {\n      start = buf;\n      while ((tok = strtok_r(start, \&quot; \\t\\r\\n\&quot;, &amp;state))) {\n        if ((promise = FindPromise(tok)) != -1) {\n          ipromises &amp;= ~(1ULL << promise);\n        } else {\n          rc = -1;\n          break;\n        }\n        start = 0;\n      }\n    } else {\n      rc = -1;\n    }\n  } else {\n    ipromises = 0;\n  }\n  if (!rc) {\n    *out = ipromises;\n  }\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2854,&quot;string&quot;:&quot;2,854&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:67,&quot;string&quot;:&quot;67&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:24,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/commandv.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/calls.h\&quot;\n// #include \&quot;libc/calls/struct/stat.h\&quot;\n#include \&quot;libc/dce.h\&quot;\n// #include \&quot;libc/errno.h\&quot;\n#include \&quot;libc/intrin/bits.h\&quot;\n#include \&quot;libc/intrin/safemacros.internal.h\&quot;\n// #include \&quot;libc/intrin/strace.internal.h\&quot;\n// #include \&quot;libc/log/libfatal.internal.h\&quot;\n#include \&quot;libc/runtime/runtime.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n/*\n#include \&quot;libc/sysv/consts/ok.h\&quot;\n#include \&quot;libc/sysv/consts/s.h\&quot;\n#include \&quot;libc/sysv/errfuns.h\&quot;\n*/\n\n#include <errno.h>\n#include <sys/stat.h>\n#include <unistd.h>\n\nstatic bool IsExePath(const char *s, size_t n) {\n  return n >= 4 &amp;&amp; (READ32LE(s + n - 4) == READ32LE(\&quot;.exe\&quot;) ||\n                    READ32LE(s + n - 4) == READ32LE(\&quot;.EXE\&quot;));\n}\n\nstatic bool IsComPath(const char *s, size_t n) {\n  return n >= 4 &amp;&amp; (READ32LE(s + n - 4) == READ32LE(\&quot;.com\&quot;) ||\n                    READ32LE(s + n - 4) == READ32LE(\&quot;.COM\&quot;));\n}\n\nstatic bool IsComDbgPath(const char *s, size_t n) {\n  return n >= 8 &amp;&amp; (READ64LE(s + n - 8) == READ64LE(\&quot;.com.dbg\&quot;) ||\n                    READ64LE(s + n - 8) == READ64LE(\&quot;.COM.DBG\&quot;));\n}\n\nstatic bool AccessCommand(const char *name, char *path, size_t pathsz,\n                          size_t namelen, int *err, const char *suffix,\n                          size_t pathlen) {\n  size_t suffixlen;\n  suffixlen = strlen(suffix);\n  if (IsWindows() &amp;&amp; suffixlen == 0 &amp;&amp; !IsExePath(name, namelen) &amp;&amp;\n      !IsComPath(name, namelen))\n    return false;\n  if (pathlen + 1 + namelen + suffixlen + 1 > pathsz) return false;\n  if (pathlen &amp;&amp; (path[pathlen - 1] != '/' &amp;&amp; path[pathlen - 1] != '\\\\')) {\n    path[pathlen] = !IsWindows()                  ? '/'\n                    : memchr(path, '\\\\', pathlen) ? '\\\\'\n                                                  : '/';\n    pathlen++;\n  }\n  memcpy(path + pathlen, name, namelen);\n  memcpy(path + pathlen + namelen, suffix, suffixlen + 1);\n  if (!access(path, X_OK)) {\n    struct stat st;\n    if (!stat(path, &amp;st)) {\n      if (S_ISREG(st.st_mode)) {\n        return true;\n      } else {\n        errno = EACCES;\n      }\n    }\n  }\n  if (errno == EACCES || *err != EACCES) *err = errno;\n  return false;\n}\n\nstatic bool SearchPath(const char *name, char *path, size_t pathsz,\n                       size_t namelen, int *err, const char *suffix) {\n  char sep;\n  size_t i;\n  const char *p;\n  if (!(p = getenv(\&quot;PATH\&quot;))) p = \&quot;/bin:/usr/local/bin:/usr/bin\&quot;;\n  sep = IsWindows() &amp;&amp; strchr(p, ';') ? ';' : ':';\n  for (;;) {\n    for (i = 0; p[i] &amp;&amp; p[i] != sep; ++i) {\n      if (i < pathsz) {\n        path[i] = p[i];\n      }\n    }\n    if (AccessCommand(name, path, pathsz, namelen, err, suffix, i)) {\n      return true;\n    }\n    if (p[i] == sep) {\n      p += i + 1;\n    } else {\n      break;\n    }\n  }\n  return false;\n}\n\nstatic bool FindCommand(const char *name, char *pb, size_t pbsz, size_t namelen,\n                        bool pri, const char *suffix, int *err) {\n  if (pri &amp;&amp; (memchr(name, '/', namelen) || memchr(name, '\\\\', namelen))) {\n    pb[0] = 0;\n    return AccessCommand(name, pb, pbsz, namelen, err, suffix, 0);\n  }\n  return SearchPath(name, pb, pbsz, namelen, err, suffix);\n}\n\nstatic bool FindVerbatim(const char *name, char *pb, size_t pbsz,\n                         size_t namelen, bool pri, int *err) {\n  return FindCommand(name, pb, pbsz, namelen, pri, \&quot;\&quot;, err);\n}\n\nstatic bool FindSuffixed(const char *name, char *pb, size_t pbsz,\n                         size_t namelen, bool pri, int *err) {\n  return !IsExePath(name, namelen) &amp;&amp; !IsComPath(name, namelen) &amp;&amp;\n         !IsComDbgPath(name, namelen) &amp;&amp;\n         (FindCommand(name, pb, pbsz, namelen, pri, \&quot;.com\&quot;, err) ||\n          FindCommand(name, pb, pbsz, namelen, pri, \&quot;.exe\&quot;, err));\n}\n\n/**\n * Resolves full pathname of executable.\n *\n * @return execve()'able path, or NULL w/ errno\n * @errno ENOENT, EACCES, ENOMEM\n * @see free(), execvpe()\n * @asyncsignalsafe\n * @vforksafe\n */\nchar *commandv(const char *name, char *pathbuf, size_t pathbufsz) {\n  int e, f;\n  char *res;\n  size_t namelen;\n  res = 0;\n  if (!name) {\n    errno = EFAULT;\n  } else if (!(namelen = strlen(name))) {\n    errno = ENOENT;\n  } else if (namelen + 1 > pathbufsz) {\n    errno = ENAMETOOLONG;\n  } else {\n    e = errno;\n    f = ENOENT;\n    if ((IsWindows() &amp;&amp;\n         (FindSuffixed(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||\n          FindVerbatim(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||\n          FindSuffixed(name, pathbuf, pathbufsz, namelen, false, &amp;f) ||\n          FindVerbatim(name, pathbuf, pathbufsz, namelen, false, &amp;f))) ||\n        (!IsWindows() &amp;&amp;\n         (FindVerbatim(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||\n          FindSuffixed(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||\n          FindVerbatim(name, pathbuf, pathbufsz, namelen, false, &amp;f) ||\n          FindSuffixed(name, pathbuf, pathbufsz, namelen, false, &amp;f)))) {\n      errno = e;\n      res = pathbuf;\n    } else {\n      errno = f;\n    }\n  }\n  return res;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:6718,&quot;string&quot;:&quot;6,718&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:173,&quot;string&quot;:&quot;173&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:25,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/unveil.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2020 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n/*\n#include \&quot;libc/assert.h\&quot;\n*/\n#include \&quot;libc/calls/blockcancel.internal.h\&quot;\n#include \&quot;libc/calls/calls.h\&quot;\n#include \&quot;libc/calls/landlock.h\&quot;\n/*\n#include \&quot;libc/calls/struct/bpf.h\&quot;\n#include \&quot;libc/calls/struct/filter.h\&quot;\n#include \&quot;libc/calls/struct/seccomp.h\&quot;\n#include \&quot;libc/calls/struct/stat.h\&quot;\n#include \&quot;libc/calls/struct/stat.internal.h\&quot;\n#include \&quot;libc/calls/syscall-sysv.internal.h\&quot;\n*/\n#include \&quot;libc/calls/syscall_support-sysv.internal.h\&quot;\n/*\n#include \&quot;libc/errno.h\&quot;\n*/\n#include \&quot;libc/fmt/conv.h\&quot;\n/*\n#include \&quot;libc/intrin/strace.internal.h\&quot;\n*/\n#include \&quot;libc/macros.internal.h\&quot;\n/*\n#include \&quot;libc/nexgen32e/vendor.internal.h\&quot;\n#include \&quot;libc/runtime/internal.h\&quot;\n*/\n#include \&quot;libc/runtime/runtime.h\&quot;\n#include \&quot;libc/runtime/stack.h\&quot;\n#include \&quot;libc/str/path.h\&quot;\n#include \&quot;libc/str/str.h\&quot;\n/*\n#include \&quot;libc/sysv/consts/at.h\&quot;\n#include \&quot;libc/sysv/consts/audit.h\&quot;\n#include \&quot;libc/sysv/consts/f.h\&quot;\n#include \&quot;libc/sysv/consts/fd.h\&quot;\n#include \&quot;libc/sysv/consts/nrlinux.h\&quot;\n#include \&quot;libc/sysv/consts/o.h\&quot;\n#include \&quot;libc/sysv/consts/pr.h\&quot;\n#include \&quot;libc/sysv/consts/s.h\&quot;\n#include \&quot;libc/sysv/errfuns.h\&quot;\n#include \&quot;libc/thread/tls.h\&quot;\n*/\n\n#include <errno.h>\n#include <fcntl.h>\n#include <libgen.h>\n#include <limits.h>\n#include <linux/filter.h>\n#include <linux/seccomp.h>\n#include <stddef.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/prctl.h>\n#include <sys/stat.h>\n#include <sys/syscall.h>\n#include <unistd.h>\n\n#define OFF(f) offsetof(struct seccomp_data, f)\n\n#define UNVEIL_READ                                             \\\n  (LANDLOCK_ACCESS_FS_READ_FILE | LANDLOCK_ACCESS_FS_READ_DIR | \\\n   LANDLOCK_ACCESS_FS_REFER)\n#define UNVEIL_WRITE \\\n  (LANDLOCK_ACCESS_FS_WRITE_FILE | LANDLOCK_ACCESS_FS_TRUNCATE)\n#define UNVEIL_EXEC (LANDLOCK_ACCESS_FS_EXECUTE)\n#define UNVEIL_CREATE                                             \\\n  (LANDLOCK_ACCESS_FS_MAKE_CHAR | LANDLOCK_ACCESS_FS_MAKE_DIR |   \\\n   LANDLOCK_ACCESS_FS_MAKE_REG | LANDLOCK_ACCESS_FS_MAKE_SOCK |   \\\n   LANDLOCK_ACCESS_FS_MAKE_FIFO | LANDLOCK_ACCESS_FS_MAKE_BLOCK | \\\n   LANDLOCK_ACCESS_FS_MAKE_SYM)\n\n#define FILE_BITS                                                 \\\n  (LANDLOCK_ACCESS_FS_READ_FILE | LANDLOCK_ACCESS_FS_WRITE_FILE | \\\n   LANDLOCK_ACCESS_FS_EXECUTE)\n\nstatic struct sock_filter kUnveilBlacklistAbiVersionBelow3[] = {\n#if 0  // Should we have this ? It certainly means things don't work on other\n       // architectures than x86-64 as-is... (TODO check this up later when\n       // relevant)\n    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(arch)),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AUDIT_ARCH_X86_64, 1, 0),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),\n#endif\n    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_truncate, 1, 0),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_setxattr, 0, 1),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (1 &amp; SECCOMP_RET_DATA)),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n};\n\nstatic struct sock_filter kUnveilBlacklistLatestAbi[] = {\n#if 0\n    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(arch)),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AUDIT_ARCH_X86_64, 1, 0),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),\n#endif\n    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_setxattr, 0, 1),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (1 &amp; SECCOMP_RET_DATA)),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n};\n\nstatic int landlock_abi_version;\n\n__attribute__((__constructor__)) void init_landlock_version() {\n  landlock_abi_version =\n      landlock_create_ruleset(0, 0, LANDLOCK_CREATE_RULESET_VERSION);\n}\n\n/**\n * Long living state for landlock calls.\n * fs_mask is set to use all the access rights from the latest landlock ABI.\n * On init, the current supported abi is checked and unavailable rights are\n * masked off.\n *\n * As of 6.2, the latest abi is v3.\n *\n * TODO:\n *  - Integrate with pledge and remove the file access?\n *  - Stuff state into the .protected section?\n */\n_Thread_local static struct {\n  uint64_t fs_mask;\n  int fd;\n} State;\n\nstatic int unveil_final(void) {\n  int e, rc;\n  struct sock_fprog sandbox = {\n      .filter = kUnveilBlacklistLatestAbi,\n      .len = ARRAYLEN(kUnveilBlacklistLatestAbi),\n  };\n  if (landlock_abi_version < 3) {\n    sandbox = (struct sock_fprog){\n        .filter = kUnveilBlacklistAbiVersionBelow3,\n        .len = ARRAYLEN(kUnveilBlacklistAbiVersionBelow3),\n    };\n  }\n  e = errno;\n  prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);\n  errno = e;\n  if ((rc = landlock_restrict_self(State.fd, 0)) != -1 &amp;&amp;\n      (rc = close(State.fd)) != -1 &amp;&amp;\n      (rc = prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &amp;sandbox)) != -1) {\n    State.fd = 0;\n  }\n  return rc;\n}\n\nstatic int err_close(int rc, int fd) {\n  int serrno = errno;\n  close(fd);\n  errno = serrno;\n  return rc;\n}\n\nstatic int unveil_init(void) {\n  int rc, fd;\n  State.fs_mask = UNVEIL_READ | UNVEIL_WRITE | UNVEIL_EXEC | UNVEIL_CREATE;\n  if (landlock_abi_version == -1) {\n    if (errno == EOPNOTSUPP) {\n      errno = ENOSYS;\n    }\n    return -1;\n  }\n  if (landlock_abi_version < 2) {\n    State.fs_mask &amp;= ~LANDLOCK_ACCESS_FS_REFER;\n  }\n  if (landlock_abi_version < 3) {\n    State.fs_mask &amp;= ~LANDLOCK_ACCESS_FS_TRUNCATE;\n  }\n  const struct landlock_ruleset_attr attr = {\n      .handled_access_fs = State.fs_mask,\n  };\n  // [undocumented] landlock_create_ruleset() always returns o_cloexec\n  //                assert(__sys_fcntl(rc, F_GETFD, 0) == FD_CLOEXEC);\n  if ((rc = landlock_create_ruleset(&amp;attr, sizeof(attr), 0)) < 0) return -1;\n  // grant file descriptor a higher number that's less likely to interfere\n  if ((fd = fcntl(rc, F_DUPFD_CLOEXEC, 100)) == -1) {\n    return err_close(-1, rc);\n  }\n  if (close(rc) == -1) {\n    return err_close(-1, fd);\n  }\n  State.fd = fd;\n  return 0;\n}\n\nint sys_unveil_linux(const char *path, const char *permissions) {\n  int rc;\n  const char *dir;\n  const char *last;\n  const char *next;\n  struct {\n    char lbuf[PATH_MAX];\n    char buf1[PATH_MAX];\n    char buf2[PATH_MAX];\n    char buf3[PATH_MAX];\n    char buf4[PATH_MAX];\n  } b;\n  CheckLargeStackAllocation(&amp;b, sizeof(b));\n\n  if (!State.fd &amp;&amp; (rc = unveil_init()) == -1) return rc;\n  if ((path &amp;&amp; !permissions) || (!path &amp;&amp; permissions)) {\n    errno = EINVAL;\n    return -1;\n  }\n  if (!path &amp;&amp; !permissions) return unveil_final();\n  struct landlock_path_beneath_attr pb = {0};\n  for (const char *c = permissions; *c != '\\0'; c++) {\n    switch (*c) {\n      case 'r':\n        pb.allowed_access |= UNVEIL_READ;\n        break;\n      case 'w':\n        pb.allowed_access |= UNVEIL_WRITE;\n        break;\n      case 'x':\n        pb.allowed_access |= UNVEIL_EXEC;\n        break;\n      case 'c':\n        pb.allowed_access |= UNVEIL_CREATE;\n        break;\n      default:\n        errno = EINVAL;\n        return -1;\n    }\n  }\n  pb.allowed_access &amp;= State.fs_mask;\n\n  // landlock exposes all metadata, so we only technically need to add\n  // realpath(path) to the ruleset. however a corner case exists where\n  // it isn't valid, e.g. /dev/stdin -> /proc/2834/fd/pipe:[51032], so\n  // we'll need to work around this, by adding the path which is valid\n  if (strlen(path) + 1 > PATH_MAX) {\n    errno = ENAMETOOLONG;\n    return -1;\n  }\n  last = path;\n  next = path;\n  for (int i = 0;; ++i) {\n    if (i == 64) {\n      // give up\n      errno = ELOOP;\n      return -1;\n    }\n    int err = errno;\n    if ((rc = readlinkat(AT_FDCWD, next, b.lbuf, PATH_MAX)) != -1) {\n      if (rc < PATH_MAX) {\n        // we need to nul-terminate\n        b.lbuf[rc] = 0;\n        // last = next\n        strcpy(b.buf1, next);\n        last = b.buf1;\n        // next = join(dirname(next), link)\n        strcpy(b.buf2, next);\n        dir = dirname(b.buf2);\n        if ((next = joinpaths(b.buf3, PATH_MAX, dir, b.lbuf))) {\n          // next now points to either: buf3, buf2, lbuf, rodata\n          strcpy(b.buf4, next);\n          next = b.buf4;\n        } else {\n          errno = ENAMETOOLONG;\n          return -1;\n        }\n      } else {\n        // symbolic link data was too long\n        errno = ENAMETOOLONG;\n        return -1;\n      }\n    } else if (errno == EINVAL) {\n      // next wasn't a symbolic link\n      errno = err;\n      path = next;\n      break;\n    } else if (i &amp;&amp; (errno == ENOENT || errno == ENOTDIR)) {\n      // next is a broken symlink, use last\n      errno = err;\n      path = last;\n      break;\n    } else {\n      // readlink failed for some other reason\n      return -1;\n    }\n  }\n\n  // now we can open the path\n  BLOCK_CANCELLATIONS;\n  rc = open(path, O_PATH | O_NOFOLLOW | O_CLOEXEC, 0);\n  ALLOW_CANCELLATIONS;\n  if (rc == -1) return rc;\n\n  pb.parent_fd = rc;\n  struct stat st;\n  if ((rc = fstat(pb.parent_fd, &amp;st)) == -1) {\n    return err_close(rc, pb.parent_fd);\n  }\n  if (!S_ISDIR(st.st_mode)) {\n    pb.allowed_access &amp;= FILE_BITS;\n  }\n  if ((rc = landlock_add_rule(State.fd, LANDLOCK_RULE_PATH_BENEATH, &amp;pb, 0))) {\n    return err_close(rc, pb.parent_fd);\n  }\n  close(pb.parent_fd);\n  return rc;\n}\n\n/**\n * Makes files accessible, e.g.\n *\n *     unveil(\&quot;.\&quot;, \&quot;r\&quot;);     // current directory + children are visible\n *     unveil(\&quot;/etc\&quot;, \&quot;r\&quot;);  // make /etc readable too\n *     unveil(0, 0);         // commit and lock policy\n *\n * Unveiling restricts a view of the filesystem to a set of allowed\n * paths with specific privileges.\n *\n * Once you start using unveil(), the entire file system is considered\n * hidden. You then specify, by repeatedly calling unveil(), which paths\n * should become unhidden. When you're finished, you call `unveil(0,0)`\n * which commits your policy.\n *\n * This function requires OpenBSD or Linux 5.13+. We don't consider lack\n * of system support to be an ENOSYS error, because the files will still\n * become unveiled. Therefore we return 0 in such cases.\n *\n * There are some differences between unveil() on Linux versus OpenBSD.\n *\n * 1. Build your policy and lock it in one go. On OpenBSD, policies take\n *    effect immediately and may evolve as you continue to call unveil()\n *    but only in a more restrictive direction. On Linux, nothing will\n *    happen until you call `unveil(0,0)` which commits and locks.\n *\n * 2. Try not to overlap directory trees. On OpenBSD, if directory trees\n *    overlap, then the most restrictive policy will be used for a given\n *    file. On Linux overlapping may result in a less restrictive policy\n *    and possibly even undefined behavior.\n *\n * 3. OpenBSD and Linux disagree on error codes. On OpenBSD, accessing\n *    paths outside of the allowed set raises ENOENT, and accessing ones\n *    with incorrect permissions raises EACCES. On Linux, both these\n *    cases raise EACCES.\n *\n * 4. Unlike OpenBSD, Linux does nothing to conceal the existence of\n *    paths. Even with an unveil() policy in place, it's still possible\n *    to access the metadata of all files using functions like stat()\n *    and open(O_PATH), provided you know the path. A sandboxed process\n *    can always, for example, determine how many bytes of data are in\n *    /etc/passwd, even if the file isn't readable. But it's still not\n *    possible to use opendir() and go fishing for paths which weren't\n *    previously known.\n *\n * 5. Use ftruncate() rather than truncate() if you wish for portability to\n *    Linux kernels versions released before February 2022. One issue\n *    Landlock hadn't addressed as of ABI version 2 was restrictions over\n *    truncate() and setxattr() which could permit certain kinds of\n *    modifications to files outside the sandbox. When your policy is\n *    committed, we install a SECCOMP BPF filter to disable those calls,\n *    however similar trickery may be possible through other unaddressed\n *    calls like ioctl(). Using the pledge() function in addition to\n *    unveil() will solve this, since it installs a strong system call\n *    access policy. Linux 6.2 has improved this situation with Landlock\n *    ABI v3, which added the ability to control truncation operations -\n *    this means the SECCOMP BPF filter will only disable\n *    truncate() on Linux 6.1 or older\n *\n * 6. Set your process-wide policy at startup from the main thread. On\n *    OpenBSD unveil() will apply process-wide even when called from a\n *    child thread; whereas with Linux, calling unveil() from a thread\n *    will cause your ruleset to only apply to that thread in addition\n *    to any descendent threads it creates.\n *\n * 7. Always specify at least one path. OpenBSD has unclear semantics\n *    when `unveil(0,0)` is used without any previous calls.\n *\n * 8. On OpenBSD calling `unveil(0,0)` will prevent unveil() from being\n *    used again. On Linux this is allowed, because Landlock is able to\n *    do that securely, i.e. the second ruleset can only be a subset of\n *    the previous ones.\n *\n * This system call is supported natively on OpenBSD and polyfilled on\n * Linux using the Landlock LSM[1].\n *\n * @param path is the file or directory to unveil\n * @param permissions is a string consisting of zero or more of the\n *     following characters:\n *\n *     - 'r' makes `path` available for read-only path operations,\n *       corresponding to the pledge promise \&quot;rpath\&quot;.\n *\n *     - `w` makes `path` available for write operations, corresponding\n *       to the pledge promise \&quot;wpath\&quot;.\n *\n *     - `x` makes `path` available for execute operations,\n *       corresponding to the pledge promises \&quot;exec\&quot; and \&quot;execnative\&quot;.\n *\n *     - `c` allows `path` to be created and removed, corresponding to\n *       the pledge promise \&quot;cpath\&quot;.\n *\n * @return 0 on success, or -1 w/ errno\n * @raise EINVAL if one argument is set and the other is not\n * @raise EINVAL if an invalid character in `permissions` was found\n * @raise EPERM if unveil() is called after locking\n * @note on Linux this function requires Linux Kernel 5.13+ and version 6.2+\n *     to properly support truncation operations\n * @see [1] https://docs.kernel.org/userspace-api/landlock.html\n * @threadsafe\n */\nint unveil(const char *path, const char *permissions) {\n  int e, rc;\n  e = errno;\n  /*if (IsGenuineBlink()) {\n    rc = 0;  // blink doesn't support landlock\n  } else if (IsLinux()) {*/\n  rc = sys_unveil_linux(path, permissions);\n  /*} else {\n    abort();\n    rc = sys_unveil(path, permissions);\n  }*/\n  if (rc == -1 &amp;&amp; errno == ENOSYS) {\n    errno = e;\n    rc = 0;\n  }\n  // STRACE(\&quot;unveil(%#s, %#s) â %d% m\&quot;, path, permissions, rc);\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:16207,&quot;string&quot;:&quot;16,207&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:446,&quot;string&quot;:&quot;446&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:26,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/calls.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_CALLS_H_\n#define PLEDGE_LIBC_CALLS_H_\n\n#include <stddef.h>\n\nchar *commandv(const char *, char *, size_t);\nint ioprio_set(int, int, int);\nint pledge(const char *, const char *);\nint unveil(const char *, const char *);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:245,&quot;string&quot;:&quot;245&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:12,&quot;string&quot;:&quot;12&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:27,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/pledge.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_CALLS_PLEDGE_H_\n#define PLEDGE_LIBC_CALLS_PLEDGE_H_\n\n#define PLEDGE_PENALTY_KILL_THREAD  0x0000\n#define PLEDGE_PENALTY_KILL_PROCESS 0x0001\n#define PLEDGE_PENALTY_RETURN_EPERM 0x0002\n#define PLEDGE_PENALTY_MASK         0x000f\n#define PLEDGE_STDERR_LOGGING       0x0010\n\nextern int __pledge_mode;\n\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:324,&quot;string&quot;:&quot;324&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:14,&quot;string&quot;:&quot;14&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:28,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/pledge-linux.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include <errno.h>\n#include <fcntl.h>\n#include <linux/audit.h>\n#include <linux/filter.h>\n#include <linux/seccomp.h>\n#include <netinet/in.h>\n#include <netinet/ip.h>\n#include <netinet/tcp.h>\n#include <sched.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <stdbool.h>\n#include <string.h>\n#include <sys/ioctl.h>\n#include <sys/mman.h>\n#include <sys/prctl.h>\n#include <sys/socket.h>\n#include <sys/syscall.h>\n#include <unistd.h>\n#include \&quot;libc/calls/pledge.internal.h\&quot;\n#include \&quot;libc/intrin/likely.h\&quot;\n#include \&quot;libc/intrin/promises.internal.h\&quot;\n#include \&quot;libc/macros.internal.h\&quot;\n#include \&quot;libc/runtime/runtime.h\&quot;\n#include \&quot;libc/runtime/stack.h\&quot;\n\n/**\n * @fileoverview OpenBSD pledge() Polyfill Payload for GNU/Systemd\n *\n * This file contains only the minimum amount of Linux-specific code\n * that's necessary to get a pledge() policy installed. This file is\n * designed to not use static or tls memory or libc depnedencies, so\n * it can be transplanted into codebases and injected into programs.\n */\n\n#define SPECIAL   0xf000\n#define SELF      0x8000\n#define ADDRLESS  0x2000\n#define INET      0x2000\n#define LOCK      0x4000\n#define NOEXEC    0x8000\n#define EXEC      0x4000\n#define READONLY  0x8000\n#define WRITEONLY 0x4000\n#define CREATONLY 0x2000\n#define STDIO     0x8000\n#define THREAD    0x8000\n#define TTY       0x8000\n#define UNIX      0x4000\n#define NOBITS    0x8000\n#define RESTRICT  0x1000\n\n#define PLEDGE(pledge) pledge, ARRAYLEN(pledge)\n#define OFF(f)         offsetof(struct seccomp_data, f)\n#define bsr(x)         (__builtin_clzll(x) ^ 63)\n\n#ifdef __x86_64__\n#define MCONTEXT_SYSCALL_RESULT_REGISTER gregs[REG_RAX]\n#define MCONTEXT_INSTRUCTION_POINTER     gregs[REG_RIP]\n#define ARCHITECTURE                     AUDIT_ARCH_X86_64\n#elif defined(__aarch64__)\n#define MCONTEXT_SYSCALL_RESULT_REGISTER regs[0]\n#define MCONTEXT_INSTRUCTION_POINTER     pc\n#define ARCHITECTURE                     AUDIT_ARCH_AARCH64\n#else\n#error \&quot;unsupported architecture\&quot;\n#endif\n\nstruct Filter {\n  size_t n;\n  struct sock_filter p[800];\n};\n\nstatic const struct thatispacked SyscallName {\n  uint16_t n;\n  const char *const s;\n} kSyscallName[] = {\n    {__NR_exit, \&quot;exit\&quot;},\n    {__NR_exit_group, \&quot;exit_group\&quot;},\n    {__NR_read, \&quot;read\&quot;},\n    {__NR_write, \&quot;write\&quot;},\n#ifdef __NR_open\n    {__NR_open, \&quot;open\&quot;},\n#endif\n    {__NR_close, \&quot;close\&quot;},\n#ifdef __NR_stat\n    {__NR_stat, \&quot;stat\&quot;},\n#endif\n    {__NR_fstat, \&quot;fstat\&quot;},\n#ifdef __NR_lstat\n    {__NR_lstat, \&quot;lstat\&quot;},\n#endif\n#ifdef __NR_poll\n    {__NR_poll, \&quot;poll\&quot;},\n#endif\n    {__NR_ppoll, \&quot;ppoll\&quot;},\n    {__NR_brk, \&quot;brk\&quot;},\n    {__NR_rt_sigreturn, \&quot;sigreturn\&quot;},\n    {__NR_lseek, \&quot;lseek\&quot;},\n    {__NR_mmap, \&quot;mmap\&quot;},\n    {__NR_msync, \&quot;msync\&quot;},\n    {__NR_mprotect, \&quot;mprotect\&quot;},\n    {__NR_munmap, \&quot;munmap\&quot;},\n    {__NR_rt_sigaction, \&quot;sigaction\&quot;},\n    {__NR_rt_sigprocmask, \&quot;sigprocmask\&quot;},\n    {__NR_ioctl, \&quot;ioctl\&quot;},\n    {__NR_pread64, \&quot;pread\&quot;},\n    {__NR_pwrite64, \&quot;pwrite\&quot;},\n    {__NR_readv, \&quot;readv\&quot;},\n    {__NR_writev, \&quot;writev\&quot;},\n#ifdef __NR_access\n    {__NR_access, \&quot;access\&quot;},\n#endif\n#ifdef __NR_pipe\n    {__NR_pipe, \&quot;pipe\&quot;},\n#endif\n#ifdef __NR_select\n    {__NR_select, \&quot;select\&quot;},\n#endif\n    {__NR_pselect6, \&quot;pselect6\&quot;},\n    {__NR_sched_yield, \&quot;sched_yield\&quot;},\n    {__NR_mremap, \&quot;mremap\&quot;},\n    {__NR_mincore, \&quot;mincore\&quot;},\n    {__NR_madvise, \&quot;madvise\&quot;},\n    {__NR_shmget, \&quot;shmget\&quot;},\n    {__NR_shmat, \&quot;shmat\&quot;},\n    {__NR_shmctl, \&quot;shmctl\&quot;},\n    {__NR_dup, \&quot;dup\&quot;},\n#ifdef __NR_dup2\n    {__NR_dup2, \&quot;dup2\&quot;},\n#endif\n#ifdef __NR_pause\n    {__NR_pause, \&quot;pause\&quot;},\n#endif\n    {__NR_nanosleep, \&quot;nanosleep\&quot;},\n    {__NR_getitimer, \&quot;getitimer\&quot;},\n    {__NR_setitimer, \&quot;setitimer\&quot;},\n#ifdef __NR_alarm\n    {__NR_alarm, \&quot;alarm\&quot;},\n#endif\n    {__NR_getpid, \&quot;getpid\&quot;},\n    {__NR_sendfile, \&quot;sendfile\&quot;},\n    {__NR_socket, \&quot;socket\&quot;},\n    {__NR_connect, \&quot;connect\&quot;},\n    {__NR_accept, \&quot;accept\&quot;},\n    {__NR_sendto, \&quot;sendto\&quot;},\n    {__NR_recvfrom, \&quot;recvfrom\&quot;},\n    {__NR_sendmsg, \&quot;sendmsg\&quot;},\n    {__NR_recvmsg, \&quot;recvmsg\&quot;},\n    {__NR_shutdown, \&quot;shutdown\&quot;},\n    {__NR_bind, \&quot;bind\&quot;},\n    {__NR_listen, \&quot;listen\&quot;},\n    {__NR_getsockname, \&quot;getsockname\&quot;},\n    {__NR_getpeername, \&quot;getpeername\&quot;},\n    {__NR_socketpair, \&quot;socketpair\&quot;},\n    {__NR_setsockopt, \&quot;setsockopt\&quot;},\n    {__NR_getsockopt, \&quot;getsockopt\&quot;},\n#ifdef __NR_fork\n    {__NR_fork, \&quot;fork\&quot;},\n#endif\n#ifdef __NR_vfork\n    {__NR_vfork, \&quot;vfork\&quot;},\n#endif\n    {__NR_execve, \&quot;execve\&quot;},\n    {__NR_wait4, \&quot;wait4\&quot;},\n    {__NR_kill, \&quot;kill\&quot;},\n    {__NR_clone, \&quot;clone\&quot;},\n    {__NR_tkill, \&quot;tkill\&quot;},\n    {__NR_futex, \&quot;futex\&quot;},\n    {__NR_set_robust_list, \&quot;set_robust_list\&quot;},\n    {__NR_get_robust_list, \&quot;get_robust_list\&quot;},\n    {__NR_uname, \&quot;uname\&quot;},\n    {__NR_semget, \&quot;semget\&quot;},\n    {__NR_semop, \&quot;semop\&quot;},\n    {__NR_semctl, \&quot;semctl\&quot;},\n    {__NR_shmdt, \&quot;shmdt\&quot;},\n    {__NR_msgget, \&quot;msgget\&quot;},\n    {__NR_msgsnd, \&quot;msgsnd\&quot;},\n    {__NR_msgrcv, \&quot;msgrcv\&quot;},\n    {__NR_msgctl, \&quot;msgctl\&quot;},\n    {__NR_fcntl, \&quot;fcntl\&quot;},\n    {__NR_flock, \&quot;flock\&quot;},\n    {__NR_fsync, \&quot;fsync\&quot;},\n    {__NR_fdatasync, \&quot;fdatasync\&quot;},\n    {__NR_truncate, \&quot;truncate\&quot;},\n    {__NR_ftruncate, \&quot;ftruncate\&quot;},\n    {__NR_getcwd, \&quot;getcwd\&quot;},\n    {__NR_chdir, \&quot;chdir\&quot;},\n    {__NR_fchdir, \&quot;fchdir\&quot;},\n#ifdef __NR_rename\n    {__NR_rename, \&quot;rename\&quot;},\n#endif\n#ifdef __NR_mkdir\n    {__NR_mkdir, \&quot;mkdir\&quot;},\n#endif\n#ifdef __NR_rmdir\n    {__NR_rmdir, \&quot;rmdir\&quot;},\n#endif\n#ifdef __NR_creat\n    {__NR_creat, \&quot;creat\&quot;},\n#endif\n#ifdef __NR_link\n    {__NR_link, \&quot;link\&quot;},\n#endif\n#ifdef __NR_unlink\n    {__NR_unlink, \&quot;unlink\&quot;},\n#endif\n#ifdef __NR_symlink\n    {__NR_symlink, \&quot;symlink\&quot;},\n#endif\n#ifdef __NR_readlink\n    {__NR_readlink, \&quot;readlink\&quot;},\n#endif\n#ifdef __NR_chmod\n    {__NR_chmod, \&quot;chmod\&quot;},\n#endif\n    {__NR_fchmod, \&quot;fchmod\&quot;},\n#ifdef __NR_chown\n    {__NR_chown, \&quot;chown\&quot;},\n#endif\n    {__NR_fchown, \&quot;fchown\&quot;},\n#ifdef __NR_lchown\n    {__NR_lchown, \&quot;lchown\&quot;},\n#endif\n    {__NR_umask, \&quot;umask\&quot;},\n    {__NR_gettimeofday, \&quot;gettimeofday\&quot;},\n    {__NR_getrlimit, \&quot;getrlimit\&quot;},\n    {__NR_getrusage, \&quot;getrusage\&quot;},\n    {__NR_sysinfo, \&quot;sysinfo\&quot;},\n    {__NR_times, \&quot;times\&quot;},\n    {__NR_ptrace, \&quot;ptrace\&quot;},\n    {__NR_syslog, \&quot;syslog\&quot;},\n    {__NR_getuid, \&quot;getuid\&quot;},\n    {__NR_getgid, \&quot;getgid\&quot;},\n    {__NR_getppid, \&quot;getppid\&quot;},\n#ifdef __NR_getpgrp\n    {__NR_getpgrp, \&quot;getpgrp\&quot;},\n#endif\n    {__NR_setsid, \&quot;setsid\&quot;},\n    {__NR_getsid, \&quot;getsid\&quot;},\n    {__NR_getpgid, \&quot;getpgid\&quot;},\n    {__NR_setpgid, \&quot;setpgid\&quot;},\n    {__NR_geteuid, \&quot;geteuid\&quot;},\n    {__NR_getegid, \&quot;getegid\&quot;},\n    {__NR_getgroups, \&quot;getgroups\&quot;},\n    {__NR_setgroups, \&quot;setgroups\&quot;},\n    {__NR_setreuid, \&quot;setreuid\&quot;},\n    {__NR_setregid, \&quot;setregid\&quot;},\n    {__NR_setuid, \&quot;setuid\&quot;},\n    {__NR_setgid, \&quot;setgid\&quot;},\n    {__NR_setresuid, \&quot;setresuid\&quot;},\n    {__NR_setresgid, \&quot;setresgid\&quot;},\n    {__NR_getresuid, \&quot;getresuid\&quot;},\n    {__NR_getresgid, \&quot;getresgid\&quot;},\n    {__NR_rt_sigpending, \&quot;sigpending\&quot;},\n    {__NR_rt_sigsuspend, \&quot;sigsuspend\&quot;},\n    {__NR_sigaltstack, \&quot;sigaltstack\&quot;},\n#ifdef __NR_mknod\n    {__NR_mknod, \&quot;mknod\&quot;},\n#endif\n    {__NR_mknodat, \&quot;mknodat\&quot;},\n    {__NR_statfs, \&quot;statfs\&quot;},\n    {__NR_fstatfs, \&quot;fstatfs\&quot;},\n    {__NR_getpriority, \&quot;getpriority\&quot;},\n    {__NR_setpriority, \&quot;setpriority\&quot;},\n    {__NR_mlock, \&quot;mlock\&quot;},\n    {__NR_munlock, \&quot;munlock\&quot;},\n    {__NR_mlockall, \&quot;mlockall\&quot;},\n    {__NR_munlockall, \&quot;munlockall\&quot;},\n    {__NR_setrlimit, \&quot;setrlimit\&quot;},\n    {__NR_chroot, \&quot;chroot\&quot;},\n    {__NR_sync, \&quot;sync\&quot;},\n    {__NR_acct, \&quot;acct\&quot;},\n    {__NR_settimeofday, \&quot;settimeofday\&quot;},\n    {__NR_mount, \&quot;mount\&quot;},\n    {__NR_reboot, \&quot;reboot\&quot;},\n    {__NR_quotactl, \&quot;quotactl\&quot;},\n    {__NR_setfsuid, \&quot;setfsuid\&quot;},\n    {__NR_setfsgid, \&quot;setfsgid\&quot;},\n    {__NR_capget, \&quot;capget\&quot;},\n    {__NR_capset, \&quot;capset\&quot;},\n    {__NR_rt_sigtimedwait, \&quot;sigtimedwait\&quot;},\n    {__NR_rt_sigqueueinfo, \&quot;rt_sigqueueinfo\&quot;},\n    {__NR_personality, \&quot;personality\&quot;},\n#ifdef __NR_ustat\n    {__NR_ustat, \&quot;ustat\&quot;},\n#endif\n#ifdef __NR_sysfs\n    {__NR_sysfs, \&quot;sysfs\&quot;},\n#endif\n    {__NR_sched_setparam, \&quot;sched_setparam\&quot;},\n    {__NR_sched_getparam, \&quot;sched_getparam\&quot;},\n    {__NR_sched_setscheduler, \&quot;sched_setscheduler\&quot;},\n    {__NR_sched_getscheduler, \&quot;sched_getscheduler\&quot;},\n    {__NR_sched_get_priority_max, \&quot;sched_get_priority_max\&quot;},\n    {__NR_sched_get_priority_min, \&quot;sched_get_priority_min\&quot;},\n    {__NR_sched_rr_get_interval, \&quot;sched_rr_get_interval\&quot;},\n    {__NR_vhangup, \&quot;vhangup\&quot;},\n#ifdef __NR_modify_ldt\n    {__NR_modify_ldt, \&quot;modify_ldt\&quot;},\n#endif\n    {__NR_pivot_root, \&quot;pivot_root\&quot;},\n#ifdef __NR__sysctl\n    {__NR__sysctl, \&quot;_sysctl\&quot;},\n#endif\n    {__NR_prctl, \&quot;prctl\&quot;},\n#ifdef __NR_arch_prctl\n    {__NR_arch_prctl, \&quot;arch_prctl\&quot;},\n#endif\n    {__NR_adjtimex, \&quot;adjtimex\&quot;},\n    {__NR_umount2, \&quot;umount2\&quot;},\n    {__NR_swapon, \&quot;swapon\&quot;},\n    {__NR_swapoff, \&quot;swapoff\&quot;},\n    {__NR_sethostname, \&quot;sethostname\&quot;},\n    {__NR_setdomainname, \&quot;setdomainname\&quot;},\n#ifdef __NR_iopl\n    {__NR_iopl, \&quot;iopl\&quot;},\n#endif\n#ifdef __NR_ioperm\n    {__NR_ioperm, \&quot;ioperm\&quot;},\n#endif\n    {__NR_init_module, \&quot;init_module\&quot;},\n    {__NR_delete_module, \&quot;delete_module\&quot;},\n    {__NR_gettid, \&quot;gettid\&quot;},\n    {__NR_readahead, \&quot;readahead\&quot;},\n    {__NR_setxattr, \&quot;setxattr\&quot;},\n    {__NR_fsetxattr, \&quot;fsetxattr\&quot;},\n    {__NR_getxattr, \&quot;getxattr\&quot;},\n    {__NR_fgetxattr, \&quot;fgetxattr\&quot;},\n    {__NR_listxattr, \&quot;listxattr\&quot;},\n    {__NR_flistxattr, \&quot;flistxattr\&quot;},\n    {__NR_removexattr, \&quot;removexattr\&quot;},\n    {__NR_fremovexattr, \&quot;fremovexattr\&quot;},\n    {__NR_lsetxattr, \&quot;lsetxattr\&quot;},\n    {__NR_lgetxattr, \&quot;lgetxattr\&quot;},\n    {__NR_llistxattr, \&quot;llistxattr\&quot;},\n    {__NR_lremovexattr, \&quot;lremovexattr\&quot;},\n    {__NR_sched_setaffinity, \&quot;sched_setaffinity\&quot;},\n    {__NR_sched_getaffinity, \&quot;sched_getaffinity\&quot;},\n    {__NR_io_setup, \&quot;io_setup\&quot;},\n    {__NR_io_destroy, \&quot;io_destroy\&quot;},\n    {__NR_io_getevents, \&quot;io_getevents\&quot;},\n    {__NR_io_submit, \&quot;io_submit\&quot;},\n    {__NR_io_cancel, \&quot;io_cancel\&quot;},\n    {__NR_lookup_dcookie, \&quot;lookup_dcookie\&quot;},\n#ifdef __NR_epoll_create\n    {__NR_epoll_create, \&quot;epoll_create\&quot;},\n#endif\n#ifdef __NR_epoll_wait\n    {__NR_epoll_wait, \&quot;epoll_wait\&quot;},\n#endif\n    {__NR_epoll_ctl, \&quot;epoll_ctl\&quot;},\n#ifdef __NR_getdents\n    {__NR_getdents, \&quot;getdents\&quot;},\n#endif\n    {__NR_getdents64, \&quot;getdents64\&quot;},\n    {__NR_set_tid_address, \&quot;set_tid_address\&quot;},\n    {__NR_restart_syscall, \&quot;restart_syscall\&quot;},\n    {__NR_semtimedop, \&quot;semtimedop\&quot;},\n    {__NR_fadvise64, \&quot;fadvise\&quot;},\n    {__NR_timer_create, \&quot;timer_create\&quot;},\n    {__NR_timer_settime, \&quot;timer_settime\&quot;},\n    {__NR_timer_gettime, \&quot;timer_gettime\&quot;},\n    {__NR_timer_getoverrun, \&quot;timer_getoverrun\&quot;},\n    {__NR_timer_delete, \&quot;timer_delete\&quot;},\n    {__NR_clock_settime, \&quot;clock_settime\&quot;},\n    {__NR_clock_gettime, \&quot;clock_gettime\&quot;},\n    {__NR_clock_getres, \&quot;clock_getres\&quot;},\n    {__NR_clock_nanosleep, \&quot;clock_nanosleep\&quot;},\n    {__NR_tgkill, \&quot;tgkill\&quot;},\n    {__NR_mbind, \&quot;mbind\&quot;},\n    {__NR_set_mempolicy, \&quot;set_mempolicy\&quot;},\n    {__NR_get_mempolicy, \&quot;get_mempolicy\&quot;},\n    {__NR_mq_open, \&quot;mq_open\&quot;},\n    {__NR_mq_unlink, \&quot;mq_unlink\&quot;},\n    {__NR_mq_timedsend, \&quot;mq_timedsend\&quot;},\n    {__NR_mq_timedreceive, \&quot;mq_timedreceive\&quot;},\n    {__NR_mq_notify, \&quot;mq_notify\&quot;},\n    {__NR_mq_getsetattr, \&quot;mq_getsetattr\&quot;},\n    {__NR_kexec_load, \&quot;kexec_load\&quot;},\n    {__NR_waitid, \&quot;waitid\&quot;},\n    {__NR_add_key, \&quot;add_key\&quot;},\n    {__NR_request_key, \&quot;request_key\&quot;},\n    {__NR_keyctl, \&quot;keyctl\&quot;},\n    {__NR_ioprio_set, \&quot;ioprio_set\&quot;},\n    {__NR_ioprio_get, \&quot;ioprio_get\&quot;},\n#ifdef __NR_inotify_init\n    {__NR_inotify_init, \&quot;inotify_init\&quot;},\n#endif\n    {__NR_inotify_add_watch, \&quot;inotify_add_watch\&quot;},\n    {__NR_inotify_rm_watch, \&quot;inotify_rm_watch\&quot;},\n    {__NR_openat, \&quot;openat\&quot;},\n    {__NR_mkdirat, \&quot;mkdirat\&quot;},\n    {__NR_fchownat, \&quot;fchownat\&quot;},\n#ifdef __NR_utime\n    {__NR_utime, \&quot;utime\&quot;},\n#endif\n#ifdef __NR_utimes\n    {__NR_utimes, \&quot;utimes\&quot;},\n#endif\n#ifdef __NR_futimesat\n    {__NR_futimesat, \&quot;futimesat\&quot;},\n#endif\n    {__NR_newfstatat, \&quot;fstatat\&quot;},\n    {__NR_unlinkat, \&quot;unlinkat\&quot;},\n    {__NR_renameat, \&quot;renameat\&quot;},\n    {__NR_linkat, \&quot;linkat\&quot;},\n    {__NR_symlinkat, \&quot;symlinkat\&quot;},\n    {__NR_readlinkat, \&quot;readlinkat\&quot;},\n    {__NR_fchmodat, \&quot;fchmodat\&quot;},\n    {__NR_faccessat, \&quot;faccessat\&quot;},\n    {__NR_unshare, \&quot;unshare\&quot;},\n    {__NR_splice, \&quot;splice\&quot;},\n    {__NR_tee, \&quot;tee\&quot;},\n    {__NR_sync_file_range, \&quot;sync_file_range\&quot;},\n    {__NR_vmsplice, \&quot;vmsplice\&quot;},\n    {__NR_migrate_pages, \&quot;migrate_pages\&quot;},\n    {__NR_move_pages, \&quot;move_pages\&quot;},\n    {__NR_preadv, \&quot;preadv\&quot;},\n    {__NR_pwritev, \&quot;pwritev\&quot;},\n    {__NR_utimensat, \&quot;utimensat\&quot;},\n    {__NR_fallocate, \&quot;fallocate\&quot;},\n    {__NR_accept4, \&quot;accept4\&quot;},\n    {__NR_dup3, \&quot;dup3\&quot;},\n    {__NR_pipe2, \&quot;pipe2\&quot;},\n    {__NR_epoll_pwait, \&quot;epoll_pwait\&quot;},\n    {__NR_epoll_create1, \&quot;epoll_create1\&quot;},\n    {__NR_perf_event_open, \&quot;perf_event_open\&quot;},\n    {__NR_inotify_init1, \&quot;inotify_init1\&quot;},\n    {__NR_rt_tgsigqueueinfo, \&quot;rt_tgsigqueueinfo\&quot;},\n#ifdef __NR_signalfd\n    {__NR_signalfd, \&quot;signalfd\&quot;},\n#endif\n    {__NR_signalfd4, \&quot;signalfd4\&quot;},\n#ifdef __NR_eventfd\n    {__NR_eventfd, \&quot;eventfd\&quot;},\n#endif\n    {__NR_eventfd2, \&quot;eventfd2\&quot;},\n    {__NR_timerfd_create, \&quot;timerfd_create\&quot;},\n    {__NR_timerfd_settime, \&quot;timerfd_settime\&quot;},\n    {__NR_timerfd_gettime, \&quot;timerfd_gettime\&quot;},\n    {__NR_recvmmsg, \&quot;recvmmsg\&quot;},\n    {__NR_fanotify_init, \&quot;fanotify_init\&quot;},\n    {__NR_fanotify_mark, \&quot;fanotify_mark\&quot;},\n    {__NR_prlimit64, \&quot;prlimit\&quot;},\n    {__NR_name_to_handle_at, \&quot;name_to_handle_at\&quot;},\n    {__NR_open_by_handle_at, \&quot;open_by_handle_at\&quot;},\n    {__NR_clock_adjtime, \&quot;clock_adjtime\&quot;},\n    {__NR_syncfs, \&quot;syncfs\&quot;},\n    {__NR_sendmmsg, \&quot;sendmmsg\&quot;},\n    {__NR_setns, \&quot;setns\&quot;},\n    {__NR_getcpu, \&quot;getcpu\&quot;},\n    {__NR_process_vm_readv, \&quot;process_vm_readv\&quot;},\n    {__NR_process_vm_writev, \&quot;process_vm_writev\&quot;},\n    {__NR_kcmp, \&quot;kcmp\&quot;},\n    {__NR_finit_module, \&quot;finit_module\&quot;},\n    {__NR_sched_setattr, \&quot;sched_setattr\&quot;},\n    {__NR_sched_getattr, \&quot;sched_getattr\&quot;},\n    {__NR_renameat2, \&quot;renameat2\&quot;},\n    {__NR_seccomp, \&quot;seccomp\&quot;},\n    {__NR_getrandom, \&quot;getrandom\&quot;},\n    {__NR_memfd_create, \&quot;memfd_create\&quot;},\n    {__NR_kexec_file_load, \&quot;kexec_file_load\&quot;},\n    {__NR_bpf, \&quot;bpf\&quot;},\n    {__NR_execveat, \&quot;execveat\&quot;},\n    {__NR_userfaultfd, \&quot;userfaultfd\&quot;},\n    {__NR_membarrier, \&quot;membarrier\&quot;},\n    {__NR_mlock2, \&quot;mlock2\&quot;},\n    {__NR_copy_file_range, \&quot;copy_file_range\&quot;},\n    {__NR_preadv2, \&quot;preadv2\&quot;},\n    {__NR_pwritev2, \&quot;pwritev2\&quot;},\n    {__NR_pkey_mprotect, \&quot;pkey_mprotect\&quot;},\n    {__NR_pkey_alloc, \&quot;pkey_alloc\&quot;},\n    {__NR_pkey_free, \&quot;pkey_free\&quot;},\n    {__NR_statx, \&quot;statx\&quot;},\n    {__NR_io_pgetevents, \&quot;io_pgetevents\&quot;},\n    {__NR_rseq, \&quot;rseq\&quot;},\n    {__NR_pidfd_send_signal, \&quot;pidfd_send_signal\&quot;},\n    {__NR_io_uring_setup, \&quot;io_uring_setup\&quot;},\n    {__NR_io_uring_enter, \&quot;io_uring_enter\&quot;},\n    {__NR_io_uring_register, \&quot;io_uring_register\&quot;},\n    {__NR_open_tree, \&quot;open_tree\&quot;},\n    {__NR_move_mount, \&quot;move_mount\&quot;},\n    {__NR_fsopen, \&quot;fsopen\&quot;},\n    {__NR_fsconfig, \&quot;fsconfig\&quot;},\n    {__NR_fsmount, \&quot;fsmount\&quot;},\n    {__NR_fspick, \&quot;fspick\&quot;},\n    {__NR_pidfd_open, \&quot;pidfd_open\&quot;},\n    {__NR_clone3, \&quot;clone3\&quot;},\n    {__NR_close_range, \&quot;close_range\&quot;},\n    {__NR_openat2, \&quot;openat2\&quot;},\n    {__NR_pidfd_getfd, \&quot;pidfd_getfd\&quot;},\n    {__NR_faccessat2, \&quot;faccessat2\&quot;},\n    {__NR_process_madvise, \&quot;process_madvise\&quot;},\n    {__NR_epoll_pwait2, \&quot;epoll_pwait2\&quot;},\n    {__NR_mount_setattr, \&quot;mount_setattr\&quot;},\n#ifdef __NR_quotactl_fd\n    {__NR_quotactl_fd, \&quot;quotactl_fd\&quot;},\n#endif\n    {__NR_landlock_create_ruleset, \&quot;landlock_create_ruleset\&quot;},\n    {__NR_landlock_add_rule, \&quot;landlock_add_rule\&quot;},\n    {__NR_landlock_restrict_self, \&quot;landlock_restrict_self\&quot;},\n#ifdef __NR_memfd_secret\n    {__NR_memfd_secret, \&quot;memfd_secret\&quot;},\n#endif\n#ifdef __NR_process_mrelease\n    {__NR_process_mrelease, \&quot;process_mrelease\&quot;},\n#endif\n#ifdef __NR_futex_waitv\n    {__NR_futex_waitv, \&quot;futex_waitv\&quot;},\n#endif\n#ifdef __NR_set_mempolicy_home_node\n    {__NR_set_mempolicy_home_node, \&quot;set_mempolicy_home_node\&quot;},\n#endif\n};\n\nstatic const uint16_t kPledgeDefault[] = {\n    __NR_exit,  // thread return / exit()\n};\n\n// stdio contains all the benign system calls. openbsd makes the\n// assumption that preexisting file descriptors are trustworthy. we\n// implement checking for these as a simple linear scan rather than\n// binary search, since there doesn't appear to be any measurable\n// difference in the latency of sched_yield() if it's at the start of\n// the bpf script or the end.\nstatic const uint16_t kPledgeStdio[] = {\n    __NR_rt_sigreturn,\n    __NR_restart_syscall,\n    __NR_exit_group,\n    __NR_sched_yield,\n    __NR_sched_getaffinity,\n    __NR_clock_getres,\n    __NR_clock_gettime,\n    __NR_clock_nanosleep,\n    __NR_close_range,\n    __NR_close,\n    __NR_write,\n    __NR_writev,\n    __NR_pwrite64,\n    __NR_pwritev,\n    __NR_pwritev2,\n    __NR_read,\n    __NR_readv,\n    __NR_pread64,\n    __NR_preadv,\n    __NR_preadv2,\n    __NR_dup,\n#ifdef __NR_dup2\n    __NR_dup2,\n#endif\n    __NR_dup3,\n    __NR_fchdir,\n    __NR_fcntl | STDIO,\n    __NR_fstat,\n    __NR_fsync,\n    __NR_sysinfo,\n    __NR_fdatasync,\n    __NR_ftruncate,\n    __NR_getrandom,\n    __NR_getgroups,\n    __NR_getpgid,\n#ifdef __NR_getpgrp\n    __NR_getpgrp,\n#endif\n    __NR_getpid,\n    __NR_gettid,\n    __NR_getuid,\n    __NR_getgid,\n    __NR_getsid,\n    __NR_getppid,\n    __NR_geteuid,\n    __NR_getegid,\n    __NR_getrlimit,\n    __NR_getresgid,\n    __NR_getresuid,\n    __NR_getitimer,\n    __NR_setitimer,\n    __NR_timerfd_create,\n    __NR_timerfd_settime,\n    __NR_timerfd_gettime,\n    __NR_copy_file_range,\n    __NR_gettimeofday,\n    __NR_sendfile,\n    __NR_vmsplice,\n    __NR_splice,\n    __NR_lseek,\n    __NR_tee,\n    __NR_brk,\n    __NR_msync,\n    __NR_mmap | NOEXEC,\n    __NR_mremap,\n    __NR_munmap,\n    __NR_mincore,\n    __NR_madvise,\n    __NR_fadvise64,\n    __NR_mprotect | NOEXEC,\n#ifdef __NR_arch_prctl\n    __NR_arch_prctl,\n#endif\n    __NR_migrate_pages,\n    __NR_sync_file_range,\n    __NR_set_tid_address,\n    __NR_membarrier,\n    __NR_nanosleep,\n#ifdef __NR_pipe\n    __NR_pipe,\n#endif\n    __NR_pipe2,\n#ifdef __NR_poll\n    __NR_poll,\n#endif\n    __NR_ppoll,\n#ifdef __NR_select\n    __NR_select,\n#endif\n    __NR_pselect6,\n#ifdef __NR_epoll_create\n    __NR_epoll_create,\n#endif\n    __NR_epoll_create1,\n    __NR_epoll_ctl,\n#ifdef __NR_epoll_wait\n    __NR_epoll_wait,\n#endif\n    __NR_epoll_pwait,\n    __NR_epoll_pwait2,\n    __NR_recvfrom,\n    __NR_sendto | ADDRLESS,\n    __NR_ioctl | RESTRICT,\n#ifdef __NR_alarm\n    __NR_alarm,\n#endif\n#ifdef __NR_pause\n    __NR_pause,\n#endif\n    __NR_shutdown,\n#ifdef __NR_eventfd\n    __NR_eventfd,\n#endif\n    __NR_eventfd2,\n#ifdef __NR_signalfd\n    __NR_signalfd,\n#endif\n    __NR_signalfd4,\n    __NR_rt_sigaction,\n    __NR_sigaltstack,\n    __NR_rt_sigprocmask,\n    __NR_rt_sigsuspend,\n    __NR_rt_sigpending,\n    __NR_kill | SELF,\n    __NR_tkill,\n    __NR_tgkill | SELF,\n    __NR_socketpair,\n    __NR_getrusage,\n    __NR_times,\n    __NR_umask,\n    __NR_wait4,\n    __NR_uname,\n    __NR_prctl | STDIO,\n    __NR_clone | THREAD,\n    __NR_futex,\n    __NR_set_robust_list,\n    __NR_get_robust_list,\n    __NR_prlimit64 | STDIO,\n    __NR_sched_getaffinity,\n    __NR_sched_setaffinity,\n    __NR_rt_sigtimedwait,\n};\n\nstatic const uint16_t kPledgeFlock[] = {\n    __NR_flock,\n    __NR_fcntl | LOCK,\n};\n\nstatic const uint16_t kPledgeRpath[] = {\n    __NR_chdir,\n    __NR_getcwd,\n#ifdef __NR_open\n    __NR_open | READONLY,\n#endif\n    __NR_openat | READONLY,\n#ifdef __NR_stat\n    __NR_stat,\n#endif\n#ifdef __NR_lstat\n    __NR_lstat,\n#endif\n    __NR_fstat,\n    __NR_newfstatat,\n#ifdef __NR_access\n    __NR_access,\n#endif\n    __NR_faccessat,\n    __NR_faccessat2,\n#ifdef __NR_readlink\n    __NR_readlink,\n#endif\n    __NR_readlinkat,\n    __NR_statfs,\n    __NR_fstatfs,\n#ifdef __NR_getdents\n    __NR_getdents,\n#endif\n    __NR_getdents64,\n};\n\nstatic const uint16_t kPledgeWpath[] = {\n    __NR_getcwd,\n#ifdef __NR_open\n    __NR_open | WRITEONLY,\n#endif\n    __NR_openat | WRITEONLY,\n#ifdef __NR_stat\n    __NR_stat,\n#endif\n    __NR_fstat,\n#ifdef __NR_lstat\n    __NR_lstat,\n#endif\n    __NR_newfstatat,\n#ifdef __NR_access\n    __NR_access,\n#endif\n    __NR_truncate,\n    __NR_faccessat,\n    __NR_faccessat2,\n    __NR_readlinkat,\n#ifdef __NR_chmod\n    __NR_chmod | NOBITS,\n#endif\n    __NR_fchmod | NOBITS,\n    __NR_fchmodat | NOBITS,\n};\n\nstatic const uint16_t kPledgeCpath[] = {\n#ifdef __NR_open\n    __NR_open | CREATONLY,\n#endif\n    __NR_openat | CREATONLY,\n#ifdef __NR_creat\n    __NR_creat | RESTRICT,\n#endif\n#ifdef __NR_rename\n    __NR_rename,\n#endif\n    __NR_renameat,\n    __NR_renameat2,\n#ifdef __NR_link\n    __NR_link,\n#endif\n    __NR_linkat,\n#ifdef __NR_symlink\n    __NR_symlink,\n#endif\n    __NR_symlinkat,\n#ifdef __NR_rmdir\n    __NR_rmdir,\n#endif\n#ifdef __NR_unlink\n    __NR_unlink,\n#endif\n    __NR_unlinkat,\n#ifdef __NR_mkdir\n    __NR_mkdir,\n#endif\n    __NR_mkdirat,\n};\n\nstatic const uint16_t kPledgeDpath[] = {\n#ifdef __NR_mknod\n    __NR_mknod,  //\n#endif\n    __NR_mknodat,  //\n};\n\nstatic const uint16_t kPledgeFattr[] = {\n#ifdef __NR_chmod\n    __NR_chmod | NOBITS,  //\n#endif\n    __NR_fchmod | NOBITS,    //\n    __NR_fchmodat | NOBITS,  //\n#ifdef __NR_utime\n    __NR_utime,  //\n#endif\n#ifdef __NR_utimes\n    __NR_utimes,  //\n#endif\n#ifdef __NR_futimesat\n    __NR_futimesat,  //\n#endif\n    __NR_utimensat,  //\n};\n\nstatic const uint16_t kPledgeInet[] = {\n    __NR_socket | INET,          //\n    __NR_listen,                 //\n    __NR_bind,                   //\n    __NR_sendto,                 //\n    __NR_connect,                //\n    __NR_accept,                 //\n    __NR_accept4,                //\n    __NR_ioctl | INET,           //\n    __NR_getsockopt | RESTRICT,  //\n    __NR_setsockopt | RESTRICT,  //\n    __NR_getpeername,            //\n    __NR_getsockname,            //\n};\n\nstatic const uint16_t kPledgeUnix[] = {\n    __NR_socket | UNIX,          //\n    __NR_listen,                 //\n    __NR_bind,                   //\n    __NR_connect,                //\n    __NR_sendto,                 //\n    __NR_accept,                 //\n    __NR_accept4,                //\n    __NR_getsockopt | RESTRICT,  //\n    __NR_setsockopt | RESTRICT,  //\n    __NR_getpeername,            //\n    __NR_getsockname,            //\n};\n\nstatic const uint16_t kPledgeDns[] = {\n    __NR_socket | INET,          //\n    __NR_bind,                   //\n    __NR_sendto,                 //\n    __NR_connect,                //\n    __NR_recvfrom,               //\n    __NR_setsockopt | RESTRICT,  //\n    __NR_newfstatat,             //\n    __NR_openat | READONLY,      //\n    __NR_read,                   //\n    __NR_close,                  //\n};\n\nstatic const uint16_t kPledgeTty[] = {\n    __NR_ioctl | TTY,  //\n};\n\nstatic const uint16_t kPledgeRecvfd[] = {\n    __NR_recvmsg,   //\n    __NR_recvmmsg,  //\n};\n\nstatic const uint16_t kPledgeSendfd[] = {\n    __NR_sendmsg,   //\n    __NR_sendmmsg,  //\n};\n\nstatic const uint16_t kPledgeProc[] = {\n#ifdef __NR_fork\n    __NR_fork,  //\n#endif\n#ifdef __NR_vfork\n    __NR_vfork,  //\n#endif\n    __NR_clone | RESTRICT,        //\n    __NR_kill,                    //\n    __NR_tgkill,                  //\n    __NR_setsid,                  //\n    __NR_setpgid,                 //\n    __NR_prlimit64,               //\n    __NR_setrlimit,               //\n    __NR_getpriority,             //\n    __NR_setpriority,             //\n    __NR_ioprio_get,              //\n    __NR_ioprio_set,              //\n    __NR_sched_getscheduler,      //\n    __NR_sched_setscheduler,      //\n    __NR_sched_get_priority_min,  //\n    __NR_sched_get_priority_max,  //\n    __NR_sched_getparam,          //\n    __NR_sched_setparam,          //\n};\n\nstatic const uint16_t kPledgeId[] = {\n    __NR_setuid,       //\n    __NR_setreuid,     //\n    __NR_setresuid,    //\n    __NR_setgid,       //\n    __NR_setregid,     //\n    __NR_setresgid,    //\n    __NR_setgroups,    //\n    __NR_prlimit64,    //\n    __NR_setrlimit,    //\n    __NR_getpriority,  //\n    __NR_setpriority,  //\n    __NR_setfsuid,     //\n    __NR_setfsgid,     //\n};\n\nstatic const uint16_t kPledgeChown[] = {\n#ifdef __NR_chown\n    __NR_chown,  //\n#endif\n    __NR_fchown,  //\n#ifdef __NR_lchown\n    __NR_lchown,  //\n#endif\n    __NR_fchownat,  //\n};\n\nstatic const uint16_t kPledgeSettime[] = {\n    __NR_settimeofday,   //\n    __NR_clock_adjtime,  //\n};\n\nstatic const uint16_t kPledgeProtExec[] = {\n    __NR_mmap | EXEC,  //\n    __NR_mprotect,     //\n};\n\nstatic const uint16_t kPledgeExec[] = {\n    __NR_execve,    //\n    __NR_execveat,  //\n};\n\nstatic const uint16_t kPledgeUnveil[] = {\n    __NR_landlock_create_ruleset,  //\n    __NR_landlock_add_rule,        //\n    __NR_landlock_restrict_self,   //\n};\n\n// placeholder group\n//\n// pledge.com checks this to do auto-unveiling\nstatic const uint16_t kPledgeVminfo[] = {\n    __NR_sched_yield,  //\n};\n\n// placeholder group\n//\n// pledge.com uses this to auto-unveil /tmp and $TMPPATH with rwc\n// permissions. pledge() alone (without unveil() too) offers very\n// little security here. consider using them together.\nstatic const uint16_t kPledgeTmppath[] = {\n#ifdef __NR_lstat\n    __NR_lstat,  //\n#endif\n#ifdef __NR_unlink\n    __NR_unlink,  //\n#endif\n    __NR_unlinkat,  //\n};\n\nconst struct Pledges kPledge[PROMISE_LEN_] = {\n    [PROMISE_STDIO] = {\&quot;stdio\&quot;, PLEDGE(kPledgeStdio)},\n    [PROMISE_RPATH] = {\&quot;rpath\&quot;, PLEDGE(kPledgeRpath)},\n    [PROMISE_WPATH] = {\&quot;wpath\&quot;, PLEDGE(kPledgeWpath)},\n    [PROMISE_CPATH] = {\&quot;cpath\&quot;, PLEDGE(kPledgeCpath)},\n    [PROMISE_DPATH] = {\&quot;dpath\&quot;, PLEDGE(kPledgeDpath)},\n    [PROMISE_FLOCK] = {\&quot;flock\&quot;, PLEDGE(kPledgeFlock)},\n    [PROMISE_FATTR] = {\&quot;fattr\&quot;, PLEDGE(kPledgeFattr)},\n    [PROMISE_INET] = {\&quot;inet\&quot;, PLEDGE(kPledgeInet)},\n    [PROMISE_UNIX] = {\&quot;unix\&quot;, PLEDGE(kPledgeUnix)},\n    [PROMISE_DNS] = {\&quot;dns\&quot;, PLEDGE(kPledgeDns)},\n    [PROMISE_TTY] = {\&quot;tty\&quot;, PLEDGE(kPledgeTty)},\n    [PROMISE_RECVFD] = {\&quot;recvfd\&quot;, PLEDGE(kPledgeRecvfd)},\n    [PROMISE_SENDFD] = {\&quot;sendfd\&quot;, PLEDGE(kPledgeSendfd)},\n    [PROMISE_PROC] = {\&quot;proc\&quot;, PLEDGE(kPledgeProc)},\n    [PROMISE_EXEC] = {\&quot;exec\&quot;, PLEDGE(kPledgeExec)},\n    [PROMISE_ID] = {\&quot;id\&quot;, PLEDGE(kPledgeId)},\n    [PROMISE_UNVEIL] = {\&quot;unveil\&quot;, PLEDGE(kPledgeUnveil)},\n    [PROMISE_SETTIME] = {\&quot;settime\&quot;, PLEDGE(kPledgeSettime)},\n    [PROMISE_PROT_EXEC] = {\&quot;prot_exec\&quot;, PLEDGE(kPledgeProtExec)},\n    [PROMISE_VMINFO] = {\&quot;vminfo\&quot;, PLEDGE(kPledgeVminfo)},\n    [PROMISE_TMPPATH] = {\&quot;tmppath\&quot;, PLEDGE(kPledgeTmppath)},\n    [PROMISE_CHOWN] = {\&quot;chown\&quot;, PLEDGE(kPledgeChown)},\n};\n\nstatic const struct sock_filter kPledgeStart[] = {\n    // make sure this isn't an i386 binary or something\n    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(arch)),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, ARCHITECTURE, 1, 0),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),\n    // each filter assumes ordinal is already loaded into accumulator\n    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n#ifdef __NR_memfd_secret\n    // forbid some system calls with ENOSYS (rather than EPERM)\n    BPF_JUMP(BPF_JMP | BPF_JGE | BPF_K, __NR_memfd_secret, 5, 0),\n#else\n    BPF_JUMP(BPF_JMP | BPF_JGE | BPF_K, __NR_landlock_restrict_self + 1, 5, 0),\n#endif\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rseq, 4, 0),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_memfd_create, 3, 0),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat2, 2, 0),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_clone3, 1, 0),\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_statx, 0, 1),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (ENOSYS &amp; SECCOMP_RET_DATA)),\n};\n\nstatic const struct sock_filter kFilterIgnoreExitGroup[] = {\n    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_exit_group, 0, 1),\n    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (EPERM &amp; SECCOMP_RET_DATA)),\n};\n\nstatic char *FixCpy(char p[17], uint64_t x, int k) {\n  while (k > 0) *p++ = \&quot;0123456789abcdef\&quot;[(x >> (k -= 4)) &amp; 15];\n  *p = '\\0';\n  return p;\n}\n\nstatic privileged char *HexCpy(char p[17], uint64_t x) {\n  return FixCpy(p, x, ROUNDUP(x ? bsr(x) + 1 : 1, 4));\n}\n\nstatic void Log(const char *s, ...) {\n  int ax;\n  va_list va;\n  va_start(va, s);\n  do ax = write(2, s, strlen(s));\n  while ((s = va_arg(va, const char *)));\n  va_end(va);\n}\n\nstatic void KillThisProcess(void) {\n  abort();\n}\n\nstatic void KillThisThread(void) {\n  int ax;\n  sigset_t full, empty;\n  sigfillset(&amp;full);\n  sigemptyset(&amp;empty);\n  sigaction(SIGABRT, &amp;(struct sigaction){0}, 0);\n  sigprocmask(SIG_SETMASK, &amp;full, 0);\n  ax = syscall(__NR_tkill, syscall(__NR_gettid), SIGABRT);\n  sigprocmask(SIG_SETMASK, &amp;empty, 0);\n  syscall(__NR_exit, 128 + SIGABRT);\n}\n\nstatic const char *GetSyscallName(uint16_t n) {\n  int i;\n  for (i = 0; i < ARRAYLEN(kSyscallName); ++i) {\n    if (kSyscallName[i].n == n) {\n      return kSyscallName[i].s;\n    }\n  }\n  return \&quot;unknown\&quot;;\n}\n\nstatic int HasSyscall(const struct Pledges *p, uint16_t n) {\n  int i;\n  for (i = 0; i < p->len; ++i) {\n    if (p->syscalls[i] == n) {\n      return 1;\n    }\n    if ((p->syscalls[i] &amp; 0xfff) == n) {\n      return 2;\n    }\n  }\n  return 0;\n}\n\nstatic void OnSigSys(int sig, siginfo_t *si, void *vctx) {\n  bool found;\n  char ord[17], ip[17];\n  int i, ok, mode = si->si_errno;\n  ucontext_t *ctx = vctx;\n\n  ctx->uc_mcontext.MCONTEXT_SYSCALL_RESULT_REGISTER = -EPERM;\n  FixCpy(ord, si->si_syscall, 12);\n  HexCpy(ip, ctx->uc_mcontext.MCONTEXT_INSTRUCTION_POINTER);\n  for (found = i = 0; i < ARRAYLEN(kPledge); ++i) {\n    if (HasSyscall(kPledge + i, si->si_syscall)) {\n      Log(\&quot;error: pledge \&quot;, kPledge[i].name, \&quot; for \&quot;,\n          GetSyscallName(si->si_syscall), \&quot; (ord=0x\&quot;, ord, \&quot; ip=0x\&quot;, ip, \&quot;)\\n\&quot;,\n          NULL);\n      found = true;\n    }\n  }\n  if (!found) {\n    Log(\&quot;error: bad syscall (\&quot;, GetSyscallName(si->si_syscall), \&quot; ord=0x\&quot;, ord,\n        \&quot; ip=0x\&quot;, ip, \&quot;)\\n\&quot;, NULL);\n  }\n  switch (mode &amp; PLEDGE_PENALTY_MASK) {\n    case PLEDGE_PENALTY_KILL_PROCESS:\n      KillThisProcess();\n      // fallthrough\n    case PLEDGE_PENALTY_KILL_THREAD:\n      KillThisThread();\n      __builtin_trap();\n    default:\n      break;\n  }\n}\n\nstatic void MonitorSigSys(void) {\n  int ax;\n  struct sigaction sa = {\n      .sa_sigaction = OnSigSys,\n      .sa_flags = SA_SIGINFO | SA_RESTART,\n  };\n  // we block changing sigsys once pledge is installed\n  // so we aren't terribly concerned if this will fail\n  if (sigaction(SIGSYS, &amp;sa, 0) == -1) {\n    __builtin_trap();\n  }\n}\n\nstatic void AppendFilter(struct Filter *f, const struct sock_filter *p,\n                         size_t n) {\n  if (UNLIKELY(f->n + n > ARRAYLEN(f->p))) __builtin_trap();\n  memcpy(f->p + f->n, p, n * sizeof(*f->p));\n  f->n += n;\n}\n\n// The first argument of kill() must be\n//\n//   - getpid()\n//\nstatic void AllowKillSelf(struct Filter *f) {\n  struct sock_filter fragment[] = {\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_kill, 0, 4),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, getpid(), 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The first argument of tgkill() must be\n//\n//   - getpid()\n//\nstatic void AllowTgkillSelf(struct Filter *f) {\n  struct sock_filter fragment[] = {\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_tgkill, 0, 4),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, getpid(), 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The following system calls are allowed:\n//\n//   - write(2) to allow logging\n//   - kill(getpid(), SIGABRT) to abort process\n//   - tkill(gettid(), SIGABRT) to abort thread\n//   - sigaction(SIGABRT) to force default signal handler\n//   - sigreturn() to return from signal handler\n//   - sigprocmask() to force signal delivery\n//\nstatic void AllowMonitor(struct Filter *f) {\n  struct sock_filter fragment[] = {\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_write, 0, 4),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 2, 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_kill, 0, 6),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, getpid(), 0, 3),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIGABRT, 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_tkill, 0, 6),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, gettid(), 0, 3),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIGABRT, 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rt_sigaction, 0, 4),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIGABRT, 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rt_sigreturn, 1, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rt_sigprocmask, 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The first argument of sys_clone_linux() must NOT have:\n//\n//   - CLONE_NEWNS    (0x00020000)\n//   - CLONE_PTRACE   (0x00002000)\n//   - CLONE_UNTRACED (0x00800000)\n//\nstatic void AllowCloneRestrict(struct Filter *f) {\n  // clang-format off\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_clone, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, CLONE_NEWNS | CLONE_PTRACE | CLONE_UNTRACED),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  // clang-format on\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The first argument of sys_clone_linux() must have:\n//\n//   - CLONE_VM       (0x00000100)\n//   - CLONE_FS       (0x00000200)\n//   - CLONE_FILES    (0x00000400)\n//   - CLONE_THREAD   (0x00010000)\n//   - CLONE_SIGHAND  (0x00000800)\n//\n// The first argument of sys_clone_linux() must NOT have:\n//\n//   - CLONE_NEWNS    (0x00020000)\n//   - CLONE_PTRACE   (0x00002000)\n//   - CLONE_UNTRACED (0x00800000)\n//\nstatic void AllowCloneThread(struct Filter *f) {\n#define NEED (CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_THREAD | CLONE_SIGHAND)\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_clone, 0, 9 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, NEED),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, NEED, 0, 8 - 4),\n      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, CLONE_NEWNS | CLONE_PTRACE | CLONE_UNTRACED),\n      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L9*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n#undef NEED\n}\n\n// The second argument of ioctl() must be one of:\n//\n//   - FIONREAD (0x541b)\n//   - FIONBIO  (0x5421)\n//   - FIOCLEX  (0x5451)\n//   - FIONCLEX (0x5450)\n//\nstatic void AllowIoctlStdio(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_ioctl, 0, 7),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIONREAD, 3, 0),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIONBIO, 2, 0),\n      /*L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIOCLEX, 1, 0),\n      /*L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIONCLEX, 0, 1),\n      /*L6*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L8*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The second argument of ioctl() must be one of:\n//\n//   - SIOCATMARK (0x8905)\n//\nstatic void AllowIoctlInet(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_ioctl, 0, 4),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIOCATMARK, 0, 1),\n      /*L6*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L8*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The second argument of ioctl() must be one of:\n//\n//   - TCGETS     (0x5401)\n//   - TCSETS     (0x5402)\n//   - TCSETSW    (0x5403)\n//   - TCSETSF    (0x5404)\n//   - TIOCGWINSZ (0x5413)\n//   - TIOCSPGRP  (0x5410)\n//   - TIOCGPGRP  (0x540f)\n//   - TIOCSWINSZ (0x5414)\n//   - TCFLSH     (0x540b)\n//   - TCXONC     (0x540a)\n//   - TCSBRK     (0x5409)\n//   - TIOCSBRK   (0x5427)\n//\nstatic void AllowIoctlTty(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_ioctl, 0, 15),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCGETS, 11, 0),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSETS, 10, 0),\n      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSETSW, 9, 0),\n      /* L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSETSF, 8, 0),\n      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCGWINSZ, 7, 0),\n      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCSPGRP, 6, 0),\n      /* L8*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCGPGRP, 5, 0),\n      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCSWINSZ, 4, 0),\n      /*L10*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCFLSH, 3, 0),\n      /*L11*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCXONC, 2, 0),\n      /*L12*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSBRK, 1, 0),\n      /*L13*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCSBRK, 0, 1),\n      /*L14*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L15*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L16*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The level argument of getsockopt/setsockopt must be one of:\n//\n//   - IPPROTO_IP     (0)\n//   - SOL_SOCKET     (1)\n//   - IPPROTO_TCP    (6)\n//   - IPPROTO_IPV6   (41)\n//\n// The optname argument of getsockopt/setsockopt must be one of:\n//\n//   - TCP_NODELAY          (0x01)\n//   - TCP_CORK             (0x03)\n//   - TCP_KEEPIDLE         (0x04)\n//   - TCP_KEEPINTVL        (0x05)\n//   - SO_TYPE              (0x03)\n//   - SO_ERROR             (0x04)\n//   - SO_DONTROUTE         (0x05)\n//   - SO_BROADCAST         (0x06)\n//   - SO_REUSEPORT         (0x0f)\n//   - SO_REUSEADDR         (0x02)\n//   - SO_KEEPALIVE         (0x09)\n//   - SO_RCVTIMEO          (0x14)\n//   - SO_SNDTIMEO          (0x15)\n//   - IP_RECVTTL           (0x0c)\n//   - IP_RECVERR           (0x0b)\n//   - TCP_FASTOPEN         (0x17)\n//   - TCP_FASTOPEN_CONNECT (0x1e)\n//   - IPV6_V6ONLY          (0x1a)\n//   - TCP_QUICKACK         (0x0c)\n//\nstatic void AllowSockoptRestrict(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_getsockopt, 1, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_setsockopt, 0, 29),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOL_SOCKET, 3, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_TCP, 11, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_IP, 18, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_IPV6, 20, 23),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_TYPE, 7 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_ERROR, 6 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_BROADCAST, 5 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_REUSEPORT, 4 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_REUSEADDR, 3 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_KEEPALIVE, 2 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_RCVTIMEO, 1 + 13, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_SNDTIMEO, 0 + 13, 14),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_QUICKACK, 6 + 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_CORK, 5 + 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_NODELAY, 4 + 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_KEEPIDLE, 3 + 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_KEEPINTVL, 2 + 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_FASTOPEN, 1 + 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_FASTOPEN_CONNECT, 0 + 5, 6),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IP_RECVTTL, 1 + 2, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IP_RECVERR, 0 + 2, 3),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPV6_V6ONLY, 0 + 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The flags parameter of mmap() must not have:\n//\n//   - MAP_LOCKED   (0x02000)\n//   - MAP_NONBLOCK (0x10000)\n//   - MAP_HUGETLB  (0x40000)\n//\nstatic void AllowMmapExec(struct Filter *f) {\n  // long y = (long)__privileged_end;\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_mmap, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[3])),  // flags\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, MAP_LOCKED | MAP_NONBLOCK | MAP_HUGETLB),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 5 - 4),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The prot parameter of mmap() may only have:\n//\n//   - PROT_NONE\n//   - PROT_READ\n//   - PROT_WRITE\n//\n// The flags parameter must not have:\n//\n//   - MAP_LOCKED   (0x02000)\n//   - MAP_HUGETLB  (0x40000)\n//\nstatic void AllowMmapNoexec(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_mmap, 0, 8),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),  // prot\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(PROT_READ | PROT_WRITE)),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 8 - 4),\n      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[3])),  // flags\n      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, MAP_LOCKED | MAP_HUGETLB),\n      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L9*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The prot parameter of mprotect() may only have:\n//\n//   - PROT_NONE  (0)\n//   - PROT_READ  (1)\n//   - PROT_WRITE (2)\n//\nstatic void AllowMprotectNoexec(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_mprotect, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),  // prot\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(PROT_READ | PROT_WRITE)),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n#ifdef __NR_open\n// The open() system call is permitted only when\n//\n//   - (flags &amp; O_ACCMODE) == O_RDONLY\n//\n// The flags parameter of open() must not have:\n//\n//   - O_CREAT     (000000100)\n//   - O_TRUNC     (000001000)\n//   - __O_TMPFILE (020000000)\n//\nstatic void AllowOpenReadonly(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_open, 0, 9 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDONLY, 0, 8 - 4),\n      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_TRUNC | O_CREAT),\n      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L9*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n#endif\n\n// The open() system call is permitted only when\n//\n//   - (flags &amp; O_ACCMODE) == O_RDONLY\n//\n// The flags parameter of open() must not have:\n//\n//   - O_CREAT     (000000100)\n//   - O_TRUNC     (000001000)\n//   - __O_TMPFILE (020000000)\n//\nstatic void AllowOpenatReadonly(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat, 0, 9 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDONLY, 0, 8 - 4),\n      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_TRUNC | O_CREAT),\n      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L9*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n#ifdef __NR_open\n// The open() system call is permitted only when\n//\n//   - (flags &amp; O_ACCMODE) == O_WRONLY\n//   - (flags &amp; O_ACCMODE) == O_RDWR\n//\n// The open() flags parameter must not contain\n//\n//   - O_CREAT     (000000100)\n//   - __O_TMPFILE (020000000)\n//\nstatic void AllowOpenWriteonly(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_open, 0, 10 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_WRONLY, 1, 0),\n      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDWR, 0, 9 - 5),\n      /* L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L6*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_CREAT),\n      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /* L8*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /* L9*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L10*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n#endif\n\n// The open() system call is permitted only when\n//\n//   - (flags &amp; O_ACCMODE) == O_WRONLY\n//   - (flags &amp; O_ACCMODE) == O_RDWR\n//\n// The openat() flags parameter must not contain\n//\n//   - O_CREAT     (000000100)\n//   - __O_TMPFILE (020000000)\n//\nstatic void AllowOpenatWriteonly(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat, 0, 10 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_WRONLY, 1, 0),\n      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDWR, 0, 9 - 5),\n      /* L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L6*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_CREAT),\n      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /* L8*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /* L9*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L10*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n#ifdef __NR_open\n// If the flags parameter of open() has one of:\n//\n//   - O_CREAT     (000000100)\n//   - __O_TMPFILE (020000000)\n//\n// Then the mode parameter must not have:\n//\n//   - S_ISVTX (01000 sticky)\n//   - S_ISGID (02000 setgid)\n//   - S_ISUID (04000 setuid)\n//\nstatic void AllowOpenCreatonly(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_open, 0, 12 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_CREAT),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_CREAT, 7 - 4, 0),\n      /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, 020200000),\n      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 020200000, 0, 10 - 7),\n      /* L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L8*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),\n      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L10*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L11*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L12*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n#endif\n\n// If the flags parameter of openat() has one of:\n//\n//   - O_CREAT     (000000100)\n//   - __O_TMPFILE (020000000)\n//\n// Then the mode parameter must not have:\n//\n//   - S_ISVTX (01000 sticky)\n//   - S_ISGID (02000 setgid)\n//   - S_ISUID (04000 setuid)\n//\nstatic void AllowOpenatCreatonly(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat, 0, 12 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_CREAT),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_CREAT, 7 - 4, 0),\n      /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, 020200000),\n      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 020200000, 0, 10 - 7),\n      /* L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[3])),\n      /* L8*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),\n      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L10*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L11*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L12*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n#ifdef __NR_creat\n// Then the mode parameter must not have:\n//\n//   - S_ISVTX (01000 sticky)\n//   - S_ISGID (02000 setgid)\n//   - S_ISUID (04000 setuid)\n//\nstatic void AllowCreatRestrict(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_creat, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n#endif\n\n// The second argument of fcntl() must be one of:\n//\n//   - F_DUPFD (0)\n//   - F_DUPFD_CLOEXEC (1030)\n//   - F_GETFD (1)\n//   - F_SETFD (2)\n//   - F_GETFL (3)\n//   - F_SETFL (4)\n//\nstatic void AllowFcntlStdio(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fcntl, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_DUPFD_CLOEXEC, 4 - 3, 0),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JGE | BPF_K, 5, 5 - 4, 0),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  _Static_assert(F_DUPFD == 0 &amp;&amp; F_GETFD == 1 &amp;&amp; F_SETFD == 2 &amp;&amp; F_GETFL == 3 &amp;&amp; F_SETFL == 4, \&quot;This ensures that the above BPF_JGE statement will work correctly\&quot;);\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The second argument of fcntl() must be one of:\n//\n//   - F_GETLK (0x05)\n//   - F_SETLK (0x06)\n//   - F_SETLKW (0x07)\n//   - F_OFD_GETLK (0x24)\n//   - F_OFD_SETLK (0x25)\n//   - F_OFD_SETLKW (0x26)\n//\nstatic void AllowFcntlLock(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fcntl, 0, 9),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_GETLK, 5, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_SETLK, 4, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_SETLKW, 3, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_OFD_GETLK, 2, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_OFD_SETLK, 1, 0),\n      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_OFD_SETLKW, 0, 1),\n      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The addr parameter of sendto() must be\n//\n//   - NULL\n//\nstatic void AllowSendtoAddrless(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_sendto, 0, 7 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[4]) + 0),\n      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 6 - 3),\n      /*L3*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[4]) + 4),\n      /*L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 6 - 5),\n      /*L5*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L6*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L7*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The family parameter of socket() must be one of:\n//\n//   - AF_INET  (0x02)\n//   - AF_INET6 (0x0a)\n//\n// The type parameter of socket() will ignore:\n//\n//   - SOCK_CLOEXEC  (0x80000)\n//   - SOCK_NONBLOCK (0x00800)\n//\n// The type parameter of socket() must be one of:\n//\n//   - SOCK_STREAM (0x01)\n//   - SOCK_DGRAM  (0x02)\n//\n// The protocol parameter of socket() must be one of:\n//\n//   - 0\n//   - IPPROTO_ICMP (0x01)\n//   - IPPROTO_TCP  (0x06)\n//   - IPPROTO_UDP  (0x11)\n//\nstatic void AllowSocketInet(struct Filter *f) {\n  // clang-format off\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_socket, 0, 15 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AF_INET, 1, 0),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AF_INET6, 0, 14 - 4),\n      /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(SOCK_CLOEXEC | SOCK_NONBLOCK)),\n      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_STREAM, 1, 0),\n      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_DGRAM, 0, 14 - 8),\n      /* L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 3, 0),\n      /*L10*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_ICMP, 2, 0),\n      /*L11*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_TCP, 1, 0),\n      /*L12*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_UDP, 0, 1),\n      /*L13*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L14*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L15*/ /* next filter */\n  };\n  // clang-format on\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The family parameter of socket() must be one of:\n//\n//   - AF_UNIX (1)\n//   - AF_LOCAL (1)\n//\n// The type parameter of socket() will ignore:\n//\n//   - SOCK_CLOEXEC  (0x80000)\n//   - SOCK_NONBLOCK (0x00800)\n//\n// The type parameter of socket() must be one of:\n//\n//   - SOCK_STREAM (1)\n//   - SOCK_DGRAM  (2)\n//\n// The protocol parameter of socket() must be one of:\n//\n//   - 0\n//\nstatic void AllowSocketUnix(struct Filter *f) {\n  // clang-format off\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_socket, 0, 11 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AF_UNIX, 0, 10 - 3),\n      /* L3*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(SOCK_CLOEXEC | SOCK_NONBLOCK)),\n      /* L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_STREAM, 1, 0),\n      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_DGRAM, 0, 10 - 7),\n      /* L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /* L8*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /* L9*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L10*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L11*/ /* next filter */\n  };\n  // clang-format on\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The first parameter of prctl() can be any of\n//\n//   - PR_SET_NAME         (15)\n//   - PR_GET_NAME         (16)\n//   - PR_GET_SECCOMP      (21)\n//   - PR_SET_SECCOMP      (22)\n//   - PR_SET_NO_NEW_PRIVS (38)\n//   - PR_CAPBSET_READ     (23)\n//   - PR_CAPBSET_DROP     (24)\n//\nstatic void AllowPrctlStdio(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_prctl, 0, 11 - 1),\n      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),\n      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_SET_NAME, 6, 0),\n      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_GET_NAME, 5, 0),\n      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_GET_SECCOMP, 4, 0),\n      /* L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_SET_SECCOMP, 3, 0),\n      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_CAPBSET_READ, 2, 0),\n      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_CAPBSET_DROP, 1, 0),\n      /* L8*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_SET_NO_NEW_PRIVS, 0, 1),\n      /* L9*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L10*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L11*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n#ifdef __NR_chmod\n// The mode parameter of chmod() can't have the following:\n//\n//   - S_ISVTX (01000 sticky)\n//   - S_ISGID (02000 setgid)\n//   - S_ISUID (04000 setuid)\n//\nstatic void AllowChmodNobits(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_chmod, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n#endif\n\n// The mode parameter of fchmod() can't have the following:\n//\n//   - S_ISVTX (01000 sticky)\n//   - S_ISGID (02000 setgid)\n//   - S_ISUID (04000 setuid)\n//\nstatic void AllowFchmodNobits(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fchmod, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, 07000),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The mode parameter of fchmodat() can't have the following:\n//\n//   - S_ISVTX (01000 sticky)\n//   - S_ISGID (02000 setgid)\n//   - S_ISUID (04000 setuid)\n//\nstatic void AllowFchmodatNobits(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fchmodat, 0, 6 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),\n      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L6*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\n// The new_limit parameter of prlimit() must be\n//\n//   - NULL (0)\n//\nstatic void AllowPrlimitStdio(struct Filter *f) {\n  static const struct sock_filter fragment[] = {\n      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_prlimit64, 0, 7 - 1),\n      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),\n      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 6 - 3),\n      /*L3*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2]) + 4),\n      /*L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),\n      /*L5*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      /*L6*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),\n      /*L7*/ /* next filter */\n  };\n  AppendFilter(f, PLEDGE(fragment));\n}\n\nstatic int CountUnspecial(const uint16_t *p, size_t len) {\n  int i, count;\n  for (count = i = 0; i < len; ++i) {\n    if (!(p[i] &amp; SPECIAL)) {\n      ++count;\n    }\n  }\n  return count;\n}\n\nstatic void AppendPledge(struct Filter *f,   //\n                         const uint16_t *p,  //\n                         size_t len) {       //\n  int i, j, count;\n\n  // handle ordinals which allow syscalls regardless of args\n  // we put in extra effort here to reduce num of bpf instrs\n  if ((count = CountUnspecial(p, len))) {\n    if (count < 256) {\n      for (j = i = 0; i < len; ++i) {\n        if (p[i] &amp; SPECIAL) continue;\n        // jump to ALLOW rule below if accumulator equals ordinal\n        struct sock_filter fragment[] = {\n            BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K,  // instruction\n                     p[i],                       // operand\n                     count - j - 1,              // jump if true displacement\n                     j == count - 1),            // jump if false displacement\n        };\n        AppendFilter(f, PLEDGE(fragment));\n        ++j;\n      }\n      struct sock_filter fragment[] = {\n          BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),\n      };\n      AppendFilter(f, PLEDGE(fragment));\n    } else {\n      __builtin_trap();\n    }\n  }\n\n  // handle \&quot;special\&quot; ordinals which use hand-crafted bpf\n  for (i = 0; i < len; ++i) {\n    if (!(p[i] &amp; SPECIAL)) continue;\n    switch (p[i]) {\n      case __NR_mmap | EXEC:\n        AllowMmapExec(f);\n        break;\n      case __NR_mmap | NOEXEC:\n        AllowMmapNoexec(f);\n        break;\n      case __NR_mprotect | NOEXEC:\n        AllowMprotectNoexec(f);\n        break;\n#ifdef __NR_chmod\n      case __NR_chmod | NOBITS:\n        AllowChmodNobits(f);\n        break;\n#endif\n      case __NR_fchmod | NOBITS:\n        AllowFchmodNobits(f);\n        break;\n      case __NR_fchmodat | NOBITS:\n        AllowFchmodatNobits(f);\n        break;\n      case __NR_prctl | STDIO:\n        AllowPrctlStdio(f);\n        break;\n#ifdef __NR_open\n      case __NR_open | CREATONLY:\n        AllowOpenCreatonly(f);\n        break;\n#endif\n      case __NR_openat | CREATONLY:\n        AllowOpenatCreatonly(f);\n        break;\n#ifdef __NR_open\n      case __NR_open | READONLY:\n        AllowOpenReadonly(f);\n        break;\n#endif\n      case __NR_openat | READONLY:\n        AllowOpenatReadonly(f);\n        break;\n#ifdef __NR_open\n      case __NR_open | WRITEONLY:\n        AllowOpenWriteonly(f);\n        break;\n#endif\n      case __NR_openat | WRITEONLY:\n        AllowOpenatWriteonly(f);\n        break;\n      case __NR_getsockopt | RESTRICT:\n      case __NR_setsockopt | RESTRICT:\n        AllowSockoptRestrict(f);\n        break;\n#ifdef __NR_creat\n      case __NR_creat | RESTRICT:\n        AllowCreatRestrict(f);\n        break;\n#endif\n      case __NR_fcntl | STDIO:\n        AllowFcntlStdio(f);\n        break;\n      case __NR_fcntl | LOCK:\n        AllowFcntlLock(f);\n        break;\n      case __NR_ioctl | RESTRICT:\n        AllowIoctlStdio(f);\n        break;\n      case __NR_ioctl | TTY:\n        AllowIoctlTty(f);\n        break;\n      case __NR_ioctl | INET:\n        AllowIoctlInet(f);\n        break;\n      case __NR_socket | INET:\n        AllowSocketInet(f);\n        break;\n      case __NR_socket | UNIX:\n        AllowSocketUnix(f);\n        break;\n      case __NR_sendto | ADDRLESS:\n        AllowSendtoAddrless(f);\n        break;\n      case __NR_clone | RESTRICT:\n        AllowCloneRestrict(f);\n        break;\n      case __NR_clone | THREAD:\n        AllowCloneThread(f);\n        break;\n      case __NR_prlimit64 | STDIO:\n        AllowPrlimitStdio(f);\n        break;\n      case __NR_kill | SELF:\n        AllowKillSelf(f);\n        break;\n      case __NR_tgkill | SELF:\n        AllowTgkillSelf(f);\n        break;\n      default:\n        __builtin_trap();\n    }\n  }\n}\n\n/**\n * Installs SECCOMP BPF filter on Linux thread.\n *\n * @param ipromises is inverted integer bitmask of pledge() promises\n * @return 0 on success, or negative error number on error\n */\nint sys_pledge_linux(unsigned long ipromises, int mode) {\n  struct Filter f;\n  int i, e, rc = -1;\n  struct sock_filter sf[1] = {BPF_STMT(BPF_RET | BPF_K, 0)};\n  CheckLargeStackAllocation(&amp;f, sizeof(f));\n  f.n = 0;\n\n  // set up the seccomp filter\n  AppendFilter(&amp;f, PLEDGE(kPledgeStart));\n  if (ipromises == -1) {\n    // if we're pledging empty string, then avoid triggering a sigsys\n    // when _Exit() gets called since we need to fallback to _Exit1()\n    AppendFilter(&amp;f, PLEDGE(kFilterIgnoreExitGroup));\n  }\n  AppendPledge(&amp;f, PLEDGE(kPledgeDefault));\n  for (i = 0; i < ARRAYLEN(kPledge); ++i) {\n    if (~ipromises &amp; (1ul << i)) {\n      if (kPledge[i].len) {\n        AppendPledge(&amp;f, kPledge[i].syscalls, kPledge[i].len);\n      } else {\n        __builtin_trap();\n      }\n    }\n  }\n\n  // now determine what we'll do on sandbox violations\n  if (mode &amp; PLEDGE_STDERR_LOGGING) {\n    // trapping mode\n    //\n    // if we haven't pledged exec, then we can monitor SIGSYS\n    // and print a helpful error message when things do break\n    // to avoid tls / static memory, we embed mode within bpf\n    MonitorSigSys();\n    AllowMonitor(&amp;f);\n    sf[0].k = SECCOMP_RET_TRAP | (mode &amp; SECCOMP_RET_DATA);\n    AppendFilter(&amp;f, PLEDGE(sf));\n  } else {\n    // non-trapping mode\n    //\n    // our sigsys error message handler can't be inherited across\n    // execve() boundaries so if you've pledged exec then that'll\n    // likely cause a SIGSYS in your child after the exec happens\n    switch (mode &amp; PLEDGE_PENALTY_MASK) {\n      case PLEDGE_PENALTY_KILL_THREAD:\n        sf[0].k = SECCOMP_RET_KILL_THREAD;\n        break;\n      case PLEDGE_PENALTY_KILL_PROCESS:\n        sf[0].k = SECCOMP_RET_KILL_PROCESS;\n        break;\n      case PLEDGE_PENALTY_RETURN_EPERM:\n        sf[0].k = SECCOMP_RET_ERRNO | EPERM;\n        break;\n      default:\n        return -EINVAL;\n    }\n    AppendFilter(&amp;f, PLEDGE(sf));\n  }\n\n  // drop privileges\n  //\n  // PR_SET_SECCOMP (Linux 2.6.23+) will refuse to work if\n  // PR_SET_NO_NEW_PRIVS (Linux 3.5+) wasn't called so we punt the error\n  // detection to the seccomp system call below.\n  prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);\n\n  // register our seccomp filter with the kernel\n  struct sock_fprog sandbox = {.len = f.n, .filter = f.p};\n  rc = prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &amp;sandbox, 0, 0);\n\n  // the EINVAL error could mean a lot of things. it could mean the bpf\n  // code is broken. it could also mean we're running on RHEL5 which\n  // doesn't have SECCOMP support. since we don't consider lack of\n  // system support for security to be an error, we distinguish these\n  // two cases by running a simpler SECCOMP operation.\n  if (rc < 0 &amp;&amp;                                 //\n      errno == EINVAL &amp;&amp;                        //\n      prctl(PR_GET_SECCOMP, 0, 0, 0, 0) < 0 &amp;&amp;  //\n      errno == EINVAL) {\n    rc = 0;  // -ENOSYS\n  }\n\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:69089,&quot;string&quot;:&quot;69,089&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2143,&quot;string&quot;:&quot;2,143&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:29,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/landlock_add_rule.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/landlock.h\&quot;\n/*\n#include \&quot;libc/intrin/strace.internal.h\&quot;\n\nint sys_landlock_add_rule(int, enum landlock_rule_type, const void *, uint32_t);\n*/\n\n#include <sys/syscall.h>\n#include <unistd.h>\n\n/**\n * Adds new rule to Landlock ruleset.\n *\n * @error ENOSYS if Landlock isn't supported\n * @error EPERM if Landlock supported but SECCOMP BPF shut it down\n * @error EOPNOTSUPP if Landlock supported but disabled at boot time\n * @error EINVAL if flags not 0, or inconsistent access in the rule,\n *     i.e. landlock_path_beneath_attr::allowed_access is not a subset\n *     of the ruleset handled accesses\n * @error ENOMSG empty allowed_access\n * @error EBADF `fd` is not a file descriptor for current thread, or\n *     member of `rule_attr` is not a file descriptor as expected\n * @error EBADFD `fd` is not a ruleset file descriptor, or a member\n *     of `rule_attr` is not the expected file descriptor type\n * @error EPERM `fd` has no write access to the underlying ruleset\n * @error EFAULT `rule_attr` inconsistency\n */\nint landlock_add_rule(int fd, enum landlock_rule_type rule_type,\n                      const void *rule_attr, uint32_t flags) {\n  int rc;\n  rc = syscall(__NR_landlock_add_rule, fd, rule_type, rule_attr, flags);\n  /*KERNTRACE(\&quot;landlock_add_rule(%d, %d, %p, %#x) â %d% m\&quot;, fd, rule_type,\n            rule_attr, flags, rc);*/\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:3208,&quot;string&quot;:&quot;3,208&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:54,&quot;string&quot;:&quot;54&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:30,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/pledge.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include <errno.h>\n#include <unistd.h>\n#include \&quot;libc/calls/calls.h\&quot;\n#include \&quot;libc/calls/pledge.internal.h\&quot;\n#include \&quot;libc/dce.h\&quot;\n#include \&quot;libc/intrin/promises.internal.h\&quot;\n#include \&quot;libc/runtime/runtime.h\&quot;\n\n/**\n * Permits system operations, e.g.\n *\n *     __pledge_mode = PLEDGE_PENALTY_KILL_PROCESS | PLEDGE_STDERR_LOGGING;\n *     if (pledge(\&quot;stdio rfile tty\&quot;, 0)) {\n *       perror(\&quot;pledge\&quot;);\n *       exit(1);\n *     }\n *\n * Pledging causes most system calls to become unavailable. Your system\n * call policy is enforced by the kernel (which means it can propagate\n * across execve() if permitted). Root access is not required. Support\n * is limited to Linux 2.6.23+ (c. RHEL6) and OpenBSD. If your kernel\n * isn't supported, then pledge() will return 0 and do nothing rather\n * than raising ENOSYS. We don't consider lack of system support to be\n * an error, because the specified operations will be permitted.\n *\n * The promises you give pledge() define which system calls are allowed.\n * Error messages are logged when sandbox violations occur, but how that\n * happens depends on the `mode` parameter (see below).\n *\n * Timing is everything with pledge. It's designed to be a voluntary\n * self-imposed security model. That works best when programs perform\n * permission-hungry operations (e.g. calling GetSymbolTable) towards\n * the beginning of execution, and then relinquish privilege afterwards\n * by calling pledge(). Here's an example of where that matters. Your\n * Cosmopolitan C Library needs to code morph your executable in memory\n * once you start using threads. But that's only possible to do if you\n * used the `prot_exec` promise. So the right thing to do here, is to\n * call __enable_threads() before calling pledge() to force it early.\n *\n *     __enable_threads();\n *     ShowCrashReports();\n *     pledge(\&quot;...\&quot;, 0);\n *\n * By default exit() is allowed. This is useful for processes that\n * perform pure computation and interface with the parent via shared\n * memory. On Linux we mean sys_exit (_Exit1), not sys_exit_group\n * (_Exit). The difference is effectively meaningless, since _Exit()\n * will attempt both. All it means is that, if you're using threads,\n * then a `pledge(\&quot;\&quot;, 0)` thread can't kill all your threads unless you\n * `pledge(\&quot;stdio\&quot;, 0)`.\n *\n * Once pledge is in effect, the chmod functions (if allowed) will not\n * permit the sticky/setuid/setgid bits to change. Linux will EPERM here\n * and OpenBSD should ignore those three bits rather than crashing.\n *\n * User and group IDs can't be changed once pledge is in effect. OpenBSD\n * should ignore chown without crashing; whereas Linux will just EPERM.\n *\n * Using pledge is irreversible. On Linux it causes PR_SET_NO_NEW_PRIVS\n * to be set on your process; however, if \&quot;id\&quot; or \&quot;recvfd\&quot; are allowed\n * then then they theoretically could permit the gaining of some new\n * privileges. You may call pledge() multiple times if \&quot;stdio\&quot; is\n * allowed. In that case, the process can only move towards a more\n * restrictive state.\n *\n * pledge() can't filter filesystem paths. See unveil() which lets you\n * do that. pledge() also can't do address firewalling. For example if\n * you use the `inet` promise then your process will be able to talk to\n * *every* internet address including public ones.\n *\n * `promises` is a string that may include any of the following groups\n * delimited by spaces.\n *\n * - \&quot;stdio\&quot; allows exit, close, dup, dup2, dup3, fchdir, fstat, fsync,\n *   fdatasync, ftruncate, getdents, getegid, getrandom, geteuid,\n *   getgid, getgroups, times, getrusage, getitimer, getpgid, getpgrp,\n *   getpid, getppid, getresgid, getresuid, getrlimit, getsid, wait4,\n *   gettimeofday, getuid, lseek, madvise, brk, arch_prctl, uname,\n *   set_tid_address, clock_getres, clock_gettime, clock_nanosleep,\n *   mremap, mmap, (PROT_EXEC and weird flags aren't allowed), mprotect\n *   (PROT_EXEC isn't allowed), msync, sync_file_range, migrate_pages,\n *   munmap, nanosleep, pipe, pipe2, read, readv, pread, recv, poll,\n *   recvfrom, preadv, write, writev, pwrite, pwritev, select, pselect6,\n *   copy_file_range, sendfile, tee, splice, vmsplice, alarm, pause,\n *   send, sendto (only if addr is null), setitimer, shutdown, sigaction\n *   (but SIGSYS is forbidden), sigaltstack, sigprocmask, sigreturn,\n *   sigsuspend, umask, mincore, socketpair, ioctl(FIONREAD),\n *   ioctl(FIONBIO), ioctl(FIOCLEX), ioctl(FIONCLEX), fcntl(F_GETFD),\n *   fcntl(F_SETFD), fcntl(F_GETFL), fcntl(F_SETFL), sched_yield,\n *   epoll_create, epoll_create1, epoll_ctl, epoll_wait, epoll_pwait,\n *   epoll_pwait2, clone(CLONE_THREAD), futex, set_robust_list,\n *   get_robust_list, setaffinity, sigpending.\n *\n * - \&quot;rpath\&quot; (read-only path ops) allows chdir, getcwd, open(O_RDONLY),\n *   openat(O_RDONLY), stat, fstat, lstat, fstatat, access, faccessat,\n *   faccessat2, readlink, readlinkat, statfs, fstatfs.\n *\n * - \&quot;wpath\&quot; (write path ops) allows getcwd, open(O_WRONLY),\n *   openat(O_WRONLY), stat, fstat, lstat, fstatat, access, faccessat,\n *   faccessat2, readlink, readlinkat, chmod, fchmod, fchmodat.\n *\n * - \&quot;cpath\&quot; (create path ops) allows open(O_CREAT), openat(O_CREAT),\n *   rename, renameat, renameat2, link, linkat, symlink, symlinkat,\n *   unlink, rmdir, unlinkat, mkdir, mkdirat.\n *\n * - \&quot;dpath\&quot; (create special path ops) allows mknod, mknodat, mkfifo.\n *\n * - \&quot;flock\&quot; allows flock, fcntl(F_GETLK), fcntl(F_SETLK),\n *   fcntl(F_SETLKW).\n *\n * - \&quot;tty\&quot; allows ioctl(TIOCGWINSZ), ioctl(TCGETS), ioctl(TCSETS),\n *   ioctl(TCSETSW), ioctl(TCSETSF).\n *\n * - \&quot;recvfd\&quot; allows recvmsg and recvmmsg.\n *\n * - \&quot;recvfd\&quot; allows sendmsg and sendmmsg.\n *\n * - \&quot;fattr\&quot; allows chmod, fchmod, fchmodat, utime, utimes, futimens,\n *   utimensat.\n *\n * - \&quot;inet\&quot; allows socket(AF_INET), listen, bind, connect, accept,\n *   accept4, getpeername, getsockname, setsockopt, getsockopt, sendto.\n *\n * - \&quot;unix\&quot; allows socket(AF_UNIX), listen, bind, connect, accept,\n *   accept4, getpeername, getsockname, setsockopt, getsockopt.\n *\n * - \&quot;dns\&quot; allows socket(AF_INET), sendto, recvfrom, connect.\n *\n * - \&quot;proc\&quot; allows fork, vfork, clone, kill, tgkill, getpriority,\n *   setpriority, prlimit, setrlimit, setpgid, setsid.\n *\n * - \&quot;id\&quot; allows setuid, setreuid, setresuid, setgid, setregid,\n *   setresgid, setgroups, prlimit, setrlimit, getpriority, setpriority,\n *   setfsuid, setfsgid.\n *\n * - \&quot;settime\&quot; allows settimeofday and clock_adjtime.\n *\n * - \&quot;exec\&quot; allows execve, execveat. Note that `exec` alone might not be\n *   enough by itself to let your executable be executed. For dynamic,\n *   interpreted, and ape binaries, you'll usually want `rpath` and\n *   `prot_exec` too. With APE it's possible to work around this\n *   requirement, by \&quot;assimilating\&quot; your binaries beforehand. See the\n *   assimilate.com program and `--assimilate` flag which can be used to\n *   turn APE binaries into static native binaries.\n *\n * - \&quot;prot_exec\&quot; allows mmap(PROT_EXEC) and mprotect(PROT_EXEC). This is\n *   needed to (1) code morph mutexes in __enable_threads(), and it's\n *   needed to (2) launch non-static or non-native executables, e.g.\n *   non-assimilated APE binaries, or dynamic-linked executables.\n *\n * - \&quot;unveil\&quot; allows unveil() to be called, as well as the underlying\n *   landlock_create_ruleset, landlock_add_rule, landlock_restrict_self\n *   calls on Linux.\n *\n * - \&quot;vminfo\&quot; OpenBSD defines this for programs like `top`. On Linux,\n *   this is a placeholder group that lets tools like pledge.com check\n *   `__promises` and automatically unveil() a subset of files top would\n *   need, e.g. /proc/stat, /proc/meminfo.\n *\n * - \&quot;tmppath\&quot; allows unlink, unlinkat, and lstat. This is mostly a\n *   placeholder group for pledge.com, which reads the `__promises`\n *   global to determine if /tmp and $TMPPATH should be unveiled.\n *\n * `execpromises` only matters if \&quot;exec\&quot; is specified in `promises`. In\n * that case, this specifies the promises that'll apply once execve()\n * happens. If this is NULL then the default is used, which is\n * unrestricted. OpenBSD allows child processes to escape the sandbox\n * (so a pledged OpenSSH server process can do things like spawn a root\n * shell). Linux however requires monotonically decreasing privileges.\n * This function will will perform some validation on Linux to make sure\n * that `execpromises` is a subset of `promises`. Your libc wrapper for\n * execve() will then apply its SECCOMP BPF filter later. Since Linux\n * has to do this before calling sys_execve(), the executed process will\n * be weakened to have execute permissions too.\n *\n * `__pledge_mode` is available to improve the experience of pledge() on\n * Linux. It should specify one of the following penalties:\n *\n * - `PLEDGE_PENALTY_KILL_THREAD` causes the violating thread to be\n *   killed. This is the default on Linux. It's effectively the same as\n *   killing the process, since redbean has no threads. The termination\n *   signal can't be caught and will be either `SIGSYS` or `SIGABRT`.\n *   Consider enabling stderr logging below so you'll know why your\n *   program failed. Otherwise check the system log.\n *\n * - `PLEDGE_PENALTY_KILL_PROCESS` causes the process and all its\n *   threads to be killed. This is always the case on OpenBSD.\n *\n * - `PLEDGE_PENALTY_RETURN_EPERM` causes system calls to just return an\n *   `EPERM` error instead of killing. This is a gentler solution that\n *   allows code to display a friendly warning. Please note this may\n *   lead to weird behaviors if the software being sandboxed is lazy\n *   about checking error results.\n *\n * `mode` may optionally bitwise or the following flags:\n *\n * - `PLEDGE_STDERR_LOGGING` enables friendly error message logging\n *   letting you know which promises are needed whenever violations\n *   occur. Without this, violations will be logged to `dmesg` on Linux\n *   if the penalty is to kill the process. You would then need to\n *   manually look up the system call number and then cross reference it\n *   with the cosmopolitan libc pledge() documentation. You can also use\n *   `strace -ff` which is easier. This is ignored OpenBSD, which\n *   already has a good system log. Turning on stderr logging (which\n *   uses SECCOMP trapping) also means that the `WTERMSIG()` on your\n *   killed processes will always be `SIGABRT` on both Linux and\n *   OpenBSD. Otherwise, Linux prefers to raise `SIGSYS`. Enabling this\n *   option might not be a good idea if you're pledging `exec` because\n *   subprocesses can't inherit the `SIGSYS` handler this installs.\n *\n * @return 0 on success, or -1 w/ errno\n * @raise EINVAL if `execpromises` on Linux isn't a subset of `promises`\n * @raise EINVAL if `promises` allows exec and `execpromises` is null\n * @threadsafe\n * @vforksafe\n */\nint pledge(const char *promises, const char *execpromises) {\n  int e, rc;\n  unsigned long ipromises, iexecpromises;\n  if (!ParsePromises(promises, &amp;ipromises) &amp;&amp;\n      !ParsePromises(execpromises, &amp;iexecpromises)) {\n    // copy exec and execnative from promises to execpromises\n    iexecpromises = ~(~iexecpromises | (~ipromises &amp; (1ul << PROMISE_EXEC)));\n    // if bits are missing in execpromises that exist in promises\n    // then execpromises wouldn't be a monotonic access reduction\n    // this check only matters when exec / execnative are allowed\n    if ((ipromises &amp; ~iexecpromises) &amp;&amp; (~ipromises &amp; (1ul << PROMISE_EXEC))) {\n      errno = EINVAL;\n      rc = -1;\n    } else {\n      rc = sys_pledge_linux(ipromises, __pledge_mode);\n      if (rc > -4096u) errno = -rc, rc = -1;\n    }\n    if (!rc &amp;&amp; (getpid() == gettid())) {\n      __promises = ipromises;\n      __execpromises = iexecpromises;\n    }\n  } else {\n    errno = EINVAL;\n    rc = -1;\n  }\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:13517,&quot;string&quot;:&quot;13,517&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:262,&quot;string&quot;:&quot;262&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:31,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/landlock.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_CALLS_LANDLOCK_H_\n#define PLEDGE_LIBC_CALLS_LANDLOCK_H_\n\n#include <linux/landlock.h>\n#include <stdint.h>\n#include <stddef.h>\n\n/**\n * Allow renaming or linking file to a different directory.\n *\n * @see https://lore.kernel.org/r/20220329125117.1393824-8-mic@digikod.net\n * @see https://docs.kernel.org/userspace-api/landlock.html\n * @note ABI 2+\n */\n#ifndef LANDLOCK_ACCESS_FS_REFER\n#define LANDLOCK_ACCESS_FS_REFER 0x2000ul\n#endif\n\n/**\n * Control file truncation.\n *\n * @see https://lore.kernel.org/all/20221018182216.301684-1-gnoack3000@gmail.com/\n * @see https://docs.kernel.org/userspace-api/landlock.html\n * @note ABI 3+\n */\n#ifndef LANDLOCK_ACCESS_FS_TRUNCATE\n#define LANDLOCK_ACCESS_FS_TRUNCATE 0x4000ul\n#endif\n\nint landlock_restrict_self(int, uint32_t);\nint landlock_add_rule(int, enum landlock_rule_type, const void *, uint32_t);\nint landlock_create_ruleset(const struct landlock_ruleset_attr *, size_t,\n                            uint32_t);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:978,&quot;string&quot;:&quot;978&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:36,&quot;string&quot;:&quot;36&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:32,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/landlock_create_ruleset.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/landlock.h\&quot;\n/*\n#include \&quot;libc/intrin/strace.internal.h\&quot;\n\nint sys_landlock_create_ruleset(const struct landlock_ruleset_attr *, size_t,\n                                uint32_t);\n*/\n\n#include <sys/syscall.h>\n#include <unistd.h>\n\n/**\n * Create new Landlock filesystem sandboxing ruleset.\n *\n * You may also use this function to query the current ABI version:\n *\n *     landlock_create_ruleset(0, 0, LANDLOCK_CREATE_RULESET_VERSION);\n *\n * @return close exec file descriptor for new ruleset\n * @error ENOSYS if not running Linux 5.13+\n * @error EPERM if pledge() or seccomp bpf shut it down\n * @error EOPNOTSUPP Landlock supported but disabled at boot\n * @error EINVAL unknown flags, or unknown access, or too small size\n * @error E2BIG attr or size inconsistencies\n * @error EFAULT attr or size inconsistencies\n * @error ENOMSG empty landlock_ruleset_attr::handled_access_fs\n */\nint landlock_create_ruleset(const struct landlock_ruleset_attr *attr,\n                            size_t size, uint32_t flags) {\n  int rc;\n  rc = syscall(__NR_landlock_create_ruleset, attr, size, flags);\n  //KERNTRACE(\&quot;landlock_create_ruleset(%p, %'zu, %#x) â %d% m\&quot;, attr, size, flags,\n  //          rc);\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:3057,&quot;string&quot;:&quot;3,057&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:54,&quot;string&quot;:&quot;54&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:33,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/syscall_support-sysv.internal.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_CALLS_SYSCALL_SUPPORT_SYSV_INTERNAL_H_\n#define PLEDGE_LIBC_CALLS_SYSCALL_SUPPORT_SYSV_INTERNAL_H_\n\n#include <stdbool.h>\n\nbool is_linux_2_6_23(void);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:177,&quot;string&quot;:&quot;177&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:9,&quot;string&quot;:&quot;9&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:34,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/landlock_restrict_self.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/landlock.h\&quot;\n/*\n#include \&quot;libc/intrin/strace.internal.h\&quot;\n\nint sys_landlock_restrict_self(int, uint32_t);\n*/\n\n#include <sys/syscall.h>\n#include <unistd.h>\n\n/**\n * Enforces Landlock ruleset on calling thread.\n *\n * @error EOPNOTSUPP if Landlock supported but disabled at boot time\n * @error EINVAL if flags isn't zero\n * @error EBADF if `fd` isn't file descriptor for the current thread\n * @error EBADFD if `fd` is not a ruleset file descriptor\n * @error EPERM if `fd` has no read access to underlying ruleset, or\n *     current thread is not running with no_new_privs, or it doesnât\n *     have CAP_SYS_ADMIN in its namespace\n * @error E2BIG if the maximum number of stacked rulesets is\n *     reached for current thread\n */\nint landlock_restrict_self(int fd, uint32_t flags) {\n  int rc;\n  rc = syscall(__NR_landlock_restrict_self, fd, flags);\n  //KERNTRACE(\&quot;landlock_create_ruleset(%d, %#x) â %d% m\&quot;, fd, flags, rc);\n  return rc;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2792,&quot;string&quot;:&quot;2,792&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:48,&quot;string&quot;:&quot;48&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:35,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/calls/pledge.internal.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_CALLS_PLEDGE_INTERNAL_H_\n#define PLEDGE_LIBC_CALLS_PLEDGE_INTERNAL_H_\n\n#include \&quot;libc/calls/pledge.h\&quot;\n#include \&quot;libc/intrin/promises.internal.h\&quot;\n#include <stdint.h>\n#include <stddef.h>\n\nstruct Pledges {\n  const char *name;\n  const uint16_t *syscalls;\n  const size_t len;\n};\n\nextern const struct Pledges kPledge[PROMISE_LEN_];\n\nint sys_pledge_linux(unsigned long, int);\nint ParsePromises(const char *, unsigned long *);\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:447,&quot;string&quot;:&quot;447&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:21,&quot;string&quot;:&quot;21&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:36,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/safemacros.internal.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_INTRIN_SAFEMACROS_INTERNAL_H_\n#define PLEDGE_LIBC_INTRIN_SAFEMACROS_INTERNAL_H_\n\n#include \&quot;libc/integral/c.h\&quot;\n\n#define max(x, y)              \\\n  ({                           \\\n    autotype(x) MaxX = (x);    \\\n    autotype(y) MaxY = (y);    \\\n    MaxX > MaxY ? MaxX : MaxY; \\\n  })\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:309,&quot;string&quot;:&quot;309&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:14,&quot;string&quot;:&quot;14&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:37,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/kprintf.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_INTRIN_KPRINTF_H_\n#define PLEDGE_LIBC_INTRIN_KPRINTF_H_\n\n#include <stdio.h>\n\n#define kprintf printf\n#define ksnprintf snprintf\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:155,&quot;string&quot;:&quot;155&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:10,&quot;string&quot;:&quot;10&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:38,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/promises.internal.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_INTRIN_PROMISES_INTERNAL_H_\n#define PLEDGE_LIBC_INTRIN_PROMISES_INTERNAL_H_\n\n#define PROMISE_STDIO     0\n#define PROMISE_RPATH     1\n#define PROMISE_WPATH     2\n#define PROMISE_CPATH     3\n#define PROMISE_DPATH     4\n#define PROMISE_FLOCK     5\n#define PROMISE_FATTR     6\n#define PROMISE_INET      7\n#define PROMISE_UNIX      8\n#define PROMISE_DNS       9\n#define PROMISE_TTY       10\n#define PROMISE_RECVFD    11\n#define PROMISE_PROC      12\n#define PROMISE_EXEC      13\n#define PROMISE_ID        14\n#define PROMISE_UNVEIL    15\n#define PROMISE_SENDFD    16\n#define PROMISE_SETTIME   17\n#define PROMISE_PROT_EXEC 18\n#define PROMISE_VMINFO    19\n#define PROMISE_TMPPATH   20\n#define PROMISE_CHOWN     21\n#define PROMISE_LEN_      22\n\nextern unsigned long __promises;\nextern unsigned long __execpromises;\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:833,&quot;string&quot;:&quot;833&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:32,&quot;string&quot;:&quot;32&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:39,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/pthread_setcancelstate.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/blockcancel.internal.h\&quot;\n/*\n#include \&quot;libc/errno.h\&quot;\n#include \&quot;libc/thread/posixthread.internal.h\&quot;\n#include \&quot;libc/thread/thread.h\&quot;\n#include \&quot;libc/thread/tls.h\&quot;\n*/\n\n#include <pthread.h>\n\nvoid pthread_allow_cancellations(int oldstate) {\n  pthread_setcancelstate(oldstate, 0);\n}\n\nint pthread_block_cancellations(void) {\n  int oldstate;\n  pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, &amp;oldstate);\n  return oldstate;\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2270,&quot;string&quot;:&quot;2,270&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:38,&quot;string&quot;:&quot;38&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:40,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/promises.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â\nâvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡\nâ Copyright 2022 Justine Alexandra Roberts Tunney                              â\nâ                                                                              â\nâ Permission to use, copy, modify, and/or distribute this software for         â\nâ any purpose with or without fee is hereby granted, provided that the         â\nâ above copyright notice and this permission notice appear in all copies.      â\nâ                                                                              â\nâ THE SOFTWARE IS PROVIDED \&quot;AS IS\&quot; AND THE AUTHOR DISCLAIMS ALL                â\nâ WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â\nâ WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â\nâ AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â\nâ DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â\nâ PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â\nâ TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â\nâ PERFORMANCE OF THIS SOFTWARE.                                                â\nââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/\n#include \&quot;libc/calls/pledge.h\&quot;\n#include \&quot;libc/intrin/promises.internal.h\&quot;\n\n// XXX: should be inherited thread local\n//      see also sys_pledge_linux() which is 100% pure\nint __pledge_mode;\nunsigned long __promises;\nunsigned long __execpromises;\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:2082,&quot;string&quot;:&quot;2,082&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:27,&quot;string&quot;:&quot;27&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:41,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/likely.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_INTRIN_LIKELY_H_\n#define PLEDGE_LIBC_INTRIN_LIKELY_H_\n\n#ifndef __STRICT_ANSI__\n#define LIKELY(x)   __builtin_expect(!!(x), 1)\n#define UNLIKELY(x) __builtin_expect(!!(x), 0)\n#else\n#define LIKELY(x)\n#define UNLIKELY(x)\n#endif\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:252,&quot;string&quot;:&quot;252&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:13,&quot;string&quot;:&quot;13&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:42,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/intrin/bits.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_INTRIN_BITS_H_\n#define PLEDGE_LIBC_INTRIN_BITS_H_\n\n#include <stdint.h>\n\n#ifdef __STRICT_ANSI__\n#define READ32LE(S)                                                    \\\n  ((uint32_t)(255 &amp; (S)[3]) << 030 | (uint32_t)(255 &amp; (S)[2]) << 020 | \\\n   (uint32_t)(255 &amp; (S)[1]) << 010 | (uint32_t)(255 &amp; (S)[0]) << 000)\n#define READ64LE(S)                                                    \\\n  ((uint64_t)(255 &amp; (S)[7]) << 070 | (uint64_t)(255 &amp; (S)[6]) << 060 | \\\n   (uint64_t)(255 &amp; (S)[5]) << 050 | (uint64_t)(255 &amp; (S)[4]) << 040 | \\\n   (uint64_t)(255 &amp; (S)[3]) << 030 | (uint64_t)(255 &amp; (S)[2]) << 020 | \\\n   (uint64_t)(255 &amp; (S)[1]) << 010 | (uint64_t)(255 &amp; (S)[0]) << 000)\n#else /* gcc needs help knowing above are mov if s isn't a variable */\n#define READ32LE(S)                                      \\\n  ({                                                     \\\n    const uint8_t *Ptr = (const uint8_t *)(S);           \\\n    ((uint32_t)Ptr[3] << 030 | (uint32_t)Ptr[2] << 020 | \\\n     (uint32_t)Ptr[1] << 010 | (uint32_t)Ptr[0] << 000); \\\n  })\n#define READ64LE(S)                                      \\\n  ({                                                     \\\n    const uint8_t *Ptr = (const uint8_t *)(S);           \\\n    ((uint64_t)Ptr[7] << 070 | (uint64_t)Ptr[6] << 060 | \\\n     (uint64_t)Ptr[5] << 050 | (uint64_t)Ptr[4] << 040 | \\\n     (uint64_t)Ptr[3] << 030 | (uint64_t)Ptr[2] << 020 | \\\n     (uint64_t)Ptr[1] << 010 | (uint64_t)Ptr[0] << 000); \\\n  })\n#endif\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:1497,&quot;string&quot;:&quot;1,497&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:33,&quot;string&quot;:&quot;33&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:43,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/integral/c.h&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#ifndef PLEDGE_LIBC_INTEGRAL_C_H_\n#define PLEDGE_LIBC_INTEGRAL_C_H_\n\n#include <stdarg.h>\n#include <stdint.h>\n#include <stdlib.h>\n\n#ifndef __STRICT_ANSI__\n#define pureconst __attribute__((__const__))\n#else\n#define pureconst\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;     \\\n    (__has_attribute(__nonnull__) || \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 403)\n#define paramsnonnull(opt_1idxs) __attribute__((__nonnull__ opt_1idxs))\n#else\n#define paramsnonnull(opt_1idxs)\n#endif\n\n#define libcesque dontthrow nocallback\n\n#if defined(__cplusplus) &amp;&amp; !defined(__STRICT_ANSI__) &amp;&amp; \\\n    (__has_attribute(dontthrow) ||                       \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 303)\n#define dontthrow __attribute__((__nothrow__))\n#elif defined(_MSC_VER)\n#define dontthrow __declspec(nothrow)\n#else\n#define dontthrow\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;  \\\n    (__has_attribute(__leaf__) || \\\n     (!defined(__llvm__) &amp;&amp;       \\\n      (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 406))\n#define nocallback __attribute__((__leaf__))\n#else\n#define nocallback\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp; \\\n    (__has_attribute(__sentinel__) || __GNUC__ + 0 >= 4)\n#define nullterminated(x) __attribute__((__sentinel__ x))\n#else\n#define nullterminated(x)\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;    \\\n    (__has_attribute(__malloc__) || \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409)\n#define returnspointerwithnoaliases __attribute__((__malloc__))\n#elif defined(_MSC_VER)\n#define returnspointerwithnoaliases __declspec(allocator)\n#else\n#define returnspointerwithnoaliases\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;                           \\\n    ((__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 304 || \\\n     __has_attribute(__warn_unused_result__))\n#define dontdiscard __attribute__((__warn_unused_result__))\n#else\n#define dontdiscard\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;             \\\n    (__has_attribute(__returns_nonnull__) || \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409)\n#define returnsnonnull __attribute__((__returns_nonnull__))\n#else\n#define returnsnonnull\n#endif\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;        \\\n    (__has_attribute(__alloc_size__) || \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409)\n#define attributeallocsize(x) __attribute__((__alloc_size__ x))\n#else\n#define attributeallocsize(x)\n#endif\n\n#ifdef __cplusplus\n#define forceinline inline\n#else\n#if !defined(__STRICT_ANSI__) &amp;&amp; \\\n    (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 302\n#if (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 403 || \\\n    !defined(__cplusplus) ||                              \\\n    (defined(__clang__) &amp;&amp;                                \\\n     (defined(__GNUC_STDC_INLINE__) || defined(__GNUC_GNU_INLINE__)))\n#if defined(__GNUC_STDC_INLINE__) || defined(__cplusplus)\n#define forceinline                                                 \\\n  static __inline __attribute__((__always_inline__, __gnu_inline__, \\\n                                 __no_instrument_function__, __unused__))\n#else\n#define forceinline                                 \\\n  static __inline __attribute__((__always_inline__, \\\n                                 __no_instrument_function__, __unused__))\n#endif /* __GNUC_STDC_INLINE__ */\n#endif /* GCC >= 4.3 */\n#elif defined(_MSC_VER)\n#define forceinline __forceinline\n#else\n#define forceinline static inline\n#endif /* !ANSI &amp;&amp; GCC >= 3.2 */\n#endif /* __cplusplus */\n\n#define strlenesque libcesque nosideeffect paramsnonnull()\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;  \\\n    (__has_attribute(__pure__) || \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 296)\n#define nosideeffect __attribute__((__pure__))\n#else\n#define nosideeffect\n#endif\n\n#if __cplusplus + 0 >= 201103L\n#define autotype(x) auto\n#elif ((__has_builtin(auto_type) || defined(__llvm__) ||       \\\n        (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409) &amp;&amp; \\\n       !defined(__chibicc__))\n#define autotype(x) __auto_type\n#else\n#define autotype(x) typeof(x)\n#endif\n\n#define privileged\n\n#ifndef __STRICT_ANSI__\n#define thatispacked __attribute__((__packed__))\n#else\n#define thatispacked\n#endif\n\n#define notpossible __builtin_trap()\n\n#if !defined(__STRICT_ANSI__) &amp;&amp;      \\\n    (__has_attribute(__noreturn__) || \\\n     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 208)\n#define wontreturn __attribute__((__noreturn__))\n#else\n#define wontreturn\n#endif\n\n#endif\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:4386,&quot;string&quot;:&quot;4,386&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:149,&quot;string&quot;:&quot;149&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}},{&quot;rowIdx&quot;:44,&quot;cells&quot;:{&quot;path&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;pledge/libc/sysv/calls/ioprio_set.c&quot;},&quot;content&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;#include \&quot;libc/calls/calls.h\&quot;\n\n#include <sys/syscall.h>\n#include <unistd.h>\n\nint ioprio_set(int which, int who, int ioprio) {\n  return syscall(__NR_ioprio_set, which, who, ioprio);\n}\n&quot;},&quot;size&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:183,&quot;string&quot;:&quot;183&quot;},&quot;max_lines&quot;:{&quot;kind&quot;:&quot;number&quot;,&quot;value&quot;:9,&quot;string&quot;:&quot;9&quot;},&quot;repo_name&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;jart/plegde&quot;},&quot;autogenerated&quot;:{&quot;kind&quot;:&quot;string&quot;,&quot;value&quot;:&quot;false&quot;}}}],&quot;truncated&quot;:true},&quot;paginationData&quot;:{&quot;pageIndex&quot;:0,&quot;numItemsPerPage&quot;:100,&quot;numTotalItems&quot;:18912,&quot;offset&quot;:0,&quot;length&quot;:100}},&quot;jwt&quot;:&quot;eyJhbGciOiJFZERTQSJ9.eyJyZWFkIjp0cnVlLCJwZXJtaXNzaW9ucyI6eyJyZXBvLmNvbnRlbnQucmVhZCI6dHJ1ZX0sImlhdCI6MTc0MjkyMzExMSwic3ViIjoiL2RhdGFzZXRzL3dheWJhcnJpb3MvZ2l0aHViLWNvZGUtZGF0YXNldCIsImV4cCI6MTc0MjkyNjcxMSwiaXNzIjoiaHR0cHM6Ly9odWdnaW5nZmFjZS5jbyJ9.Gufrd95DOLdanXEdfwvBPP-6FbkMqcE6vbDuYi2RGjlCPOxoVqYen9XQre5ok07ALxiaatxbxQilO05Sb6WQBA&quot;,&quot;displayUrls&quot;:true},&quot;dataset&quot;:&quot;waybarrios/github-code-dataset&quot;,&quot;isGated&quot;:false,&quot;isPrivate&quot;:false,&quot;hasParquetFormat&quot;:true,&quot;author&quot;:{&quot;_id&quot;:&quot;6428793f53b748123d4d793b&quot;,&quot;avatarUrl&quot;:&quot;/avatars/5bf9d1ade981ab50dd488cc01a44b6e6.svg&quot;,&quot;fullname&quot;:&quot;Wayner Barrios&quot;,&quot;name&quot;:&quot;waybarrios&quot;,&quot;type&quot;:&quot;user&quot;,&quot;isPro&quot;:false,&quot;isHf&quot;:false,&quot;isHfAdmin&quot;:false,&quot;isMod&quot;:false},&quot;compact&quot;:true}"><div class="flex flex-col overflow-hidden shadow-xs mx-auto mb-10 rounded-lg border pt-2  px-2.5"><div class="mb-2 flex flex-wrap items-center gap-2"><div class="mr-auto flex items-center"><svg class="mr-1 flex-none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 12 12"><path fill="currentColor" d="M2.5 2h7a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1Zm0 2v2h3V4h-3Zm4 0v2h3V4h-3Zm-4 3v2h3V7h-3Zm4 0v2h3V7h-3Z"></path></svg>
	<div class="whitespace-nowrap font-semibold">Dataset Viewer</div>
	</div>
				<a href="/datasets/waybarrios/github-code-dataset/tree/refs%2Fconvert%2Fparquet/default" class="group mr-1 text-xs text-gray-400 max-sm:hidden"><svg class="text-[.6rem] mr-1 inline -translate-y-px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path fill="currentColor" d="M12 10H6.78A11 11 0 0 1 27 16h2A13 13 0 0 0 6 7.68V4H4v8h8zm8 12h5.22A11 11 0 0 1 5 16H3a13 13 0 0 0 23 8.32V28h2v-8h-8z"></path></svg>
						<span class="underline decoration-gray-300 group-hover:decoration-gray-400 dark:decoration-gray-500 dark:group-hover:decoration-gray-300">Auto-converted</span> to Parquet
					</a>
				<button class="btn shadow-xs flex cursor-pointer items-center rounded-sm border px-1 py-0.5 text-xs font-normal text-gray-700 hover:text-gray-800 hover:shadow-inner dark:hover:text-gray-200"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" style="transform: rotate(360deg);"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg>API</button>
					<button class="btn shadow-xs flex cursor-pointer items-center rounded-sm border px-1 py-0.5 text-xs font-normal text-gray-700 hover:text-gray-800 hover:shadow-inner dark:hover:text-gray-200"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 12 12"><path d="M9.80603 2.86737H3.56107C3.37704 2.86737 3.20055 2.94048 3.07042 3.0706C2.94029 3.20073 2.86719 3.37723 2.86719 3.56126V9.80622C2.86719 9.99025 2.94029 10.1667 3.07042 10.2969C3.20055 10.427 3.37704 10.5001 3.56107 10.5001H9.80603C9.99006 10.5001 10.1666 10.427 10.2967 10.2969C10.4268 10.1667 10.4999 9.99025 10.4999 9.80622V3.56126C10.4999 3.37723 10.4268 3.20073 10.2967 3.0706C10.1666 2.94048 9.99006 2.86737 9.80603 2.86737Z" fill="currentColor" fill-opacity="0.3"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2.40942 1.66191C2.05175 1.66191 1.7618 1.95186 1.7618 2.30953V6.76191H1.43799V2.30953C1.43799 1.77303 1.87291 1.3381 2.40942 1.3381H6.45704V1.66191H2.40942Z" fill="currentColor"></path></svg>Embed</button>

					<button class="bg-linear-to-b shadow-xs flex items-center gap-1.5 rounded-full border from-white to-red-100/90 px-2 py-0.5 text-xs font-medium text-[#2D3648] transition-shadow hover:shadow-inner dark:from-gray-900 dark:to-red-800/30 dark:text-gray-100 dark:hover:shadow-inner dark:hover:shadow-red-800/30" ><svg class="h-3.5 w-3.5 text-red-500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 12 12"><path fill="currentColor" d="M2.5 2h7a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1Zm0 2v2h3V4h-3Zm4 0v2h3V4h-3Zm-4 3v2h3V7h-3Zm4 0v2h3V7h-3Z"></path></svg>
						<span>Data Studio</span></button></div>
		<div class="flex flex-1 flex-col overflow-hidden -mx-2.5"><div class="flex flex-1 flex-col overflow-hidden"><div class="flex min-h-0 flex-1"><div class="flex flex-1 flex-col overflow-hidden"><div class="md:-mx-2.5 flex min-w-0 flex-wrap border-t"><div class="flex min-w-0 flex-1 flex-wrap"><div class="grid flex-1 grid-cols-1 overflow-hidden text-sm md:grid-cols-2 md:place-content-center sm:mx-2.5"><label class="relative block flex-1 px-3 py-2 hover:bg-gray-50 dark:border-gray-850 dark:hover:bg-gray-950 md:border-r md:border-r-0 hidden" title="default"><span class="text-gray-500">Subset (1)</span>
			<div class="flex items-center whitespace-nowrap"><span class="truncate">default</span>
				<span class="mx-2 text-gray-500">·</span>
					<span class="text-gray-500">18.9k rows</span>
				<svg class="ml-auto min-w-6 pl-2" width="1em" height="1em" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L6 6L11 1" stroke="currentColor"></path></svg></div>
			<select class="absolute inset-0 z-10 w-full cursor-pointer border-0 bg-white text-base opacity-0"><optgroup label="Subset (1)"><option value="default" selected>default (18.9k rows)</option></optgroup></select></label>
		<label class="relative block flex-1 px-3 py-2 hover:bg-gray-50 dark:border-gray-850 dark:hover:bg-gray-900 md:border-r md:border-r" title="train"><div class="text-gray-500">Split (1)</div>
				<div class="flex items-center overflow-hidden whitespace-nowrap"><span class="truncate">train</span>
					<span class="mx-2 text-gray-500">·</span>
						<span class="text-gray-500">18.9k rows</span>
					<svg class="ml-auto min-w-6 pl-2" width="1em" height="1em" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L6 6L11 1" stroke="currentColor"></path></svg></div>
				<select class="absolute inset-0 z-10 w-full cursor-pointer border-0 bg-white text-base opacity-0"><optgroup label="Split (1)"><option value="train" selected>train (18.9k rows)</option></optgroup></select></label></div></div>
								</div>

							<div class="flex min-h-0 flex-1 flex-col ">
	<div class="bg-linear-to-r text-smd relative flex items-center dark:border-gray-900 dark:bg-gray-950 false border-t [&amp;:has(:focus)]:from-gray-50 [&amp;:has(:focus)]:to-transparent [&amp;:has(:focus)]:to-20% dark:[&amp;:has(:focus)]:from-gray-900"><form class="flex-1"><svg class="absolute left-3 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-400" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M30 28.59L22.45 21A11 11 0 1 0 21 22.45L28.59 30zM5 14a9 9 0 1 1 9 9a9 9 0 0 1-9-9z" fill="currentColor"></path></svg>
				<input disabled class="outline-hidden h-9 w-full border-none bg-transparent px-1 pl-9 pr-3 placeholder:text-gray-400 " placeholder="Search this dataset" dir="auto"></form>
			<div class="flex items-center gap-2 px-2 py-1"><button type="button" class="hover:bg-yellow-200/70 flex items-center gap-1 rounded-md border border-yellow-200 bg-yellow-100 pl-0.5 pr-1 text-[.8rem] leading-normal text-gray-700 dark:border-orange-500/25 dark:bg-orange-500/20 dark:text-gray-300 dark:hover:brightness-110 hidden"><div class="rounded-sm bg-yellow-300 px-1 font-mono text-[.7rem] font-bold text-black dark:bg-yellow-700 dark:text-gray-200">SQL
	</div>
	Console
</button></div></div>


<div class="flex flex-1 flex-col overflow-hidden min-h-64 border-t">
		

<div class="max-h-96 relative overflow-auto"><table class="w-full table-auto rounded-lg font-mono text-xs text-gray-900"><thead class="shadow-xs sticky left-0 right-0 top-0 z-1 bg-white align-top"><tr class="space-y-54 h-full min-w-fit divide-x border-b text-left"><th class="h-full max-w-sm p-2 text-left  relative w-auto"><div class="flex h-full flex-col flex-nowrap justify-between"><div><div class="flex items-center justify-between">path
				<form class="flex flex-col"><button id="asc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="-rotate-180 transform text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button>
						<button id="desc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button></form></div>

			<div class="mb-2 whitespace-nowrap text-xs font-normal text-gray-500"><span>string</span><span class="italic text-gray-400 before:mx-1 before:content-['·']">lengths</span></div></div>

		<div><div class="" style="height: 40px; padding-top: 2px"><svg width="130" height="28"><g><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="0" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="13.2" y="19.202134337727557" width="11.2" height="10.797865662272443" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="26.4" y="0" width="11.2" height="30" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="39.599999999999994" y="1.2200251098556194" width="11.2" height="28.77997489014438" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="52.8" y="12.094161958568739" width="11.2" height="17.90583804143126" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="66" y="21.707470182046453" width="11.2" height="8.292529817953547" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="79.19999999999999" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="92.39999999999999" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="105.6" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="118.8" y="25" width="11.2" height="5" fill-opacity="1"></rect></g><rect class="fill-white dark:fill-gray-900" x="0" y="26" width="130" height="2" stroke-opacity="1"></rect><line class="stroke-gray-100 dark:stroke-gray-500/20" x1="0" y1="27.5" x2="130" y2="27.5" stroke-opacity="1"></line><g><rect class="fill-indigo-500 cursor-pointer" x="-1" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="12.2" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="25.4" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="38.599999999999994" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="51.8" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="65" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="78.19999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="91.39999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="104.6" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="117.8" y="0" width="13.2" height="30" fill-opacity="0"></rect></g></svg>
	<div class="relative font-light text-gray-400" style="height: 10px; width: 130px;"><div class="absolute left-0 overflow-hidden text-ellipsis whitespace-nowrap" style="max-width: 60px">14</div>
			<div class="absolute overflow-hidden text-ellipsis whitespace-nowrap" style="right: 0px; max-width: 60px">112</div>
			</div></div></div></div>
	<div class="absolute right-0 top-0 z-10 h-full w-1 cursor-col-resize hover:bg-indigo-100 active:bg-indigo-500 dark:hover:bg-indigo-800 dark:active:bg-indigo-600/80"><div class="absolute right-0 top-0 h-full w-1"></div>
								</div>
						</th><th class="h-full max-w-sm p-2 text-left  relative w-auto"><div class="flex h-full flex-col flex-nowrap justify-between"><div><div class="flex items-center justify-between">content
				<form class="flex flex-col"><button id="asc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="-rotate-180 transform text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button>
						<button id="desc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button></form></div>

			<div class="mb-2 whitespace-nowrap text-xs font-normal text-gray-500"><span>string</span><span class="italic text-gray-400 before:mx-1 before:content-['·']">lengths</span></div></div>

		<div><div class="" style="height: 40px; padding-top: 2px"><svg width="130" height="28"><g><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="0" y="0" width="11.2" height="30" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="13.2" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="26.4" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="39.599999999999994" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="52.8" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="66" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="79.19999999999999" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="92.39999999999999" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="105.6" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-gray-400 dark:fill-gray-500/80" rx="2" x="118.8" y="25" width="11.2" height="5" fill-opacity="1"></rect></g><rect class="fill-white dark:fill-gray-900" x="0" y="26" width="130" height="2" stroke-opacity="1"></rect><line class="stroke-gray-100 dark:stroke-gray-500/20" x1="0" y1="27.5" x2="130" y2="27.5" stroke-opacity="1"></line><g><rect class="fill-indigo-500 cursor-pointer" x="-1" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="12.2" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="25.4" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="38.599999999999994" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="51.8" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="65" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="78.19999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="91.39999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="104.6" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="117.8" y="0" width="13.2" height="30" fill-opacity="0"></rect></g></svg>
	<div class="relative font-light text-gray-400" style="height: 10px; width: 130px;"><div class="absolute left-0 overflow-hidden text-ellipsis whitespace-nowrap" style="max-width: 60px">0</div>
			<div class="absolute overflow-hidden text-ellipsis whitespace-nowrap" style="right: 0px; max-width: 60px">6.32M</div>
			</div></div></div></div>
	<div class="absolute right-0 top-0 z-10 h-full w-1 cursor-col-resize hover:bg-indigo-100 active:bg-indigo-500 dark:hover:bg-indigo-800 dark:active:bg-indigo-600/80"><div class="absolute right-0 top-0 h-full w-1"></div>
								</div>
						</th><th class="h-full max-w-sm p-2 text-left  relative w-auto"><div class="flex h-full flex-col flex-nowrap justify-between"><div><div class="flex items-center justify-between">size
				<form class="flex flex-col"><button id="asc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="-rotate-180 transform text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button>
						<button id="desc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button></form></div>

			<div class="mb-2 whitespace-nowrap text-xs font-normal text-gray-500"><span>int64</span></div></div>

		<div><div class="" style="height: 40px; padding-top: 2px"><svg width="130" height="28"><g><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="0" y="0" width="11.2" height="30" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="13.2" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="26.4" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="39.599999999999994" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="52.8" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="66" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="79.19999999999999" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="92.39999999999999" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="105.6" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="118.8" y="25" width="11.2" height="5" fill-opacity="1"></rect></g><rect class="fill-white dark:fill-gray-900" x="0" y="26" width="130" height="2" stroke-opacity="1"></rect><line class="stroke-gray-100 dark:stroke-gray-500/20" x1="0" y1="27.5" x2="130" y2="27.5" stroke-opacity="1"></line><g><rect class="fill-indigo-500 cursor-pointer" x="-1" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="12.2" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="25.4" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="38.599999999999994" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="51.8" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="65" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="78.19999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="91.39999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="104.6" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="117.8" y="0" width="13.2" height="30" fill-opacity="0"></rect></g></svg>
	<div class="relative font-light text-gray-400" style="height: 10px; width: 130px;"><div class="absolute left-0 overflow-hidden text-ellipsis whitespace-nowrap" style="max-width: 60px">0</div>
			<div class="absolute overflow-hidden text-ellipsis whitespace-nowrap" style="right: 0px; max-width: 60px">6.32M</div>
			</div></div></div></div>
	<div class="absolute right-0 top-0 z-10 h-full w-1 cursor-col-resize hover:bg-indigo-100 active:bg-indigo-500 dark:hover:bg-indigo-800 dark:active:bg-indigo-600/80"><div class="absolute right-0 top-0 h-full w-1"></div>
								</div>
						</th><th class="h-full max-w-sm p-2 text-left  relative w-auto"><div class="flex h-full flex-col flex-nowrap justify-between"><div><div class="flex items-center justify-between">max_lines
				<form class="flex flex-col"><button id="asc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="-rotate-180 transform text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button>
						<button id="desc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button></form></div>

			<div class="mb-2 whitespace-nowrap text-xs font-normal text-gray-500"><span>int64</span></div></div>

		<div><div class="" style="height: 40px; padding-top: 2px"><svg width="130" height="28"><g><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="0" y="0" width="11.2" height="30" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="13.2" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="26.4" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="39.599999999999994" y="25" width="11.2" height="5" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="52.8" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="66" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="79.19999999999999" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="92.39999999999999" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="105.6" y="26" width="11.2" height="4" fill-opacity="1"></rect><rect class="fill-indigo-500 dark:fill-indigo-600/80" rx="2" x="118.8" y="25" width="11.2" height="5" fill-opacity="1"></rect></g><rect class="fill-white dark:fill-gray-900" x="0" y="26" width="130" height="2" stroke-opacity="1"></rect><line class="stroke-gray-100 dark:stroke-gray-500/20" x1="0" y1="27.5" x2="130" y2="27.5" stroke-opacity="1"></line><g><rect class="fill-indigo-500 cursor-pointer" x="-1" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="12.2" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="25.4" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="38.599999999999994" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="51.8" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="65" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="78.19999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="91.39999999999999" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="104.6" y="0" width="13.2" height="30" fill-opacity="0"></rect><rect class="fill-indigo-500 cursor-pointer" x="117.8" y="0" width="13.2" height="30" fill-opacity="0"></rect></g></svg>
	<div class="relative font-light text-gray-400" style="height: 10px; width: 130px;"><div class="absolute left-0 overflow-hidden text-ellipsis whitespace-nowrap" style="max-width: 60px">1</div>
			<div class="absolute overflow-hidden text-ellipsis whitespace-nowrap" style="right: 0px; max-width: 60px">100k</div>
			</div></div></div></div>
	<div class="absolute right-0 top-0 z-10 h-full w-1 cursor-col-resize hover:bg-indigo-100 active:bg-indigo-500 dark:hover:bg-indigo-800 dark:active:bg-indigo-600/80"><div class="absolute right-0 top-0 h-full w-1"></div>
								</div>
						</th><th class="h-full max-w-sm p-2 text-left  relative w-auto"><div class="flex h-full flex-col flex-nowrap justify-between"><div><div class="flex items-center justify-between">repo_name
				<form class="flex flex-col"><button id="asc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="-rotate-180 transform text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button>
						<button id="desc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button></form></div>

			<div class="mb-2 whitespace-nowrap text-xs font-normal text-gray-500"><span>string</span><span class="italic text-gray-400 before:mx-1 before:content-['·']">classes</span></div></div>

		<div><div class="" style="height: 40px; padding-top: 2px"><svg width="130" height="28"><defs><clipPath id="rounded-bar"><rect x="0" y="0" width="130" height="8" rx="4"></rect></clipPath><pattern id="hatching" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)" height="1" width="5"><line y1="0" class="stroke-gray-400 dark:stroke-gray-500/80" stroke-width="3" y2="1" x1="2" x2="2"></line></pattern><pattern id="hatching-faded" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)" height="1" width="5"><line y1="0" class="stroke-gray-100 dark:stroke-gray-500/20" stroke-width="3" y2="1" x1="2" x2="2"></line></pattern></defs><g height="8" style="transform: translateY(20px)" clip-path="url(#rounded-bar)"><g style="transform: scaleX(1.0153846153846153) translateX(-1px)"><g><rect class="fill-indigo-500 dark:fill-indigo-600/80" x="1" y="0" width="127.61505922165821" height="8" fill-opacity="1"></rect></g></g></g><g style="transform: scaleX(1.0153846153846153) translateX(-1px)"><g><rect class="fill-white cursor-pointer" x="0" y="0" width="129.6150592216582" height="28" fill-opacity="0"></rect><rect class="fill-white cursor-pointer" x="129.6150592216582" y="0" width="0.3849407783417936" height="28" fill-opacity="0"></rect></g></g></svg>
	<div class="relative font-light text-gray-400" style="height: 10px; width: 130px;"><div class="absolute left-0 max-w-full overflow-hidden text-ellipsis whitespace-nowrap">2
				values</div></div></div></div></div>
	<div class="absolute right-0 top-0 z-10 h-full w-1 cursor-col-resize hover:bg-indigo-100 active:bg-indigo-500 dark:hover:bg-indigo-800 dark:active:bg-indigo-600/80"><div class="absolute right-0 top-0 h-full w-1"></div>
								</div>
						</th><th class="h-full max-w-sm p-2 text-left  relative w-auto"><div class="flex h-full flex-col flex-nowrap justify-between"><div><div class="flex items-center justify-between">autogenerated
				<form class="flex flex-col"><button id="asc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="-rotate-180 transform text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button>
						<button id="desc" class="-mr-1 ml-2 h-[0.4rem] w-[0.8rem] transition ease-in-out"><svg class="text-gray-300 hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 64 256 128" fill="currentColor" aria-hidden="true"><path d="M213.65674,101.657l-80,79.99976a7.99945,7.99945,0,0,1-11.31348,0l-80-79.99976A8,8,0,0,1,48,88H208a8,8,0,0,1,5.65674,13.657Z"></path></svg></button></form></div>

			<div class="mb-2 whitespace-nowrap text-xs font-normal text-gray-500"><span>bool</span></div></div>

		<div><div class="" style="height: 40px; padding-top: 2px"><svg width="130" height="28"><defs><clipPath id="rounded-bar"><rect x="0" y="0" width="130" height="8" rx="4"></rect></clipPath><pattern id="hatching" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)" height="1" width="5"><line y1="0" class="stroke-gray-400 dark:stroke-gray-500/80" stroke-width="3" y2="1" x1="2" x2="2"></line></pattern><pattern id="hatching-faded" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)" height="1" width="5"><line y1="0" class="stroke-gray-100 dark:stroke-gray-500/20" stroke-width="3" y2="1" x1="2" x2="2"></line></pattern></defs><g height="8" style="transform: translateY(20px)" clip-path="url(#rounded-bar)"><g style="transform: scaleX(1.0153846153846153) translateX(-1px)"><g><rect class="fill-indigo-500 dark:fill-indigo-600/80" x="1" y="0" width="128" height="8" fill-opacity="1"></rect></g></g></g><g style="transform: scaleX(1.0153846153846153) translateX(-1px)"><g><rect class="fill-white cursor-pointer" x="0" y="0" width="130" height="28" fill-opacity="0"></rect></g></g></svg>
	<div class="relative font-light text-gray-400" style="height: 10px; width: 130px;"><div class="absolute left-0 max-w-full overflow-hidden text-ellipsis whitespace-nowrap">1
				class</div></div></div></div></div>
	<div class="absolute right-0 top-0 z-10 h-full w-1 cursor-col-resize hover:bg-indigo-100 active:bg-indigo-500 dark:hover:bg-indigo-800 dark:active:bg-indigo-600/80"><div class="absolute right-0 top-0 h-full w-1"></div>
								</div>
						</th></tr></thead>
			<tbody class="h-16 overflow-scroll"><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="0"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/LICENSE</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">ISC License

Copyright 2020 Justine Alexandra Roberts Tunney

Permission to use, copy, modify, and/or distribute this software for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">759</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">17</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="1"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/.gitignore</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class=""># -*- conf -*-

/o

# TODO: Find some way to have Python write to o/
__pycache__

*.tmp
/.bochs.log
/HTAGS
/TAGS
/bx_enh_dbg.ini
/tool/emacs/*.elc
/perf.data
/perf.data.old
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">173</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">16</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="2"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/Makefile</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class=""># Makefiles are prettier like this
ifeq ($(origin .RECIPEPREFIX), undefined)
  $(error This Make does not support .RECIPEPREFIX. \
        Please use GNU Make 3.82 or later)
endif
.RECIPEPREFIX = >

# Use bash as the shell
SHELL := bash

# ...And use strict flags with it to make sure things fail if a step in there
# fails
.SHELLFLAGS := -eu -o pipefail -c

# Delete the target file of a Make rule if it fails - this guards against
# broken files
.DELETE_ON_ERROR:

# --no-builtin-rules: I'd rather make my own rules myself, make, thanks :)
MAKEFLAGS += --no-builtin-rules

# We use `override` to enable setting part of CFLAGS on the command line

# This makes the compiler generate dependency files, which will solve any
# header-related dependency problems we could have had
override CFLAGS += -MMD -MP -MF $@.d

# Make it simpler to include library include files
override CFLAGS += -I.

# We need functions provided by defining _GNU_SOURCE
override CFLAGS += -D_GNU_SOURCE

# We need to compile as PIC code since we're making shared libraries here
override CFLAGS += -fPIC

# LDFLAGS should contain CFLAGS (seperate so command-line can add to it, and
# to correspond to usual practice)
override LDFLAGS += $(CFLAGS)

OUTPUT_FOLDER = o/$(MODE)

.PHONY: all clean

all: $(OUTPUT_FOLDER)/pledge $(OUTPUT_FOLDER)/sandbox.so

# Note: we cannot merge the source file list for pledge and the sandbox as this may otherwise result in constructors calling forbidden syscalls in the sandbox
PLEDGE_SOURCE_FILES := cmd/pledge
PLEDGE_SOURCE_FILES += libc/calls/commandv libc/calls/getcpucount libc/calls/islinux
PLEDGE_SOURCE_FILES += libc/calls/landlock_add_rule libc/calls/landlock_create_ruleset
PLEDGE_SOURCE_FILES += libc/calls/landlock_restrict_self libc/calls/parsepromises
PLEDGE_SOURCE_FILES += libc/calls/pledge libc/calls/pledge-linux libc/calls/unveil

PLEDGE_SOURCE_FILES += libc/x/xdie libc/x/xjoinpaths libc/x/xmalloc libc/x/xrealloc
PLEDGE_SOURCE_FILES += libc/x/xstrcat libc/x/xstrdup

PLEDGE_SOURCE_FILES += libc/elf/checkelfaddress libc/elf/getelfsegmentheaderaddress

PLEDGE_SOURCE_FILES += libc/str/classifypath libc/str/endswith libc/str/isabspath

PLEDGE_SOURCE_FILES += libc/intrin/promises libc/intrin/pthread_setcancelstate

PLEDGE_SOURCE_FILES += libc/fmt/joinpaths libc/fmt/sizetol

PLEDGE_SOURCE_FILES += libc/runtime/isdynamicexecutable

PLEDGE_SOURCE_FILES += libc/sysv/calls/ioprio_set

SANDBOX_SOURCE_FILES := cmd/sandbox
SANDBOX_SOURCE_FILES += libc/calls/pledge-linux


SANDBOX_OBJECT_FILES := $(addprefix $(OUTPUT_FOLDER)/, $(addsuffix .o, $(SANDBOX_SOURCE_FILES)))
PLEDGE_OBJECT_FILES := $(addprefix $(OUTPUT_FOLDER)/, $(addsuffix .o, $(PLEDGE_SOURCE_FILES)))

# First we need to have a shared object for the sandbox
$(OUTPUT_FOLDER)/sandbox.so: $(SANDBOX_OBJECT_FILES)
> $(CC) $(LDFLAGS) -shared -o $@ $^

# Next we need to make an object file out of that shared object containing the shared object as a symbol
$(OUTPUT_FOLDER)/embedded-sandbox.o: $(OUTPUT_FOLDER)/sandbox.so
> ld -r -b binary -o $@ $^

# Finally we need to embed the sandbox into our executable so it can copy it out when needed
$(OUTPUT_FOLDER)/pledge: $(PLEDGE_OBJECT_FILES) $(OUTPUT_FOLDER)/embedded-sandbox.o
> $(CC) $(LDFLAGS) -o $@ $^

$(OUTPUT_FOLDER)/%.o: %.c
> @mkdir --parents $(OUTPUT_FOLDER)/cmd
> @mkdir --parents $(OUTPUT_FOLDER)/libc/calls
> @mkdir --parents $(OUTPUT_FOLDER)/libc/sysv/calls
> @mkdir --parents $(OUTPUT_FOLDER)/libc/str
> @mkdir --parents $(OUTPUT_FOLDER)/libc/mem
> @mkdir --parents $(OUTPUT_FOLDER)/libc/fmt
> @mkdir --parents $(OUTPUT_FOLDER)/libc/intrin
> @mkdir --parents $(OUTPUT_FOLDER)/libc/x
> @mkdir --parents $(OUTPUT_FOLDER)/libc/runtime
> @mkdir --parents $(OUTPUT_FOLDER)/libc/elf
> $(CC) -c $&lt; -o $@ $(CFLAGS)

# Include dependencies for the object files
include $(shell [ -d $(OUTPUT_FOLDER)/obj ] &amp;&amp; find $(OUTPUT_FOLDER)/ -type f -name '*.d')

# Remove all object, binary and other produced files
clean:
> rm -rf ./o/

</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">3,966</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">108</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="3"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/.clang-format</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">---
BasedOnStyle: Google
StatementMacros:
  - INITIALIZER
AlignConsecutiveMacros: true
AlignConsecutiveDeclarations: false
AlwaysBreakBeforeMultilineStrings: false
AllowShortFunctionsOnASingleLine: false
KeepEmptyLinesAtTheStartOfBlocks: true
ConstructorInitializerAllOnOneLineOrOnePerLine: true
IncludeBlocks: Merge
---
Language: Cpp
AllowShortFunctionsOnASingleLine: false
---
Language: Proto
...
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">399</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">18</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="4"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/README.md</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class=""># pledge for linux

OpenBSD is an operating system that's famous for its focus on security.
Unfortunately, OpenBSD leader Theo states that there are only 7000 users
of OpenBSD. So it's a very small but elite group, that wields a
disproportionate influence; since we hear all the time about the awesome
security features these guys get to use, even though we usually can't
use them ourselves, *until now*.

Pledge was like the forbidden fruit we'd all covet when the boss says we
must use things like Linux. Why does it matter? It's because pledge()
actually makes security comprehensible. Linux has never really had a
security layer that mere mortals can understand. For example, let's say
you want to do something on Linux like control whether or not some
program you downloaded from the web is allowed to have telemetry. You'd
need to write stuff like this:

```c
static const struct sock_filter kFilter[] = {
    /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, syscall, 0, 14 - 1),
    /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
    /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 2, 4 - 3, 0),
    /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 10, 0, 13 - 4),
    /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
    /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~0x80800),
    /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 1, 8 - 7, 0),
    /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 2, 0, 13 - 8),
    /* L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
    /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 12 - 10, 0),
    /*L10*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 6, 12 - 11, 0),
    /*L11*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 17, 0, 13 - 11),
    /*L12*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
    /*L13*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
    /*L14*/ /* next filter */
};
```

Oh my gosh. It's like we traded one form of security privilege for
another. OpenBSD limits security to a small pond, but makes it easy.
Linux is a big tent, but makes it impossibly hard. SECCOMP BPF might as
well be the Traditional Chinese of programming languages, since only a
small number of people who've devoted the oodles of time it takes to
understand code like what you see above have actually been able to
benefit from it. But if you've got OpenBSD privilege, then doing the
same thing becomes easy:

```c
pledge("stdio rpath", 0);
```

That's really all OpenBSD users have to do to prevent things like leaks
of confidential information. So how do we get it that simple on Linux?
The answer is to find someone with enough free time to figure out how to
use SECCOMP BPF to implement pledge. The latest volunteers are us, so
look upon our code ye mighty and despair.
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,697</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">56</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="5"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/macros.internal.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_MACROS_INTERNAL_H_
#define PLEDGE_LIBC_MACROS_INTERNAL_H_

#define ROUNDUP(X, K) (((X) + (K)-1) &amp; -(K))
#define ARRAYLEN(A) \
  ((sizeof(A) / sizeof(*(A))) / ((unsigned)!(sizeof(A) % sizeof(*(A)))))

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">227</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">9</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="6"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/dce.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_DCE_H_
#define PLEDGE_LIBC_DCE_H_

#ifndef __linux__
#error "This program is extremely likely to only work properly on Linux !"
#endif

#define IsLinux() 1
#define IsWindows() 0
#define IsOpenbsd() 0

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">228</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">13</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="7"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/xdie.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include &lt;stdlib.h>
#include "libc/x/x.h"

void xdie(void) {
  abort();
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">1,910</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">25</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="8"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/xstrcat.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/str/str.h"
#include "libc/x/x.h"

/**
 * Concatenates strings / chars to newly allocated memory, e.g.
 *
 *     xstrcat("hi", ' ', "there")
 *
 * Or without the C99 helper macro:
 *
 *     (xstrcat)("hi", ' ', "there", NULL)
 *
 * This goes twice as fast as the more powerful xasprintf(). It's not
 * quadratic like strcat(). It's much slower than high-effort stpcpy(),
 * particularly with string literals.
 *
 * @see gc()
 */
char *(xstrcat)(const char *s, ...) {
  va_list va;
  intptr_t q;
  char *p, b[2];
  size_t n, m, c;
  n = 0;
  c = 32;
  p = xmalloc(c);
  va_start(va, s);
  do {
    q = (intptr_t)s;
    if (q > 0 &amp;&amp; q &lt;= 255) {
      b[0] = q;
      b[1] = '\0';
      s = b;
      m = 1;
    } else {
      m = strlen(s);
    }
    if (n + m + 1 > c) {
      do {
        c += c >> 1;
      } while (n + m + 1 > c);
      p = xrealloc(p, c);
    }
    memcpy(p + n, s, m + 1);
    n += m;
  } while ((s = va_arg(va, const char *)));
  va_end(va);
  return p;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,827</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">68</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="9"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/xmalloc.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/x/x.h"

/**
 * Allocates uninitialized memory, or dies.
 */
void *xmalloc(size_t bytes) {
  void *res = malloc(bytes);
  if (!res) xdie();
  return res;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,006</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">29</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="10"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/xstrdup.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/intrin/likely.h"
#include "libc/str/str.h"
#include "libc/x/x.h"

/**
 * Allocates new copy of string, or dies.
 */
char *xstrdup(const char *s) {
  size_t len = strlen(s);
  char *s2 = malloc(len + 1);
  if (UNLIKELY(!s2)) xdie();
  return memcpy(s2, s, len + 1);
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,118</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">32</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="11"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/xjoinpaths.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/intrin/safemacros.internal.h"
#include "libc/str/path.h"
#include "libc/str/str.h"
#include "libc/x/x.h"

/**
 * Joins paths, e.g.
 *
 *     "a"  + "b"  â "a/b"
 *     "a/" + "b"  â "a/b"
 *     "a"  + "b/" â "a/b/"
 *     "a"  + "/b" â "/b"
 *     "."  + "b"  â "b"
 *     ""   + "b"  â "b"
 *
 * @return newly allocated string of resulting path
 */
char *xjoinpaths(const char *path, const char *other) {
  if (!*other) {
    return xstrdup(path);
  } else if (!*path) {
    return xstrdup(other);
  } else if (isabspath(other) || !strcmp(path, ".")) {
    return xstrdup(other);
  } else if (endswith(path, "/")) {
    return xstrcat(path, other);
  } else {
    return xstrcat(path, (uintptr_t)'/', other);
  }
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,580</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">49</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="12"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/xrealloc.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/x/x.h"

/**
 * Allocates/expands/shrinks/frees memory, or die.
 *
 * This API enables you to do the following:
 *
 *     p = xrealloc(p, n)
 *
 * The standard behaviors for realloc() still apply:
 *
 * - `!p` means xmalloc (returns non-NULL)
 * - `p &amp;&amp; n` means resize (returns non-NULL)
 * - `p &amp;&amp; !n` means free (returns NULL)
 *
 * The complexity of resizing is guaranteed to be amortized.
 */
void *xrealloc(void *p, size_t n) {
  void *q;
  q = realloc(p, n);
  if (!q &amp;&amp; !(p &amp;&amp; !n)) xdie();
  return q;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,362</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">42</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="13"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/x/x.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_X_X_H_
#define PLEDGE_LIBC_X_X_H_

#include "libc/integral/c.h"

_Noreturn void xdie(void);
void *xmalloc(size_t);
void *xrealloc(void *, size_t);
char *xstrdup(const char *);
char *xstrcat(const char *, ...);
#define xstrcat(...) (xstrcat)(__VA_ARGS__, NULL)
char *xjoinpaths(const char *, const char *);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">334</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">15</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="14"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/fmt/conv.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_SIZETOL_H_
#define PLEDGE_LIBC_SIZETOL_H_

#include "libc/integral/c.h"

long sizetol(const char *, long) paramsnonnull() libcesque;

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">161</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">9</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="15"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/fmt/sizetol.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2021 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/fmt/conv.h"
// #include "libc/fmt/fmt.h"
#include "libc/str/str.h"
// #include "libc/sysv/errfuns.h"

#include &lt;errno.h>

static int GetExponent(int c) {
  switch (c) {
    case '\0':
    case ' ':
    case '\t':
      return 0;
    case 'k':
    case 'K':
      return 1;
    case 'm':
    case 'M':
      return 2;
    case 'g':
    case 'G':
      return 3;
    case 't':
    case 'T':
      return 4;
    case 'p':
    case 'P':
      return 5;
    case 'e':
    case 'E':
      return 6;
    default:
      return -1;
  }
}

/**
 * Converts size string to long.
 *
 * The following unit suffixes may be used
 *
 * - `k` or `K` for kilo (multiply by ðÂ¹)
 * - `m` or `M` for mega (multiply by ðÂ²)
 * - `g` or `G` for giga (multiply by ðÂ³)
 * - `t` or `T` for tera (multiply by ðâ´)
 * - `p` or `P` for peta (multiply by ðâµ)
 * - `e` or `E` for exa  (multiply by ðâ¶)
 *
 * If a permitted alpha character is supplied, then any additional
 * characters after it (e.g. kbit, Mibit, TiB) are ignored. Spaces
 * before the integer are ignored, and overflows will be detected.
 *
 * Negative numbers are permissible, as well as a leading `+` sign. To
 * tell the difference between an error return and `-1` you must clear
 * `errno` before calling and test whether it changed.
 *
 * @param s is non-null nul-terminated input string
 * @param b is multiplier which should be 1000 or 1024
 * @return size greater than or equal 0 or -1 on error
 * @error EINVAL if error is due to bad syntax
 * @error EOVERFLOW if error is due to overflow
 */
long sizetol(const char *s, long b) {
  long x;
  int c, e, d;
  do {
    c = *s++;
  } while (c == ' ' || c == '\t');
  d = c == '-' ? -1 : 1;
  if (c == '-' || c == '+') c = *s++;
  if (!isdigit(c)) {
    errno = EINVAL;
    return -1;
  }
  x = 0;
  do {
    if (__builtin_mul_overflow(x, 10, &amp;x) ||
        __builtin_add_overflow(x, (c - '0') * d, &amp;x)) {
      errno = EOVERFLOW;
      return -1;
    }
  } while (isdigit((c = *s++)));
  if ((e = GetExponent(c)) == -1) {
    errno = EINVAL;
    return -1;
  }
  while (e--) {
    if (__builtin_mul_overflow(x, b, &amp;x)) {
      errno = EOVERFLOW;
      return -1;
    }
  }
  return x;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">4,055</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">113</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="16"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/fmt/joinpaths.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/intrin/bits.h"
#include "libc/str/path.h"
#include "libc/str/str.h"
// #include "libc/sysv/errfuns.h"

/**
 * Joins paths, e.g.
 *
 *     0    + 0    â 0
 *     ""   + ""   â ""
 *     "a"  + 0    â "a"
 *     "a"  + ""   â "a/"
 *     0    + "b"  â "b"
 *     ""   + "b"  â "b"
 *     "."  + "b"  â "./b"
 *     "b"  + "."  â "b/."
 *     "a"  + "b"  â "a/b"
 *     "a/" + "b"  â "a/b"
 *     "a"  + "b/" â "a/b/"
 *     "a"  + "/b" â "/b"
 *
 * @return joined path, which may be `buf`, `path`, or `other`, or null
 *     if (1) `buf` didn't have enough space, or (2) both `path` and
 *     `other` were null
 */
char *joinpaths(char *buf, size_t size, const char *path, const char *other) {
  size_t pathlen, otherlen;
  if (!other) return (char *)path;
  if (!path) return (char *)other;
  pathlen = strlen(path);
  if (!pathlen || *other == '/') {
    return (/*unconst*/ char *)other;
  }
  otherlen = strlen(other);
  if (path[pathlen - 1] == '/') {
    if (pathlen + otherlen + 1 &lt;= size) {
      memmove(buf, path, pathlen);
      memmove(buf + pathlen, other, otherlen + 1);
      return buf;
    } else {
      return 0;
    }
  } else {
    if (pathlen + 1 + otherlen + 1 &lt;= size) {
      memmove(buf, path, pathlen);
      buf[pathlen] = '/';
      memmove(buf + pathlen + 1, other, otherlen + 1);
      return buf;
    } else {
      return 0;
    }
  }
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">3,244</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">72</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="17"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/elf/getelfsegmentheaderaddress.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/elf/elf.h"

Elf64_Phdr *GetElfSegmentHeaderAddress(const Elf64_Ehdr *elf, size_t mapsize,
                                       unsigned i) {
  intptr_t addr =
      ((intptr_t)elf + (intptr_t)elf->e_phoff + (intptr_t)elf->e_phentsize * i);
  CheckElfAddress(elf, mapsize, addr, elf->e_phentsize);
  return (Elf64_Phdr *)addr;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,181</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">28</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="18"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/elf/checkelfaddress.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/elf/elf.h"
#include "libc/runtime/runtime.h"

void CheckElfAddress(const Elf64_Ehdr *elf, size_t mapsize, intptr_t addr,
                     size_t addrsize) {
#if 1//!(TRUSTWORTHY + ELF_TRUSTWORTHY + 0) || ELF_UNTRUSTWORTHY + 0
  if (addr &lt; (intptr_t)elf || addr + addrsize > (intptr_t)elf + mapsize) {
    /* kprintf("%p-%p falls outside interval %p-%p",  // */
    /*         addr, addr + addrsize,                 // */
    /*         elf, (char *)elf + mapsize);           // */
    abort();
  }
#endif
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,362</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">33</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="19"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/elf/elf.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_ELF_ELF_H_
#define PLEDGE_LIBC_ELF_ELF_H_

#include &lt;elf.h>
#include &lt;stddef.h>

void CheckElfAddress(const Elf64_Ehdr *, size_t, intptr_t, size_t);
Elf64_Phdr *GetElfSegmentHeaderAddress(const Elf64_Ehdr *, size_t, unsigned);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">255</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">11</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="20"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/blockcancel.internal.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_CALLS_BLOCKCANCEL_INTERNAL_H_
#define PLEDGE_LIBC_CALLS_BLOCKCANCEL_INTERNAL_H_

#define ALLOW_CANCELLATIONS                   \
  pthread_allow_cancellations(_cancelState);  \
  }                                           \
  while (0)

void pthread_allow_cancellations(int);

#define BLOCK_CANCELLATIONS \
  do {                      \
    int _cancelState;       \
  _cancelState = pthread_block_cancellations()

int pthread_block_cancellations(void);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">483</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">19</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="21"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/getcpucount.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2021 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include &lt;sched.h>
#include "libc/calls/calls.h"
#include "libc/runtime/runtime.h"

static unsigned _getcpucount_linux(void) {
  cpu_set_t s = {0};
  if (sched_getaffinity(0, sizeof(s), &amp;s) != -1) {
    return CPU_COUNT(&amp;s);
  } else {
    return 0;
  }
}

static unsigned _getcpucount_impl(void) {
  return _getcpucount_linux();
}

static int g_cpucount;

// precompute because process affinity on linux may change later
__attribute__((__constructor__)) static void _getcpucount_init(void) {
  g_cpucount = _getcpucount_impl();
}

/**
 * Returns number of CPUs in system.
 *
 * This is the same as the standard interface:
 *
 *     sysconf(_SC_NPROCESSORS_ONLN);
 *
 * Except this function isn't a bloated diamond dependency.
 *
 * On Intel systems with HyperThreading this will return the number of
 * cores multiplied by two.
 *
 * @return cpu count or 0 if it couldn't be determined
 */
unsigned getcpucount(void) {
  return g_cpucount;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,779</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">60</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="22"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/islinux.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include &lt;errno.h>
#include &lt;stdbool.h>
#include &lt;sys/prctl.h>
#include "libc/dce.h"
#include "libc/runtime/runtime.h"

privileged bool is_linux_2_6_23(void) {
  return prctl(PR_GET_SECCOMP) >= 0 || errno != EINVAL;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,054</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">28</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="23"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/parsepromises.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/pledge.internal.h"
#include "libc/macros.internal.h"
#include "libc/str/str.h"

static int FindPromise(const char *name) {
  int i;
  for (i = 0; i &lt; ARRAYLEN(kPledge); ++i) {
    if (!strcasecmp(name, kPledge[i].name)) {
      return i;
    }
  }
  return -1;
}

/**
 * Parses the arguments to pledge() into a bitmask.
 *
 * @return 0 on success, or -1 if invalid
 */
int ParsePromises(const char *promises, unsigned long *out) {
  int rc = 0;
  int promise;
  unsigned long ipromises;
  char *tok, *state, *start, buf[256];
  if (promises) {
    ipromises = -1;
    if (memccpy(buf, promises, 0, sizeof(buf))) {
      start = buf;
      while ((tok = strtok_r(start, " \t\r\n", &amp;state))) {
        if ((promise = FindPromise(tok)) != -1) {
          ipromises &amp;= ~(1ULL &lt;&lt; promise);
        } else {
          rc = -1;
          break;
        }
        start = 0;
      }
    } else {
      rc = -1;
    }
  } else {
    ipromises = 0;
  }
  if (!rc) {
    *out = ipromises;
  }
  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,854</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">67</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="24"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/commandv.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/calls.h"
// #include "libc/calls/struct/stat.h"
#include "libc/dce.h"
// #include "libc/errno.h"
#include "libc/intrin/bits.h"
#include "libc/intrin/safemacros.internal.h"
// #include "libc/intrin/strace.internal.h"
// #include "libc/log/libfatal.internal.h"
#include "libc/runtime/runtime.h"
#include "libc/str/str.h"
/*
#include "libc/sysv/consts/ok.h"
#include "libc/sysv/consts/s.h"
#include "libc/sysv/errfuns.h"
*/

#include &lt;errno.h>
#include &lt;sys/stat.h>
#include &lt;unistd.h>

static bool IsExePath(const char *s, size_t n) {
  return n >= 4 &amp;&amp; (READ32LE(s + n - 4) == READ32LE(".exe") ||
                    READ32LE(s + n - 4) == READ32LE(".EXE"));
}

static bool IsComPath(const char *s, size_t n) {
  return n >= 4 &amp;&amp; (READ32LE(s + n - 4) == READ32LE(".com") ||
                    READ32LE(s + n - 4) == READ32LE(".COM"));
}

static bool IsComDbgPath(const char *s, size_t n) {
  return n >= 8 &amp;&amp; (READ64LE(s + n - 8) == READ64LE(".com.dbg") ||
                    READ64LE(s + n - 8) == READ64LE(".COM.DBG"));
}

static bool AccessCommand(const char *name, char *path, size_t pathsz,
                          size_t namelen, int *err, const char *suffix,
                          size_t pathlen) {
  size_t suffixlen;
  suffixlen = strlen(suffix);
  if (IsWindows() &amp;&amp; suffixlen == 0 &amp;&amp; !IsExePath(name, namelen) &amp;&amp;
      !IsComPath(name, namelen))
    return false;
  if (pathlen + 1 + namelen + suffixlen + 1 > pathsz) return false;
  if (pathlen &amp;&amp; (path[pathlen - 1] != '/' &amp;&amp; path[pathlen - 1] != '\\')) {
    path[pathlen] = !IsWindows()                  ? '/'
                    : memchr(path, '\\', pathlen) ? '\\'
                                                  : '/';
    pathlen++;
  }
  memcpy(path + pathlen, name, namelen);
  memcpy(path + pathlen + namelen, suffix, suffixlen + 1);
  if (!access(path, X_OK)) {
    struct stat st;
    if (!stat(path, &amp;st)) {
      if (S_ISREG(st.st_mode)) {
        return true;
      } else {
        errno = EACCES;
      }
    }
  }
  if (errno == EACCES || *err != EACCES) *err = errno;
  return false;
}

static bool SearchPath(const char *name, char *path, size_t pathsz,
                       size_t namelen, int *err, const char *suffix) {
  char sep;
  size_t i;
  const char *p;
  if (!(p = getenv("PATH"))) p = "/bin:/usr/local/bin:/usr/bin";
  sep = IsWindows() &amp;&amp; strchr(p, ';') ? ';' : ':';
  for (;;) {
    for (i = 0; p[i] &amp;&amp; p[i] != sep; ++i) {
      if (i &lt; pathsz) {
        path[i] = p[i];
      }
    }
    if (AccessCommand(name, path, pathsz, namelen, err, suffix, i)) {
      return true;
    }
    if (p[i] == sep) {
      p += i + 1;
    } else {
      break;
    }
  }
  return false;
}

static bool FindCommand(const char *name, char *pb, size_t pbsz, size_t namelen,
                        bool pri, const char *suffix, int *err) {
  if (pri &amp;&amp; (memchr(name, '/', namelen) || memchr(name, '\\', namelen))) {
    pb[0] = 0;
    return AccessCommand(name, pb, pbsz, namelen, err, suffix, 0);
  }
  return SearchPath(name, pb, pbsz, namelen, err, suffix);
}

static bool FindVerbatim(const char *name, char *pb, size_t pbsz,
                         size_t namelen, bool pri, int *err) {
  return FindCommand(name, pb, pbsz, namelen, pri, "", err);
}

static bool FindSuffixed(const char *name, char *pb, size_t pbsz,
                         size_t namelen, bool pri, int *err) {
  return !IsExePath(name, namelen) &amp;&amp; !IsComPath(name, namelen) &amp;&amp;
         !IsComDbgPath(name, namelen) &amp;&amp;
         (FindCommand(name, pb, pbsz, namelen, pri, ".com", err) ||
          FindCommand(name, pb, pbsz, namelen, pri, ".exe", err));
}

/**
 * Resolves full pathname of executable.
 *
 * @return execve()'able path, or NULL w/ errno
 * @errno ENOENT, EACCES, ENOMEM
 * @see free(), execvpe()
 * @asyncsignalsafe
 * @vforksafe
 */
char *commandv(const char *name, char *pathbuf, size_t pathbufsz) {
  int e, f;
  char *res;
  size_t namelen;
  res = 0;
  if (!name) {
    errno = EFAULT;
  } else if (!(namelen = strlen(name))) {
    errno = ENOENT;
  } else if (namelen + 1 > pathbufsz) {
    errno = ENAMETOOLONG;
  } else {
    e = errno;
    f = ENOENT;
    if ((IsWindows() &amp;&amp;
         (FindSuffixed(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||
          FindVerbatim(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||
          FindSuffixed(name, pathbuf, pathbufsz, namelen, false, &amp;f) ||
          FindVerbatim(name, pathbuf, pathbufsz, namelen, false, &amp;f))) ||
        (!IsWindows() &amp;&amp;
         (FindVerbatim(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||
          FindSuffixed(name, pathbuf, pathbufsz, namelen, true, &amp;f) ||
          FindVerbatim(name, pathbuf, pathbufsz, namelen, false, &amp;f) ||
          FindSuffixed(name, pathbuf, pathbufsz, namelen, false, &amp;f)))) {
      errno = e;
      res = pathbuf;
    } else {
      errno = f;
    }
  }
  return res;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">6,718</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">173</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="25"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/unveil.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2020 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
/*
#include "libc/assert.h"
*/
#include "libc/calls/blockcancel.internal.h"
#include "libc/calls/calls.h"
#include "libc/calls/landlock.h"
/*
#include "libc/calls/struct/bpf.h"
#include "libc/calls/struct/filter.h"
#include "libc/calls/struct/seccomp.h"
#include "libc/calls/struct/stat.h"
#include "libc/calls/struct/stat.internal.h"
#include "libc/calls/syscall-sysv.internal.h"
*/
#include "libc/calls/syscall_support-sysv.internal.h"
/*
#include "libc/errno.h"
*/
#include "libc/fmt/conv.h"
/*
#include "libc/intrin/strace.internal.h"
*/
#include "libc/macros.internal.h"
/*
#include "libc/nexgen32e/vendor.internal.h"
#include "libc/runtime/internal.h"
*/
#include "libc/runtime/runtime.h"
#include "libc/runtime/stack.h"
#include "libc/str/path.h"
#include "libc/str/str.h"
/*
#include "libc/sysv/consts/at.h"
#include "libc/sysv/consts/audit.h"
#include "libc/sysv/consts/f.h"
#include "libc/sysv/consts/fd.h"
#include "libc/sysv/consts/nrlinux.h"
#include "libc/sysv/consts/o.h"
#include "libc/sysv/consts/pr.h"
#include "libc/sysv/consts/s.h"
#include "libc/sysv/errfuns.h"
#include "libc/thread/tls.h"
*/

#include &lt;errno.h>
#include &lt;fcntl.h>
#include &lt;libgen.h>
#include &lt;limits.h>
#include &lt;linux/filter.h>
#include &lt;linux/seccomp.h>
#include &lt;stddef.h>
#include &lt;stdlib.h>
#include &lt;string.h>
#include &lt;sys/prctl.h>
#include &lt;sys/stat.h>
#include &lt;sys/syscall.h>
#include &lt;unistd.h>

#define OFF(f) offsetof(struct seccomp_data, f)

#define UNVEIL_READ                                             \
  (LANDLOCK_ACCESS_FS_READ_FILE | LANDLOCK_ACCESS_FS_READ_DIR | \
   LANDLOCK_ACCESS_FS_REFER)
#define UNVEIL_WRITE \
  (LANDLOCK_ACCESS_FS_WRITE_FILE | LANDLOCK_ACCESS_FS_TRUNCATE)
#define UNVEIL_EXEC (LANDLOCK_ACCESS_FS_EXECUTE)
#define UNVEIL_CREATE                                             \
  (LANDLOCK_ACCESS_FS_MAKE_CHAR | LANDLOCK_ACCESS_FS_MAKE_DIR |   \
   LANDLOCK_ACCESS_FS_MAKE_REG | LANDLOCK_ACCESS_FS_MAKE_SOCK |   \
   LANDLOCK_ACCESS_FS_MAKE_FIFO | LANDLOCK_ACCESS_FS_MAKE_BLOCK | \
   LANDLOCK_ACCESS_FS_MAKE_SYM)

#define FILE_BITS                                                 \
  (LANDLOCK_ACCESS_FS_READ_FILE | LANDLOCK_ACCESS_FS_WRITE_FILE | \
   LANDLOCK_ACCESS_FS_EXECUTE)

static struct sock_filter kUnveilBlacklistAbiVersionBelow3[] = {
#if 0  // Should we have this ? It certainly means things don't work on other
       // architectures than x86-64 as-is... (TODO check this up later when
       // relevant)
    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(arch)),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),
#endif
    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_truncate, 1, 0),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_setxattr, 0, 1),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (1 &amp; SECCOMP_RET_DATA)),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
};

static struct sock_filter kUnveilBlacklistLatestAbi[] = {
#if 0
    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(arch)),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),
#endif
    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_setxattr, 0, 1),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (1 &amp; SECCOMP_RET_DATA)),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
};

static int landlock_abi_version;

__attribute__((__constructor__)) void init_landlock_version() {
  landlock_abi_version =
      landlock_create_ruleset(0, 0, LANDLOCK_CREATE_RULESET_VERSION);
}

/**
 * Long living state for landlock calls.
 * fs_mask is set to use all the access rights from the latest landlock ABI.
 * On init, the current supported abi is checked and unavailable rights are
 * masked off.
 *
 * As of 6.2, the latest abi is v3.
 *
 * TODO:
 *  - Integrate with pledge and remove the file access?
 *  - Stuff state into the .protected section?
 */
_Thread_local static struct {
  uint64_t fs_mask;
  int fd;
} State;

static int unveil_final(void) {
  int e, rc;
  struct sock_fprog sandbox = {
      .filter = kUnveilBlacklistLatestAbi,
      .len = ARRAYLEN(kUnveilBlacklistLatestAbi),
  };
  if (landlock_abi_version &lt; 3) {
    sandbox = (struct sock_fprog){
        .filter = kUnveilBlacklistAbiVersionBelow3,
        .len = ARRAYLEN(kUnveilBlacklistAbiVersionBelow3),
    };
  }
  e = errno;
  prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);
  errno = e;
  if ((rc = landlock_restrict_self(State.fd, 0)) != -1 &amp;&amp;
      (rc = close(State.fd)) != -1 &amp;&amp;
      (rc = prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &amp;sandbox)) != -1) {
    State.fd = 0;
  }
  return rc;
}

static int err_close(int rc, int fd) {
  int serrno = errno;
  close(fd);
  errno = serrno;
  return rc;
}

static int unveil_init(void) {
  int rc, fd;
  State.fs_mask = UNVEIL_READ | UNVEIL_WRITE | UNVEIL_EXEC | UNVEIL_CREATE;
  if (landlock_abi_version == -1) {
    if (errno == EOPNOTSUPP) {
      errno = ENOSYS;
    }
    return -1;
  }
  if (landlock_abi_version &lt; 2) {
    State.fs_mask &amp;= ~LANDLOCK_ACCESS_FS_REFER;
  }
  if (landlock_abi_version &lt; 3) {
    State.fs_mask &amp;= ~LANDLOCK_ACCESS_FS_TRUNCATE;
  }
  const struct landlock_ruleset_attr attr = {
      .handled_access_fs = State.fs_mask,
  };
  // [undocumented] landlock_create_ruleset() always returns o_cloexec
  //                assert(__sys_fcntl(rc, F_GETFD, 0) == FD_CLOEXEC);
  if ((rc = landlock_create_ruleset(&amp;attr, sizeof(attr), 0)) &lt; 0) return -1;
  // grant file descriptor a higher number that's less likely to interfere
  if ((fd = fcntl(rc, F_DUPFD_CLOEXEC, 100)) == -1) {
    return err_close(-1, rc);
  }
  if (close(rc) == -1) {
    return err_close(-1, fd);
  }
  State.fd = fd;
  return 0;
}

int sys_unveil_linux(const char *path, const char *permissions) {
  int rc;
  const char *dir;
  const char *last;
  const char *next;
  struct {
    char lbuf[PATH_MAX];
    char buf1[PATH_MAX];
    char buf2[PATH_MAX];
    char buf3[PATH_MAX];
    char buf4[PATH_MAX];
  } b;
  CheckLargeStackAllocation(&amp;b, sizeof(b));

  if (!State.fd &amp;&amp; (rc = unveil_init()) == -1) return rc;
  if ((path &amp;&amp; !permissions) || (!path &amp;&amp; permissions)) {
    errno = EINVAL;
    return -1;
  }
  if (!path &amp;&amp; !permissions) return unveil_final();
  struct landlock_path_beneath_attr pb = {0};
  for (const char *c = permissions; *c != '\0'; c++) {
    switch (*c) {
      case 'r':
        pb.allowed_access |= UNVEIL_READ;
        break;
      case 'w':
        pb.allowed_access |= UNVEIL_WRITE;
        break;
      case 'x':
        pb.allowed_access |= UNVEIL_EXEC;
        break;
      case 'c':
        pb.allowed_access |= UNVEIL_CREATE;
        break;
      default:
        errno = EINVAL;
        return -1;
    }
  }
  pb.allowed_access &amp;= State.fs_mask;

  // landlock exposes all metadata, so we only technically need to add
  // realpath(path) to the ruleset. however a corner case exists where
  // it isn't valid, e.g. /dev/stdin -> /proc/2834/fd/pipe:[51032], so
  // we'll need to work around this, by adding the path which is valid
  if (strlen(path) + 1 > PATH_MAX) {
    errno = ENAMETOOLONG;
    return -1;
  }
  last = path;
  next = path;
  for (int i = 0;; ++i) {
    if (i == 64) {
      // give up
      errno = ELOOP;
      return -1;
    }
    int err = errno;
    if ((rc = readlinkat(AT_FDCWD, next, b.lbuf, PATH_MAX)) != -1) {
      if (rc &lt; PATH_MAX) {
        // we need to nul-terminate
        b.lbuf[rc] = 0;
        // last = next
        strcpy(b.buf1, next);
        last = b.buf1;
        // next = join(dirname(next), link)
        strcpy(b.buf2, next);
        dir = dirname(b.buf2);
        if ((next = joinpaths(b.buf3, PATH_MAX, dir, b.lbuf))) {
          // next now points to either: buf3, buf2, lbuf, rodata
          strcpy(b.buf4, next);
          next = b.buf4;
        } else {
          errno = ENAMETOOLONG;
          return -1;
        }
      } else {
        // symbolic link data was too long
        errno = ENAMETOOLONG;
        return -1;
      }
    } else if (errno == EINVAL) {
      // next wasn't a symbolic link
      errno = err;
      path = next;
      break;
    } else if (i &amp;&amp; (errno == ENOENT || errno == ENOTDIR)) {
      // next is a broken symlink, use last
      errno = err;
      path = last;
      break;
    } else {
      // readlink failed for some other reason
      return -1;
    }
  }

  // now we can open the path
  BLOCK_CANCELLATIONS;
  rc = open(path, O_PATH | O_NOFOLLOW | O_CLOEXEC, 0);
  ALLOW_CANCELLATIONS;
  if (rc == -1) return rc;

  pb.parent_fd = rc;
  struct stat st;
  if ((rc = fstat(pb.parent_fd, &amp;st)) == -1) {
    return err_close(rc, pb.parent_fd);
  }
  if (!S_ISDIR(st.st_mode)) {
    pb.allowed_access &amp;= FILE_BITS;
  }
  if ((rc = landlock_add_rule(State.fd, LANDLOCK_RULE_PATH_BENEATH, &amp;pb, 0))) {
    return err_close(rc, pb.parent_fd);
  }
  close(pb.parent_fd);
  return rc;
}

/**
 * Makes files accessible, e.g.
 *
 *     unveil(".", "r");     // current directory + children are visible
 *     unveil("/etc", "r");  // make /etc readable too
 *     unveil(0, 0);         // commit and lock policy
 *
 * Unveiling restricts a view of the filesystem to a set of allowed
 * paths with specific privileges.
 *
 * Once you start using unveil(), the entire file system is considered
 * hidden. You then specify, by repeatedly calling unveil(), which paths
 * should become unhidden. When you're finished, you call `unveil(0,0)`
 * which commits your policy.
 *
 * This function requires OpenBSD or Linux 5.13+. We don't consider lack
 * of system support to be an ENOSYS error, because the files will still
 * become unveiled. Therefore we return 0 in such cases.
 *
 * There are some differences between unveil() on Linux versus OpenBSD.
 *
 * 1. Build your policy and lock it in one go. On OpenBSD, policies take
 *    effect immediately and may evolve as you continue to call unveil()
 *    but only in a more restrictive direction. On Linux, nothing will
 *    happen until you call `unveil(0,0)` which commits and locks.
 *
 * 2. Try not to overlap directory trees. On OpenBSD, if directory trees
 *    overlap, then the most restrictive policy will be used for a given
 *    file. On Linux overlapping may result in a less restrictive policy
 *    and possibly even undefined behavior.
 *
 * 3. OpenBSD and Linux disagree on error codes. On OpenBSD, accessing
 *    paths outside of the allowed set raises ENOENT, and accessing ones
 *    with incorrect permissions raises EACCES. On Linux, both these
 *    cases raise EACCES.
 *
 * 4. Unlike OpenBSD, Linux does nothing to conceal the existence of
 *    paths. Even with an unveil() policy in place, it's still possible
 *    to access the metadata of all files using functions like stat()
 *    and open(O_PATH), provided you know the path. A sandboxed process
 *    can always, for example, determine how many bytes of data are in
 *    /etc/passwd, even if the file isn't readable. But it's still not
 *    possible to use opendir() and go fishing for paths which weren't
 *    previously known.
 *
 * 5. Use ftruncate() rather than truncate() if you wish for portability to
 *    Linux kernels versions released before February 2022. One issue
 *    Landlock hadn't addressed as of ABI version 2 was restrictions over
 *    truncate() and setxattr() which could permit certain kinds of
 *    modifications to files outside the sandbox. When your policy is
 *    committed, we install a SECCOMP BPF filter to disable those calls,
 *    however similar trickery may be possible through other unaddressed
 *    calls like ioctl(). Using the pledge() function in addition to
 *    unveil() will solve this, since it installs a strong system call
 *    access policy. Linux 6.2 has improved this situation with Landlock
 *    ABI v3, which added the ability to control truncation operations -
 *    this means the SECCOMP BPF filter will only disable
 *    truncate() on Linux 6.1 or older
 *
 * 6. Set your process-wide policy at startup from the main thread. On
 *    OpenBSD unveil() will apply process-wide even when called from a
 *    child thread; whereas with Linux, calling unveil() from a thread
 *    will cause your ruleset to only apply to that thread in addition
 *    to any descendent threads it creates.
 *
 * 7. Always specify at least one path. OpenBSD has unclear semantics
 *    when `unveil(0,0)` is used without any previous calls.
 *
 * 8. On OpenBSD calling `unveil(0,0)` will prevent unveil() from being
 *    used again. On Linux this is allowed, because Landlock is able to
 *    do that securely, i.e. the second ruleset can only be a subset of
 *    the previous ones.
 *
 * This system call is supported natively on OpenBSD and polyfilled on
 * Linux using the Landlock LSM[1].
 *
 * @param path is the file or directory to unveil
 * @param permissions is a string consisting of zero or more of the
 *     following characters:
 *
 *     - 'r' makes `path` available for read-only path operations,
 *       corresponding to the pledge promise "rpath".
 *
 *     - `w` makes `path` available for write operations, corresponding
 *       to the pledge promise "wpath".
 *
 *     - `x` makes `path` available for execute operations,
 *       corresponding to the pledge promises "exec" and "execnative".
 *
 *     - `c` allows `path` to be created and removed, corresponding to
 *       the pledge promise "cpath".
 *
 * @return 0 on success, or -1 w/ errno
 * @raise EINVAL if one argument is set and the other is not
 * @raise EINVAL if an invalid character in `permissions` was found
 * @raise EPERM if unveil() is called after locking
 * @note on Linux this function requires Linux Kernel 5.13+ and version 6.2+
 *     to properly support truncation operations
 * @see [1] https://docs.kernel.org/userspace-api/landlock.html
 * @threadsafe
 */
int unveil(const char *path, const char *permissions) {
  int e, rc;
  e = errno;
  /*if (IsGenuineBlink()) {
    rc = 0;  // blink doesn't support landlock
  } else if (IsLinux()) {*/
  rc = sys_unveil_linux(path, permissions);
  /*} else {
    abort();
    rc = sys_unveil(path, permissions);
  }*/
  if (rc == -1 &amp;&amp; errno == ENOSYS) {
    errno = e;
    rc = 0;
  }
  // STRACE("unveil(%#s, %#s) â %d% m", path, permissions, rc);
  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">16,207</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">446</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="26"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/calls.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_CALLS_H_
#define PLEDGE_LIBC_CALLS_H_

#include &lt;stddef.h>

char *commandv(const char *, char *, size_t);
int ioprio_set(int, int, int);
int pledge(const char *, const char *);
int unveil(const char *, const char *);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">245</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">12</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="27"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/pledge.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_CALLS_PLEDGE_H_
#define PLEDGE_LIBC_CALLS_PLEDGE_H_

#define PLEDGE_PENALTY_KILL_THREAD  0x0000
#define PLEDGE_PENALTY_KILL_PROCESS 0x0001
#define PLEDGE_PENALTY_RETURN_EPERM 0x0002
#define PLEDGE_PENALTY_MASK         0x000f
#define PLEDGE_STDERR_LOGGING       0x0010

extern int __pledge_mode;


#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">324</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">14</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="28"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/pledge-linux.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include &lt;errno.h>
#include &lt;fcntl.h>
#include &lt;linux/audit.h>
#include &lt;linux/filter.h>
#include &lt;linux/seccomp.h>
#include &lt;netinet/in.h>
#include &lt;netinet/ip.h>
#include &lt;netinet/tcp.h>
#include &lt;sched.h>
#include &lt;signal.h>
#include &lt;stdarg.h>
#include &lt;stdbool.h>
#include &lt;string.h>
#include &lt;sys/ioctl.h>
#include &lt;sys/mman.h>
#include &lt;sys/prctl.h>
#include &lt;sys/socket.h>
#include &lt;sys/syscall.h>
#include &lt;unistd.h>
#include "libc/calls/pledge.internal.h"
#include "libc/intrin/likely.h"
#include "libc/intrin/promises.internal.h"
#include "libc/macros.internal.h"
#include "libc/runtime/runtime.h"
#include "libc/runtime/stack.h"

/**
 * @fileoverview OpenBSD pledge() Polyfill Payload for GNU/Systemd
 *
 * This file contains only the minimum amount of Linux-specific code
 * that's necessary to get a pledge() policy installed. This file is
 * designed to not use static or tls memory or libc depnedencies, so
 * it can be transplanted into codebases and injected into programs.
 */

#define SPECIAL   0xf000
#define SELF      0x8000
#define ADDRLESS  0x2000
#define INET      0x2000
#define LOCK      0x4000
#define NOEXEC    0x8000
#define EXEC      0x4000
#define READONLY  0x8000
#define WRITEONLY 0x4000
#define CREATONLY 0x2000
#define STDIO     0x8000
#define THREAD    0x8000
#define TTY       0x8000
#define UNIX      0x4000
#define NOBITS    0x8000
#define RESTRICT  0x1000

#define PLEDGE(pledge) pledge, ARRAYLEN(pledge)
#define OFF(f)         offsetof(struct seccomp_data, f)
#define bsr(x)         (__builtin_clzll(x) ^ 63)

#ifdef __x86_64__
#define MCONTEXT_SYSCALL_RESULT_REGISTER gregs[REG_RAX]
#define MCONTEXT_INSTRUCTION_POINTER     gregs[REG_RIP]
#define ARCHITECTURE                     AUDIT_ARCH_X86_64
#elif defined(__aarch64__)
#define MCONTEXT_SYSCALL_RESULT_REGISTER regs[0]
#define MCONTEXT_INSTRUCTION_POINTER     pc
#define ARCHITECTURE                     AUDIT_ARCH_AARCH64
#else
#error "unsupported architecture"
#endif

struct Filter {
  size_t n;
  struct sock_filter p[800];
};

static const struct thatispacked SyscallName {
  uint16_t n;
  const char *const s;
} kSyscallName[] = {
    {__NR_exit, "exit"},
    {__NR_exit_group, "exit_group"},
    {__NR_read, "read"},
    {__NR_write, "write"},
#ifdef __NR_open
    {__NR_open, "open"},
#endif
    {__NR_close, "close"},
#ifdef __NR_stat
    {__NR_stat, "stat"},
#endif
    {__NR_fstat, "fstat"},
#ifdef __NR_lstat
    {__NR_lstat, "lstat"},
#endif
#ifdef __NR_poll
    {__NR_poll, "poll"},
#endif
    {__NR_ppoll, "ppoll"},
    {__NR_brk, "brk"},
    {__NR_rt_sigreturn, "sigreturn"},
    {__NR_lseek, "lseek"},
    {__NR_mmap, "mmap"},
    {__NR_msync, "msync"},
    {__NR_mprotect, "mprotect"},
    {__NR_munmap, "munmap"},
    {__NR_rt_sigaction, "sigaction"},
    {__NR_rt_sigprocmask, "sigprocmask"},
    {__NR_ioctl, "ioctl"},
    {__NR_pread64, "pread"},
    {__NR_pwrite64, "pwrite"},
    {__NR_readv, "readv"},
    {__NR_writev, "writev"},
#ifdef __NR_access
    {__NR_access, "access"},
#endif
#ifdef __NR_pipe
    {__NR_pipe, "pipe"},
#endif
#ifdef __NR_select
    {__NR_select, "select"},
#endif
    {__NR_pselect6, "pselect6"},
    {__NR_sched_yield, "sched_yield"},
    {__NR_mremap, "mremap"},
    {__NR_mincore, "mincore"},
    {__NR_madvise, "madvise"},
    {__NR_shmget, "shmget"},
    {__NR_shmat, "shmat"},
    {__NR_shmctl, "shmctl"},
    {__NR_dup, "dup"},
#ifdef __NR_dup2
    {__NR_dup2, "dup2"},
#endif
#ifdef __NR_pause
    {__NR_pause, "pause"},
#endif
    {__NR_nanosleep, "nanosleep"},
    {__NR_getitimer, "getitimer"},
    {__NR_setitimer, "setitimer"},
#ifdef __NR_alarm
    {__NR_alarm, "alarm"},
#endif
    {__NR_getpid, "getpid"},
    {__NR_sendfile, "sendfile"},
    {__NR_socket, "socket"},
    {__NR_connect, "connect"},
    {__NR_accept, "accept"},
    {__NR_sendto, "sendto"},
    {__NR_recvfrom, "recvfrom"},
    {__NR_sendmsg, "sendmsg"},
    {__NR_recvmsg, "recvmsg"},
    {__NR_shutdown, "shutdown"},
    {__NR_bind, "bind"},
    {__NR_listen, "listen"},
    {__NR_getsockname, "getsockname"},
    {__NR_getpeername, "getpeername"},
    {__NR_socketpair, "socketpair"},
    {__NR_setsockopt, "setsockopt"},
    {__NR_getsockopt, "getsockopt"},
#ifdef __NR_fork
    {__NR_fork, "fork"},
#endif
#ifdef __NR_vfork
    {__NR_vfork, "vfork"},
#endif
    {__NR_execve, "execve"},
    {__NR_wait4, "wait4"},
    {__NR_kill, "kill"},
    {__NR_clone, "clone"},
    {__NR_tkill, "tkill"},
    {__NR_futex, "futex"},
    {__NR_set_robust_list, "set_robust_list"},
    {__NR_get_robust_list, "get_robust_list"},
    {__NR_uname, "uname"},
    {__NR_semget, "semget"},
    {__NR_semop, "semop"},
    {__NR_semctl, "semctl"},
    {__NR_shmdt, "shmdt"},
    {__NR_msgget, "msgget"},
    {__NR_msgsnd, "msgsnd"},
    {__NR_msgrcv, "msgrcv"},
    {__NR_msgctl, "msgctl"},
    {__NR_fcntl, "fcntl"},
    {__NR_flock, "flock"},
    {__NR_fsync, "fsync"},
    {__NR_fdatasync, "fdatasync"},
    {__NR_truncate, "truncate"},
    {__NR_ftruncate, "ftruncate"},
    {__NR_getcwd, "getcwd"},
    {__NR_chdir, "chdir"},
    {__NR_fchdir, "fchdir"},
#ifdef __NR_rename
    {__NR_rename, "rename"},
#endif
#ifdef __NR_mkdir
    {__NR_mkdir, "mkdir"},
#endif
#ifdef __NR_rmdir
    {__NR_rmdir, "rmdir"},
#endif
#ifdef __NR_creat
    {__NR_creat, "creat"},
#endif
#ifdef __NR_link
    {__NR_link, "link"},
#endif
#ifdef __NR_unlink
    {__NR_unlink, "unlink"},
#endif
#ifdef __NR_symlink
    {__NR_symlink, "symlink"},
#endif
#ifdef __NR_readlink
    {__NR_readlink, "readlink"},
#endif
#ifdef __NR_chmod
    {__NR_chmod, "chmod"},
#endif
    {__NR_fchmod, "fchmod"},
#ifdef __NR_chown
    {__NR_chown, "chown"},
#endif
    {__NR_fchown, "fchown"},
#ifdef __NR_lchown
    {__NR_lchown, "lchown"},
#endif
    {__NR_umask, "umask"},
    {__NR_gettimeofday, "gettimeofday"},
    {__NR_getrlimit, "getrlimit"},
    {__NR_getrusage, "getrusage"},
    {__NR_sysinfo, "sysinfo"},
    {__NR_times, "times"},
    {__NR_ptrace, "ptrace"},
    {__NR_syslog, "syslog"},
    {__NR_getuid, "getuid"},
    {__NR_getgid, "getgid"},
    {__NR_getppid, "getppid"},
#ifdef __NR_getpgrp
    {__NR_getpgrp, "getpgrp"},
#endif
    {__NR_setsid, "setsid"},
    {__NR_getsid, "getsid"},
    {__NR_getpgid, "getpgid"},
    {__NR_setpgid, "setpgid"},
    {__NR_geteuid, "geteuid"},
    {__NR_getegid, "getegid"},
    {__NR_getgroups, "getgroups"},
    {__NR_setgroups, "setgroups"},
    {__NR_setreuid, "setreuid"},
    {__NR_setregid, "setregid"},
    {__NR_setuid, "setuid"},
    {__NR_setgid, "setgid"},
    {__NR_setresuid, "setresuid"},
    {__NR_setresgid, "setresgid"},
    {__NR_getresuid, "getresuid"},
    {__NR_getresgid, "getresgid"},
    {__NR_rt_sigpending, "sigpending"},
    {__NR_rt_sigsuspend, "sigsuspend"},
    {__NR_sigaltstack, "sigaltstack"},
#ifdef __NR_mknod
    {__NR_mknod, "mknod"},
#endif
    {__NR_mknodat, "mknodat"},
    {__NR_statfs, "statfs"},
    {__NR_fstatfs, "fstatfs"},
    {__NR_getpriority, "getpriority"},
    {__NR_setpriority, "setpriority"},
    {__NR_mlock, "mlock"},
    {__NR_munlock, "munlock"},
    {__NR_mlockall, "mlockall"},
    {__NR_munlockall, "munlockall"},
    {__NR_setrlimit, "setrlimit"},
    {__NR_chroot, "chroot"},
    {__NR_sync, "sync"},
    {__NR_acct, "acct"},
    {__NR_settimeofday, "settimeofday"},
    {__NR_mount, "mount"},
    {__NR_reboot, "reboot"},
    {__NR_quotactl, "quotactl"},
    {__NR_setfsuid, "setfsuid"},
    {__NR_setfsgid, "setfsgid"},
    {__NR_capget, "capget"},
    {__NR_capset, "capset"},
    {__NR_rt_sigtimedwait, "sigtimedwait"},
    {__NR_rt_sigqueueinfo, "rt_sigqueueinfo"},
    {__NR_personality, "personality"},
#ifdef __NR_ustat
    {__NR_ustat, "ustat"},
#endif
#ifdef __NR_sysfs
    {__NR_sysfs, "sysfs"},
#endif
    {__NR_sched_setparam, "sched_setparam"},
    {__NR_sched_getparam, "sched_getparam"},
    {__NR_sched_setscheduler, "sched_setscheduler"},
    {__NR_sched_getscheduler, "sched_getscheduler"},
    {__NR_sched_get_priority_max, "sched_get_priority_max"},
    {__NR_sched_get_priority_min, "sched_get_priority_min"},
    {__NR_sched_rr_get_interval, "sched_rr_get_interval"},
    {__NR_vhangup, "vhangup"},
#ifdef __NR_modify_ldt
    {__NR_modify_ldt, "modify_ldt"},
#endif
    {__NR_pivot_root, "pivot_root"},
#ifdef __NR__sysctl
    {__NR__sysctl, "_sysctl"},
#endif
    {__NR_prctl, "prctl"},
#ifdef __NR_arch_prctl
    {__NR_arch_prctl, "arch_prctl"},
#endif
    {__NR_adjtimex, "adjtimex"},
    {__NR_umount2, "umount2"},
    {__NR_swapon, "swapon"},
    {__NR_swapoff, "swapoff"},
    {__NR_sethostname, "sethostname"},
    {__NR_setdomainname, "setdomainname"},
#ifdef __NR_iopl
    {__NR_iopl, "iopl"},
#endif
#ifdef __NR_ioperm
    {__NR_ioperm, "ioperm"},
#endif
    {__NR_init_module, "init_module"},
    {__NR_delete_module, "delete_module"},
    {__NR_gettid, "gettid"},
    {__NR_readahead, "readahead"},
    {__NR_setxattr, "setxattr"},
    {__NR_fsetxattr, "fsetxattr"},
    {__NR_getxattr, "getxattr"},
    {__NR_fgetxattr, "fgetxattr"},
    {__NR_listxattr, "listxattr"},
    {__NR_flistxattr, "flistxattr"},
    {__NR_removexattr, "removexattr"},
    {__NR_fremovexattr, "fremovexattr"},
    {__NR_lsetxattr, "lsetxattr"},
    {__NR_lgetxattr, "lgetxattr"},
    {__NR_llistxattr, "llistxattr"},
    {__NR_lremovexattr, "lremovexattr"},
    {__NR_sched_setaffinity, "sched_setaffinity"},
    {__NR_sched_getaffinity, "sched_getaffinity"},
    {__NR_io_setup, "io_setup"},
    {__NR_io_destroy, "io_destroy"},
    {__NR_io_getevents, "io_getevents"},
    {__NR_io_submit, "io_submit"},
    {__NR_io_cancel, "io_cancel"},
    {__NR_lookup_dcookie, "lookup_dcookie"},
#ifdef __NR_epoll_create
    {__NR_epoll_create, "epoll_create"},
#endif
#ifdef __NR_epoll_wait
    {__NR_epoll_wait, "epoll_wait"},
#endif
    {__NR_epoll_ctl, "epoll_ctl"},
#ifdef __NR_getdents
    {__NR_getdents, "getdents"},
#endif
    {__NR_getdents64, "getdents64"},
    {__NR_set_tid_address, "set_tid_address"},
    {__NR_restart_syscall, "restart_syscall"},
    {__NR_semtimedop, "semtimedop"},
    {__NR_fadvise64, "fadvise"},
    {__NR_timer_create, "timer_create"},
    {__NR_timer_settime, "timer_settime"},
    {__NR_timer_gettime, "timer_gettime"},
    {__NR_timer_getoverrun, "timer_getoverrun"},
    {__NR_timer_delete, "timer_delete"},
    {__NR_clock_settime, "clock_settime"},
    {__NR_clock_gettime, "clock_gettime"},
    {__NR_clock_getres, "clock_getres"},
    {__NR_clock_nanosleep, "clock_nanosleep"},
    {__NR_tgkill, "tgkill"},
    {__NR_mbind, "mbind"},
    {__NR_set_mempolicy, "set_mempolicy"},
    {__NR_get_mempolicy, "get_mempolicy"},
    {__NR_mq_open, "mq_open"},
    {__NR_mq_unlink, "mq_unlink"},
    {__NR_mq_timedsend, "mq_timedsend"},
    {__NR_mq_timedreceive, "mq_timedreceive"},
    {__NR_mq_notify, "mq_notify"},
    {__NR_mq_getsetattr, "mq_getsetattr"},
    {__NR_kexec_load, "kexec_load"},
    {__NR_waitid, "waitid"},
    {__NR_add_key, "add_key"},
    {__NR_request_key, "request_key"},
    {__NR_keyctl, "keyctl"},
    {__NR_ioprio_set, "ioprio_set"},
    {__NR_ioprio_get, "ioprio_get"},
#ifdef __NR_inotify_init
    {__NR_inotify_init, "inotify_init"},
#endif
    {__NR_inotify_add_watch, "inotify_add_watch"},
    {__NR_inotify_rm_watch, "inotify_rm_watch"},
    {__NR_openat, "openat"},
    {__NR_mkdirat, "mkdirat"},
    {__NR_fchownat, "fchownat"},
#ifdef __NR_utime
    {__NR_utime, "utime"},
#endif
#ifdef __NR_utimes
    {__NR_utimes, "utimes"},
#endif
#ifdef __NR_futimesat
    {__NR_futimesat, "futimesat"},
#endif
    {__NR_newfstatat, "fstatat"},
    {__NR_unlinkat, "unlinkat"},
    {__NR_renameat, "renameat"},
    {__NR_linkat, "linkat"},
    {__NR_symlinkat, "symlinkat"},
    {__NR_readlinkat, "readlinkat"},
    {__NR_fchmodat, "fchmodat"},
    {__NR_faccessat, "faccessat"},
    {__NR_unshare, "unshare"},
    {__NR_splice, "splice"},
    {__NR_tee, "tee"},
    {__NR_sync_file_range, "sync_file_range"},
    {__NR_vmsplice, "vmsplice"},
    {__NR_migrate_pages, "migrate_pages"},
    {__NR_move_pages, "move_pages"},
    {__NR_preadv, "preadv"},
    {__NR_pwritev, "pwritev"},
    {__NR_utimensat, "utimensat"},
    {__NR_fallocate, "fallocate"},
    {__NR_accept4, "accept4"},
    {__NR_dup3, "dup3"},
    {__NR_pipe2, "pipe2"},
    {__NR_epoll_pwait, "epoll_pwait"},
    {__NR_epoll_create1, "epoll_create1"},
    {__NR_perf_event_open, "perf_event_open"},
    {__NR_inotify_init1, "inotify_init1"},
    {__NR_rt_tgsigqueueinfo, "rt_tgsigqueueinfo"},
#ifdef __NR_signalfd
    {__NR_signalfd, "signalfd"},
#endif
    {__NR_signalfd4, "signalfd4"},
#ifdef __NR_eventfd
    {__NR_eventfd, "eventfd"},
#endif
    {__NR_eventfd2, "eventfd2"},
    {__NR_timerfd_create, "timerfd_create"},
    {__NR_timerfd_settime, "timerfd_settime"},
    {__NR_timerfd_gettime, "timerfd_gettime"},
    {__NR_recvmmsg, "recvmmsg"},
    {__NR_fanotify_init, "fanotify_init"},
    {__NR_fanotify_mark, "fanotify_mark"},
    {__NR_prlimit64, "prlimit"},
    {__NR_name_to_handle_at, "name_to_handle_at"},
    {__NR_open_by_handle_at, "open_by_handle_at"},
    {__NR_clock_adjtime, "clock_adjtime"},
    {__NR_syncfs, "syncfs"},
    {__NR_sendmmsg, "sendmmsg"},
    {__NR_setns, "setns"},
    {__NR_getcpu, "getcpu"},
    {__NR_process_vm_readv, "process_vm_readv"},
    {__NR_process_vm_writev, "process_vm_writev"},
    {__NR_kcmp, "kcmp"},
    {__NR_finit_module, "finit_module"},
    {__NR_sched_setattr, "sched_setattr"},
    {__NR_sched_getattr, "sched_getattr"},
    {__NR_renameat2, "renameat2"},
    {__NR_seccomp, "seccomp"},
    {__NR_getrandom, "getrandom"},
    {__NR_memfd_create, "memfd_create"},
    {__NR_kexec_file_load, "kexec_file_load"},
    {__NR_bpf, "bpf"},
    {__NR_execveat, "execveat"},
    {__NR_userfaultfd, "userfaultfd"},
    {__NR_membarrier, "membarrier"},
    {__NR_mlock2, "mlock2"},
    {__NR_copy_file_range, "copy_file_range"},
    {__NR_preadv2, "preadv2"},
    {__NR_pwritev2, "pwritev2"},
    {__NR_pkey_mprotect, "pkey_mprotect"},
    {__NR_pkey_alloc, "pkey_alloc"},
    {__NR_pkey_free, "pkey_free"},
    {__NR_statx, "statx"},
    {__NR_io_pgetevents, "io_pgetevents"},
    {__NR_rseq, "rseq"},
    {__NR_pidfd_send_signal, "pidfd_send_signal"},
    {__NR_io_uring_setup, "io_uring_setup"},
    {__NR_io_uring_enter, "io_uring_enter"},
    {__NR_io_uring_register, "io_uring_register"},
    {__NR_open_tree, "open_tree"},
    {__NR_move_mount, "move_mount"},
    {__NR_fsopen, "fsopen"},
    {__NR_fsconfig, "fsconfig"},
    {__NR_fsmount, "fsmount"},
    {__NR_fspick, "fspick"},
    {__NR_pidfd_open, "pidfd_open"},
    {__NR_clone3, "clone3"},
    {__NR_close_range, "close_range"},
    {__NR_openat2, "openat2"},
    {__NR_pidfd_getfd, "pidfd_getfd"},
    {__NR_faccessat2, "faccessat2"},
    {__NR_process_madvise, "process_madvise"},
    {__NR_epoll_pwait2, "epoll_pwait2"},
    {__NR_mount_setattr, "mount_setattr"},
#ifdef __NR_quotactl_fd
    {__NR_quotactl_fd, "quotactl_fd"},
#endif
    {__NR_landlock_create_ruleset, "landlock_create_ruleset"},
    {__NR_landlock_add_rule, "landlock_add_rule"},
    {__NR_landlock_restrict_self, "landlock_restrict_self"},
#ifdef __NR_memfd_secret
    {__NR_memfd_secret, "memfd_secret"},
#endif
#ifdef __NR_process_mrelease
    {__NR_process_mrelease, "process_mrelease"},
#endif
#ifdef __NR_futex_waitv
    {__NR_futex_waitv, "futex_waitv"},
#endif
#ifdef __NR_set_mempolicy_home_node
    {__NR_set_mempolicy_home_node, "set_mempolicy_home_node"},
#endif
};

static const uint16_t kPledgeDefault[] = {
    __NR_exit,  // thread return / exit()
};

// stdio contains all the benign system calls. openbsd makes the
// assumption that preexisting file descriptors are trustworthy. we
// implement checking for these as a simple linear scan rather than
// binary search, since there doesn't appear to be any measurable
// difference in the latency of sched_yield() if it's at the start of
// the bpf script or the end.
static const uint16_t kPledgeStdio[] = {
    __NR_rt_sigreturn,
    __NR_restart_syscall,
    __NR_exit_group,
    __NR_sched_yield,
    __NR_sched_getaffinity,
    __NR_clock_getres,
    __NR_clock_gettime,
    __NR_clock_nanosleep,
    __NR_close_range,
    __NR_close,
    __NR_write,
    __NR_writev,
    __NR_pwrite64,
    __NR_pwritev,
    __NR_pwritev2,
    __NR_read,
    __NR_readv,
    __NR_pread64,
    __NR_preadv,
    __NR_preadv2,
    __NR_dup,
#ifdef __NR_dup2
    __NR_dup2,
#endif
    __NR_dup3,
    __NR_fchdir,
    __NR_fcntl | STDIO,
    __NR_fstat,
    __NR_fsync,
    __NR_sysinfo,
    __NR_fdatasync,
    __NR_ftruncate,
    __NR_getrandom,
    __NR_getgroups,
    __NR_getpgid,
#ifdef __NR_getpgrp
    __NR_getpgrp,
#endif
    __NR_getpid,
    __NR_gettid,
    __NR_getuid,
    __NR_getgid,
    __NR_getsid,
    __NR_getppid,
    __NR_geteuid,
    __NR_getegid,
    __NR_getrlimit,
    __NR_getresgid,
    __NR_getresuid,
    __NR_getitimer,
    __NR_setitimer,
    __NR_timerfd_create,
    __NR_timerfd_settime,
    __NR_timerfd_gettime,
    __NR_copy_file_range,
    __NR_gettimeofday,
    __NR_sendfile,
    __NR_vmsplice,
    __NR_splice,
    __NR_lseek,
    __NR_tee,
    __NR_brk,
    __NR_msync,
    __NR_mmap | NOEXEC,
    __NR_mremap,
    __NR_munmap,
    __NR_mincore,
    __NR_madvise,
    __NR_fadvise64,
    __NR_mprotect | NOEXEC,
#ifdef __NR_arch_prctl
    __NR_arch_prctl,
#endif
    __NR_migrate_pages,
    __NR_sync_file_range,
    __NR_set_tid_address,
    __NR_membarrier,
    __NR_nanosleep,
#ifdef __NR_pipe
    __NR_pipe,
#endif
    __NR_pipe2,
#ifdef __NR_poll
    __NR_poll,
#endif
    __NR_ppoll,
#ifdef __NR_select
    __NR_select,
#endif
    __NR_pselect6,
#ifdef __NR_epoll_create
    __NR_epoll_create,
#endif
    __NR_epoll_create1,
    __NR_epoll_ctl,
#ifdef __NR_epoll_wait
    __NR_epoll_wait,
#endif
    __NR_epoll_pwait,
    __NR_epoll_pwait2,
    __NR_recvfrom,
    __NR_sendto | ADDRLESS,
    __NR_ioctl | RESTRICT,
#ifdef __NR_alarm
    __NR_alarm,
#endif
#ifdef __NR_pause
    __NR_pause,
#endif
    __NR_shutdown,
#ifdef __NR_eventfd
    __NR_eventfd,
#endif
    __NR_eventfd2,
#ifdef __NR_signalfd
    __NR_signalfd,
#endif
    __NR_signalfd4,
    __NR_rt_sigaction,
    __NR_sigaltstack,
    __NR_rt_sigprocmask,
    __NR_rt_sigsuspend,
    __NR_rt_sigpending,
    __NR_kill | SELF,
    __NR_tkill,
    __NR_tgkill | SELF,
    __NR_socketpair,
    __NR_getrusage,
    __NR_times,
    __NR_umask,
    __NR_wait4,
    __NR_uname,
    __NR_prctl | STDIO,
    __NR_clone | THREAD,
    __NR_futex,
    __NR_set_robust_list,
    __NR_get_robust_list,
    __NR_prlimit64 | STDIO,
    __NR_sched_getaffinity,
    __NR_sched_setaffinity,
    __NR_rt_sigtimedwait,
};

static const uint16_t kPledgeFlock[] = {
    __NR_flock,
    __NR_fcntl | LOCK,
};

static const uint16_t kPledgeRpath[] = {
    __NR_chdir,
    __NR_getcwd,
#ifdef __NR_open
    __NR_open | READONLY,
#endif
    __NR_openat | READONLY,
#ifdef __NR_stat
    __NR_stat,
#endif
#ifdef __NR_lstat
    __NR_lstat,
#endif
    __NR_fstat,
    __NR_newfstatat,
#ifdef __NR_access
    __NR_access,
#endif
    __NR_faccessat,
    __NR_faccessat2,
#ifdef __NR_readlink
    __NR_readlink,
#endif
    __NR_readlinkat,
    __NR_statfs,
    __NR_fstatfs,
#ifdef __NR_getdents
    __NR_getdents,
#endif
    __NR_getdents64,
};

static const uint16_t kPledgeWpath[] = {
    __NR_getcwd,
#ifdef __NR_open
    __NR_open | WRITEONLY,
#endif
    __NR_openat | WRITEONLY,
#ifdef __NR_stat
    __NR_stat,
#endif
    __NR_fstat,
#ifdef __NR_lstat
    __NR_lstat,
#endif
    __NR_newfstatat,
#ifdef __NR_access
    __NR_access,
#endif
    __NR_truncate,
    __NR_faccessat,
    __NR_faccessat2,
    __NR_readlinkat,
#ifdef __NR_chmod
    __NR_chmod | NOBITS,
#endif
    __NR_fchmod | NOBITS,
    __NR_fchmodat | NOBITS,
};

static const uint16_t kPledgeCpath[] = {
#ifdef __NR_open
    __NR_open | CREATONLY,
#endif
    __NR_openat | CREATONLY,
#ifdef __NR_creat
    __NR_creat | RESTRICT,
#endif
#ifdef __NR_rename
    __NR_rename,
#endif
    __NR_renameat,
    __NR_renameat2,
#ifdef __NR_link
    __NR_link,
#endif
    __NR_linkat,
#ifdef __NR_symlink
    __NR_symlink,
#endif
    __NR_symlinkat,
#ifdef __NR_rmdir
    __NR_rmdir,
#endif
#ifdef __NR_unlink
    __NR_unlink,
#endif
    __NR_unlinkat,
#ifdef __NR_mkdir
    __NR_mkdir,
#endif
    __NR_mkdirat,
};

static const uint16_t kPledgeDpath[] = {
#ifdef __NR_mknod
    __NR_mknod,  //
#endif
    __NR_mknodat,  //
};

static const uint16_t kPledgeFattr[] = {
#ifdef __NR_chmod
    __NR_chmod | NOBITS,  //
#endif
    __NR_fchmod | NOBITS,    //
    __NR_fchmodat | NOBITS,  //
#ifdef __NR_utime
    __NR_utime,  //
#endif
#ifdef __NR_utimes
    __NR_utimes,  //
#endif
#ifdef __NR_futimesat
    __NR_futimesat,  //
#endif
    __NR_utimensat,  //
};

static const uint16_t kPledgeInet[] = {
    __NR_socket | INET,          //
    __NR_listen,                 //
    __NR_bind,                   //
    __NR_sendto,                 //
    __NR_connect,                //
    __NR_accept,                 //
    __NR_accept4,                //
    __NR_ioctl | INET,           //
    __NR_getsockopt | RESTRICT,  //
    __NR_setsockopt | RESTRICT,  //
    __NR_getpeername,            //
    __NR_getsockname,            //
};

static const uint16_t kPledgeUnix[] = {
    __NR_socket | UNIX,          //
    __NR_listen,                 //
    __NR_bind,                   //
    __NR_connect,                //
    __NR_sendto,                 //
    __NR_accept,                 //
    __NR_accept4,                //
    __NR_getsockopt | RESTRICT,  //
    __NR_setsockopt | RESTRICT,  //
    __NR_getpeername,            //
    __NR_getsockname,            //
};

static const uint16_t kPledgeDns[] = {
    __NR_socket | INET,          //
    __NR_bind,                   //
    __NR_sendto,                 //
    __NR_connect,                //
    __NR_recvfrom,               //
    __NR_setsockopt | RESTRICT,  //
    __NR_newfstatat,             //
    __NR_openat | READONLY,      //
    __NR_read,                   //
    __NR_close,                  //
};

static const uint16_t kPledgeTty[] = {
    __NR_ioctl | TTY,  //
};

static const uint16_t kPledgeRecvfd[] = {
    __NR_recvmsg,   //
    __NR_recvmmsg,  //
};

static const uint16_t kPledgeSendfd[] = {
    __NR_sendmsg,   //
    __NR_sendmmsg,  //
};

static const uint16_t kPledgeProc[] = {
#ifdef __NR_fork
    __NR_fork,  //
#endif
#ifdef __NR_vfork
    __NR_vfork,  //
#endif
    __NR_clone | RESTRICT,        //
    __NR_kill,                    //
    __NR_tgkill,                  //
    __NR_setsid,                  //
    __NR_setpgid,                 //
    __NR_prlimit64,               //
    __NR_setrlimit,               //
    __NR_getpriority,             //
    __NR_setpriority,             //
    __NR_ioprio_get,              //
    __NR_ioprio_set,              //
    __NR_sched_getscheduler,      //
    __NR_sched_setscheduler,      //
    __NR_sched_get_priority_min,  //
    __NR_sched_get_priority_max,  //
    __NR_sched_getparam,          //
    __NR_sched_setparam,          //
};

static const uint16_t kPledgeId[] = {
    __NR_setuid,       //
    __NR_setreuid,     //
    __NR_setresuid,    //
    __NR_setgid,       //
    __NR_setregid,     //
    __NR_setresgid,    //
    __NR_setgroups,    //
    __NR_prlimit64,    //
    __NR_setrlimit,    //
    __NR_getpriority,  //
    __NR_setpriority,  //
    __NR_setfsuid,     //
    __NR_setfsgid,     //
};

static const uint16_t kPledgeChown[] = {
#ifdef __NR_chown
    __NR_chown,  //
#endif
    __NR_fchown,  //
#ifdef __NR_lchown
    __NR_lchown,  //
#endif
    __NR_fchownat,  //
};

static const uint16_t kPledgeSettime[] = {
    __NR_settimeofday,   //
    __NR_clock_adjtime,  //
};

static const uint16_t kPledgeProtExec[] = {
    __NR_mmap | EXEC,  //
    __NR_mprotect,     //
};

static const uint16_t kPledgeExec[] = {
    __NR_execve,    //
    __NR_execveat,  //
};

static const uint16_t kPledgeUnveil[] = {
    __NR_landlock_create_ruleset,  //
    __NR_landlock_add_rule,        //
    __NR_landlock_restrict_self,   //
};

// placeholder group
//
// pledge.com checks this to do auto-unveiling
static const uint16_t kPledgeVminfo[] = {
    __NR_sched_yield,  //
};

// placeholder group
//
// pledge.com uses this to auto-unveil /tmp and $TMPPATH with rwc
// permissions. pledge() alone (without unveil() too) offers very
// little security here. consider using them together.
static const uint16_t kPledgeTmppath[] = {
#ifdef __NR_lstat
    __NR_lstat,  //
#endif
#ifdef __NR_unlink
    __NR_unlink,  //
#endif
    __NR_unlinkat,  //
};

const struct Pledges kPledge[PROMISE_LEN_] = {
    [PROMISE_STDIO] = {"stdio", PLEDGE(kPledgeStdio)},
    [PROMISE_RPATH] = {"rpath", PLEDGE(kPledgeRpath)},
    [PROMISE_WPATH] = {"wpath", PLEDGE(kPledgeWpath)},
    [PROMISE_CPATH] = {"cpath", PLEDGE(kPledgeCpath)},
    [PROMISE_DPATH] = {"dpath", PLEDGE(kPledgeDpath)},
    [PROMISE_FLOCK] = {"flock", PLEDGE(kPledgeFlock)},
    [PROMISE_FATTR] = {"fattr", PLEDGE(kPledgeFattr)},
    [PROMISE_INET] = {"inet", PLEDGE(kPledgeInet)},
    [PROMISE_UNIX] = {"unix", PLEDGE(kPledgeUnix)},
    [PROMISE_DNS] = {"dns", PLEDGE(kPledgeDns)},
    [PROMISE_TTY] = {"tty", PLEDGE(kPledgeTty)},
    [PROMISE_RECVFD] = {"recvfd", PLEDGE(kPledgeRecvfd)},
    [PROMISE_SENDFD] = {"sendfd", PLEDGE(kPledgeSendfd)},
    [PROMISE_PROC] = {"proc", PLEDGE(kPledgeProc)},
    [PROMISE_EXEC] = {"exec", PLEDGE(kPledgeExec)},
    [PROMISE_ID] = {"id", PLEDGE(kPledgeId)},
    [PROMISE_UNVEIL] = {"unveil", PLEDGE(kPledgeUnveil)},
    [PROMISE_SETTIME] = {"settime", PLEDGE(kPledgeSettime)},
    [PROMISE_PROT_EXEC] = {"prot_exec", PLEDGE(kPledgeProtExec)},
    [PROMISE_VMINFO] = {"vminfo", PLEDGE(kPledgeVminfo)},
    [PROMISE_TMPPATH] = {"tmppath", PLEDGE(kPledgeTmppath)},
    [PROMISE_CHOWN] = {"chown", PLEDGE(kPledgeChown)},
};

static const struct sock_filter kPledgeStart[] = {
    // make sure this isn't an i386 binary or something
    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(arch)),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, ARCHITECTURE, 1, 0),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),
    // each filter assumes ordinal is already loaded into accumulator
    BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
#ifdef __NR_memfd_secret
    // forbid some system calls with ENOSYS (rather than EPERM)
    BPF_JUMP(BPF_JMP | BPF_JGE | BPF_K, __NR_memfd_secret, 5, 0),
#else
    BPF_JUMP(BPF_JMP | BPF_JGE | BPF_K, __NR_landlock_restrict_self + 1, 5, 0),
#endif
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rseq, 4, 0),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_memfd_create, 3, 0),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat2, 2, 0),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_clone3, 1, 0),
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_statx, 0, 1),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (ENOSYS &amp; SECCOMP_RET_DATA)),
};

static const struct sock_filter kFilterIgnoreExitGroup[] = {
    BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_exit_group, 0, 1),
    BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ERRNO | (EPERM &amp; SECCOMP_RET_DATA)),
};

static char *FixCpy(char p[17], uint64_t x, int k) {
  while (k > 0) *p++ = "0123456789abcdef"[(x >> (k -= 4)) &amp; 15];
  *p = '\0';
  return p;
}

static privileged char *HexCpy(char p[17], uint64_t x) {
  return FixCpy(p, x, ROUNDUP(x ? bsr(x) + 1 : 1, 4));
}

static void Log(const char *s, ...) {
  int ax;
  va_list va;
  va_start(va, s);
  do ax = write(2, s, strlen(s));
  while ((s = va_arg(va, const char *)));
  va_end(va);
}

static void KillThisProcess(void) {
  abort();
}

static void KillThisThread(void) {
  int ax;
  sigset_t full, empty;
  sigfillset(&amp;full);
  sigemptyset(&amp;empty);
  sigaction(SIGABRT, &amp;(struct sigaction){0}, 0);
  sigprocmask(SIG_SETMASK, &amp;full, 0);
  ax = syscall(__NR_tkill, syscall(__NR_gettid), SIGABRT);
  sigprocmask(SIG_SETMASK, &amp;empty, 0);
  syscall(__NR_exit, 128 + SIGABRT);
}

static const char *GetSyscallName(uint16_t n) {
  int i;
  for (i = 0; i &lt; ARRAYLEN(kSyscallName); ++i) {
    if (kSyscallName[i].n == n) {
      return kSyscallName[i].s;
    }
  }
  return "unknown";
}

static int HasSyscall(const struct Pledges *p, uint16_t n) {
  int i;
  for (i = 0; i &lt; p->len; ++i) {
    if (p->syscalls[i] == n) {
      return 1;
    }
    if ((p->syscalls[i] &amp; 0xfff) == n) {
      return 2;
    }
  }
  return 0;
}

static void OnSigSys(int sig, siginfo_t *si, void *vctx) {
  bool found;
  char ord[17], ip[17];
  int i, ok, mode = si->si_errno;
  ucontext_t *ctx = vctx;

  ctx->uc_mcontext.MCONTEXT_SYSCALL_RESULT_REGISTER = -EPERM;
  FixCpy(ord, si->si_syscall, 12);
  HexCpy(ip, ctx->uc_mcontext.MCONTEXT_INSTRUCTION_POINTER);
  for (found = i = 0; i &lt; ARRAYLEN(kPledge); ++i) {
    if (HasSyscall(kPledge + i, si->si_syscall)) {
      Log("error: pledge ", kPledge[i].name, " for ",
          GetSyscallName(si->si_syscall), " (ord=0x", ord, " ip=0x", ip, ")\n",
          NULL);
      found = true;
    }
  }
  if (!found) {
    Log("error: bad syscall (", GetSyscallName(si->si_syscall), " ord=0x", ord,
        " ip=0x", ip, ")\n", NULL);
  }
  switch (mode &amp; PLEDGE_PENALTY_MASK) {
    case PLEDGE_PENALTY_KILL_PROCESS:
      KillThisProcess();
      // fallthrough
    case PLEDGE_PENALTY_KILL_THREAD:
      KillThisThread();
      __builtin_trap();
    default:
      break;
  }
}

static void MonitorSigSys(void) {
  int ax;
  struct sigaction sa = {
      .sa_sigaction = OnSigSys,
      .sa_flags = SA_SIGINFO | SA_RESTART,
  };
  // we block changing sigsys once pledge is installed
  // so we aren't terribly concerned if this will fail
  if (sigaction(SIGSYS, &amp;sa, 0) == -1) {
    __builtin_trap();
  }
}

static void AppendFilter(struct Filter *f, const struct sock_filter *p,
                         size_t n) {
  if (UNLIKELY(f->n + n > ARRAYLEN(f->p))) __builtin_trap();
  memcpy(f->p + f->n, p, n * sizeof(*f->p));
  f->n += n;
}

// The first argument of kill() must be
//
//   - getpid()
//
static void AllowKillSelf(struct Filter *f) {
  struct sock_filter fragment[] = {
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_kill, 0, 4),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, getpid(), 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The first argument of tgkill() must be
//
//   - getpid()
//
static void AllowTgkillSelf(struct Filter *f) {
  struct sock_filter fragment[] = {
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_tgkill, 0, 4),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, getpid(), 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The following system calls are allowed:
//
//   - write(2) to allow logging
//   - kill(getpid(), SIGABRT) to abort process
//   - tkill(gettid(), SIGABRT) to abort thread
//   - sigaction(SIGABRT) to force default signal handler
//   - sigreturn() to return from signal handler
//   - sigprocmask() to force signal delivery
//
static void AllowMonitor(struct Filter *f) {
  struct sock_filter fragment[] = {
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_write, 0, 4),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 2, 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_kill, 0, 6),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, getpid(), 0, 3),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIGABRT, 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_tkill, 0, 6),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, gettid(), 0, 3),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIGABRT, 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rt_sigaction, 0, 4),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIGABRT, 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rt_sigreturn, 1, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_rt_sigprocmask, 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The first argument of sys_clone_linux() must NOT have:
//
//   - CLONE_NEWNS    (0x00020000)
//   - CLONE_PTRACE   (0x00002000)
//   - CLONE_UNTRACED (0x00800000)
//
static void AllowCloneRestrict(struct Filter *f) {
  // clang-format off
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_clone, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, CLONE_NEWNS | CLONE_PTRACE | CLONE_UNTRACED),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  // clang-format on
  AppendFilter(f, PLEDGE(fragment));
}

// The first argument of sys_clone_linux() must have:
//
//   - CLONE_VM       (0x00000100)
//   - CLONE_FS       (0x00000200)
//   - CLONE_FILES    (0x00000400)
//   - CLONE_THREAD   (0x00010000)
//   - CLONE_SIGHAND  (0x00000800)
//
// The first argument of sys_clone_linux() must NOT have:
//
//   - CLONE_NEWNS    (0x00020000)
//   - CLONE_PTRACE   (0x00002000)
//   - CLONE_UNTRACED (0x00800000)
//
static void AllowCloneThread(struct Filter *f) {
#define NEED (CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_THREAD | CLONE_SIGHAND)
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_clone, 0, 9 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, NEED),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, NEED, 0, 8 - 4),
      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, CLONE_NEWNS | CLONE_PTRACE | CLONE_UNTRACED),
      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L9*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
#undef NEED
}

// The second argument of ioctl() must be one of:
//
//   - FIONREAD (0x541b)
//   - FIONBIO  (0x5421)
//   - FIOCLEX  (0x5451)
//   - FIONCLEX (0x5450)
//
static void AllowIoctlStdio(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_ioctl, 0, 7),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIONREAD, 3, 0),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIONBIO, 2, 0),
      /*L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIOCLEX, 1, 0),
      /*L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, FIONCLEX, 0, 1),
      /*L6*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L8*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The second argument of ioctl() must be one of:
//
//   - SIOCATMARK (0x8905)
//
static void AllowIoctlInet(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_ioctl, 0, 4),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SIOCATMARK, 0, 1),
      /*L6*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L8*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The second argument of ioctl() must be one of:
//
//   - TCGETS     (0x5401)
//   - TCSETS     (0x5402)
//   - TCSETSW    (0x5403)
//   - TCSETSF    (0x5404)
//   - TIOCGWINSZ (0x5413)
//   - TIOCSPGRP  (0x5410)
//   - TIOCGPGRP  (0x540f)
//   - TIOCSWINSZ (0x5414)
//   - TCFLSH     (0x540b)
//   - TCXONC     (0x540a)
//   - TCSBRK     (0x5409)
//   - TIOCSBRK   (0x5427)
//
static void AllowIoctlTty(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_ioctl, 0, 15),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCGETS, 11, 0),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSETS, 10, 0),
      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSETSW, 9, 0),
      /* L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSETSF, 8, 0),
      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCGWINSZ, 7, 0),
      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCSPGRP, 6, 0),
      /* L8*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCGPGRP, 5, 0),
      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCSWINSZ, 4, 0),
      /*L10*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCFLSH, 3, 0),
      /*L11*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCXONC, 2, 0),
      /*L12*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCSBRK, 1, 0),
      /*L13*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TIOCSBRK, 0, 1),
      /*L14*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L15*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L16*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The level argument of getsockopt/setsockopt must be one of:
//
//   - IPPROTO_IP     (0)
//   - SOL_SOCKET     (1)
//   - IPPROTO_TCP    (6)
//   - IPPROTO_IPV6   (41)
//
// The optname argument of getsockopt/setsockopt must be one of:
//
//   - TCP_NODELAY          (0x01)
//   - TCP_CORK             (0x03)
//   - TCP_KEEPIDLE         (0x04)
//   - TCP_KEEPINTVL        (0x05)
//   - SO_TYPE              (0x03)
//   - SO_ERROR             (0x04)
//   - SO_DONTROUTE         (0x05)
//   - SO_BROADCAST         (0x06)
//   - SO_REUSEPORT         (0x0f)
//   - SO_REUSEADDR         (0x02)
//   - SO_KEEPALIVE         (0x09)
//   - SO_RCVTIMEO          (0x14)
//   - SO_SNDTIMEO          (0x15)
//   - IP_RECVTTL           (0x0c)
//   - IP_RECVERR           (0x0b)
//   - TCP_FASTOPEN         (0x17)
//   - TCP_FASTOPEN_CONNECT (0x1e)
//   - IPV6_V6ONLY          (0x1a)
//   - TCP_QUICKACK         (0x0c)
//
static void AllowSockoptRestrict(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_getsockopt, 1, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_setsockopt, 0, 29),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOL_SOCKET, 3, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_TCP, 11, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_IP, 18, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_IPV6, 20, 23),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_TYPE, 7 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_ERROR, 6 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_BROADCAST, 5 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_REUSEPORT, 4 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_REUSEADDR, 3 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_KEEPALIVE, 2 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_RCVTIMEO, 1 + 13, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SO_SNDTIMEO, 0 + 13, 14),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_QUICKACK, 6 + 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_CORK, 5 + 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_NODELAY, 4 + 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_KEEPIDLE, 3 + 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_KEEPINTVL, 2 + 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_FASTOPEN, 1 + 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, TCP_FASTOPEN_CONNECT, 0 + 5, 6),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IP_RECVTTL, 1 + 2, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IP_RECVERR, 0 + 2, 3),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPV6_V6ONLY, 0 + 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The flags parameter of mmap() must not have:
//
//   - MAP_LOCKED   (0x02000)
//   - MAP_NONBLOCK (0x10000)
//   - MAP_HUGETLB  (0x40000)
//
static void AllowMmapExec(struct Filter *f) {
  // long y = (long)__privileged_end;
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_mmap, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[3])),  // flags
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, MAP_LOCKED | MAP_NONBLOCK | MAP_HUGETLB),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 5 - 4),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The prot parameter of mmap() may only have:
//
//   - PROT_NONE
//   - PROT_READ
//   - PROT_WRITE
//
// The flags parameter must not have:
//
//   - MAP_LOCKED   (0x02000)
//   - MAP_HUGETLB  (0x40000)
//
static void AllowMmapNoexec(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_mmap, 0, 8),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),  // prot
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(PROT_READ | PROT_WRITE)),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 8 - 4),
      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[3])),  // flags
      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, MAP_LOCKED | MAP_HUGETLB),
      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L9*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The prot parameter of mprotect() may only have:
//
//   - PROT_NONE  (0)
//   - PROT_READ  (1)
//   - PROT_WRITE (2)
//
static void AllowMprotectNoexec(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_mprotect, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),  // prot
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(PROT_READ | PROT_WRITE)),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

#ifdef __NR_open
// The open() system call is permitted only when
//
//   - (flags &amp; O_ACCMODE) == O_RDONLY
//
// The flags parameter of open() must not have:
//
//   - O_CREAT     (000000100)
//   - O_TRUNC     (000001000)
//   - __O_TMPFILE (020000000)
//
static void AllowOpenReadonly(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_open, 0, 9 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDONLY, 0, 8 - 4),
      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_TRUNC | O_CREAT),
      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L9*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}
#endif

// The open() system call is permitted only when
//
//   - (flags &amp; O_ACCMODE) == O_RDONLY
//
// The flags parameter of open() must not have:
//
//   - O_CREAT     (000000100)
//   - O_TRUNC     (000001000)
//   - __O_TMPFILE (020000000)
//
static void AllowOpenatReadonly(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat, 0, 9 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDONLY, 0, 8 - 4),
      /*L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /*L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_TRUNC | O_CREAT),
      /*L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L7*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L9*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

#ifdef __NR_open
// The open() system call is permitted only when
//
//   - (flags &amp; O_ACCMODE) == O_WRONLY
//   - (flags &amp; O_ACCMODE) == O_RDWR
//
// The open() flags parameter must not contain
//
//   - O_CREAT     (000000100)
//   - __O_TMPFILE (020000000)
//
static void AllowOpenWriteonly(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_open, 0, 10 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_WRONLY, 1, 0),
      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDWR, 0, 9 - 5),
      /* L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L6*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_CREAT),
      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /* L8*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /* L9*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L10*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}
#endif

// The open() system call is permitted only when
//
//   - (flags &amp; O_ACCMODE) == O_WRONLY
//   - (flags &amp; O_ACCMODE) == O_RDWR
//
// The openat() flags parameter must not contain
//
//   - O_CREAT     (000000100)
//   - __O_TMPFILE (020000000)
//
static void AllowOpenatWriteonly(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat, 0, 10 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_ACCMODE),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_WRONLY, 1, 0),
      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_RDWR, 0, 9 - 5),
      /* L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L6*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, __O_TMPFILE | O_CREAT),
      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /* L8*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /* L9*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L10*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

#ifdef __NR_open
// If the flags parameter of open() has one of:
//
//   - O_CREAT     (000000100)
//   - __O_TMPFILE (020000000)
//
// Then the mode parameter must not have:
//
//   - S_ISVTX (01000 sticky)
//   - S_ISGID (02000 setgid)
//   - S_ISUID (04000 setuid)
//
static void AllowOpenCreatonly(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_open, 0, 12 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_CREAT),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_CREAT, 7 - 4, 0),
      /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, 020200000),
      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 020200000, 0, 10 - 7),
      /* L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L8*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),
      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L10*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L11*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L12*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}
#endif

// If the flags parameter of openat() has one of:
//
//   - O_CREAT     (000000100)
//   - __O_TMPFILE (020000000)
//
// Then the mode parameter must not have:
//
//   - S_ISVTX (01000 sticky)
//   - S_ISGID (02000 setgid)
//   - S_ISUID (04000 setuid)
//
static void AllowOpenatCreatonly(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_openat, 0, 12 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, O_CREAT),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, O_CREAT, 7 - 4, 0),
      /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, 020200000),
      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 020200000, 0, 10 - 7),
      /* L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[3])),
      /* L8*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),
      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L10*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L11*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L12*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

#ifdef __NR_creat
// Then the mode parameter must not have:
//
//   - S_ISVTX (01000 sticky)
//   - S_ISGID (02000 setgid)
//   - S_ISUID (04000 setuid)
//
static void AllowCreatRestrict(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_creat, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}
#endif

// The second argument of fcntl() must be one of:
//
//   - F_DUPFD (0)
//   - F_DUPFD_CLOEXEC (1030)
//   - F_GETFD (1)
//   - F_SETFD (2)
//   - F_GETFL (3)
//   - F_SETFL (4)
//
static void AllowFcntlStdio(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fcntl, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_DUPFD_CLOEXEC, 4 - 3, 0),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JGE | BPF_K, 5, 5 - 4, 0),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  _Static_assert(F_DUPFD == 0 &amp;&amp; F_GETFD == 1 &amp;&amp; F_SETFD == 2 &amp;&amp; F_GETFL == 3 &amp;&amp; F_SETFL == 4, "This ensures that the above BPF_JGE statement will work correctly");
  AppendFilter(f, PLEDGE(fragment));
}

// The second argument of fcntl() must be one of:
//
//   - F_GETLK (0x05)
//   - F_SETLK (0x06)
//   - F_SETLKW (0x07)
//   - F_OFD_GETLK (0x24)
//   - F_OFD_SETLK (0x25)
//   - F_OFD_SETLKW (0x26)
//
static void AllowFcntlLock(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fcntl, 0, 9),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_GETLK, 5, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_SETLK, 4, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_SETLKW, 3, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_OFD_GETLK, 2, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_OFD_SETLK, 1, 0),
      BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, F_OFD_SETLKW, 0, 1),
      BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The addr parameter of sendto() must be
//
//   - NULL
//
static void AllowSendtoAddrless(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_sendto, 0, 7 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[4]) + 0),
      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 6 - 3),
      /*L3*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[4]) + 4),
      /*L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 6 - 5),
      /*L5*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L6*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L7*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The family parameter of socket() must be one of:
//
//   - AF_INET  (0x02)
//   - AF_INET6 (0x0a)
//
// The type parameter of socket() will ignore:
//
//   - SOCK_CLOEXEC  (0x80000)
//   - SOCK_NONBLOCK (0x00800)
//
// The type parameter of socket() must be one of:
//
//   - SOCK_STREAM (0x01)
//   - SOCK_DGRAM  (0x02)
//
// The protocol parameter of socket() must be one of:
//
//   - 0
//   - IPPROTO_ICMP (0x01)
//   - IPPROTO_TCP  (0x06)
//   - IPPROTO_UDP  (0x11)
//
static void AllowSocketInet(struct Filter *f) {
  // clang-format off
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_socket, 0, 15 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AF_INET, 1, 0),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AF_INET6, 0, 14 - 4),
      /* L4*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(SOCK_CLOEXEC | SOCK_NONBLOCK)),
      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_STREAM, 1, 0),
      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_DGRAM, 0, 14 - 8),
      /* L8*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L9*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 3, 0),
      /*L10*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_ICMP, 2, 0),
      /*L11*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_TCP, 1, 0),
      /*L12*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, IPPROTO_UDP, 0, 1),
      /*L13*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L14*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L15*/ /* next filter */
  };
  // clang-format on
  AppendFilter(f, PLEDGE(fragment));
}

// The family parameter of socket() must be one of:
//
//   - AF_UNIX (1)
//   - AF_LOCAL (1)
//
// The type parameter of socket() will ignore:
//
//   - SOCK_CLOEXEC  (0x80000)
//   - SOCK_NONBLOCK (0x00800)
//
// The type parameter of socket() must be one of:
//
//   - SOCK_STREAM (1)
//   - SOCK_DGRAM  (2)
//
// The protocol parameter of socket() must be one of:
//
//   - 0
//
static void AllowSocketUnix(struct Filter *f) {
  // clang-format off
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_socket, 0, 11 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AF_UNIX, 0, 10 - 3),
      /* L3*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /* L5*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, ~(SOCK_CLOEXEC | SOCK_NONBLOCK)),
      /* L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_STREAM, 1, 0),
      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, SOCK_DGRAM, 0, 10 - 7),
      /* L7*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /* L8*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /* L9*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L10*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L11*/ /* next filter */
  };
  // clang-format on
  AppendFilter(f, PLEDGE(fragment));
}

// The first parameter of prctl() can be any of
//
//   - PR_SET_NAME         (15)
//   - PR_GET_NAME         (16)
//   - PR_GET_SECCOMP      (21)
//   - PR_SET_SECCOMP      (22)
//   - PR_SET_NO_NEW_PRIVS (38)
//   - PR_CAPBSET_READ     (23)
//   - PR_CAPBSET_DROP     (24)
//
static void AllowPrctlStdio(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /* L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_prctl, 0, 11 - 1),
      /* L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[0])),
      /* L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_SET_NAME, 6, 0),
      /* L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_GET_NAME, 5, 0),
      /* L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_GET_SECCOMP, 4, 0),
      /* L5*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_SET_SECCOMP, 3, 0),
      /* L6*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_CAPBSET_READ, 2, 0),
      /* L7*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_CAPBSET_DROP, 1, 0),
      /* L8*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, PR_SET_NO_NEW_PRIVS, 0, 1),
      /* L9*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L10*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L11*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

#ifdef __NR_chmod
// The mode parameter of chmod() can't have the following:
//
//   - S_ISVTX (01000 sticky)
//   - S_ISGID (02000 setgid)
//   - S_ISUID (04000 setuid)
//
static void AllowChmodNobits(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_chmod, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}
#endif

// The mode parameter of fchmod() can't have the following:
//
//   - S_ISVTX (01000 sticky)
//   - S_ISGID (02000 setgid)
//   - S_ISUID (04000 setuid)
//
static void AllowFchmodNobits(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fchmod, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[1])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, 07000),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The mode parameter of fchmodat() can't have the following:
//
//   - S_ISVTX (01000 sticky)
//   - S_ISGID (02000 setgid)
//   - S_ISUID (04000 setuid)
//
static void AllowFchmodatNobits(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_fchmodat, 0, 6 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /*L2*/ BPF_STMT(BPF_ALU | BPF_AND | BPF_K, S_ISVTX | S_ISGID | S_ISUID),
      /*L3*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L4*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L5*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L6*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

// The new_limit parameter of prlimit() must be
//
//   - NULL (0)
//
static void AllowPrlimitStdio(struct Filter *f) {
  static const struct sock_filter fragment[] = {
      /*L0*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, __NR_prlimit64, 0, 7 - 1),
      /*L1*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2])),
      /*L2*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 6 - 3),
      /*L3*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(args[2]) + 4),
      /*L4*/ BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, 0, 0, 1),
      /*L5*/ BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      /*L6*/ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, OFF(nr)),
      /*L7*/ /* next filter */
  };
  AppendFilter(f, PLEDGE(fragment));
}

static int CountUnspecial(const uint16_t *p, size_t len) {
  int i, count;
  for (count = i = 0; i &lt; len; ++i) {
    if (!(p[i] &amp; SPECIAL)) {
      ++count;
    }
  }
  return count;
}

static void AppendPledge(struct Filter *f,   //
                         const uint16_t *p,  //
                         size_t len) {       //
  int i, j, count;

  // handle ordinals which allow syscalls regardless of args
  // we put in extra effort here to reduce num of bpf instrs
  if ((count = CountUnspecial(p, len))) {
    if (count &lt; 256) {
      for (j = i = 0; i &lt; len; ++i) {
        if (p[i] &amp; SPECIAL) continue;
        // jump to ALLOW rule below if accumulator equals ordinal
        struct sock_filter fragment[] = {
            BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K,  // instruction
                     p[i],                       // operand
                     count - j - 1,              // jump if true displacement
                     j == count - 1),            // jump if false displacement
        };
        AppendFilter(f, PLEDGE(fragment));
        ++j;
      }
      struct sock_filter fragment[] = {
          BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),
      };
      AppendFilter(f, PLEDGE(fragment));
    } else {
      __builtin_trap();
    }
  }

  // handle "special" ordinals which use hand-crafted bpf
  for (i = 0; i &lt; len; ++i) {
    if (!(p[i] &amp; SPECIAL)) continue;
    switch (p[i]) {
      case __NR_mmap | EXEC:
        AllowMmapExec(f);
        break;
      case __NR_mmap | NOEXEC:
        AllowMmapNoexec(f);
        break;
      case __NR_mprotect | NOEXEC:
        AllowMprotectNoexec(f);
        break;
#ifdef __NR_chmod
      case __NR_chmod | NOBITS:
        AllowChmodNobits(f);
        break;
#endif
      case __NR_fchmod | NOBITS:
        AllowFchmodNobits(f);
        break;
      case __NR_fchmodat | NOBITS:
        AllowFchmodatNobits(f);
        break;
      case __NR_prctl | STDIO:
        AllowPrctlStdio(f);
        break;
#ifdef __NR_open
      case __NR_open | CREATONLY:
        AllowOpenCreatonly(f);
        break;
#endif
      case __NR_openat | CREATONLY:
        AllowOpenatCreatonly(f);
        break;
#ifdef __NR_open
      case __NR_open | READONLY:
        AllowOpenReadonly(f);
        break;
#endif
      case __NR_openat | READONLY:
        AllowOpenatReadonly(f);
        break;
#ifdef __NR_open
      case __NR_open | WRITEONLY:
        AllowOpenWriteonly(f);
        break;
#endif
      case __NR_openat | WRITEONLY:
        AllowOpenatWriteonly(f);
        break;
      case __NR_getsockopt | RESTRICT:
      case __NR_setsockopt | RESTRICT:
        AllowSockoptRestrict(f);
        break;
#ifdef __NR_creat
      case __NR_creat | RESTRICT:
        AllowCreatRestrict(f);
        break;
#endif
      case __NR_fcntl | STDIO:
        AllowFcntlStdio(f);
        break;
      case __NR_fcntl | LOCK:
        AllowFcntlLock(f);
        break;
      case __NR_ioctl | RESTRICT:
        AllowIoctlStdio(f);
        break;
      case __NR_ioctl | TTY:
        AllowIoctlTty(f);
        break;
      case __NR_ioctl | INET:
        AllowIoctlInet(f);
        break;
      case __NR_socket | INET:
        AllowSocketInet(f);
        break;
      case __NR_socket | UNIX:
        AllowSocketUnix(f);
        break;
      case __NR_sendto | ADDRLESS:
        AllowSendtoAddrless(f);
        break;
      case __NR_clone | RESTRICT:
        AllowCloneRestrict(f);
        break;
      case __NR_clone | THREAD:
        AllowCloneThread(f);
        break;
      case __NR_prlimit64 | STDIO:
        AllowPrlimitStdio(f);
        break;
      case __NR_kill | SELF:
        AllowKillSelf(f);
        break;
      case __NR_tgkill | SELF:
        AllowTgkillSelf(f);
        break;
      default:
        __builtin_trap();
    }
  }
}

/**
 * Installs SECCOMP BPF filter on Linux thread.
 *
 * @param ipromises is inverted integer bitmask of pledge() promises
 * @return 0 on success, or negative error number on error
 */
int sys_pledge_linux(unsigned long ipromises, int mode) {
  struct Filter f;
  int i, e, rc = -1;
  struct sock_filter sf[1] = {BPF_STMT(BPF_RET | BPF_K, 0)};
  CheckLargeStackAllocation(&amp;f, sizeof(f));
  f.n = 0;

  // set up the seccomp filter
  AppendFilter(&amp;f, PLEDGE(kPledgeStart));
  if (ipromises == -1) {
    // if we're pledging empty string, then avoid triggering a sigsys
    // when _Exit() gets called since we need to fallback to _Exit1()
    AppendFilter(&amp;f, PLEDGE(kFilterIgnoreExitGroup));
  }
  AppendPledge(&amp;f, PLEDGE(kPledgeDefault));
  for (i = 0; i &lt; ARRAYLEN(kPledge); ++i) {
    if (~ipromises &amp; (1ul &lt;&lt; i)) {
      if (kPledge[i].len) {
        AppendPledge(&amp;f, kPledge[i].syscalls, kPledge[i].len);
      } else {
        __builtin_trap();
      }
    }
  }

  // now determine what we'll do on sandbox violations
  if (mode &amp; PLEDGE_STDERR_LOGGING) {
    // trapping mode
    //
    // if we haven't pledged exec, then we can monitor SIGSYS
    // and print a helpful error message when things do break
    // to avoid tls / static memory, we embed mode within bpf
    MonitorSigSys();
    AllowMonitor(&amp;f);
    sf[0].k = SECCOMP_RET_TRAP | (mode &amp; SECCOMP_RET_DATA);
    AppendFilter(&amp;f, PLEDGE(sf));
  } else {
    // non-trapping mode
    //
    // our sigsys error message handler can't be inherited across
    // execve() boundaries so if you've pledged exec then that'll
    // likely cause a SIGSYS in your child after the exec happens
    switch (mode &amp; PLEDGE_PENALTY_MASK) {
      case PLEDGE_PENALTY_KILL_THREAD:
        sf[0].k = SECCOMP_RET_KILL_THREAD;
        break;
      case PLEDGE_PENALTY_KILL_PROCESS:
        sf[0].k = SECCOMP_RET_KILL_PROCESS;
        break;
      case PLEDGE_PENALTY_RETURN_EPERM:
        sf[0].k = SECCOMP_RET_ERRNO | EPERM;
        break;
      default:
        return -EINVAL;
    }
    AppendFilter(&amp;f, PLEDGE(sf));
  }

  // drop privileges
  //
  // PR_SET_SECCOMP (Linux 2.6.23+) will refuse to work if
  // PR_SET_NO_NEW_PRIVS (Linux 3.5+) wasn't called so we punt the error
  // detection to the seccomp system call below.
  prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);

  // register our seccomp filter with the kernel
  struct sock_fprog sandbox = {.len = f.n, .filter = f.p};
  rc = prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &amp;sandbox, 0, 0);

  // the EINVAL error could mean a lot of things. it could mean the bpf
  // code is broken. it could also mean we're running on RHEL5 which
  // doesn't have SECCOMP support. since we don't consider lack of
  // system support for security to be an error, we distinguish these
  // two cases by running a simpler SECCOMP operation.
  if (rc &lt; 0 &amp;&amp;                                 //
      errno == EINVAL &amp;&amp;                        //
      prctl(PR_GET_SECCOMP, 0, 0, 0, 0) &lt; 0 &amp;&amp;  //
      errno == EINVAL) {
    rc = 0;  // -ENOSYS
  }

  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">69,089</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,143</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="29"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/landlock_add_rule.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/landlock.h"
/*
#include "libc/intrin/strace.internal.h"

int sys_landlock_add_rule(int, enum landlock_rule_type, const void *, uint32_t);
*/

#include &lt;sys/syscall.h>
#include &lt;unistd.h>

/**
 * Adds new rule to Landlock ruleset.
 *
 * @error ENOSYS if Landlock isn't supported
 * @error EPERM if Landlock supported but SECCOMP BPF shut it down
 * @error EOPNOTSUPP if Landlock supported but disabled at boot time
 * @error EINVAL if flags not 0, or inconsistent access in the rule,
 *     i.e. landlock_path_beneath_attr::allowed_access is not a subset
 *     of the ruleset handled accesses
 * @error ENOMSG empty allowed_access
 * @error EBADF `fd` is not a file descriptor for current thread, or
 *     member of `rule_attr` is not a file descriptor as expected
 * @error EBADFD `fd` is not a ruleset file descriptor, or a member
 *     of `rule_attr` is not the expected file descriptor type
 * @error EPERM `fd` has no write access to the underlying ruleset
 * @error EFAULT `rule_attr` inconsistency
 */
int landlock_add_rule(int fd, enum landlock_rule_type rule_type,
                      const void *rule_attr, uint32_t flags) {
  int rc;
  rc = syscall(__NR_landlock_add_rule, fd, rule_type, rule_attr, flags);
  /*KERNTRACE("landlock_add_rule(%d, %d, %p, %#x) â %d% m", fd, rule_type,
            rule_attr, flags, rc);*/
  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">3,208</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">54</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="30"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/pledge.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include &lt;errno.h>
#include &lt;unistd.h>
#include "libc/calls/calls.h"
#include "libc/calls/pledge.internal.h"
#include "libc/dce.h"
#include "libc/intrin/promises.internal.h"
#include "libc/runtime/runtime.h"

/**
 * Permits system operations, e.g.
 *
 *     __pledge_mode = PLEDGE_PENALTY_KILL_PROCESS | PLEDGE_STDERR_LOGGING;
 *     if (pledge("stdio rfile tty", 0)) {
 *       perror("pledge");
 *       exit(1);
 *     }
 *
 * Pledging causes most system calls to become unavailable. Your system
 * call policy is enforced by the kernel (which means it can propagate
 * across execve() if permitted). Root access is not required. Support
 * is limited to Linux 2.6.23+ (c. RHEL6) and OpenBSD. If your kernel
 * isn't supported, then pledge() will return 0 and do nothing rather
 * than raising ENOSYS. We don't consider lack of system support to be
 * an error, because the specified operations will be permitted.
 *
 * The promises you give pledge() define which system calls are allowed.
 * Error messages are logged when sandbox violations occur, but how that
 * happens depends on the `mode` parameter (see below).
 *
 * Timing is everything with pledge. It's designed to be a voluntary
 * self-imposed security model. That works best when programs perform
 * permission-hungry operations (e.g. calling GetSymbolTable) towards
 * the beginning of execution, and then relinquish privilege afterwards
 * by calling pledge(). Here's an example of where that matters. Your
 * Cosmopolitan C Library needs to code morph your executable in memory
 * once you start using threads. But that's only possible to do if you
 * used the `prot_exec` promise. So the right thing to do here, is to
 * call __enable_threads() before calling pledge() to force it early.
 *
 *     __enable_threads();
 *     ShowCrashReports();
 *     pledge("...", 0);
 *
 * By default exit() is allowed. This is useful for processes that
 * perform pure computation and interface with the parent via shared
 * memory. On Linux we mean sys_exit (_Exit1), not sys_exit_group
 * (_Exit). The difference is effectively meaningless, since _Exit()
 * will attempt both. All it means is that, if you're using threads,
 * then a `pledge("", 0)` thread can't kill all your threads unless you
 * `pledge("stdio", 0)`.
 *
 * Once pledge is in effect, the chmod functions (if allowed) will not
 * permit the sticky/setuid/setgid bits to change. Linux will EPERM here
 * and OpenBSD should ignore those three bits rather than crashing.
 *
 * User and group IDs can't be changed once pledge is in effect. OpenBSD
 * should ignore chown without crashing; whereas Linux will just EPERM.
 *
 * Using pledge is irreversible. On Linux it causes PR_SET_NO_NEW_PRIVS
 * to be set on your process; however, if "id" or "recvfd" are allowed
 * then then they theoretically could permit the gaining of some new
 * privileges. You may call pledge() multiple times if "stdio" is
 * allowed. In that case, the process can only move towards a more
 * restrictive state.
 *
 * pledge() can't filter filesystem paths. See unveil() which lets you
 * do that. pledge() also can't do address firewalling. For example if
 * you use the `inet` promise then your process will be able to talk to
 * *every* internet address including public ones.
 *
 * `promises` is a string that may include any of the following groups
 * delimited by spaces.
 *
 * - "stdio" allows exit, close, dup, dup2, dup3, fchdir, fstat, fsync,
 *   fdatasync, ftruncate, getdents, getegid, getrandom, geteuid,
 *   getgid, getgroups, times, getrusage, getitimer, getpgid, getpgrp,
 *   getpid, getppid, getresgid, getresuid, getrlimit, getsid, wait4,
 *   gettimeofday, getuid, lseek, madvise, brk, arch_prctl, uname,
 *   set_tid_address, clock_getres, clock_gettime, clock_nanosleep,
 *   mremap, mmap, (PROT_EXEC and weird flags aren't allowed), mprotect
 *   (PROT_EXEC isn't allowed), msync, sync_file_range, migrate_pages,
 *   munmap, nanosleep, pipe, pipe2, read, readv, pread, recv, poll,
 *   recvfrom, preadv, write, writev, pwrite, pwritev, select, pselect6,
 *   copy_file_range, sendfile, tee, splice, vmsplice, alarm, pause,
 *   send, sendto (only if addr is null), setitimer, shutdown, sigaction
 *   (but SIGSYS is forbidden), sigaltstack, sigprocmask, sigreturn,
 *   sigsuspend, umask, mincore, socketpair, ioctl(FIONREAD),
 *   ioctl(FIONBIO), ioctl(FIOCLEX), ioctl(FIONCLEX), fcntl(F_GETFD),
 *   fcntl(F_SETFD), fcntl(F_GETFL), fcntl(F_SETFL), sched_yield,
 *   epoll_create, epoll_create1, epoll_ctl, epoll_wait, epoll_pwait,
 *   epoll_pwait2, clone(CLONE_THREAD), futex, set_robust_list,
 *   get_robust_list, setaffinity, sigpending.
 *
 * - "rpath" (read-only path ops) allows chdir, getcwd, open(O_RDONLY),
 *   openat(O_RDONLY), stat, fstat, lstat, fstatat, access, faccessat,
 *   faccessat2, readlink, readlinkat, statfs, fstatfs.
 *
 * - "wpath" (write path ops) allows getcwd, open(O_WRONLY),
 *   openat(O_WRONLY), stat, fstat, lstat, fstatat, access, faccessat,
 *   faccessat2, readlink, readlinkat, chmod, fchmod, fchmodat.
 *
 * - "cpath" (create path ops) allows open(O_CREAT), openat(O_CREAT),
 *   rename, renameat, renameat2, link, linkat, symlink, symlinkat,
 *   unlink, rmdir, unlinkat, mkdir, mkdirat.
 *
 * - "dpath" (create special path ops) allows mknod, mknodat, mkfifo.
 *
 * - "flock" allows flock, fcntl(F_GETLK), fcntl(F_SETLK),
 *   fcntl(F_SETLKW).
 *
 * - "tty" allows ioctl(TIOCGWINSZ), ioctl(TCGETS), ioctl(TCSETS),
 *   ioctl(TCSETSW), ioctl(TCSETSF).
 *
 * - "recvfd" allows recvmsg and recvmmsg.
 *
 * - "recvfd" allows sendmsg and sendmmsg.
 *
 * - "fattr" allows chmod, fchmod, fchmodat, utime, utimes, futimens,
 *   utimensat.
 *
 * - "inet" allows socket(AF_INET), listen, bind, connect, accept,
 *   accept4, getpeername, getsockname, setsockopt, getsockopt, sendto.
 *
 * - "unix" allows socket(AF_UNIX), listen, bind, connect, accept,
 *   accept4, getpeername, getsockname, setsockopt, getsockopt.
 *
 * - "dns" allows socket(AF_INET), sendto, recvfrom, connect.
 *
 * - "proc" allows fork, vfork, clone, kill, tgkill, getpriority,
 *   setpriority, prlimit, setrlimit, setpgid, setsid.
 *
 * - "id" allows setuid, setreuid, setresuid, setgid, setregid,
 *   setresgid, setgroups, prlimit, setrlimit, getpriority, setpriority,
 *   setfsuid, setfsgid.
 *
 * - "settime" allows settimeofday and clock_adjtime.
 *
 * - "exec" allows execve, execveat. Note that `exec` alone might not be
 *   enough by itself to let your executable be executed. For dynamic,
 *   interpreted, and ape binaries, you'll usually want `rpath` and
 *   `prot_exec` too. With APE it's possible to work around this
 *   requirement, by "assimilating" your binaries beforehand. See the
 *   assimilate.com program and `--assimilate` flag which can be used to
 *   turn APE binaries into static native binaries.
 *
 * - "prot_exec" allows mmap(PROT_EXEC) and mprotect(PROT_EXEC). This is
 *   needed to (1) code morph mutexes in __enable_threads(), and it's
 *   needed to (2) launch non-static or non-native executables, e.g.
 *   non-assimilated APE binaries, or dynamic-linked executables.
 *
 * - "unveil" allows unveil() to be called, as well as the underlying
 *   landlock_create_ruleset, landlock_add_rule, landlock_restrict_self
 *   calls on Linux.
 *
 * - "vminfo" OpenBSD defines this for programs like `top`. On Linux,
 *   this is a placeholder group that lets tools like pledge.com check
 *   `__promises` and automatically unveil() a subset of files top would
 *   need, e.g. /proc/stat, /proc/meminfo.
 *
 * - "tmppath" allows unlink, unlinkat, and lstat. This is mostly a
 *   placeholder group for pledge.com, which reads the `__promises`
 *   global to determine if /tmp and $TMPPATH should be unveiled.
 *
 * `execpromises` only matters if "exec" is specified in `promises`. In
 * that case, this specifies the promises that'll apply once execve()
 * happens. If this is NULL then the default is used, which is
 * unrestricted. OpenBSD allows child processes to escape the sandbox
 * (so a pledged OpenSSH server process can do things like spawn a root
 * shell). Linux however requires monotonically decreasing privileges.
 * This function will will perform some validation on Linux to make sure
 * that `execpromises` is a subset of `promises`. Your libc wrapper for
 * execve() will then apply its SECCOMP BPF filter later. Since Linux
 * has to do this before calling sys_execve(), the executed process will
 * be weakened to have execute permissions too.
 *
 * `__pledge_mode` is available to improve the experience of pledge() on
 * Linux. It should specify one of the following penalties:
 *
 * - `PLEDGE_PENALTY_KILL_THREAD` causes the violating thread to be
 *   killed. This is the default on Linux. It's effectively the same as
 *   killing the process, since redbean has no threads. The termination
 *   signal can't be caught and will be either `SIGSYS` or `SIGABRT`.
 *   Consider enabling stderr logging below so you'll know why your
 *   program failed. Otherwise check the system log.
 *
 * - `PLEDGE_PENALTY_KILL_PROCESS` causes the process and all its
 *   threads to be killed. This is always the case on OpenBSD.
 *
 * - `PLEDGE_PENALTY_RETURN_EPERM` causes system calls to just return an
 *   `EPERM` error instead of killing. This is a gentler solution that
 *   allows code to display a friendly warning. Please note this may
 *   lead to weird behaviors if the software being sandboxed is lazy
 *   about checking error results.
 *
 * `mode` may optionally bitwise or the following flags:
 *
 * - `PLEDGE_STDERR_LOGGING` enables friendly error message logging
 *   letting you know which promises are needed whenever violations
 *   occur. Without this, violations will be logged to `dmesg` on Linux
 *   if the penalty is to kill the process. You would then need to
 *   manually look up the system call number and then cross reference it
 *   with the cosmopolitan libc pledge() documentation. You can also use
 *   `strace -ff` which is easier. This is ignored OpenBSD, which
 *   already has a good system log. Turning on stderr logging (which
 *   uses SECCOMP trapping) also means that the `WTERMSIG()` on your
 *   killed processes will always be `SIGABRT` on both Linux and
 *   OpenBSD. Otherwise, Linux prefers to raise `SIGSYS`. Enabling this
 *   option might not be a good idea if you're pledging `exec` because
 *   subprocesses can't inherit the `SIGSYS` handler this installs.
 *
 * @return 0 on success, or -1 w/ errno
 * @raise EINVAL if `execpromises` on Linux isn't a subset of `promises`
 * @raise EINVAL if `promises` allows exec and `execpromises` is null
 * @threadsafe
 * @vforksafe
 */
int pledge(const char *promises, const char *execpromises) {
  int e, rc;
  unsigned long ipromises, iexecpromises;
  if (!ParsePromises(promises, &amp;ipromises) &amp;&amp;
      !ParsePromises(execpromises, &amp;iexecpromises)) {
    // copy exec and execnative from promises to execpromises
    iexecpromises = ~(~iexecpromises | (~ipromises &amp; (1ul &lt;&lt; PROMISE_EXEC)));
    // if bits are missing in execpromises that exist in promises
    // then execpromises wouldn't be a monotonic access reduction
    // this check only matters when exec / execnative are allowed
    if ((ipromises &amp; ~iexecpromises) &amp;&amp; (~ipromises &amp; (1ul &lt;&lt; PROMISE_EXEC))) {
      errno = EINVAL;
      rc = -1;
    } else {
      rc = sys_pledge_linux(ipromises, __pledge_mode);
      if (rc > -4096u) errno = -rc, rc = -1;
    }
    if (!rc &amp;&amp; (getpid() == gettid())) {
      __promises = ipromises;
      __execpromises = iexecpromises;
    }
  } else {
    errno = EINVAL;
    rc = -1;
  }
  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">13,517</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">262</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="31"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/landlock.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_CALLS_LANDLOCK_H_
#define PLEDGE_LIBC_CALLS_LANDLOCK_H_

#include &lt;linux/landlock.h>
#include &lt;stdint.h>
#include &lt;stddef.h>

/**
 * Allow renaming or linking file to a different directory.
 *
 * @see https://lore.kernel.org/r/20220329125117.1393824-8-mic@digikod.net
 * @see https://docs.kernel.org/userspace-api/landlock.html
 * @note ABI 2+
 */
#ifndef LANDLOCK_ACCESS_FS_REFER
#define LANDLOCK_ACCESS_FS_REFER 0x2000ul
#endif

/**
 * Control file truncation.
 *
 * @see https://lore.kernel.org/all/20221018182216.301684-1-gnoack3000@gmail.com/
 * @see https://docs.kernel.org/userspace-api/landlock.html
 * @note ABI 3+
 */
#ifndef LANDLOCK_ACCESS_FS_TRUNCATE
#define LANDLOCK_ACCESS_FS_TRUNCATE 0x4000ul
#endif

int landlock_restrict_self(int, uint32_t);
int landlock_add_rule(int, enum landlock_rule_type, const void *, uint32_t);
int landlock_create_ruleset(const struct landlock_ruleset_attr *, size_t,
                            uint32_t);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">978</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">36</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="32"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/landlock_create_ruleset.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/landlock.h"
/*
#include "libc/intrin/strace.internal.h"

int sys_landlock_create_ruleset(const struct landlock_ruleset_attr *, size_t,
                                uint32_t);
*/

#include &lt;sys/syscall.h>
#include &lt;unistd.h>

/**
 * Create new Landlock filesystem sandboxing ruleset.
 *
 * You may also use this function to query the current ABI version:
 *
 *     landlock_create_ruleset(0, 0, LANDLOCK_CREATE_RULESET_VERSION);
 *
 * @return close exec file descriptor for new ruleset
 * @error ENOSYS if not running Linux 5.13+
 * @error EPERM if pledge() or seccomp bpf shut it down
 * @error EOPNOTSUPP Landlock supported but disabled at boot
 * @error EINVAL unknown flags, or unknown access, or too small size
 * @error E2BIG attr or size inconsistencies
 * @error EFAULT attr or size inconsistencies
 * @error ENOMSG empty landlock_ruleset_attr::handled_access_fs
 */
int landlock_create_ruleset(const struct landlock_ruleset_attr *attr,
                            size_t size, uint32_t flags) {
  int rc;
  rc = syscall(__NR_landlock_create_ruleset, attr, size, flags);
  //KERNTRACE("landlock_create_ruleset(%p, %'zu, %#x) â %d% m", attr, size, flags,
  //          rc);
  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">3,057</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">54</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="33"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/syscall_support-sysv.internal.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_CALLS_SYSCALL_SUPPORT_SYSV_INTERNAL_H_
#define PLEDGE_LIBC_CALLS_SYSCALL_SUPPORT_SYSV_INTERNAL_H_

#include &lt;stdbool.h>

bool is_linux_2_6_23(void);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">177</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">9</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="34"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/landlock_restrict_self.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/landlock.h"
/*
#include "libc/intrin/strace.internal.h"

int sys_landlock_restrict_self(int, uint32_t);
*/

#include &lt;sys/syscall.h>
#include &lt;unistd.h>

/**
 * Enforces Landlock ruleset on calling thread.
 *
 * @error EOPNOTSUPP if Landlock supported but disabled at boot time
 * @error EINVAL if flags isn't zero
 * @error EBADF if `fd` isn't file descriptor for the current thread
 * @error EBADFD if `fd` is not a ruleset file descriptor
 * @error EPERM if `fd` has no read access to underlying ruleset, or
 *     current thread is not running with no_new_privs, or it doesnât
 *     have CAP_SYS_ADMIN in its namespace
 * @error E2BIG if the maximum number of stacked rulesets is
 *     reached for current thread
 */
int landlock_restrict_self(int fd, uint32_t flags) {
  int rc;
  rc = syscall(__NR_landlock_restrict_self, fd, flags);
  //KERNTRACE("landlock_create_ruleset(%d, %#x) â %d% m", fd, flags, rc);
  return rc;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,792</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">48</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="35"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/calls/pledge.internal.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_CALLS_PLEDGE_INTERNAL_H_
#define PLEDGE_LIBC_CALLS_PLEDGE_INTERNAL_H_

#include "libc/calls/pledge.h"
#include "libc/intrin/promises.internal.h"
#include &lt;stdint.h>
#include &lt;stddef.h>

struct Pledges {
  const char *name;
  const uint16_t *syscalls;
  const size_t len;
};

extern const struct Pledges kPledge[PROMISE_LEN_];

int sys_pledge_linux(unsigned long, int);
int ParsePromises(const char *, unsigned long *);

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">447</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">21</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="36"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/safemacros.internal.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_INTRIN_SAFEMACROS_INTERNAL_H_
#define PLEDGE_LIBC_INTRIN_SAFEMACROS_INTERNAL_H_

#include "libc/integral/c.h"

#define max(x, y)              \
  ({                           \
    autotype(x) MaxX = (x);    \
    autotype(y) MaxY = (y);    \
    MaxX > MaxY ? MaxX : MaxY; \
  })

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">309</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">14</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="37"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/kprintf.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_INTRIN_KPRINTF_H_
#define PLEDGE_LIBC_INTRIN_KPRINTF_H_

#include &lt;stdio.h>

#define kprintf printf
#define ksnprintf snprintf

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">155</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">10</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="38"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/promises.internal.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_INTRIN_PROMISES_INTERNAL_H_
#define PLEDGE_LIBC_INTRIN_PROMISES_INTERNAL_H_

#define PROMISE_STDIO     0
#define PROMISE_RPATH     1
#define PROMISE_WPATH     2
#define PROMISE_CPATH     3
#define PROMISE_DPATH     4
#define PROMISE_FLOCK     5
#define PROMISE_FATTR     6
#define PROMISE_INET      7
#define PROMISE_UNIX      8
#define PROMISE_DNS       9
#define PROMISE_TTY       10
#define PROMISE_RECVFD    11
#define PROMISE_PROC      12
#define PROMISE_EXEC      13
#define PROMISE_ID        14
#define PROMISE_UNVEIL    15
#define PROMISE_SENDFD    16
#define PROMISE_SETTIME   17
#define PROMISE_PROT_EXEC 18
#define PROMISE_VMINFO    19
#define PROMISE_TMPPATH   20
#define PROMISE_CHOWN     21
#define PROMISE_LEN_      22

extern unsigned long __promises;
extern unsigned long __execpromises;

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">833</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">32</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="39"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/pthread_setcancelstate.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/blockcancel.internal.h"
/*
#include "libc/errno.h"
#include "libc/thread/posixthread.internal.h"
#include "libc/thread/thread.h"
#include "libc/thread/tls.h"
*/

#include &lt;pthread.h>

void pthread_allow_cancellations(int oldstate) {
  pthread_setcancelstate(oldstate, 0);
}

int pthread_block_cancellations(void) {
  int oldstate;
  pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, &amp;oldstate);
  return oldstate;
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,270</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">38</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="40"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/promises.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">/*-*- mode:c;indent-tabs-mode:nil;c-basic-offset:2;tab-width:8;coding:utf-8 -*-â
âvi: set net ft=c ts=2 sts=2 sw=2 fenc=utf-8                                :viâ
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ¡
â Copyright 2022 Justine Alexandra Roberts Tunney                              â
â                                                                              â
â Permission to use, copy, modify, and/or distribute this software for         â
â any purpose with or without fee is hereby granted, provided that the         â
â above copyright notice and this permission notice appear in all copies.      â
â                                                                              â
â THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL                â
â WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED                â
â WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE             â
â AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL         â
â DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR        â
â PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER               â
â TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR             â
â PERFORMANCE OF THIS SOFTWARE.                                                â
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ*/
#include "libc/calls/pledge.h"
#include "libc/intrin/promises.internal.h"

// XXX: should be inherited thread local
//      see also sys_pledge_linux() which is 100% pure
int __pledge_mode;
unsigned long __promises;
unsigned long __execpromises;
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">2,082</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">27</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="41"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/likely.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_INTRIN_LIKELY_H_
#define PLEDGE_LIBC_INTRIN_LIKELY_H_

#ifndef __STRICT_ANSI__
#define LIKELY(x)   __builtin_expect(!!(x), 1)
#define UNLIKELY(x) __builtin_expect(!!(x), 0)
#else
#define LIKELY(x)
#define UNLIKELY(x)
#endif

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">252</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">13</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="42"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/intrin/bits.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_INTRIN_BITS_H_
#define PLEDGE_LIBC_INTRIN_BITS_H_

#include &lt;stdint.h>

#ifdef __STRICT_ANSI__
#define READ32LE(S)                                                    \
  ((uint32_t)(255 &amp; (S)[3]) &lt;&lt; 030 | (uint32_t)(255 &amp; (S)[2]) &lt;&lt; 020 | \
   (uint32_t)(255 &amp; (S)[1]) &lt;&lt; 010 | (uint32_t)(255 &amp; (S)[0]) &lt;&lt; 000)
#define READ64LE(S)                                                    \
  ((uint64_t)(255 &amp; (S)[7]) &lt;&lt; 070 | (uint64_t)(255 &amp; (S)[6]) &lt;&lt; 060 | \
   (uint64_t)(255 &amp; (S)[5]) &lt;&lt; 050 | (uint64_t)(255 &amp; (S)[4]) &lt;&lt; 040 | \
   (uint64_t)(255 &amp; (S)[3]) &lt;&lt; 030 | (uint64_t)(255 &amp; (S)[2]) &lt;&lt; 020 | \
   (uint64_t)(255 &amp; (S)[1]) &lt;&lt; 010 | (uint64_t)(255 &amp; (S)[0]) &lt;&lt; 000)
#else /* gcc needs help knowing above are mov if s isn't a variable */
#define READ32LE(S)                                      \
  ({                                                     \
    const uint8_t *Ptr = (const uint8_t *)(S);           \
    ((uint32_t)Ptr[3] &lt;&lt; 030 | (uint32_t)Ptr[2] &lt;&lt; 020 | \
     (uint32_t)Ptr[1] &lt;&lt; 010 | (uint32_t)Ptr[0] &lt;&lt; 000); \
  })
#define READ64LE(S)                                      \
  ({                                                     \
    const uint8_t *Ptr = (const uint8_t *)(S);           \
    ((uint64_t)Ptr[7] &lt;&lt; 070 | (uint64_t)Ptr[6] &lt;&lt; 060 | \
     (uint64_t)Ptr[5] &lt;&lt; 050 | (uint64_t)Ptr[4] &lt;&lt; 040 | \
     (uint64_t)Ptr[3] &lt;&lt; 030 | (uint64_t)Ptr[2] &lt;&lt; 020 | \
     (uint64_t)Ptr[1] &lt;&lt; 010 | (uint64_t)Ptr[0] &lt;&lt; 000); \
  })
#endif

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">1,497</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">33</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="43"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/integral/c.h</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#ifndef PLEDGE_LIBC_INTEGRAL_C_H_
#define PLEDGE_LIBC_INTEGRAL_C_H_

#include &lt;stdarg.h>
#include &lt;stdint.h>
#include &lt;stdlib.h>

#ifndef __STRICT_ANSI__
#define pureconst __attribute__((__const__))
#else
#define pureconst
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp;     \
    (__has_attribute(__nonnull__) || \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 403)
#define paramsnonnull(opt_1idxs) __attribute__((__nonnull__ opt_1idxs))
#else
#define paramsnonnull(opt_1idxs)
#endif

#define libcesque dontthrow nocallback

#if defined(__cplusplus) &amp;&amp; !defined(__STRICT_ANSI__) &amp;&amp; \
    (__has_attribute(dontthrow) ||                       \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 303)
#define dontthrow __attribute__((__nothrow__))
#elif defined(_MSC_VER)
#define dontthrow __declspec(nothrow)
#else
#define dontthrow
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp;  \
    (__has_attribute(__leaf__) || \
     (!defined(__llvm__) &amp;&amp;       \
      (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 406))
#define nocallback __attribute__((__leaf__))
#else
#define nocallback
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp; \
    (__has_attribute(__sentinel__) || __GNUC__ + 0 >= 4)
#define nullterminated(x) __attribute__((__sentinel__ x))
#else
#define nullterminated(x)
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp;    \
    (__has_attribute(__malloc__) || \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409)
#define returnspointerwithnoaliases __attribute__((__malloc__))
#elif defined(_MSC_VER)
#define returnspointerwithnoaliases __declspec(allocator)
#else
#define returnspointerwithnoaliases
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp;                           \
    ((__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 304 || \
     __has_attribute(__warn_unused_result__))
#define dontdiscard __attribute__((__warn_unused_result__))
#else
#define dontdiscard
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp;             \
    (__has_attribute(__returns_nonnull__) || \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409)
#define returnsnonnull __attribute__((__returns_nonnull__))
#else
#define returnsnonnull
#endif

#if !defined(__STRICT_ANSI__) &amp;&amp;        \
    (__has_attribute(__alloc_size__) || \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409)
#define attributeallocsize(x) __attribute__((__alloc_size__ x))
#else
#define attributeallocsize(x)
#endif

#ifdef __cplusplus
#define forceinline inline
#else
#if !defined(__STRICT_ANSI__) &amp;&amp; \
    (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 302
#if (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 403 || \
    !defined(__cplusplus) ||                              \
    (defined(__clang__) &amp;&amp;                                \
     (defined(__GNUC_STDC_INLINE__) || defined(__GNUC_GNU_INLINE__)))
#if defined(__GNUC_STDC_INLINE__) || defined(__cplusplus)
#define forceinline                                                 \
  static __inline __attribute__((__always_inline__, __gnu_inline__, \
                                 __no_instrument_function__, __unused__))
#else
#define forceinline                                 \
  static __inline __attribute__((__always_inline__, \
                                 __no_instrument_function__, __unused__))
#endif /* __GNUC_STDC_INLINE__ */
#endif /* GCC >= 4.3 */
#elif defined(_MSC_VER)
#define forceinline __forceinline
#else
#define forceinline static inline
#endif /* !ANSI &amp;&amp; GCC >= 3.2 */
#endif /* __cplusplus */

#define strlenesque libcesque nosideeffect paramsnonnull()

#if !defined(__STRICT_ANSI__) &amp;&amp;  \
    (__has_attribute(__pure__) || \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 296)
#define nosideeffect __attribute__((__pure__))
#else
#define nosideeffect
#endif

#if __cplusplus + 0 >= 201103L
#define autotype(x) auto
#elif ((__has_builtin(auto_type) || defined(__llvm__) ||       \
        (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 409) &amp;&amp; \
       !defined(__chibicc__))
#define autotype(x) __auto_type
#else
#define autotype(x) typeof(x)
#endif

#define privileged

#ifndef __STRICT_ANSI__
#define thatispacked __attribute__((__packed__))
#else
#define thatispacked
#endif

#define notpossible __builtin_trap()

#if !defined(__STRICT_ANSI__) &amp;&amp;      \
    (__has_attribute(__noreturn__) || \
     (__GNUC__ + 0) * 100 + (__GNUC_MINOR__ + 0) >= 208)
#define wontreturn __attribute__((__noreturn__))
#else
#define wontreturn
#endif

#endif
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">4,386</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">149</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr><tr class="group cursor-pointer space-x-4 divide-x border-b outline-offset-[-2px] odd:bg-gray-50 hover:bg-gray-100 dark:odd:bg-gray-925 dark:hover:bg-gray-850  last:border-none" tabindex="0" data-row-idx="44"><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">pledge/libc/sysv/calls/ioprio_set.c</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">#include "libc/calls/calls.h"

#include &lt;sys/syscall.h>
#include &lt;unistd.h>

int ioprio_set(int which, int who, int ioprio) {
  return syscall(__NR_ioprio_set, which, who, ioprio);
}
</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">183</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto">9</div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="" dir="auto"><span class="">jart/plegde</span></div></div>
							</td><td class="min-w-fit max-w-sm break-words p-2 "><div class="line-clamp-2 "><div class="text-right" dir="auto"><span class="">false</span></div></div>
							</td>
					</tr></tbody></table>
		<div class="bg-linear-to-b sticky left-0 border-t border-dashed border-gray-300 from-gray-100 to-white py-3 text-center font-mono text-xs dark:border-gray-700 dark:from-gray-950 dark:to-gray-900">End of preview. <a href="/datasets/waybarrios/github-code-dataset/viewer/default/train" class="group"><span class="underline decoration-gray-300 group-hover:decoration-gray-400 dark:decoration-gray-500 dark:group-hover:decoration-gray-300">Expand</span>
						in <svg class="text-lg mr-0.5 inline -translate-y-px text-red-500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 12 12"><path fill="currentColor" d="M2.5 2h7a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1Zm0 2v2h3V4h-3Zm4 0v2h3V4h-3Zm-4 3v2h3V7h-3Zm4 0v2h3V7h-3Z"></path></svg>Data Studio
					</a></div></div>




			<div class="bg-linear-to-b from-gray-100 to-white dark:from-gray-950 dark:to-gray-900 "><hr class="flex-none -translate-y-px border-t border-dashed border-gray-300 bg-white dark:border-gray-700 dark:bg-gray-950">
					<nav><ul class="flex select-none items-center justify-between space-x-2 text-gray-700 sm:justify-center py-1 text-center font-mono text-xs rounded-b-lg"><li><a class="flex items-center rounded-lg px-2.5 py-1 hover:bg-gray-50 dark:hover:bg-gray-800 pointer-events-none cursor-default text-gray-400 hover:text-gray-700" href=""><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4l-8.6 8.6l8.6 8.6L20 26z" fill="currentColor"></path></svg>
		Previous</a></li>
			<li class="hidden sm:block"><a class="rounded-lg px-2.5 py-1 bg-gray-50 font-semibold ring-1 ring-inset ring-gray-200 dark:bg-gray-900 dark:text-yellow-500 dark:ring-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800" href="/datasets/waybarrios/github-code-dataset/viewer/default/train?p=0">1</a>
				</li><li class="hidden sm:block"><a class="rounded-lg px-2.5 py-1  hover:bg-gray-50 dark:hover:bg-gray-800" href="/datasets/waybarrios/github-code-dataset/viewer/default/train?p=1">2</a>
				</li><li class="hidden sm:block"><a class="rounded-lg px-2.5 py-1  hover:bg-gray-50 dark:hover:bg-gray-800" href="/datasets/waybarrios/github-code-dataset/viewer/default/train?p=2">3</a>
				</li><li class="hidden sm:block"><a class="rounded-lg px-2.5 py-1  pointer-events-none cursor-default" href="#">...</a>
				</li><li class="hidden sm:block"><a class="rounded-lg px-2.5 py-1  hover:bg-gray-50 dark:hover:bg-gray-800" href="/datasets/waybarrios/github-code-dataset/viewer/default/train?p=189">190</a>
				</li>
			<li><a class="flex items-center rounded-lg px-2.5 py-1 hover:bg-gray-50 dark:hover:bg-gray-800 " href="/datasets/waybarrios/github-code-dataset/viewer/default/train?p=1">Next
		<svg class="ml-1.5 transform rotate-180" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4l-8.6 8.6l8.6 8.6L20 26z" fill="currentColor"></path></svg></a></li></ul></nav></div></div>






</div></div></div></div></div></div></div>

				
					<div class="SVELTE_HYDRATER contents" data-target="RepoCodeCopy" data-props="{}"><div></div></div>
					

					<div class="SVELTE_HYDRATER contents" data-target="SideNavigation" data-props="{&quot;titleTree&quot;:[],&quot;classNames&quot;:&quot;top-6&quot;}">

</div>
					<div class="2xl:pr-6"><div class="prose pl-6 -ml-6 hf-sanitized hf-sanitized-TGWF-qyqJseuKltP9-LVC">
	<!-- HTML_TAG_START --><h1 class="relative group flex items-center">
	<a rel="nofollow" href="#dataset-card-for-github-code-dataset" class="block pr-1.5 text-lg md:absolute md:p-1.5 md:opacity-0 md:group-hover:opacity-100 md:right-full" id="dataset-card-for-github-code-dataset">
		<span class="header-link"><svg viewBox="0 0 256 256" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" role="img" aria-hidden="true" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" class="text-gray-500 hover:text-black dark:hover:text-gray-200 w-4"><path fill="currentColor" d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z"></path></svg></span>
	</a>
	<span>
		Dataset Card for "github-code-dataset"
	</span>
</h1>
<p><a rel="nofollow" href="https://github.com/huggingface/datasets/blob/main/CONTRIBUTING.md#how-to-contribute-to-the-dataset-cards">More Information needed</a></p>
<!-- HTML_TAG_END --></div>
</div></section>
			
			<section class="pt-6 border-gray-100 md:pb-24 md:pl-6 md:w-64 lg:w-80 xl:w-96 flex-none order-first md:order-none md:border-l pt-3! md:pt-6!"><dl class="flex items-baseline justify-between"><dt class="text-sm text-gray-500">Downloads last month</dt><div class="mx-4 flex-1 border-b border-dotted"></div><dd class="font-semibold">61</dd></dl>
				
				<div class="divider-column-vertical"></div>
				<div class="grid grid-cols-2 gap-x-2 md:flex md:flex-row md:flex-wrap"><div class="SVELTE_HYDRATER contents" data-target="DatasetAndModelActionsDropdown" data-props="{&quot;classNames&quot;:&quot;order-last&quot;,&quot;discussionsDisabled&quot;:false,&quot;repo&quot;:{&quot;type&quot;:&quot;dataset&quot;,&quot;name&quot;:&quot;waybarrios/github-code-dataset&quot;},&quot;canWrite&quot;:false,&quot;canDisable&quot;:false,&quot;repoIsPrivate&quot;:false,&quot;repoIsGated&quot;:false,&quot;repoIsDisabled&quot;:false,&quot;repoIsAdminFlaggedNFAA&quot;:false,&quot;repoHasBlockedOids&quot;:false}"><div class="order-last"><div class="relative ">
	<button class="btn px-1.5 py-1.5 " type="button">
		
			<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="p-0.5" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><circle cx="16" cy="7" r="3" fill="currentColor"></circle><circle cx="16" cy="16" r="3" fill="currentColor"></circle><circle cx="16" cy="25" r="3" fill="currentColor"></circle></svg>
		
		</button>
	
	
	</div></div>













</div>
					<div class="SVELTE_HYDRATER contents" data-target="DatasetLibrary" data-props="{&quot;classNames&quot;:&quot;md:w-full xl:w-auto xl:flex-none&quot;,&quot;libraries&quot;:[{&quot;language&quot;:&quot;python&quot;,&quot;library&quot;:&quot;datasets&quot;,&quot;function&quot;:&quot;load_dataset&quot;,&quot;loading_codes&quot;:[{&quot;config_name&quot;:&quot;default&quot;,&quot;arguments&quot;:{},&quot;code&quot;:&quot;from datasets import load_dataset\n\nds = load_dataset(\&quot;waybarrios/github-code-dataset\&quot;)&quot;}]},{&quot;language&quot;:&quot;python&quot;,&quot;library&quot;:&quot;pandas&quot;,&quot;function&quot;:&quot;pd.read_parquet&quot;,&quot;loading_codes&quot;:[{&quot;config_name&quot;:&quot;default&quot;,&quot;arguments&quot;:{&quot;splits&quot;:{&quot;train&quot;:&quot;data/train-00000-of-00001-6bfae78124635ce7.parquet&quot;}},&quot;code&quot;:&quot;import pandas as pd\n\ndf = pd.read_parquet(\&quot;hf://datasets/waybarrios/github-code-dataset/data/train-00000-of-00001-6bfae78124635ce7.parquet\&quot;)&quot;}]},{&quot;language&quot;:&quot;python&quot;,&quot;library&quot;:&quot;mlcroissant&quot;,&quot;function&quot;:&quot;Dataset&quot;,&quot;loading_codes&quot;:[{&quot;config_name&quot;:&quot;default&quot;,&quot;arguments&quot;:{&quot;record_set&quot;:&quot;default&quot;,&quot;partial&quot;:false},&quot;code&quot;:&quot;from mlcroissant import Dataset\n\nds = Dataset(jsonld=\&quot;https://huggingface.co/api/datasets/waybarrios/github-code-dataset/croissant\&quot;)\nrecords = ds.records(\&quot;default\&quot;)&quot;}]},{&quot;language&quot;:&quot;python&quot;,&quot;library&quot;:&quot;polars&quot;,&quot;function&quot;:&quot;pl.read_parquet&quot;,&quot;loading_codes&quot;:[{&quot;config_name&quot;:&quot;default&quot;,&quot;arguments&quot;:{&quot;splits&quot;:{&quot;train&quot;:&quot;data/train-00000-of-00001-6bfae78124635ce7.parquet&quot;}},&quot;code&quot;:&quot;import polars as pl\n\ndf = pl.read_parquet('hf://datasets/waybarrios/github-code-dataset/data/train-00000-of-00001-6bfae78124635ce7.parquet')\n&quot;}]}]}"><div class="relative md:w-full xl:w-auto xl:flex-none">
	<button class="from-gray-800! to-black! max-xl:mb-2 text-white! gap-1! border-gray-800! dark:border-gray-900!  btn w-full cursor-pointer text-sm" type="button">
		<svg class="mr-1.5 mr-0.5! " xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" style="transform: rotate(360deg);"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg>
			Use this dataset
		<svg class="-mr-1 text-gray-500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M16.293 9.293L12 13.586L7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z" fill="currentColor"></path></svg></button>
	
	
	</div>

</div>
					
					</div>
				<div class="divider-column-vertical"></div>
					<div class="flex flex-col flex-wrap xl:flex-row"><a class="bg-linear-to-r dark:via-none group mb-1.5 flex max-w-full flex-col overflow-hidden rounded-lg border border-gray-100 from-white via-white to-white px-2 py-1 hover:from-gray-50 dark:from-gray-900 dark:to-gray-925 dark:hover:to-gray-900 md:mr-1.5 pointer-events-none" rel="nofollow" target="_blank"><div class="truncate text-xs text-gray-400">Size of downloaded dataset files:</div>
		<div class="truncate text-sm ">
			<!-- HTML_TAG_START -->57.6 MB<!-- HTML_TAG_END --></div></a><a class="bg-linear-to-r dark:via-none group mb-1.5 flex max-w-full flex-col overflow-hidden rounded-lg border border-gray-100 from-white via-white to-white px-2 py-1 hover:from-gray-50 dark:from-gray-900 dark:to-gray-925 dark:hover:to-gray-900 md:mr-1.5 " href="/datasets/waybarrios/github-code-dataset/tree/refs%2Fconvert%2Fparquet/" rel="nofollow" target="_blank"><div class="truncate text-xs text-gray-400">Size of the auto-converted Parquet files:</div>
		<div class="truncate text-sm group-hover:underline">
			<!-- HTML_TAG_START -->57.6 MB<!-- HTML_TAG_END --></div></a><a class="bg-linear-to-r dark:via-none group mb-1.5 flex max-w-full flex-col overflow-hidden rounded-lg border border-gray-100 from-white via-white to-white px-2 py-1 hover:from-gray-50 dark:from-gray-900 dark:to-gray-925 dark:hover:to-gray-900 md:mr-1.5 pointer-events-none" rel="nofollow" target="_blank"><div class="truncate text-xs text-gray-400">Number of rows:</div>
		<div class="truncate text-sm ">
			<!-- HTML_TAG_START -->18,912<!-- HTML_TAG_END --></div></a></div>
				
				
				
				

				
				<div class="divider-column-vertical md:hidden"></div></section></div></main>

	<footer class="b-12 mb-2 flex border-t border-gray-100 md:h-14"><nav class="container relative flex flex-col justify-between space-y-2 py-6 text-gray-500 max-md:*:self-start md:flex-row md:items-center md:space-y-0 md:py-0 md:text-sm"><div class="SVELTE_HYDRATER contents" data-target="ThemeSwitcher" data-props="{&quot;theme&quot;:&quot;system&quot;,&quot;isLoggedIn&quot;:false,&quot;menuClassNames&quot;:&quot;md:-top-24&quot;,&quot;classNames&quot;:&quot;max-md:mb-5 max-md:*:self-start&quot;}">
<div class="relative inline-block max-md:mb-5 max-md:*:self-start">
	<button class="rounded-full border border-gray-100 pl-2 py-1 pr-2.5  flex items-center text-sm text-gray-500 bg-white hover:bg-purple-50 hover:border-purple-200 dark:hover:bg-gray-800 dark:hover:border-gray-950 dark:border-gray-800 " type="button">
		<svg class="mr-1.5 text-gray-500" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M29 25H3a1 1 0 1 0 0 2h26a1 1 0 1 0 0-2Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M6 22.5h20a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v13.5a2 2 0 0 0 2 2ZM7 7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H7Z" fill="currentColor"></path><path d="M6 8a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8Z" fill="currentColor" fill-opacity=".4"></path><path d="M29 25H3a1 1 0 1 0 0 2h26a1 1 0 1 0 0-2Z" fill="currentColor"></path></svg>
			System theme
		</button>
	
	
	</div></div>
		<div class="font-semibold text-black md:hidden">Company</div>
		<a class="hover:underline" href="/terms-of-service">TOS</a>
		<a class="hover:underline" href="/privacy">Privacy</a>
		<a class="hover:underline" href="/huggingface">About</a>
		<a class="hover:underline" href="https://apply.workable.com/huggingface/">Jobs</a>
		<a href="/" class="max-md:mb-4! max-md:mt-8! group flex-none max-md:order-last"><svg class="h-7 w-7 transition-transform group-hover:-translate-y-px" viewBox="0 0 95 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M47.2119 76.5C66.4037 76.5 81.9619 60.9419 81.9619 41.75C81.9619 22.5581 66.4037 7 47.2119 7C28.02 7 12.4619 22.5581 12.4619 41.75C12.4619 60.9419 28.02 76.5 47.2119 76.5Z" fill="#FFD21E"></path><path d="M81.9619 41.75C81.9619 22.5581 66.4037 7 47.2119 7C28.02 7 12.4619 22.5581 12.4619 41.75C12.4619 60.9419 28.02 76.5 47.2119 76.5C66.4037 76.5 81.9619 60.9419 81.9619 41.75ZM8.46185 41.75C8.46185 20.349 25.8108 3 47.2119 3C68.6129 3 85.9619 20.349 85.9619 41.75C85.9619 63.151 68.6129 80.5 47.2119 80.5C25.8108 80.5 8.46185 63.151 8.46185 41.75Z" fill="#FF9D0B"></path><path d="M58.5024 32.2915C59.7768 32.7415 60.2839 35.3615 61.5713 34.6769C64.0095 33.3805 64.9351 30.353 63.6387 27.9148C62.3423 25.4767 59.3148 24.5511 56.8766 25.8475C54.4384 27.1439 53.5128 30.1714 54.8092 32.6096C55.4211 33.7604 57.3632 31.8892 58.5024 32.2915Z" fill="#3A3B45"></path><path d="M34.9454 32.2915C33.671 32.7415 33.164 35.3615 31.8766 34.6769C29.4384 33.3805 28.5128 30.353 29.8092 27.9148C31.1056 25.4767 34.1331 24.5511 36.5713 25.8475C39.0095 27.1439 39.9351 30.1714 38.6387 32.6096C38.0268 33.7604 36.0846 31.8892 34.9454 32.2915Z" fill="#3A3B45"></path><path d="M46.9619 56.289C56.7903 56.289 59.9619 47.5261 59.9619 43.0262C59.9619 40.6875 58.3898 41.4236 55.8718 42.6702C53.5449 43.8222 50.4102 45.4101 46.9619 45.4101C39.7822 45.4101 33.9619 38.5263 33.9619 43.0262C33.9619 47.5261 37.1334 56.289 46.9619 56.289Z" fill="#3A3B45"></path><mask id="mask0" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="33" y="41" width="27" height="16"><path d="M46.9619 56.289C56.7903 56.289 59.9619 47.5261 59.9619 43.0262C59.9619 40.6875 58.3898 41.4236 55.8718 42.6702C53.5449 43.8222 50.4102 45.4101 46.9619 45.4101C39.7822 45.4101 33.9619 38.5263 33.9619 43.0262C33.9619 47.5261 37.1334 56.289 46.9619 56.289Z" fill="white"></path></mask><g mask="url(#mask0)"><path d="M47.2119 66.5C52.0018 66.5 55.8848 62.617 55.8848 57.8271C55.8848 54.0962 53.5291 50.9156 50.224 49.6915C50.1023 49.6464 49.9794 49.604 49.8553 49.5643C49.0219 49.2979 48.1337 52.1623 47.2119 52.1623C46.3506 52.1623 45.5186 49.2797 44.7332 49.5135C41.151 50.5799 38.5389 53.8984 38.5389 57.8271C38.5389 62.617 42.4219 66.5 47.2119 66.5Z" fill="#F94040"></path></g><path d="M70.7119 37C72.5068 37 73.9619 35.5449 73.9619 33.75C73.9619 31.9551 72.5068 30.5 70.7119 30.5C68.9169 30.5 67.4619 31.9551 67.4619 33.75C67.4619 35.5449 68.9169 37 70.7119 37Z" fill="#FF9D0B"></path><path d="M24.2119 37C26.0068 37 27.4619 35.5449 27.4619 33.75C27.4619 31.9551 26.0068 30.5 24.2119 30.5C22.4169 30.5 20.9619 31.9551 20.9619 33.75C20.9619 35.5449 22.4169 37 24.2119 37Z" fill="#FF9D0B"></path><path class="origin-bottom-right transition-transform group-hover:-rotate-6" d="M17.5238 48C15.9048 48 14.4578 48.665 13.4488 49.871C12.8248 50.618 12.1728 51.822 12.1198 53.625C11.4408 53.43 10.7878 53.321 10.1778 53.321C8.6278 53.321 7.2278 53.915 6.2378 54.994C4.9658 56.379 4.4008 58.081 4.6468 59.784C4.7638 60.595 5.0348 61.322 5.4398 61.995C4.5858 62.686 3.9568 63.648 3.6528 64.805C3.4148 65.712 3.1708 67.601 4.4448 69.547C4.3638 69.674 4.2878 69.806 4.2168 69.941C3.4508 71.395 3.4018 73.038 4.0778 74.568C5.1028 76.887 7.6498 78.714 12.5958 80.675C15.6728 81.895 18.4878 82.675 18.5128 82.682C22.5808 83.737 26.2598 84.273 29.4448 84.273C35.2988 84.273 39.4898 82.48 41.9018 78.944C45.7838 73.25 45.2288 68.042 40.2058 63.022C37.4258 60.244 35.5778 56.148 35.1928 55.249C34.4168 52.587 32.3648 49.628 28.9538 49.628H28.9528C28.6658 49.628 28.3758 49.651 28.0898 49.696C26.5958 49.931 25.2898 50.791 24.3568 52.085C23.3498 50.833 22.3718 49.837 21.4868 49.275C20.1528 48.429 18.8198 48 17.5238 48ZM17.5238 52C18.0338 52 18.6568 52.217 19.3438 52.653C21.4768 54.006 25.5928 61.081 27.0998 63.833C27.6048 64.755 28.4678 65.145 29.2448 65.145C30.7868 65.145 31.9908 63.612 29.3858 61.664C25.4688 58.733 26.8428 53.942 28.7128 53.647C28.7948 53.634 28.8758 53.628 28.9538 53.628C30.6538 53.628 31.4038 56.558 31.4038 56.558C31.4038 56.558 33.6018 62.078 37.3778 65.851C41.1538 69.625 41.3488 72.654 38.5968 76.69C36.7198 79.442 33.1268 80.273 29.4448 80.273C25.6258 80.273 21.7108 79.379 19.5168 78.81C19.4088 78.782 6.0658 75.013 7.7558 71.805C8.0398 71.266 8.5078 71.05 9.0968 71.05C11.4768 71.05 15.8058 74.592 17.6668 74.592C18.0828 74.592 18.3758 74.415 18.4958 73.983C19.2888 71.138 6.4388 69.942 7.5218 65.821C7.7128 65.092 8.2308 64.796 8.9588 64.797C12.1038 64.797 19.1598 70.328 20.6388 70.328C20.7518 70.328 20.8328 70.295 20.8768 70.225C21.6178 69.029 21.2118 68.194 15.9888 65.033C10.7658 61.871 7.0998 59.969 9.1848 57.699C9.4248 57.437 9.7648 57.321 10.1778 57.321C13.3488 57.322 20.8408 64.14 20.8408 64.14C20.8408 64.14 22.8628 66.243 24.0858 66.243C24.3668 66.243 24.6058 66.132 24.7678 65.858C25.6348 64.396 16.7148 57.636 16.2118 54.847C15.8708 52.957 16.4508 52 17.5238 52Z" fill="#FF9D0B"></path><path class="origin-bottom-right transition-transform group-hover:-rotate-6" d="M38.5967 76.6898C41.3487 72.6538 41.1537 69.6248 37.3777 65.8508C33.6017 62.0778 31.4037 56.5578 31.4037 56.5578C31.4037 56.5578 30.5827 53.3518 28.7127 53.6468C26.8427 53.9418 25.4697 58.7328 29.3867 61.6638C33.3037 64.5938 28.6067 66.5848 27.0997 63.8328C25.5927 61.0808 21.4777 54.0058 19.3437 52.6528C17.2107 51.2998 15.7087 52.0578 16.2117 54.8468C16.7147 57.6358 25.6357 64.3958 24.7677 65.8588C23.8997 67.3208 20.8407 64.1398 20.8407 64.1398C20.8407 64.1398 11.2687 55.4288 9.18465 57.6988C7.10065 59.9688 10.7657 61.8708 15.9887 65.0328C21.2127 68.1938 21.6177 69.0288 20.8767 70.2248C20.1347 71.4208 8.60465 61.6998 7.52165 65.8208C6.43965 69.9418 19.2887 71.1378 18.4957 73.9828C17.7027 76.8288 9.44465 68.5978 7.75565 71.8048C6.06565 75.0128 19.4087 78.7818 19.5167 78.8098C23.8267 79.9278 34.7727 82.2968 38.5967 76.6898Z" fill="#FFD21E"></path><path class="origin-bottom-left transition-transform group-hover:rotate-6" d="M77.3999 48C79.0189 48 80.4659 48.665 81.4749 49.871C82.0989 50.618 82.7509 51.822 82.8039 53.625C83.4829 53.43 84.1359 53.321 84.7459 53.321C86.2959 53.321 87.6959 53.915 88.6859 54.994C89.9579 56.379 90.5229 58.081 90.2769 59.784C90.1599 60.595 89.8889 61.322 89.4839 61.995C90.3379 62.686 90.9669 63.648 91.2709 64.805C91.5089 65.712 91.7529 67.601 90.4789 69.547C90.5599 69.674 90.6359 69.806 90.7069 69.941C91.4729 71.395 91.5219 73.038 90.8459 74.568C89.8209 76.887 87.2739 78.714 82.3279 80.675C79.2509 81.895 76.4359 82.675 76.4109 82.682C72.3429 83.737 68.6639 84.273 65.4789 84.273C59.6249 84.273 55.4339 82.48 53.0219 78.944C49.1399 73.25 49.6949 68.042 54.7179 63.022C57.4979 60.244 59.3459 56.148 59.7309 55.249C60.5069 52.587 62.5589 49.628 65.9699 49.628H65.9709C66.2579 49.628 66.5479 49.651 66.8339 49.696C68.3279 49.931 69.6339 50.791 70.5669 52.085C71.5739 50.833 72.5519 49.837 73.4369 49.275C74.7709 48.429 76.1039 48 77.3999 48ZM77.3999 52C76.8899 52 76.2669 52.217 75.5799 52.653C73.4469 54.006 69.3309 61.081 67.8239 63.833C67.3189 64.755 66.4559 65.145 65.6789 65.145C64.1369 65.145 62.9329 63.612 65.5379 61.664C69.4549 58.733 68.0809 53.942 66.2109 53.647C66.1289 53.634 66.0479 53.628 65.9699 53.628C64.2699 53.628 63.5199 56.558 63.5199 56.558C63.5199 56.558 61.3219 62.078 57.5459 65.851C53.7699 69.625 53.5749 72.654 56.3269 76.69C58.2039 79.442 61.7969 80.273 65.4789 80.273C69.2979 80.273 73.2129 79.379 75.4069 78.81C75.5149 78.782 88.8579 75.013 87.1679 71.805C86.8839 71.266 86.4159 71.05 85.8269 71.05C83.4469 71.05 79.1179 74.592 77.2569 74.592C76.8409 74.592 76.5479 74.415 76.4279 73.983C75.6349 71.138 88.4849 69.942 87.4019 65.821C87.2109 65.092 86.6929 64.796 85.9649 64.797C82.8199 64.797 75.7639 70.328 74.2849 70.328C74.1719 70.328 74.0909 70.295 74.0469 70.225C73.3059 69.029 73.7119 68.194 78.9349 65.033C84.1579 61.871 87.8239 59.969 85.7389 57.699C85.4989 57.437 85.1589 57.321 84.7459 57.321C81.5749 57.322 74.0829 64.14 74.0829 64.14C74.0829 64.14 72.0609 66.243 70.8379 66.243C70.5569 66.243 70.3179 66.132 70.1559 65.858C69.2889 64.396 78.2089 57.636 78.7119 54.847C79.0529 52.957 78.4729 52 77.3999 52Z" fill="#FF9D0B"></path><path class="origin-bottom-left transition-transform group-hover:rotate-6" d="M56.3271 76.6898C53.5751 72.6538 53.7701 69.6248 57.5461 65.8508C61.3221 62.0778 63.5201 56.5578 63.5201 56.5578C63.5201 56.5578 64.3411 53.3518 66.2111 53.6468C68.0811 53.9418 69.4541 58.7328 65.5371 61.6638C61.6201 64.5938 66.3171 66.5848 67.8241 63.8328C69.3311 61.0808 73.4461 54.0058 75.5801 52.6528C77.7131 51.2998 79.2151 52.0578 78.7121 54.8468C78.2091 57.6358 69.2881 64.3958 70.1561 65.8588C71.0241 67.3208 74.0831 64.1398 74.0831 64.1398C74.0831 64.1398 83.6551 55.4288 85.7391 57.6988C87.8231 59.9688 84.1581 61.8708 78.9351 65.0328C73.7111 68.1938 73.3061 69.0288 74.0471 70.2248C74.7891 71.4208 86.3191 61.6998 87.4021 65.8208C88.4841 69.9418 75.6351 71.1378 76.4281 73.9828C77.2211 76.8288 85.4791 68.5978 87.1681 71.8048C88.8581 75.0128 75.5151 78.7818 75.4071 78.8098C71.0971 79.9278 60.1511 82.2968 56.3271 76.6898Z" fill="#FFD21E"></path></svg></a>
		<div class="max-md:mt-8! font-semibold text-black md:hidden">Website</div>

		<a class="hover:underline" href="/models">Models</a>
		<a class="hover:underline" href="/datasets">Datasets</a>
		<a class="hover:underline" href="/spaces">Spaces</a>
		<a class="hover:underline" href="/pricing">Pricing</a>
		<a class="hover:underline" href="/docs">Docs</a></nav></footer></div>

		<script>
			import("\/front\/build\/kube-68d7aa0\/index.js");
			window.moonSha = "kube-68d7aa0\/";
			window.__hf_deferred = {};
		</script>

		<!-- Stripe -->
		<script>
			if (["hf.co", "huggingface.co"].includes(window.location.hostname)) {
				const script = document.createElement("script");
				script.src = "https://js.stripe.com/v3/";
				script.async = true;
				document.head.appendChild(script);
			}
		</script>
	</body>
</html>
